{"file_contents":{"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","path":null,"size_bytes":791,"size_tokens":null},"server/upload.ts":{"content":"import multer from \"multer\";\nimport path from \"path\";\nimport { promises as fs } from \"fs\";\n\n// Ensure uploads directory exists\nconst UPLOAD_DIR = path.join(process.cwd(), \"uploads\");\n\nasync function ensureUploadDir() {\n  try {\n    await fs.access(UPLOAD_DIR);\n  } catch {\n    await fs.mkdir(UPLOAD_DIR, { recursive: true });\n  }\n}\n\n// Initialize upload directory\nensureUploadDir();\n\n// Configure storage\nconst storage = multer.diskStorage({\n  destination: async (req, file, cb) => {\n    await ensureUploadDir();\n    cb(null, UPLOAD_DIR);\n  },\n  filename: (req, file, cb) => {\n    // Create unique filename with timestamp\n    const uniqueSuffix = Date.now() + '-' + Math.round(Math.random() * 1E9);\n    const ext = path.extname(file.originalname);\n    cb(null, file.fieldname + '-' + uniqueSuffix + ext);\n  }\n});\n\n// File filter - only allow images and documents\nconst fileFilter = (req: any, file: Express.Multer.File, cb: multer.FileFilterCallback) => {\n  const allowedMimes = [\n    'image/jpeg',\n    'image/png',\n    'image/gif',\n    'image/webp',\n    'application/pdf',\n    'application/msword',\n    'application/vnd.openxmlformats-officedocument.wordprocessingml.document'\n  ];\n  \n  if (allowedMimes.includes(file.mimetype)) {\n    cb(null, true);\n  } else {\n    cb(new Error('Invalid file type. Only images and documents are allowed.'));\n  }\n};\n\n// Create multer instance\nexport const upload = multer({\n  storage,\n  fileFilter,\n  limits: {\n    fileSize: 10 * 1024 * 1024, // 10MB max\n  }\n});\n\n// Helper to get media type from mimetype\nexport function getMediaType(mimetype: string): string {\n  if (mimetype.startsWith('image/')) return 'image';\n  if (mimetype === 'application/pdf') return 'document';\n  if (mimetype.includes('word')) return 'document';\n  return 'file';\n}\n","path":null,"size_bytes":1777,"size_tokens":null},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","path":null,"size_bytes":329,"size_tokens":null},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    // h-9 to match icon buttons and default buttons.\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","path":null,"size_bytes":844,"size_tokens":null},"client/src/components/app-sidebar.tsx":{"content":"import { Home, Calendar, Users, Settings, BookOpen, User, LogOut, Shield, GraduationCap, Newspaper, Heart } from \"lucide-react\";\nimport { Link, useLocation } from \"wouter\";\nimport {\n  Sidebar,\n  SidebarContent,\n  SidebarGroup,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarMenu,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarFooter,\n} from \"@/components/ui/sidebar\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ntype User = {\n  id: string;\n  name: string;\n  email: string;\n  role: string;\n  credibilityScore: number;\n  reputationScore: number;\n  accountStatus: string;\n  avatarUrl?: string;\n  bio?: string;\n};\n\nconst mainNavItems = [\n  {\n    title: \"Home\",\n    url: \"/\",\n    icon: Home,\n  },\n  {\n    title: \"News\",\n    url: \"/news\",\n    icon: Newspaper,\n  },\n  {\n    title: \"Grades\",\n    url: \"/grades\",\n    icon: GraduationCap,\n  },\n  {\n    title: \"Events\",\n    url: \"/events\",\n    icon: Calendar,\n  },\n  {\n    title: \"Teachers\",\n    url: \"/teachers\",\n    icon: Users,\n  },\n  {\n    title: \"Schedule\",\n    url: \"/schedule\",\n    icon: BookOpen,\n  },\n];\n\nconst adminNavItems = [\n  {\n    title: \"Admin Management\",\n    url: \"/admin\",\n    icon: Shield,\n  },\n];\n\nconst bottomNavItems = [\n  {\n    title: \"Profile\",\n    url: \"/profile\",\n    icon: User,\n  },\n  {\n    title: \"Settings\",\n    url: \"/settings\",\n    icon: Settings,\n  },\n  {\n    title: \"Support\",\n    url: \"/support\",\n    icon: Heart,\n  },\n];\n\nexport function AppSidebar() {\n  const [location, navigate] = useLocation();\n  const { toast } = useToast();\n\n  const { data: user } = useQuery<User>({\n    queryKey: [\"/api/auth/me\"],\n  });\n\n  const logoutMutation = useMutation({\n    mutationFn: async () => {\n      await apiRequest(\"POST\", \"/api/auth/logout\");\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/auth/me\"] });\n      toast({\n        title: \"Logged out successfully\",\n      });\n      navigate(\"/auth\");\n    },\n  });\n\n  const handleLogout = () => {\n    logoutMutation.mutate();\n  };\n\n  const getUserInitials = (name: string) => {\n    return name\n      .split(\" \")\n      .map((n) => n[0])\n      .join(\"\")\n      .toUpperCase()\n      .slice(0, 2);\n  };\n\n  return (\n    <Sidebar data-testid=\"sidebar-main\" className=\"border-r border-border/50\">\n      <SidebarContent className=\"space-y-4\">\n        {/* Logo/Branding */}\n        <div className=\"px-4 py-3 flex items-center gap-2\">\n          <div className=\"w-8 h-8 rounded-lg bg-gradient-to-br from-primary to-secondary flex items-center justify-center\">\n            <span className=\"text-white font-bold text-sm\">SC</span>\n          </div>\n          <div>\n            <h1 className=\"font-bold text-sm\">School Community</h1>\n            <p className=\"text-xs text-muted-foreground\">Connected & Engaged</p>\n          </div>\n        </div>\n\n        <SidebarGroup>\n          <SidebarGroupLabel className=\"text-xs font-bold uppercase tracking-wider px-2\">Navigation</SidebarGroupLabel>\n          <SidebarGroupContent>\n            <SidebarMenu className=\"space-y-1\">\n              {mainNavItems\n                .filter((item) => {\n                  if (user?.role === \"visitor\" && item.title === \"Schedule\") {\n                    return false;\n                  }\n                  return true;\n                })\n                .map((item) => (\n                  <SidebarMenuItem key={item.title}>\n                    <SidebarMenuButton\n                      asChild\n                      data-testid={`nav-${item.title.toLowerCase()}`}\n                      className={`transition-all ${\n                        location === item.url \n                          ? \"bg-gradient-to-r from-primary/20 to-secondary/20 text-primary font-semibold rounded-lg\" \n                          : \"hover:bg-background/50\"\n                      }`}\n                    >\n                      <Link href={item.url} className=\"flex items-center gap-3\">\n                        <item.icon className=\"w-4 h-4\" />\n                        <span className=\"text-sm\">{item.title}</span>\n                      </Link>\n                    </SidebarMenuButton>\n                  </SidebarMenuItem>\n                ))}\n            </SidebarMenu>\n          </SidebarGroupContent>\n        </SidebarGroup>\n\n        {user?.role === \"admin\" && (\n          <SidebarGroup>\n            <SidebarGroupLabel className=\"text-xs font-bold uppercase tracking-wider px-2\">Administration</SidebarGroupLabel>\n            <SidebarGroupContent>\n              <SidebarMenu className=\"space-y-1\">\n                {adminNavItems.map((item) => (\n                  <SidebarMenuItem key={item.title}>\n                    <SidebarMenuButton\n                      asChild\n                      data-testid={`nav-${item.title.toLowerCase().replace(\" \", \"-\")}`}\n                      className={`transition-all ${\n                        location === item.url \n                          ? \"bg-gradient-to-r from-amber-500/20 to-orange-500/20 text-amber-600 dark:text-amber-400 font-semibold rounded-lg\" \n                          : \"hover:bg-background/50\"\n                      }`}\n                    >\n                      <Link href={item.url} className=\"flex items-center gap-3\">\n                        <item.icon className=\"w-4 h-4\" />\n                        <span className=\"text-sm\">{item.title}</span>\n                      </Link>\n                    </SidebarMenuButton>\n                  </SidebarMenuItem>\n                ))}\n              </SidebarMenu>\n            </SidebarGroupContent>\n          </SidebarGroup>\n        )}\n\n        <SidebarGroup>\n          <SidebarGroupLabel className=\"text-xs font-bold uppercase tracking-wider px-2\">Account</SidebarGroupLabel>\n          <SidebarGroupContent>\n            <SidebarMenu className=\"space-y-1\">\n              {bottomNavItems\n                .filter((item) => {\n                  if (user?.role === \"visitor\" && item.title === \"Profile\") {\n                    return false;\n                  }\n                  return true;\n                })\n                .map((item) => (\n                  <SidebarMenuItem key={item.title}>\n                    <SidebarMenuButton\n                      asChild\n                      data-testid={`nav-${item.title.toLowerCase()}`}\n                      className={`transition-all ${\n                        location === item.url \n                          ? \"bg-gradient-to-r from-primary/20 to-secondary/20 text-primary font-semibold rounded-lg\" \n                          : \"hover:bg-background/50\"\n                      }`}\n                    >\n                      <Link href={item.url} className=\"flex items-center gap-3\">\n                        <item.icon className=\"w-4 h-4\" />\n                        <span className=\"text-sm\">{item.title}</span>\n                      </Link>\n                    </SidebarMenuButton>\n                  </SidebarMenuItem>\n                ))}\n            </SidebarMenu>\n          </SidebarGroupContent>\n        </SidebarGroup>\n      </SidebarContent>\n\n      {user && (\n        <SidebarFooter>\n          <div className=\"flex flex-col gap-3 p-4 border-t border-border/50 rounded-t-lg bg-background/50 dark:bg-background/30\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"relative\">\n                <Avatar className=\"w-10 h-10 ring-2 ring-primary/20\">\n                  <AvatarFallback className=\"bg-gradient-to-br from-primary to-secondary text-white font-bold\">\n                    {getUserInitials(user.name)}\n                  </AvatarFallback>\n                </Avatar>\n                {user.role === \"admin\" && (\n                  <div className=\"absolute -top-1 -right-1 w-4 h-4 bg-gradient-to-br from-amber-400 to-orange-500 rounded-full flex items-center justify-center text-[10px] font-bold text-white\">\n                    ★\n                  </div>\n                )}\n              </div>\n              <div className=\"flex-1 min-w-0\">\n                <p className=\"text-sm font-semibold truncate\" data-testid=\"text-username\">\n                  {user.name}\n                </p>\n                <div className=\"flex items-center gap-2 mt-1\">\n                  <Badge variant=\"outline\" className=\"text-[0.65rem]\">\n                    {user.role}\n                  </Badge>\n                  <span className=\"text-xs text-muted-foreground font-medium\">\n                    {(user.credibilityScore ?? 0).toFixed(0)}⭐\n                  </span>\n                </div>\n              </div>\n            </div>\n            <button\n              onClick={handleLogout}\n              data-testid=\"button-logout\"\n              className=\"flex items-center justify-center gap-2 w-full px-3 py-2 text-sm rounded-lg hover-elevate active-elevate-2 bg-destructive/10 hover:bg-destructive/20 text-destructive font-medium transition-colors\"\n            >\n              <LogOut className=\"w-4 h-4\" />\n              <span>Logout</span>\n            </button>\n          </div>\n        </SidebarFooter>\n      )}\n    </Sidebar>\n  );\n}\n","path":null,"size_bytes":9241,"size_tokens":null},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","path":null,"size_bytes":772,"size_tokens":null},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","path":null,"size_bytes":2751,"size_tokens":null},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\" +\n  \" hover-elevate active-elevate-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"bg-primary text-primary-foreground border border-primary-border\",\n        destructive:\n          \"bg-destructive text-destructive-foreground border border-destructive-border\",\n        outline:\n          // Shows the background color of whatever card / sidebar / accent background it is inside of.\n          // Inherits the current text color.\n          \" border [border-color:var(--button-outline)]  shadow-xs active:shadow-none \",\n        secondary: \"border bg-secondary text-secondary-foreground border border-secondary-border \",\n        // Add a transparent border so that when someone toggles a border on later, it doesn't shift layout/size.\n        ghost: \"border border-transparent\",\n      },\n      // Heights are set as \"min\" heights, because sometimes Ai will place large amount of content\n      // inside buttons. With a min-height they will look appropriate with small amounts of content,\n      // but will expand to fit large amounts of content.\n      size: {\n        default: \"min-h-9 px-4 py-2\",\n        sm: \"min-h-8 rounded-md px-3 text-xs\",\n        lg: \"min-h-10 rounded-md px-8\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  },\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","path":null,"size_bytes":2359,"size_tokens":null},"shared/schema.ts":{"content":"import { sql } from \"drizzle-orm\";\nimport { pgTable, text, varchar, integer, timestamp, boolean, real, pgEnum, unique } from \"drizzle-orm/pg-core\";\nimport { relations } from \"drizzle-orm\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\n// Enums\nexport const userRoleEnum = pgEnum(\"user_role\", [\"student\", \"admin\", \"visitor\"]);\nexport const accountStatusEnum = pgEnum(\"account_status\", [\"active\", \"threatened\", \"suspended\"]);\nexport const scopeTypeEnum = pgEnum(\"scope_type\", [\"grade\", \"section\", \"public\"]);\nexport const eventTypeEnum = pgEnum(\"event_type\", [\"curricular\", \"extracurricular\"]);\nexport const friendStatusEnum = pgEnum(\"friend_status\", [\"pending\", \"accepted\", \"rejected\"]);\nexport const violationTypeEnum = pgEnum(\"violation_type\", [\"spam\", \"offensive\", \"hate_speech\", \"harassment\", \"inappropriate\"]);\nexport const violationSeverityEnum = pgEnum(\"violation_severity\", [\"low\", \"medium\", \"high\", \"critical\"]);\nexport const detectionSourceEnum = pgEnum(\"detection_source\", [\"ai\", \"user_report\", \"admin\"]);\nexport const punishmentTypeEnum = pgEnum(\"punishment_type\", [\"warning\", \"credibility_reduction\", \"temp_ban\", \"permanent_ban\"]);\n\n// Users table with reputation and credibility\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  \n  // Authentication fields\n  username: text(\"username\").notNull().unique(), // 2-5 names, letters/periods/hyphens/commas only\n  studentId: text(\"student_id\").notNull().unique(), // Admin-assigned ID required for registration\n  email: text(\"email\").notNull().unique(),\n  phone: text(\"phone\"),\n  password: text(\"password\").notNull(),\n  name: text(\"name\").notNull(),\n  role: userRoleEnum(\"role\").notNull().default(\"student\"),\n  isSpecialAdmin: boolean(\"is_special_admin\").notNull().default(false), // For initial admin accounts\n  \n  // Grade and Class assignment (for students)\n  grade: integer(\"grade\"), // 1-6 for grades 1-6, null for admins\n  className: text(\"class_name\"), // e.g., \"A\", \"B\", \"C\", \"D\", null for admins\n  \n  // Gamification fields\n  credibilityScore: real(\"credibility_score\").notNull().default(50.0), // 0-100 scale\n  reputationScore: real(\"reputation_score\").notNull().default(0.0),\n  accountStatus: accountStatusEnum(\"account_status\").notNull().default(\"active\"),\n  \n  // Optional user details (private)\n  transportDetails: text(\"transport_details\"),\n  \n  // Avatar & bio\n  avatarUrl: text(\"avatar_url\"),\n  bio: text(\"bio\"),\n  \n  // Hobbies (max 5)\n  hobbies: text(\"hobbies\").array(),\n  \n  // Hexagon Tendency Charts - 3 hexagons with 6 metrics each\n  // Total points per hexagon: 24, each metric max: 10\n  \n  // Social Personality Hexagon (6 metrics)\n  empathy: integer(\"empathy\").default(4),\n  angerManagement: integer(\"anger_management\").default(4),\n  cooperation: integer(\"cooperation\").default(4),\n  selfConfidence: integer(\"self_confidence\").default(4),\n  acceptingCriticism: integer(\"accepting_criticism\").default(4),\n  listening: integer(\"listening\").default(4),\n  \n  // Skills & Abilities Hexagon (6 metrics)\n  problemSolving: integer(\"problem_solving\").default(4),\n  creativity: integer(\"creativity\").default(4),\n  memoryFocus: integer(\"memory_focus\").default(4),\n  planningOrganization: integer(\"planning_organization\").default(4),\n  communicationExpression: integer(\"communication_expression\").default(4),\n  leadershipInitiative: integer(\"leadership_initiative\").default(4),\n  \n  // Interests Hexagon (6 metrics)\n  artisticCreative: integer(\"artistic_creative\").default(4),\n  athleticPhysical: integer(\"athletic_physical\").default(4),\n  technicalTech: integer(\"technical_tech\").default(4),\n  linguisticReading: integer(\"linguistic_reading\").default(4),\n  socialHumanitarian: integer(\"social_humanitarian\").default(4),\n  naturalEnvironmental: integer(\"natural_environmental\").default(4),\n  \n  // Metadata\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n  updatedAt: timestamp(\"updated_at\").notNull().defaultNow(),\n});\n\n// Scopes define the three-tier access system: public (square), grade, and section (class)\nexport const scopes = pgTable(\"scopes\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  name: text(\"name\").notNull(),\n  type: scopeTypeEnum(\"type\").notNull(),\n  gradeNumber: integer(\"grade_number\"), // 1-6 for grade scopes, null for section/public\n  sectionName: text(\"section_name\"), // e.g., \"1-A\" for class sections, null for grades/public\n  accessCode: text(\"access_code\"), // null for public scope, otherwise required and unique\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\n// Digital Keys - stores unlocked scopes per user (key persistence)\nexport const digitalKeys = pgTable(\"digital_keys\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  scopeId: varchar(\"scope_id\").notNull().references(() => scopes.id, { onDelete: \"cascade\" }),\n  unlockedAt: timestamp(\"unlocked_at\").notNull().defaultNow(),\n});\n\n// Admin Succession history\nexport const adminSuccessions = pgTable(\"admin_successions\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  previousAdminId: varchar(\"previous_admin_id\").notNull().references(() => users.id),\n  newAdminId: varchar(\"new_admin_id\").notNull().references(() => users.id),\n  handoverDate: timestamp(\"handover_date\").notNull().defaultNow(),\n  notes: text(\"notes\"),\n});\n\n// Admin Student IDs - Username + ID pairs that can be assigned to new students\nexport const adminStudentIds = pgTable(\"admin_student_ids\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  username: text(\"username\").notNull().unique(), // The pre-assigned username (e.g., \"John.Smith\"), must be unique\n  studentId: text(\"student_id\").notNull().unique(), // The auto-generated random ID\n  grade: integer(\"grade\").notNull(), // 1-6 for grades\n  className: text(\"class_name\").notNull(), // e.g., \"A\", \"B\", \"C\", \"D\"\n  isAssigned: boolean(\"is_assigned\").notNull().default(false), // Whether this ID has been used\n  assignedToUserId: varchar(\"assigned_to_user_id\").references(() => users.id), // Which user claimed this ID\n  createdByAdminId: varchar(\"created_by_admin_id\").notNull().references(() => users.id),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n  assignedAt: timestamp(\"assigned_at\"),\n});\n\n// Posts with credibility and scope\nexport const posts = pgTable(\"posts\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  authorId: varchar(\"author_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  scopeId: varchar(\"scope_id\").references(() => scopes.id), // null for public square\n  \n  // Content\n  content: text(\"content\").notNull(),\n  mediaUrl: text(\"media_url\"), // for images, audio, etc.\n  mediaType: text(\"media_type\"), // 'image', 'audio', 'gif', etc.\n  \n  // Credibility\n  credibilityRating: real(\"credibility_rating\").notNull().default(50.0), // 0-100 scale\n  \n  // Engagement\n  likesCount: integer(\"likes_count\").notNull().default(0),\n  commentsCount: integer(\"comments_count\").notNull().default(0),\n  \n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n  updatedAt: timestamp(\"updated_at\").notNull().defaultNow(),\n});\n\n// Post Reactions (likes)\nexport const postReactions = pgTable(\"post_reactions\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  postId: varchar(\"post_id\").notNull().references(() => posts.id, { onDelete: \"cascade\" }),\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n}, (table) => ({\n  uniquePostUser: unique().on(table.postId, table.userId),\n}));\n\n// Events with RSVP tracking\nexport const events = pgTable(\"events\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  title: text(\"title\").notNull(),\n  description: text(\"description\"),\n  eventType: eventTypeEnum(\"event_type\").notNull(),\n  scopeId: varchar(\"scope_id\").references(() => scopes.id),\n  \n  startTime: timestamp(\"start_time\").notNull(),\n  endTime: timestamp(\"end_time\"),\n  location: text(\"location\"),\n  \n  imageUrl: text(\"image_url\"),\n  \n  createdById: varchar(\"created_by_id\").notNull().references(() => users.id),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\n// Event RSVPs\nexport const eventRsvps = pgTable(\"event_rsvps\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  eventId: varchar(\"event_id\").notNull().references(() => events.id, { onDelete: \"cascade\" }),\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  rsvpedAt: timestamp(\"rsvped_at\").notNull().defaultNow(),\n}, (table) => ({\n  uniqueEventUser: unique().on(table.eventId, table.userId),\n}));\n\n// Schedules (class timetables)\nexport const schedules = pgTable(\"schedules\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  scopeId: varchar(\"scope_id\").notNull().references(() => scopes.id), // Must be section level\n  \n  dayOfWeek: integer(\"day_of_week\").notNull(), // 1-7 (Monday-Sunday)\n  periodNumber: integer(\"period_number\").notNull(), // 1-7\n  \n  teacherName: text(\"teacher_name\"),\n  subject: text(\"subject\"),\n  \n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n  updatedAt: timestamp(\"updated_at\").notNull().defaultNow(),\n});\n\n// Teachers\nexport const teachers = pgTable(\"teachers\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id),\n  \n  name: text(\"name\").notNull(),\n  photoUrl: text(\"photo_url\"),\n  description: text(\"description\"), // Admin-written description of the teacher\n  academicAchievements: text(\"academic_achievements\").array(), // Degrees, certifications, awards\n  \n  // Subject and section management\n  subjects: text(\"subjects\").array(), // e.g., [\"Math\", \"Physics\"]\n  sections: text(\"sections\").array(), // e.g., [\"1-A\", \"1-B\", \"2-A\"]\n  \n  // Dynamic data\n  classroomRules: text(\"classroom_rules\").array(),\n  \n  // Admin-only notes (visible only to admins)\n  adminNotes: text(\"admin_notes\"),\n  \n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n  updatedAt: timestamp(\"updated_at\").notNull().defaultNow(),\n});\n\n// Settings - for application-wide configuration\nexport const settings = pgTable(\"settings\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  key: text(\"key\").notNull().unique(), // e.g., \"donationUrl\"\n  value: text(\"value\"), // The actual value (e.g., URL to donation page)\n  updatedAt: timestamp(\"updated_at\").notNull().defaultNow(),\n});\n\n// Password Reset Tokens for password recovery\nexport const passwordResetTokens = pgTable(\"password_reset_tokens\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  token: text(\"token\").notNull().unique(), // Random secure token\n  expiresAt: timestamp(\"expires_at\").notNull(), // Token expires after 1 hour\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\n// Failed Login Attempts - Track login failures for rate limiting (3 attempts max)\nexport const failedLoginAttempts = pgTable(\"failed_login_attempts\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  username: text(\"username\").notNull(), // Track by username (not userId since user might not exist)\n  attemptCount: integer(\"attempt_count\").notNull().default(1),\n  lastAttemptAt: timestamp(\"last_attempt_at\").notNull().defaultNow(),\n  lockedUntil: timestamp(\"locked_until\"), // Account locked until this time (null if not locked)\n});\n\n// Remember Me Tokens - Device tracking for \"remember me\" functionality\nexport const rememberMeTokens = pgTable(\"remember_me_tokens\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  token: text(\"token\").notNull().unique(), // Secure random token stored in cookie\n  deviceFingerprint: text(\"device_fingerprint\"), // Optional device identifier\n  lastUsedAt: timestamp(\"last_used_at\").notNull().defaultNow(), // Track last activity\n  expiresAt: timestamp(\"expires_at\").notNull(), // Token expires after 7 days of inactivity\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\n// Teacher Reviews\nexport const teacherReviews = pgTable(\"teacher_reviews\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  teacherId: varchar(\"teacher_id\").notNull().references(() => teachers.id, { onDelete: \"cascade\" }),\n  studentId: varchar(\"student_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  \n  rating: integer(\"rating\").notNull(), // 1-5 stars\n  comment: text(\"comment\"),\n  \n  isModerated: boolean(\"is_moderated\").notNull().default(false),\n  moderatedById: varchar(\"moderated_by_id\").references(() => users.id),\n  \n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n}, (table) => ({\n  uniqueTeacherStudent: unique().on(table.teacherId, table.studentId),\n}));\n\n// Teacher Feedback - detailed rating system\nexport const teacherFeedback = pgTable(\"teacher_feedback\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  teacherId: varchar(\"teacher_id\").notNull().references(() => teachers.id, { onDelete: \"cascade\" }),\n  studentId: varchar(\"student_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  \n  // 6 rating questions (1-5 scale each)\n  clarity: integer(\"clarity\").notNull(), // Clarity of Instruction\n  instruction: integer(\"instruction\").notNull(), // Quality of Instruction\n  communication: integer(\"communication\").notNull(), // Communication Skills\n  patience: integer(\"patience\").notNull(), // Patience & Understanding\n  motivation: integer(\"motivation\").notNull(), // Student Motivation\n  improvement: integer(\"improvement\").notNull(), // Encourages Improvement\n  \n  notes: text(\"notes\"), // Optional additional notes\n  \n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n}, (table) => ({\n  uniqueTeacherStudent: unique().on(table.teacherId, table.studentId),\n}));\n\n// Post Accuracy Ratings - users rate post accuracy (1-5 stars)\nexport const postAccuracyRatings = pgTable(\"post_accuracy_ratings\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  postId: varchar(\"post_id\").notNull().references(() => posts.id, { onDelete: \"cascade\" }),\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  \n  rating: integer(\"rating\").notNull(), // 1-5 stars, default 3\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n  updatedAt: timestamp(\"updated_at\").notNull().defaultNow(),\n}, (table) => ({\n  uniqueUserPost: unique().on(table.postId, table.userId),\n}));\n\n// Post Comments\nexport const postComments = pgTable(\"post_comments\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  postId: varchar(\"post_id\").notNull().references(() => posts.id, { onDelete: \"cascade\" }),\n  authorId: varchar(\"author_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  \n  content: text(\"content\").notNull(),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\n// Event Comments\nexport const eventComments = pgTable(\"event_comments\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  eventId: varchar(\"event_id\").notNull().references(() => events.id, { onDelete: \"cascade\" }),\n  authorId: varchar(\"author_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  \n  content: text(\"content\").notNull(),\n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\n// Profile Comments - user-to-user comments/reviews\nexport const profileComments = pgTable(\"profile_comments\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  profileUserId: varchar(\"profile_user_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }), // Whose profile\n  authorId: varchar(\"author_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }), // Who wrote it\n  \n  content: text(\"content\").notNull(),\n  rating: integer(\"rating\"), // Optional 1-5 stars\n  \n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\n// Friendships - user-to-user friend connections\nexport const friendships = pgTable(\"friendships\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  user1Id: varchar(\"user1_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }), // Lower ID always goes here\n  user2Id: varchar(\"user2_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }), // Higher ID always goes here\n  initiatorId: varchar(\"initiator_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }), // Who sent the request\n  status: friendStatusEnum(\"status\").notNull().default(\"pending\"),\n  \n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n  updatedAt: timestamp(\"updated_at\").notNull().defaultNow(),\n}, (table) => ({\n  uniqueFriendship: unique().on(table.user1Id, table.user2Id),\n}));\n\n// Chat Messages - direct messages between friends\nexport const chatMessages = pgTable(\"chat_messages\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  senderId: varchar(\"sender_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  receiverId: varchar(\"receiver_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  \n  content: text(\"content\").notNull(),\n  isRead: boolean(\"is_read\").notNull().default(false),\n  \n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\n// Content Violations - AI-detected or user-reported violations\nexport const contentViolations = pgTable(\"content_violations\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  contentType: text(\"content_type\").notNull(), // 'post', 'chat_message', 'profile_comment', etc.\n  contentId: varchar(\"content_id\").notNull(), // ID of the violating content\n  authorId: varchar(\"author_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }), // Who created the violating content\n  \n  violationType: violationTypeEnum(\"violation_type\").notNull(),\n  severity: violationSeverityEnum(\"severity\").notNull(),\n  detectedBy: detectionSourceEnum(\"detected_by\").notNull(),\n  aiConfidence: real(\"ai_confidence\"), // 0-1 scale, null if not AI-detected\n  aiReasoning: text(\"ai_reasoning\"), // AI explanation of why it's a violation\n  \n  reportedById: varchar(\"reported_by_id\").references(() => users.id), // If user-reported\n  \n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\n// User Punishments - automatic punishments based on violations\nexport const userPunishments = pgTable(\"user_punishments\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  violationId: varchar(\"violation_id\").references(() => contentViolations.id, { onDelete: \"set null\" }),\n  \n  punishmentType: punishmentTypeEnum(\"punishment_type\").notNull(),\n  credibilityPenalty: real(\"credibility_penalty\").notNull().default(0), // Amount credibility reduced\n  banUntil: timestamp(\"ban_until\"), // Null if not a ban, otherwise when ban expires\n  notes: text(\"notes\"), // Admin notes or automated reasoning\n  \n  createdAt: timestamp(\"created_at\").notNull().defaultNow(),\n});\n\n\n// Relations\nexport const usersRelations = relations(users, ({ many }) => ({\n  posts: many(posts),\n  digitalKeys: many(digitalKeys),\n  events: many(events),\n  eventRsvps: many(eventRsvps),\n  teacherReviews: many(teacherReviews),\n  profileComments: many(profileComments, { relationName: \"profileComments\" }),\n  authoredComments: many(profileComments, { relationName: \"authoredComments\" }),\n}));\n\nexport const scopesRelations = relations(scopes, ({ many }) => ({\n  digitalKeys: many(digitalKeys),\n  posts: many(posts),\n  events: many(events),\n  schedules: many(schedules),\n}));\n\nexport const digitalKeysRelations = relations(digitalKeys, ({ one }) => ({\n  user: one(users, {\n    fields: [digitalKeys.userId],\n    references: [users.id],\n  }),\n  scope: one(scopes, {\n    fields: [digitalKeys.scopeId],\n    references: [scopes.id],\n  }),\n}));\n\nexport const postsRelations = relations(posts, ({ one, many }) => ({\n  author: one(users, {\n    fields: [posts.authorId],\n    references: [users.id],\n  }),\n  scope: one(scopes, {\n    fields: [posts.scopeId],\n    references: [scopes.id],\n  }),\n  reactions: many(postReactions),\n}));\n\nexport const postReactionsRelations = relations(postReactions, ({ one }) => ({\n  post: one(posts, {\n    fields: [postReactions.postId],\n    references: [posts.id],\n  }),\n  user: one(users, {\n    fields: [postReactions.userId],\n    references: [users.id],\n  }),\n}));\n\nexport const eventsRelations = relations(events, ({ one, many }) => ({\n  createdBy: one(users, {\n    fields: [events.createdById],\n    references: [users.id],\n  }),\n  scope: one(scopes, {\n    fields: [events.scopeId],\n    references: [scopes.id],\n  }),\n  rsvps: many(eventRsvps),\n}));\n\nexport const eventRsvpsRelations = relations(eventRsvps, ({ one }) => ({\n  event: one(events, {\n    fields: [eventRsvps.eventId],\n    references: [events.id],\n  }),\n  user: one(users, {\n    fields: [eventRsvps.userId],\n    references: [users.id],\n  }),\n}));\n\nexport const schedulesRelations = relations(schedules, ({ one }) => ({\n  scope: one(scopes, {\n    fields: [schedules.scopeId],\n    references: [scopes.id],\n  }),\n}));\n\nexport const teachersRelations = relations(teachers, ({ one, many }) => ({\n  user: one(users, {\n    fields: [teachers.userId],\n    references: [users.id],\n  }),\n  reviews: many(teacherReviews),\n}));\n\nexport const teacherReviewsRelations = relations(teacherReviews, ({ one }) => ({\n  teacher: one(teachers, {\n    fields: [teacherReviews.teacherId],\n    references: [teachers.id],\n  }),\n  student: one(users, {\n    fields: [teacherReviews.studentId],\n    references: [users.id],\n  }),\n  moderatedBy: one(users, {\n    fields: [teacherReviews.moderatedById],\n    references: [users.id],\n  }),\n}));\n\nexport const profileCommentsRelations = relations(profileComments, ({ one }) => ({\n  profileUser: one(users, {\n    fields: [profileComments.profileUserId],\n    references: [users.id],\n    relationName: \"profileComments\",\n  }),\n  author: one(users, {\n    fields: [profileComments.authorId],\n    references: [users.id],\n    relationName: \"authoredComments\",\n  }),\n}));\n\n// Insert schemas\nexport const insertUserSchema = createInsertSchema(users)\n  .omit({\n    id: true,\n    createdAt: true,\n    updatedAt: true,\n    credibilityScore: true,\n    reputationScore: true,\n    accountStatus: true,\n    isSpecialAdmin: true, // Only set programmatically for special admins\n    name: true, // Derived from username, not provided by user\n    role: true, // Auto-set to student\n    grade: true, // Set from adminStudentId lookup\n    className: true, // Set from adminStudentId lookup\n  })\n  .extend({\n    username: z.string().trim().min(1, \"Username is required\"),\n    studentId: z.string().trim().min(1, \"Student ID is required\"),\n    email: z.string().trim().email(\"Valid email is required\"),\n    password: z.string().min(8, \"Password must be at least 8 characters\"),\n    phone: z.string().trim().optional(),\n  });\n\nexport const insertScopeSchema = createInsertSchema(scopes).omit({\n  id: true,\n  createdAt: true,\n}).extend({\n  accessCode: z.string().optional().nullable(), // Optional for public scopes\n});\n\nexport const insertDigitalKeySchema = createInsertSchema(digitalKeys).omit({\n  id: true,\n  unlockedAt: true,\n});\n\nexport const insertAdminSuccessionSchema = createInsertSchema(adminSuccessions).omit({\n  id: true,\n  handoverDate: true,\n});\n\nexport const insertAdminStudentIdSchema = createInsertSchema(adminStudentIds)\n  .omit({\n    id: true,\n    createdAt: true,\n    isAssigned: true,\n    assignedToUserId: true,\n    assignedAt: true,\n    studentId: true, // Auto-generated, not provided by admin\n  })\n  .extend({\n    username: z.string()\n      .trim()\n      .min(1, \"Username is required\")\n      .regex(\n        /^[A-Za-z.,-]+(\\s[A-Za-z.,-]+){0,4}$/,\n        \"Username must contain 1-5 names with only letters, periods, hyphens, commas, and single spaces between names\"\n      ),\n    grade: z.number().int().min(1).max(6),\n    className: z.string().trim().min(1, \"Class name is required\"),\n  });\n\nexport const insertPostSchema = createInsertSchema(posts)\n  .omit({\n    id: true,\n    createdAt: true,\n    updatedAt: true,\n    credibilityRating: true,\n    likesCount: true,\n    commentsCount: true,\n  })\n  .extend({\n    content: z.string().trim().min(1, \"Content is required\").max(4000, \"Content must not exceed 4000 characters\"),\n  });\n\nexport const insertEventSchema = createInsertSchema(events)\n  .omit({\n    id: true,\n    createdAt: true,\n  })\n  .extend({\n    description: z.string().trim().min(1, \"Description is required\").max(4000, \"Description must not exceed 4000 characters\"),\n  });\n\nexport const insertEventRsvpSchema = createInsertSchema(eventRsvps).omit({\n  id: true,\n  rsvpedAt: true,\n});\n\nexport const insertScheduleSchema = createInsertSchema(schedules).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertTeacherSchema = createInsertSchema(teachers).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertTeacherReviewSchema = createInsertSchema(teacherReviews)\n  .omit({\n    id: true,\n    createdAt: true,\n    isModerated: true,\n    moderatedById: true,\n  })\n  .extend({\n    rating: z.number().int().min(1, \"Rating must be at least 1\").max(5, \"Rating must be at most 5\"),\n    comment: z.string().trim().optional(),\n  });\n\nexport const insertTeacherFeedbackSchema = createInsertSchema(teacherFeedback)\n  .omit({\n    id: true,\n    createdAt: true,\n  })\n  .extend({\n    clarity: z.number().int().min(1).max(5),\n    instruction: z.number().int().min(1).max(5),\n    communication: z.number().int().min(1).max(5),\n    patience: z.number().int().min(1).max(5),\n    motivation: z.number().int().min(1).max(5),\n    improvement: z.number().int().min(1).max(5),\n    notes: z.string().trim().optional(),\n  });\n\nexport const insertPostCommentSchema = createInsertSchema(postComments).omit({\n  id: true,\n  createdAt: true,\n}).extend({\n  content: z.string().trim().min(1, \"Comment is required\").max(1000, \"Comment must not exceed 1000 characters\"),\n});\n\nexport const insertEventCommentSchema = createInsertSchema(eventComments).omit({\n  id: true,\n  createdAt: true,\n}).extend({\n  content: z.string().trim().min(1, \"Comment is required\").max(1000, \"Comment must not exceed 1000 characters\"),\n});\n\nexport const insertProfileCommentSchema = createInsertSchema(profileComments).omit({\n  id: true,\n  createdAt: true,\n});\n\n\n// Types\nexport type InsertUser = z.infer<typeof insertUserSchema>;\nexport type User = typeof users.$inferSelect;\n\nexport type InsertScope = z.infer<typeof insertScopeSchema>;\nexport type Scope = typeof scopes.$inferSelect;\n\nexport type InsertDigitalKey = z.infer<typeof insertDigitalKeySchema>;\nexport type DigitalKey = typeof digitalKeys.$inferSelect;\n\nexport type InsertAdminSuccession = z.infer<typeof insertAdminSuccessionSchema>;\nexport type AdminSuccession = typeof adminSuccessions.$inferSelect;\n\nexport type InsertAdminStudentId = z.infer<typeof insertAdminStudentIdSchema>;\nexport type AdminStudentId = typeof adminStudentIds.$inferSelect;\n\nexport const insertPostReactionSchema = createInsertSchema(postReactions).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertPostAccuracyRatingSchema = createInsertSchema(postAccuracyRatings).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n}).extend({\n  rating: z.number().int().min(1).max(5).default(3),\n});\n\nexport type InsertPost = z.infer<typeof insertPostSchema>;\nexport type Post = typeof posts.$inferSelect;\n\nexport type InsertPostReaction = z.infer<typeof insertPostReactionSchema>;\nexport type PostReaction = typeof postReactions.$inferSelect;\n\nexport type InsertPostAccuracyRating = z.infer<typeof insertPostAccuracyRatingSchema>;\nexport type PostAccuracyRating = typeof postAccuracyRatings.$inferSelect;\n\nexport type InsertEvent = z.infer<typeof insertEventSchema>;\nexport type Event = typeof events.$inferSelect;\n\nexport type InsertEventRsvp = z.infer<typeof insertEventRsvpSchema>;\nexport type EventRsvp = typeof eventRsvps.$inferSelect;\n\nexport type InsertSchedule = z.infer<typeof insertScheduleSchema>;\nexport type Schedule = typeof schedules.$inferSelect;\n\nexport type InsertTeacher = z.infer<typeof insertTeacherSchema>;\nexport type Teacher = typeof teachers.$inferSelect;\n\nexport type InsertTeacherReview = z.infer<typeof insertTeacherReviewSchema>;\nexport type TeacherReview = typeof teacherReviews.$inferSelect;\n\nexport type InsertTeacherFeedback = z.infer<typeof insertTeacherFeedbackSchema>;\nexport type TeacherFeedback = typeof teacherFeedback.$inferSelect;\n\nexport type InsertPostComment = z.infer<typeof insertPostCommentSchema>;\nexport type PostComment = typeof postComments.$inferSelect;\n\nexport type InsertEventComment = z.infer<typeof insertEventCommentSchema>;\nexport type EventComment = typeof eventComments.$inferSelect;\n\nexport type InsertProfileComment = z.infer<typeof insertProfileCommentSchema>;\nexport type ProfileComment = typeof profileComments.$inferSelect;\n\nexport const insertSettingSchema = createInsertSchema(settings).omit({\n  id: true,\n  updatedAt: true,\n});\n\nexport type InsertSetting = z.infer<typeof insertSettingSchema>;\nexport type Setting = typeof settings.$inferSelect;\n\nexport const insertPasswordResetTokenSchema = createInsertSchema(passwordResetTokens).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type InsertPasswordResetToken = z.infer<typeof insertPasswordResetTokenSchema>;\nexport type PasswordResetToken = typeof passwordResetTokens.$inferSelect;\n\nexport const insertFailedLoginAttemptSchema = createInsertSchema(failedLoginAttempts).omit({\n  id: true,\n  lastAttemptAt: true,\n});\n\nexport type InsertFailedLoginAttempt = z.infer<typeof insertFailedLoginAttemptSchema>;\nexport type FailedLoginAttempt = typeof failedLoginAttempts.$inferSelect;\n\nexport const insertRememberMeTokenSchema = createInsertSchema(rememberMeTokens).omit({\n  id: true,\n  createdAt: true,\n  lastUsedAt: true,\n});\n\nexport type InsertRememberMeToken = z.infer<typeof insertRememberMeTokenSchema>;\nexport type RememberMeToken = typeof rememberMeTokens.$inferSelect;\n\nexport const insertFriendshipSchema = createInsertSchema(friendships).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport type InsertFriendship = z.infer<typeof insertFriendshipSchema>;\nexport type Friendship = typeof friendships.$inferSelect;\n\nexport const insertChatMessageSchema = createInsertSchema(chatMessages).omit({\n  id: true,\n  createdAt: true,\n  isRead: true,\n}).extend({\n  content: z.string().trim().min(1, \"Message cannot be empty\").max(2000, \"Message must not exceed 2000 characters\"),\n});\n\nexport type InsertChatMessage = z.infer<typeof insertChatMessageSchema>;\nexport type ChatMessage = typeof chatMessages.$inferSelect;\n\nexport const insertContentViolationSchema = createInsertSchema(contentViolations).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type InsertContentViolation = z.infer<typeof insertContentViolationSchema>;\nexport type ContentViolation = typeof contentViolations.$inferSelect;\n\nexport const insertUserPunishmentSchema = createInsertSchema(userPunishments).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type InsertUserPunishment = z.infer<typeof insertUserPunishmentSchema>;\nexport type UserPunishment = typeof userPunishments.$inferSelect;\n","path":null,"size_bytes":31663,"size_tokens":null},"server/storage.ts":{"content":"import {\n  users,\n  scopes,\n  digitalKeys,\n  adminSuccessions,\n  adminStudentIds,\n  posts,\n  postReactions,\n  postAccuracyRatings,\n  postComments,\n  events,\n  eventRsvps,\n  eventComments,\n  schedules,\n  teachers,\n  teacherReviews,\n  teacherFeedback,\n  profileComments,\n  settings,\n  passwordResetTokens,\n  failedLoginAttempts,\n  rememberMeTokens,\n  friendships,\n  chatMessages,\n  contentViolations,\n  userPunishments,\n  type User,\n  type InsertUser,\n  type Scope,\n  type InsertScope,\n  type DigitalKey,\n  type InsertDigitalKey,\n  type AdminSuccession,\n  type InsertAdminSuccession,\n  type AdminStudentId,\n  type InsertAdminStudentId,\n  type Post,\n  type InsertPost,\n  type PostReaction,\n  type InsertPostReaction,\n  type PostAccuracyRating,\n  type InsertPostAccuracyRating,\n  type PostComment,\n  type InsertPostComment,\n  type Event,\n  type InsertEvent,\n  type EventRsvp,\n  type InsertEventRsvp,\n  type EventComment,\n  type InsertEventComment,\n  type Schedule,\n  type InsertSchedule,\n  type Teacher,\n  type InsertTeacher,\n  type TeacherReview,\n  type InsertTeacherReview,\n  type TeacherFeedback,\n  type InsertTeacherFeedback,\n  type ProfileComment,\n  type InsertProfileComment,\n  type Setting,\n  type InsertSetting,\n  type PasswordResetToken,\n  type InsertPasswordResetToken,\n  type FailedLoginAttempt,\n  type InsertFailedLoginAttempt,\n  type RememberMeToken,\n  type InsertRememberMeToken,\n  type Friendship,\n  type InsertFriendship,\n  type ChatMessage,\n  type InsertChatMessage,\n  type ContentViolation,\n  type InsertContentViolation,\n  type UserPunishment,\n  type InsertUserPunishment,\n} from \"@shared/schema\";\nimport { db } from \"./db\";\nimport { eq, and, desc, sql, inArray } from \"drizzle-orm\";\nimport bcrypt from \"bcrypt\";\n\nconst CREDIBILITY_THRESHOLD_FOR_THREAT = 25.0; // Below this, account becomes \"threatened\"\n\nexport interface IStorage {\n  // User management\n  getUser(id: string): Promise<User | undefined>;\n  getUserByEmail(email: string): Promise<User | undefined>;\n  getUserByUsername(username: string): Promise<User | undefined>;\n  getAdminUser(): Promise<User | undefined>;\n  getVisitorUser(): Promise<User | undefined>;\n  createVisitorUser(userData: InsertUser): Promise<User>;\n  getStudentsByClass(grade: number, className: string): Promise<User[]>;\n  createUser(user: InsertUser): Promise<User>;\n  updateUserProfile(userId: string, updates: { bio?: string; avatarUrl?: string; grade?: number; className?: string; empathy?: number; angerManagement?: number; cooperation?: number; selfConfidence?: number; acceptingCriticism?: number; listening?: number; problemSolving?: number; creativity?: number; memoryFocus?: number; planningOrganization?: number; communicationExpression?: number; leadershipInitiative?: number; artisticCreative?: number; athleticPhysical?: number; technicalTech?: number; linguisticReading?: number; socialHumanitarian?: number; naturalEnvironmental?: number; hobbies?: string[] }): Promise<User | undefined>;\n  updateUserCredibility(userId: string, newScore: number): Promise<User | undefined>;\n  updateUserReputation(userId: string, newScore: number): Promise<User | undefined>;\n  deleteUser(userId: string): Promise<boolean>;\n  deleteStudentAccount(userId: string): Promise<boolean>;\n  deleteTeacherAccount(teacherId: string): Promise<boolean>;\n  \n  // Student ID Management (Admin only)\n  createStudentId(username: string, grade: number, className: string, adminId: string): Promise<AdminStudentId>;\n  getStudentIdRecord(studentId: string): Promise<AdminStudentId | undefined>;\n  getStudentIdByUsername(username: string): Promise<AdminStudentId | undefined>;\n  getAllStudentIds(): Promise<AdminStudentId[]>;\n  deleteStudentId(id: string): Promise<boolean>;\n  // Access Code / Digital Key System\n  verifyAndUnlockScope(userId: string, scopeId: string, accessCode: string): Promise<{ success: boolean; message: string; key?: DigitalKey }>;\n  getUserDigitalKeys(userId: string): Promise<DigitalKey[]>;\n  hasAccessToScope(userId: string, scopeId: string): Promise<boolean>;\n  \n  // Admin Handover Protocol\n  transferAdminPrivileges(currentAdminId: string, successorId: string, notes?: string): Promise<{ success: boolean; message: string; succession?: AdminSuccession }>;\n  getAdminSuccessionHistory(): Promise<AdminSuccession[]>;\n  \n  // Admin Promotion (without demotion)\n  promoteUserToAdmin(currentAdminId: string, userId: string): Promise<{ success: boolean; message: string }>;\n  \n  // Credibility & Reputation Engine\n  calculateUserReputation(userId: string): Promise<number>;\n  checkAndUpdateAccountStatus(userId: string): Promise<void>;\n  \n  // Scopes\n  getScope(id: string): Promise<Scope | undefined>;\n  getAllScopes(): Promise<Scope[]>;\n  createScope(scope: InsertScope): Promise<Scope>;\n  deleteScope(id: string): Promise<boolean>;\n  \n  // Posts\n  createPost(post: InsertPost): Promise<Post>;\n  getPosts(scopeId?: string | null, userId?: string): Promise<any[]>;\n  getPost(id: string): Promise<Post | undefined>;\n  updatePost(postId: string, content: string): Promise<Post | undefined>;\n  updatePostCredibility(postId: string, rating: number): Promise<Post | undefined>;\n  deletePost(postId: string): Promise<boolean>;\n  ratePostAccuracy(postId: string, userId: string, rating: number): Promise<PostAccuracyRating>;\n  getUserPostAccuracyRating(postId: string, userId: string): Promise<PostAccuracyRating | undefined>;\n  \n  // Events\n  createEvent(event: InsertEvent): Promise<Event>;\n  getEvents(scopeId?: string, userId?: string): Promise<any[]>;\n  rsvpToEvent(eventId: string, userId: string): Promise<EventRsvp | null>;\n  getEventRsvps(eventId: string): Promise<EventRsvp[]>;\n  getUserRsvps(userId: string): Promise<EventRsvp[]>;\n  getEventAttendees(eventId: string): Promise<User[]>;\n  \n  // Schedules\n  createSchedule(schedule: InsertSchedule): Promise<Schedule>;\n  getSchedules(scopeId: string): Promise<Schedule[]>;\n  updateSchedule(id: string, teacherName: string, subject: string): Promise<Schedule | undefined>;\n  bulkUpdateSchedules(scopeId: string, updates: Array<{ dayOfWeek: number; periodNumber: number; subject: string | null; teacherName: string | null }>): Promise<void>;\n  \n  // Teachers\n  createTeacher(teacher: InsertTeacher): Promise<Teacher>;\n  getTeachers(): Promise<Teacher[]>;\n  getTeacher(id: string): Promise<Teacher | undefined>;\n  updateTeacher(id: string, updates: Partial<InsertTeacher>): Promise<Teacher | undefined>;\n  deleteTeacher(id: string): Promise<boolean>;\n  getTeacherWithReviews(id: string): Promise<{ teacher: Teacher; reviews: TeacherReview[]; averageRating: number } | undefined>;\n  \n  // Teacher Reviews\n  createTeacherReview(review: InsertTeacherReview): Promise<TeacherReview>;\n  getTeacherReviews(teacherId: string): Promise<TeacherReview[]>;\n  \n  // Teacher Feedback\n  createTeacherFeedback(feedback: InsertTeacherFeedback): Promise<TeacherFeedback>;\n  getTeacherFeedback(teacherId: string): Promise<TeacherFeedback[]>;\n  getTeacherFeedbackStats(teacherId: string): Promise<{ averages: Record<string, number>; count: number }>;\n  \n  // Post Comments\n  createPostComment(comment: InsertPostComment): Promise<PostComment>;\n  getPostComments(postId: string): Promise<PostComment[]>;\n\n  // Event Comments\n  createEventComment(comment: InsertEventComment): Promise<EventComment>;\n  getEventComments(eventId: string): Promise<EventComment[]>;\n\n  // Profile Comments\n  createProfileComment(comment: InsertProfileComment): Promise<ProfileComment>;\n  getProfileComments(profileUserId: string): Promise<ProfileComment[]>;\n  \n  // Settings\n  getSetting(key: string): Promise<Setting | undefined>;\n  setSetting(key: string, value: string): Promise<Setting>;\n\n  // Password Recovery\n  createPasswordResetToken(userId: string): Promise<string>;\n  validatePasswordResetToken(token: string): Promise<User | undefined>;\n  resetPassword(token: string, newPassword: string): Promise<boolean>;\n  \n  // Friends\n  sendFriendRequest(user1Id: string, user2Id: string): Promise<Friendship>;\n  acceptFriendRequest(friendshipId: string): Promise<Friendship | undefined>;\n  rejectFriendRequest(friendshipId: string): Promise<Friendship | undefined>;\n  getFriends(userId: string): Promise<User[]>;\n  getPendingFriendRequests(userId: string): Promise<Array<Friendship & { initiator: User }>>;\n  unfriend(user1Id: string, user2Id: string): Promise<boolean>;\n  getFriendship(user1Id: string, user2Id: string): Promise<Friendship | undefined>;\n  \n  // Chat\n  sendChatMessage(senderId: string, receiverId: string, content: string): Promise<ChatMessage>;\n  getChatMessages(user1Id: string, user2Id: string): Promise<ChatMessage[]>;\n  markMessageAsRead(messageId: string): Promise<ChatMessage | undefined>;\n  getUnreadMessageCount(userId: string): Promise<number>;\n  \n  // Content Moderation\n  createViolation(violation: InsertContentViolation): Promise<ContentViolation>;\n  getUserViolations(userId: string): Promise<ContentViolation[]>;\n  getUserViolationCount(userId: string): Promise<number>;\n  \n  // Punishments\n  createPunishment(punishment: InsertUserPunishment): Promise<UserPunishment>;\n  getUserPunishments(userId: string): Promise<UserPunishment[]>;\n  applyPunishment(userId: string, credibilityPenalty: number, banUntil?: Date): Promise<User | undefined>;\n}\n\nexport class DatabaseStorage implements IStorage {\n  // ==================== USER MANAGEMENT ====================\n  async getUser(id: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.id, id));\n    return user || undefined;\n  }\n\n  async getUserByEmail(email: string): Promise<User | undefined> {\n    const [user] = await db.select().from(users).where(eq(users.email, email));\n    return user || undefined;\n  }\n\n  async getUserByUsername(username: string): Promise<User | undefined> {\n    // Case-insensitive lookup using SQL lower() function\n    const [user] = await db.select().from(users).where(sql`LOWER(${users.username}) = LOWER(${username})`);\n    return user || undefined;\n  }\n\n  async getAdminUser(): Promise<User | undefined> {\n    const [admin] = await db.select().from(users).where(eq(users.role, \"admin\"));\n    return admin || undefined;\n  }\n\n  async getVisitorUser(): Promise<User | undefined> {\n    const [visitor] = await db.select().from(users).where(eq(users.role, \"visitor\"));\n    return visitor || undefined;\n  }\n\n  async createVisitorUser(insertUser: InsertUser): Promise<User> {\n    const hashedPassword = await bcrypt.hash(insertUser.password, 10);\n    \n    const [user] = await db\n      .insert(users)\n      .values({\n        ...insertUser,\n        password: hashedPassword,\n        role: \"visitor\",\n      })\n      .returning();\n    \n    return user;\n  }\n\n  // ==================== FAILED LOGIN TRACKING ====================\n  \n  async getFailedLoginAttempts(username: string) {\n    const [attempt] = await db\n      .select()\n      .from(failedLoginAttempts)\n      .where(eq(failedLoginAttempts.username, sql`LOWER(${username})`));\n    return attempt;\n  }\n\n  async recordFailedLogin(username: string): Promise<void> {\n    const existing = await this.getFailedLoginAttempts(username);\n    \n    if (existing) {\n      const newCount = existing.attemptCount + 1;\n      const isLocked = newCount >= 3;\n      const lockDuration = 15 * 60 * 1000; // 15 minutes in ms\n      \n      await db\n        .update(failedLoginAttempts)\n        .set({\n          attemptCount: newCount,\n          lastAttemptAt: new Date(),\n          lockedUntil: isLocked ? new Date(Date.now() + lockDuration) : null,\n        })\n        .where(eq(failedLoginAttempts.id, existing.id));\n    } else {\n      await db.insert(failedLoginAttempts).values({\n        username: username.toLowerCase(),\n        attemptCount: 1,\n        lastAttemptAt: new Date(),\n      });\n    }\n  }\n\n  async clearFailedLoginAttempts(username: string): Promise<void> {\n    await db\n      .delete(failedLoginAttempts)\n      .where(eq(failedLoginAttempts.username, sql`LOWER(${username})`));\n  }\n\n  async isAccountLocked(username: string): Promise<boolean> {\n    const attempt = await this.getFailedLoginAttempts(username);\n    \n    if (!attempt || !attempt.lockedUntil) {\n      return false;\n    }\n    \n    // Check if lock has expired\n    if (new Date() > attempt.lockedUntil) {\n      // Lock expired, clear the record\n      await this.clearFailedLoginAttempts(username);\n      return false;\n    }\n    \n    return true;\n  }\n\n  // ==================== REMEMBER ME TOKENS ====================\n  \n  async createRememberMeToken(\n    userId: string, \n    token: string, \n    deviceFingerprint?: string\n  ): Promise<void> {\n    const sevenDays = 7 * 24 * 60 * 60 * 1000; // 7 days in ms\n    \n    await db.insert(rememberMeTokens).values({\n      userId,\n      token,\n      deviceFingerprint,\n      expiresAt: new Date(Date.now() + sevenDays),\n    });\n  }\n\n  async getRememberMeToken(token: string) {\n    const [tokenRecord] = await db\n      .select()\n      .from(rememberMeTokens)\n      .where(eq(rememberMeTokens.token, token));\n    return tokenRecord;\n  }\n\n  async updateRememberMeTokenActivity(tokenId: string): Promise<void> {\n    const sevenDays = 7 * 24 * 60 * 60 * 1000;\n    \n    await db\n      .update(rememberMeTokens)\n      .set({\n        lastUsedAt: new Date(),\n        expiresAt: new Date(Date.now() + sevenDays), // Extend expiry on each use\n      })\n      .where(eq(rememberMeTokens.id, tokenId));\n  }\n\n  async deleteRememberMeToken(token: string): Promise<void> {\n    await db\n      .delete(rememberMeTokens)\n      .where(eq(rememberMeTokens.token, token));\n  }\n\n  async cleanupExpiredRememberMeTokens(): Promise<void> {\n    await db\n      .delete(rememberMeTokens)\n      .where(sql`${rememberMeTokens.expiresAt} < ${new Date()}`);\n  }\n\n  async getStudentsByClass(grade: number, className: string): Promise<User[]> {\n    const students = await db\n      .select()\n      .from(users)\n      .where(\n        and(\n          eq(users.grade, grade),\n          eq(users.className, className),\n          eq(users.role, \"student\")\n        )\n      )\n      .orderBy(users.name);\n    return students;\n  }\n\n  async createUser(insertUser: InsertUser): Promise<User> {\n    const hashedPassword = await bcrypt.hash(insertUser.password, 10);\n    \n    // Students MUST have a valid student ID generated by admin\n    if (!insertUser.studentId) {\n      throw new Error(\"Student ID is required for registration\");\n    }\n    \n    // Derive the full name from username (replace periods/hyphens/commas with spaces, capitalize each word)\n    const name = insertUser.username\n      .replace(/[.,-]/g, ' ')\n      .split(' ')\n      .filter(word => word.length > 0) // Remove empty strings from double punctuation\n      .map(word => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase())\n      .join(' ');\n    \n    // Use transaction to ensure atomicity and prevent race conditions\n    return await db.transaction(async (tx) => {\n      // Fetch and verify the student ID record inside the transaction\n      const [studentIdRecord] = await tx\n        .select()\n        .from(adminStudentIds)\n        .where(eq(adminStudentIds.studentId, insertUser.studentId))\n        .for('update'); // Lock the row to prevent concurrent access\n      \n      if (!studentIdRecord) {\n        throw new Error(\"Invalid student ID. This ID was not generated by an administrator.\");\n      }\n      \n      // Validate the student ID record\n      if (studentIdRecord.isAssigned) {\n        throw new Error(\"This student ID has already been used\");\n      }\n      \n      // Verify the username matches (case-insensitive)\n      if (studentIdRecord.username.toLowerCase() !== insertUser.username.toLowerCase()) {\n        throw new Error(\"Username does not match the assigned student ID\");\n      }\n      \n      // Insert user with original username casing preserved\n      const [user] = await tx\n        .insert(users)\n        .values({\n          ...insertUser,\n          password: hashedPassword,\n          name,\n          role: \"student\",\n          grade: studentIdRecord.grade,\n          className: studentIdRecord.className,\n        })\n        .returning();\n      \n      // Mark the student ID as assigned with a guard against concurrent updates\n      const updateResult = await tx\n        .update(adminStudentIds)\n        .set({\n          isAssigned: true,\n          assignedToUserId: user.id,\n          assignedAt: new Date(),\n        })\n        .where(\n          and(\n            eq(adminStudentIds.studentId, insertUser.studentId),\n            eq(adminStudentIds.isAssigned, false) // Guard against race conditions\n          )\n        )\n        .returning();\n      \n      if (!updateResult || updateResult.length === 0) {\n        throw new Error(\"Failed to assign student ID - it may have been used concurrently\");\n      }\n      \n      return user;\n    });\n  }\n\n  async updateUserProfile(userId: string, updates: { bio?: string; avatarUrl?: string; grade?: number; className?: string; empathy?: number; angerManagement?: number; cooperation?: number; selfConfidence?: number; acceptingCriticism?: number; listening?: number; problemSolving?: number; creativity?: number; memoryFocus?: number; planningOrganization?: number; communicationExpression?: number; leadershipInitiative?: number; artisticCreative?: number; athleticPhysical?: number; technicalTech?: number; linguisticReading?: number; socialHumanitarian?: number; naturalEnvironmental?: number; hobbies?: string[] }): Promise<User | undefined> {\n    const [user] = await db\n      .update(users)\n      .set({ \n        bio: updates.bio,\n        avatarUrl: updates.avatarUrl,\n        grade: updates.grade,\n        className: updates.className,\n        empathy: updates.empathy,\n        angerManagement: updates.angerManagement,\n        cooperation: updates.cooperation,\n        selfConfidence: updates.selfConfidence,\n        acceptingCriticism: updates.acceptingCriticism,\n        listening: updates.listening,\n        problemSolving: updates.problemSolving,\n        creativity: updates.creativity,\n        memoryFocus: updates.memoryFocus,\n        planningOrganization: updates.planningOrganization,\n        communicationExpression: updates.communicationExpression,\n        leadershipInitiative: updates.leadershipInitiative,\n        artisticCreative: updates.artisticCreative,\n        athleticPhysical: updates.athleticPhysical,\n        technicalTech: updates.technicalTech,\n        linguisticReading: updates.linguisticReading,\n        socialHumanitarian: updates.socialHumanitarian,\n        naturalEnvironmental: updates.naturalEnvironmental,\n        hobbies: updates.hobbies,\n        updatedAt: new Date(),\n      })\n      .where(eq(users.id, userId))\n      .returning();\n    return user || undefined;\n  }\n\n  async updateUserCredibility(userId: string, newScore: number): Promise<User | undefined> {\n    const [user] = await db\n      .update(users)\n      .set({ \n        credibilityScore: newScore,\n        updatedAt: new Date(),\n      })\n      .where(eq(users.id, userId))\n      .returning();\n    \n    // Check if account status needs to be updated\n    if (user) {\n      await this.checkAndUpdateAccountStatus(userId);\n    }\n    \n    return user || undefined;\n  }\n\n  async updateUserReputation(userId: string, newScore: number): Promise<User | undefined> {\n    const [user] = await db\n      .update(users)\n      .set({ \n        reputationScore: newScore,\n        updatedAt: new Date(),\n      })\n      .where(eq(users.id, userId))\n      .returning();\n    return user || undefined;\n  }\n\n  async deleteUser(userId: string): Promise<boolean> {\n    try {\n      const result = await db.delete(users).where(eq(users.id, userId));\n      return result.rowCount ? result.rowCount > 0 : false;\n    } catch (error) {\n      console.error(\"Failed to delete user:\", error);\n      return false;\n    }\n  }\n\n  async deleteStudentAccount(userId: string): Promise<boolean> {\n    try {\n      return await db.transaction(async (tx) => {\n        // Delete all posts by the user\n        await tx.delete(posts).where(eq(posts.authorId, userId));\n        \n        // Delete all post comments by the user\n        await tx.delete(postComments).where(eq(postComments.authorId, userId));\n        \n        // Delete all post reactions by the user\n        await tx.delete(postReactions).where(eq(postReactions.userId, userId));\n        \n        // Delete all post accuracy ratings by the user\n        await tx.delete(postAccuracyRatings).where(eq(postAccuracyRatings.userId, userId));\n        \n        // Delete all profile comments by the user\n        await tx.delete(profileComments).where(eq(profileComments.authorId, userId));\n        \n        // Delete all profile comments on the user's profile\n        await tx.delete(profileComments).where(eq(profileComments.profileUserId, userId));\n        \n        // Delete all event RSVPs by the user\n        await tx.delete(eventRsvps).where(eq(eventRsvps.userId, userId));\n        \n        // Delete all event comments by the user\n        await tx.delete(eventComments).where(eq(eventComments.authorId, userId));\n        \n        // Delete all teacher reviews by the user\n        await tx.delete(teacherReviews).where(eq(teacherReviews.studentId, userId));\n        \n        // Delete all digital keys (unlocked scopes)\n        await tx.delete(digitalKeys).where(eq(digitalKeys.userId, userId));\n        \n        // Delete admin student IDs assigned to this user\n        await tx.delete(adminStudentIds).where(eq(adminStudentIds.assignedToUserId, userId));\n        \n        // Finally, delete the user record\n        const result = await tx.delete(users).where(eq(users.id, userId));\n        \n        return result.rowCount ? result.rowCount > 0 : false;\n      });\n    } catch (error) {\n      console.error(\"Failed to delete student account:\", error);\n      return false;\n    }\n  }\n\n  async deleteTeacherAccount(teacherId: string): Promise<boolean> {\n    try {\n      return await db.transaction(async (tx) => {\n        // Get the teacher record first to find the associated userId\n        const [teacher] = await tx\n          .select()\n          .from(teachers)\n          .where(eq(teachers.id, teacherId));\n        \n        if (!teacher) {\n          throw new Error(\"Teacher not found\");\n        }\n\n        const userId = teacher.userId;\n\n        // Delete all teacher reviews for this teacher\n        await tx.delete(teacherReviews).where(eq(teacherReviews.teacherId, teacherId));\n        \n        // Delete the teacher record itself\n        await tx.delete(teachers).where(eq(teachers.id, teacherId));\n        \n        // If teacher has an associated user account, delete all their data\n        if (userId) {\n          // Delete all posts by the teacher\n          await tx.delete(posts).where(eq(posts.authorId, userId));\n          \n          // Delete all post comments by the teacher\n          await tx.delete(postComments).where(eq(postComments.authorId, userId));\n          \n          // Delete all post reactions by the teacher\n          await tx.delete(postReactions).where(eq(postReactions.userId, userId));\n          \n          // Delete all post accuracy ratings by the teacher\n          await tx.delete(postAccuracyRatings).where(eq(postAccuracyRatings.userId, userId));\n          \n          // Delete all profile comments by the teacher\n          await tx.delete(profileComments).where(eq(profileComments.authorId, userId));\n          \n          // Delete all profile comments on the teacher's profile\n          await tx.delete(profileComments).where(eq(profileComments.profileUserId, userId));\n          \n          // Delete all event RSVPs by the teacher\n          await tx.delete(eventRsvps).where(eq(eventRsvps.userId, userId));\n          \n          // Delete all event comments by the teacher\n          await tx.delete(eventComments).where(eq(eventComments.authorId, userId));\n          \n          // Delete all schedules associated with this teacher (if any stored that way)\n          // Note: schedules are typically just text fields, so cascading should handle it\n          \n          // Delete all digital keys (unlocked scopes)\n          await tx.delete(digitalKeys).where(eq(digitalKeys.userId, userId));\n          \n          // Finally, delete the user record\n          await tx.delete(users).where(eq(users.id, userId));\n        }\n        \n        return true;\n      });\n    } catch (error) {\n      console.error(\"Failed to delete teacher account:\", error);\n      return false;\n    }\n  }\n\n  // ==================== STUDENT ID MANAGEMENT ====================\n  \n  /**\n   * Create a new student ID that can be assigned during registration\n   * Auto-generates a random 8-character alphanumeric ID\n   */\n  async createStudentId(username: string, grade: number, className: string, adminId: string): Promise<AdminStudentId> {\n    // Check if username already exists (case-insensitive check)\n    const existingUsername = await this.getStudentIdByUsername(username);\n    if (existingUsername) {\n      throw new Error(\"A student ID has already been created for this username\");\n    }\n    \n    // Generate a random 8-character alphanumeric ID\n    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';\n    let studentId = '';\n    for (let i = 0; i < 8; i++) {\n      studentId += chars.charAt(Math.floor(Math.random() * chars.length));\n    }\n    \n    // Check if ID already exists (very unlikely but possible)\n    const existing = await this.getStudentIdRecord(studentId);\n    if (existing) {\n      // Recursively try again with a new random ID\n      return this.createStudentId(username, grade, className, adminId);\n    }\n    \n    const [record] = await db\n      .insert(adminStudentIds)\n      .values({\n        username, // Preserve original casing\n        studentId,\n        grade,\n        className,\n        createdByAdminId: adminId,\n      })\n      .returning();\n    return record;\n  }\n\n  /**\n   * Get student ID record by the ID string\n   */\n  async getStudentIdRecord(studentId: string): Promise<AdminStudentId | undefined> {\n    const [record] = await db\n      .select()\n      .from(adminStudentIds)\n      .where(eq(adminStudentIds.studentId, studentId));\n    return record || undefined;\n  }\n\n  /**\n   * Get student ID record by username\n   */\n  async getStudentIdByUsername(username: string): Promise<AdminStudentId | undefined> {\n    // Case-insensitive lookup using SQL lower() function\n    const [record] = await db\n      .select()\n      .from(adminStudentIds)\n      .where(sql`LOWER(${adminStudentIds.username}) = LOWER(${username})`);\n    return record || undefined;\n  }\n\n  /**\n   * Get all student IDs (for admin management interface)\n   */\n  async getAllStudentIds(): Promise<AdminStudentId[]> {\n    return await db\n      .select()\n      .from(adminStudentIds)\n      .orderBy(desc(adminStudentIds.createdAt));\n  }\n\n  /**\n   * Get all assigned students (students with assigned user IDs) for admin management\n   */\n  async getAssignedStudents(): Promise<(User & { assignedDate: string | null })[]> {\n    const result = await db\n      .select({\n        ...users,\n        assignedDate: adminStudentIds.assignedAt,\n      })\n      .from(users)\n      .leftJoin(adminStudentIds, eq(adminStudentIds.assignedToUserId, users.id))\n      .where(eq(users.role, \"student\"))\n      .orderBy(desc(users.createdAt));\n    \n    return result as any;\n  }\n\n  /**\n   * Delete a student ID (only if not assigned)\n   */\n  async deleteStudentId(id: string): Promise<boolean> {\n    const result = await db\n      .delete(adminStudentIds)\n      .where(and(\n        eq(adminStudentIds.id, id),\n        eq(adminStudentIds.isAssigned, false) // Can only delete unassigned IDs\n      ));\n    return result.rowCount !== null && result.rowCount > 0;\n  }\n\n  // ==================== ACCESS CODE / DIGITAL KEY SYSTEM ====================\n  \n  /**\n   * Core logic: Verifies access code and creates a \"Digital Key\" if correct.\n   * Once a user enters the code correctly, they never need to enter it again.\n   */\n  async verifyAndUnlockScope(\n    userId: string, \n    scopeId: string, \n    accessCode: string\n  ): Promise<{ success: boolean; message: string; key?: DigitalKey }> {\n    // Get the scope\n    const scope = await this.getScope(scopeId);\n    if (!scope) {\n      return { success: false, message: \"Scope not found\" };\n    }\n\n    // Check if user already has this key\n    const existingKey = await db\n      .select()\n      .from(digitalKeys)\n      .where(and(\n        eq(digitalKeys.userId, userId),\n        eq(digitalKeys.scopeId, scopeId)\n      ));\n    \n    if (existingKey.length > 0) {\n      return { \n        success: true, \n        message: \"You already have access to this scope\",\n        key: existingKey[0]\n      };\n    }\n\n    // Verify the access code\n    if (scope.accessCode !== accessCode) {\n      return { success: false, message: \"Incorrect access code\" };\n    }\n\n    // Create the digital key (persistent access)\n    const [newKey] = await db\n      .insert(digitalKeys)\n      .values({\n        userId,\n        scopeId,\n      })\n      .returning();\n\n    return { \n      success: true, \n      message: \"Access granted! Digital key saved to your profile.\",\n      key: newKey\n    };\n  }\n\n  async getUserDigitalKeys(userId: string): Promise<DigitalKey[]> {\n    return await db\n      .select()\n      .from(digitalKeys)\n      .where(eq(digitalKeys.userId, userId));\n  }\n\n  async hasAccessToScope(userId: string, scopeId: string): Promise<boolean> {\n    // Check if user has the digital key\n    const keys = await db\n      .select()\n      .from(digitalKeys)\n      .where(and(\n        eq(digitalKeys.userId, userId),\n        eq(digitalKeys.scopeId, scopeId)\n      ));\n    \n    return keys.length > 0;\n  }\n\n  // ==================== ADMIN HANDOVER PROTOCOL ====================\n  \n  /**\n   * Core logic: Atomic transfer of admin privileges with succession tracking.\n   * The current admin appoints a successor and downgrades to \"alumni\" status.\n   */\n  async transferAdminPrivileges(\n    currentAdminId: string, \n    successorId: string, \n    notes?: string\n  ): Promise<{ success: boolean; message: string; succession?: AdminSuccession }> {\n    // Verify current user is admin\n    const currentAdmin = await this.getUser(currentAdminId);\n    if (!currentAdmin || currentAdmin.role !== \"admin\") {\n      return { success: false, message: \"Only admins can transfer privileges\" };\n    }\n\n    // Verify successor exists\n    const successor = await this.getUser(successorId);\n    if (!successor) {\n      return { success: false, message: \"Successor not found\" };\n    }\n\n    // Prevent self-succession\n    if (currentAdminId === successorId) {\n      return { success: false, message: \"Cannot transfer privileges to yourself\" };\n    }\n\n    try {\n      // Perform atomic transaction\n      const result = await db.transaction(async (tx) => {\n        // Downgrade current admin to student\n        await tx\n          .update(users)\n          .set({ \n            role: \"student\",\n            updatedAt: new Date(),\n          })\n          .where(eq(users.id, currentAdminId));\n\n        // Upgrade successor to admin\n        await tx\n          .update(users)\n          .set({ \n            role: \"admin\",\n            updatedAt: new Date(),\n          })\n          .where(eq(users.id, successorId));\n\n        // Record succession\n        const [succession] = await tx\n          .insert(adminSuccessions)\n          .values({\n            previousAdminId: currentAdminId,\n            newAdminId: successorId,\n            notes: notes || `Admin privileges transferred from ${currentAdmin.name} to ${successor.name}`,\n          })\n          .returning();\n\n        return succession;\n      });\n\n      return { \n        success: true, \n        message: `Admin privileges successfully transferred to ${successor.name}. You are now a student.`,\n        succession: result\n      };\n    } catch (error) {\n      return { success: false, message: \"Failed to transfer privileges. Please try again.\" };\n    }\n  }\n\n  async getAdminSuccessionHistory(): Promise<AdminSuccession[]> {\n    return await db\n      .select()\n      .from(adminSuccessions)\n      .orderBy(desc(adminSuccessions.handoverDate));\n  }\n\n  /**\n   * Admin Promotion: Allow an admin to promote another user to admin role\n   * WITHOUT demoting themselves (different from handover)\n   */\n  async promoteUserToAdmin(\n    currentAdminId: string,\n    userId: string\n  ): Promise<{ success: boolean; message: string }> {\n    const currentAdmin = await this.getUser(currentAdminId);\n    if (!currentAdmin || currentAdmin.role !== \"admin\") {\n      return { success: false, message: \"Only admins can promote users\" };\n    }\n\n    const targetUser = await this.getUser(userId);\n    if (!targetUser) {\n      return { success: false, message: \"User not found\" };\n    }\n\n    if (targetUser.role === \"admin\") {\n      return { success: false, message: \"User is already an admin\" };\n    }\n\n    if (currentAdminId === userId) {\n      return { success: false, message: \"You are already an admin\" };\n    }\n\n    try {\n      await db\n        .update(users)\n        .set({ \n          role: \"admin\",\n          updatedAt: new Date(),\n        })\n        .where(eq(users.id, userId));\n\n      return { \n        success: true, \n        message: `Successfully promoted ${targetUser.name} to admin` \n      };\n    } catch (error) {\n      console.error(\"Error promoting user to admin:\", error);\n      return { success: false, message: \"Failed to promote user to admin\" };\n    }\n  }\n\n  // ==================== CREDIBILITY & REPUTATION ENGINE ====================\n  \n  /**\n   * Core logic: Calculates reputation based on activity, credibility, and participation.\n   * Formula: (activity_weight × posts) + (credibility_weight × avg_credibility) + (participation_weight × events)\n   */\n  async calculateUserReputation(userId: string): Promise<number> {\n    const user = await this.getUser(userId);\n    if (!user) return 0;\n\n    // Get user's posts count\n    const userPosts = await db\n      .select()\n      .from(posts)\n      .where(eq(posts.authorId, userId));\n    \n    const postsCount = userPosts.length;\n    const avgPostCredibility = postsCount > 0 \n      ? userPosts.reduce((sum, post) => sum + post.credibilityRating, 0) / postsCount\n      : user.credibilityScore;\n\n    // Get user's event participation\n    const userRsvps = await db\n      .select()\n      .from(eventRsvps)\n      .where(eq(eventRsvps.userId, userId));\n    \n    const eventsAttended = userRsvps.length;\n\n    // Weights for reputation calculation\n    const activityWeight = 2.0;\n    const credibilityWeight = 1.5;\n    const participationWeight = 3.0;\n\n    // Calculate reputation score\n    const reputation = \n      (activityWeight * postsCount) +\n      (credibilityWeight * avgPostCredibility) +\n      (participationWeight * eventsAttended);\n\n    // Update user's reputation\n    await this.updateUserReputation(userId, reputation);\n\n    return reputation;\n  }\n\n  /**\n   * Core logic: Automatically flags account as \"threatened\" if credibility drops too low.\n   * This is the self-moderation system to prevent spam/bullying.\n   */\n  async checkAndUpdateAccountStatus(userId: string): Promise<void> {\n    const user = await this.getUser(userId);\n    if (!user) return;\n\n    let newStatus = user.accountStatus;\n\n    if (user.credibilityScore < CREDIBILITY_THRESHOLD_FOR_THREAT) {\n      newStatus = \"threatened\";\n    } else if (user.accountStatus === \"threatened\" && user.credibilityScore >= CREDIBILITY_THRESHOLD_FOR_THREAT) {\n      newStatus = \"active\";\n    }\n\n    if (newStatus !== user.accountStatus) {\n      await db\n        .update(users)\n        .set({ \n          accountStatus: newStatus,\n          updatedAt: new Date(),\n        })\n        .where(eq(users.id, userId));\n    }\n  }\n\n  // ==================== SCOPES ====================\n  async getScope(id: string): Promise<Scope | undefined> {\n    const [scope] = await db.select().from(scopes).where(eq(scopes.id, id));\n    return scope || undefined;\n  }\n\n  async getAllScopes(): Promise<Scope[]> {\n    return await db.select().from(scopes);\n  }\n\n  async createScope(insertScope: InsertScope): Promise<Scope> {\n    // For public scopes, ensure accessCode is null\n    const scopeData = insertScope.type === \"public\" \n      ? { ...insertScope, accessCode: null }\n      : insertScope;\n    const [scope] = await db.insert(scopes).values(scopeData).returning();\n    return scope;\n  }\n\n  async deleteScope(id: string): Promise<boolean> {\n    // Get the scope to check its type\n    const scope = await this.getScope(id);\n    if (!scope) {\n      throw new Error(\"Scope not found\");\n    }\n\n    // If it's a grade scope, check for dependent section scopes\n    if (scope.type === \"grade\" && scope.gradeNumber) {\n      const dependentSections = await db\n        .select()\n        .from(scopes)\n        .where(\n          and(\n            eq(scopes.type, \"section\"),\n            sql`${scopes.sectionName} LIKE ${scope.gradeNumber + '-%'}`\n          )\n        );\n      \n      if (dependentSections.length > 0) {\n        throw new Error(`Cannot delete grade scope: ${dependentSections.length} class section(s) belong to this grade. Delete the class sections first.`);\n      }\n    }\n\n    // Check if scope has digital keys (users with access)\n    const keysCount = await db\n      .select({ count: sql<number>`COUNT(*)` })\n      .from(digitalKeys)\n      .where(eq(digitalKeys.scopeId, id));\n    \n    if (keysCount[0]?.count > 0) {\n      throw new Error(`Cannot delete scope: ${keysCount[0].count} user(s) have access to this scope`);\n    }\n\n    // Check if scope has posts\n    const postsCount = await db\n      .select({ count: sql<number>`COUNT(*)` })\n      .from(posts)\n      .where(eq(posts.scopeId, id));\n    \n    if (postsCount[0]?.count > 0) {\n      throw new Error(`Cannot delete scope: ${postsCount[0].count} post(s) exist in this scope`);\n    }\n\n    // Check if scope has events\n    const eventsCount = await db\n      .select({ count: sql<number>`COUNT(*)` })\n      .from(events)\n      .where(eq(events.scopeId, id));\n    \n    if (eventsCount[0]?.count > 0) {\n      throw new Error(`Cannot delete scope: ${eventsCount[0].count} event(s) exist in this scope`);\n    }\n\n    // Check if scope has schedules\n    const schedulesCount = await db\n      .select({ count: sql<number>`COUNT(*)` })\n      .from(schedules)\n      .where(eq(schedules.scopeId, id));\n    \n    if (schedulesCount[0]?.count > 0) {\n      throw new Error(`Cannot delete scope: ${schedulesCount[0].count} schedule(s) exist in this scope`);\n    }\n\n    // All checks passed, safe to delete\n    const result = await db.delete(scopes).where(eq(scopes.id, id));\n    return result.rowCount !== null && result.rowCount > 0;\n  }\n\n  // ==================== POSTS ====================\n  async createPost(insertPost: InsertPost): Promise<Post> {\n    const [post] = await db.insert(posts).values(insertPost).returning();\n    \n    // Recalculate author's reputation after posting\n    await this.calculateUserReputation(insertPost.authorId);\n    \n    return post;\n  }\n\n  async getPosts(scopeId?: string | null, userId?: string): Promise<any[]> {\n    if (scopeId === null || scopeId === undefined) {\n      // Get public square posts (no scope) with author info\n      const results = await db\n        .select({\n          id: posts.id,\n          content: posts.content,\n          authorId: posts.authorId,\n          scopeId: posts.scopeId,\n          credibilityRating: posts.credibilityRating,\n          mediaUrl: posts.mediaUrl,\n          mediaType: posts.mediaType,\n          likesCount: posts.likesCount,\n          commentsCount: posts.commentsCount,\n          createdAt: posts.createdAt,\n          authorName: users.name,\n          authorRole: users.role,\n          authorAvatarUrl: users.avatarUrl,\n          authorCredibilityScore: users.credibilityScore,\n        })\n        .from(posts)\n        .leftJoin(users, eq(posts.authorId, users.id))\n        .where(sql`${posts.scopeId} IS NULL`)\n        .orderBy(desc(posts.createdAt));\n      \n      // Get user's liked posts if userId provided\n      const likedPostIds = userId ? (await db\n        .select({ postId: postReactions.postId })\n        .from(postReactions)\n        .where(eq(postReactions.userId, userId)))\n        .map(r => r.postId) : [];\n      \n      // Get user's accuracy ratings if userId provided (gracefully handle if table doesn't exist yet)\n      let accuracyRatings: Record<string, number> = {};\n      try {\n        if (userId) {\n          const ratings = await db\n            .select({ postId: postAccuracyRatings.postId, rating: postAccuracyRatings.rating })\n            .from(postAccuracyRatings)\n            .where(eq(postAccuracyRatings.userId, userId));\n          accuracyRatings = ratings.reduce((map, r) => ({ ...map, [r.postId]: r.rating }), {});\n        }\n      } catch (error) {\n        // Table might not exist yet, continue without accuracy ratings\n      }\n      \n      // Transform to ensure author always exists and include liked status\n      return results.map(post => {\n        return {\n          ...post,\n          isLikedByCurrentUser: likedPostIds.includes(post.id),\n          currentUserAccuracyRating: accuracyRatings[post.id] || null,\n          author: {\n            name: post.authorName || \"Unknown User\",\n            role: post.authorRole || \"student\",\n            avatarUrl: post.authorAvatarUrl,\n          },\n        };\n      });\n    }\n    \n    const results = await db\n      .select({\n        id: posts.id,\n        content: posts.content,\n        authorId: posts.authorId,\n        scopeId: posts.scopeId,\n        credibilityRating: posts.credibilityRating,\n        mediaUrl: posts.mediaUrl,\n        mediaType: posts.mediaType,\n        likesCount: posts.likesCount,\n        commentsCount: posts.commentsCount,\n        createdAt: posts.createdAt,\n        authorName: users.name,\n        authorRole: users.role,\n        authorAvatarUrl: users.avatarUrl,\n        authorCredibilityScore: users.credibilityScore,\n      })\n      .from(posts)\n      .leftJoin(users, eq(posts.authorId, users.id))\n      .where(eq(posts.scopeId, scopeId))\n      .orderBy(desc(posts.createdAt));\n    \n    // Get user's liked posts if userId provided\n    const likedPostIds = userId ? (await db\n      .select({ postId: postReactions.postId })\n      .from(postReactions)\n      .where(eq(postReactions.userId, userId)))\n      .map(r => r.postId) : [];\n    \n    // Get user's accuracy ratings if userId provided (gracefully handle if table doesn't exist yet)\n    let accuracyRatings2: Record<string, number> = {};\n    try {\n      if (userId) {\n        const ratings = await db\n          .select({ postId: postAccuracyRatings.postId, rating: postAccuracyRatings.rating })\n          .from(postAccuracyRatings)\n          .where(eq(postAccuracyRatings.userId, userId));\n        accuracyRatings2 = ratings.reduce((map, r) => ({ ...map, [r.postId]: r.rating }), {});\n      }\n    } catch (error) {\n      // Table might not exist yet, continue without accuracy ratings\n    }\n    \n    // Transform to ensure author always exists and include liked status\n    return results.map(post => {\n      return {\n        ...post,\n        isLikedByCurrentUser: likedPostIds.includes(post.id),\n        currentUserAccuracyRating: accuracyRatings2[post.id] || null,\n        author: {\n          name: post.authorName || \"Unknown User\",\n          role: post.authorRole || \"student\",\n          avatarUrl: post.authorAvatarUrl,\n        },\n      };\n    });\n  }\n\n  async getPost(id: string): Promise<Post | undefined> {\n    const [post] = await db.select().from(posts).where(eq(posts.id, id));\n    return post || undefined;\n  }\n\n  async updatePost(postId: string, content: string): Promise<Post | undefined> {\n    const [post] = await db\n      .update(posts)\n      .set({ \n        content,\n        updatedAt: new Date(),\n      })\n      .where(eq(posts.id, postId))\n      .returning();\n    return post || undefined;\n  }\n\n  async updatePostCredibility(postId: string, rating: number): Promise<Post | undefined> {\n    const [post] = await db\n      .update(posts)\n      .set({ \n        credibilityRating: rating,\n        updatedAt: new Date(),\n      })\n      .where(eq(posts.id, postId))\n      .returning();\n    \n    // Update author's overall credibility\n    if (post) {\n      const authorPosts = await db\n        .select()\n        .from(posts)\n        .where(eq(posts.authorId, post.authorId));\n      \n      const avgCredibility = authorPosts.reduce((sum, p) => sum + p.credibilityRating, 0) / authorPosts.length;\n      await this.updateUserCredibility(post.authorId, avgCredibility);\n    }\n    \n    return post || undefined;\n  }\n\n  async deletePost(postId: string): Promise<boolean> {\n    try {\n      const result = await db.delete(posts).where(eq(posts.id, postId));\n      return result.rowCount ? result.rowCount > 0 : false;\n    } catch (error) {\n      console.error(\"Failed to delete post:\", error);\n      return false;\n    }\n  }\n\n  async ratePostAccuracy(postId: string, userId: string, rating: number): Promise<PostAccuracyRating> {\n    try {\n      // Check if rating already exists\n      const existing = await db\n        .select()\n        .from(postAccuracyRatings)\n        .where(and(\n          eq(postAccuracyRatings.postId, postId),\n          eq(postAccuracyRatings.userId, userId)\n        ));\n\n      let result;\n      if (existing.length > 0) {\n        // Update existing rating\n        const [updated] = await db\n          .update(postAccuracyRatings)\n          .set({ \n            rating,\n            updatedAt: new Date(),\n          })\n          .where(and(\n            eq(postAccuracyRatings.postId, postId),\n            eq(postAccuracyRatings.userId, userId)\n          ))\n          .returning();\n        result = updated;\n      } else {\n        // Create new rating\n        const [created] = await db\n          .insert(postAccuracyRatings)\n          .values({ postId, userId, rating })\n          .returning();\n        result = created;\n      }\n\n      // Recalculate post author's credibility based on ALL accuracy ratings across ALL their posts\n      const post = await this.getPost(postId);\n      if (post) {\n        try {\n          // Get all posts by the author\n          const authorPosts = await db\n            .select({ id: posts.id })\n            .from(posts)\n            .where(eq(posts.authorId, post.authorId));\n          \n          const postIds = authorPosts.map(p => p.id);\n          \n          // Get all accuracy ratings for all author's posts\n          let allAccuracyRatings: any[] = [];\n          if (postIds.length > 0) {\n            allAccuracyRatings = await db\n              .select()\n              .from(postAccuracyRatings)\n              .where(inArray(postAccuracyRatings.postId, postIds));\n          }\n          \n          // Calculate average credibility: average of all ratings * 20\n          let avgCredibility = 50;\n          if (allAccuracyRatings.length > 0) {\n            const sumRatings = allAccuracyRatings.reduce((sum, r) => sum + r.rating, 0);\n            avgCredibility = (sumRatings / allAccuracyRatings.length) * 20;\n          }\n          \n          // Update user credibility\n          await this.updateUserCredibility(post.authorId, avgCredibility);\n        } catch (e) {\n          // Ignore errors in recalculating credibility\n        }\n      }\n\n      return result;\n    } catch (error) {\n      // If table doesn't exist or other error, throw it so the API can handle it\n      throw error;\n    }\n  }\n\n  async getUserPostAccuracyRating(postId: string, userId: string): Promise<PostAccuracyRating | undefined> {\n    const [rating] = await db\n      .select()\n      .from(postAccuracyRatings)\n      .where(and(\n        eq(postAccuracyRatings.postId, postId),\n        eq(postAccuracyRatings.userId, userId)\n      ));\n    return rating || undefined;\n  }\n\n  // ==================== EVENTS ====================\n  async createEvent(insertEvent: InsertEvent): Promise<Event> {\n    const [event] = await db.insert(events).values(insertEvent).returning();\n    return event;\n  }\n\n  async getEvents(scopeId?: string, userId?: string): Promise<any[]> {\n    const baseQuery = db\n      .select({\n        id: events.id,\n        title: events.title,\n        description: events.description,\n        eventType: events.eventType,\n        scopeId: events.scopeId,\n        startTime: events.startTime,\n        endTime: events.endTime,\n        location: events.location,\n        imageUrl: events.imageUrl,\n        createdById: events.createdById,\n        createdAt: events.createdAt,\n        createdByName: users.name,\n        createdByRole: users.role,\n        createdByAvatarUrl: users.avatarUrl,\n      })\n      .from(events)\n      .leftJoin(users, eq(events.createdById, users.id));\n\n    if (scopeId) {\n      const results = await baseQuery\n        .where(eq(events.scopeId, scopeId))\n        .orderBy(desc(events.startTime));\n      \n      // Add RSVP count and user's RSVP status for each event\n      const eventsWithRsvps = await Promise.all(\n        results.map(async (event) => {\n          const rsvps = await this.getEventRsvps(event.id);\n          const userHasRsvpd = userId ? rsvps.some(r => r.userId === userId) : false;\n          \n          return { \n            ...event, \n            rsvpCount: rsvps.length, \n            userHasRsvpd,\n            createdBy: {\n              name: event.createdByName || \"Unknown User\",\n              role: event.createdByRole || \"student\",\n              avatarUrl: event.createdByAvatarUrl,\n            }\n          };\n        })\n      );\n      return eventsWithRsvps;\n    }\n    \n    const results = await baseQuery.orderBy(desc(events.startTime));\n    \n    // Add RSVP count and user's RSVP status for each event\n    const eventsWithRsvps = await Promise.all(\n      results.map(async (event) => {\n        const rsvps = await this.getEventRsvps(event.id);\n        const userHasRsvpd = userId ? rsvps.some(r => r.userId === userId) : false;\n        \n        return { \n          ...event, \n          rsvpCount: rsvps.length, \n          userHasRsvpd,\n          createdBy: {\n            name: event.createdByName || \"Unknown User\",\n            role: event.createdByRole || \"student\",\n            avatarUrl: event.createdByAvatarUrl,\n          }\n        };\n      })\n    );\n    return eventsWithRsvps;\n  }\n\n  async rsvpToEvent(eventId: string, userId: string): Promise<EventRsvp | null> {\n    // Check if user already RSVP'd\n    const existingRsvp = await db\n      .select()\n      .from(eventRsvps)\n      .where(and(eq(eventRsvps.eventId, eventId), eq(eventRsvps.userId, userId)))\n      .limit(1);\n    \n    if (existingRsvp.length > 0) {\n      // User already RSVP'd - remove the RSVP (toggle off)\n      await db\n        .delete(eventRsvps)\n        .where(and(eq(eventRsvps.eventId, eventId), eq(eventRsvps.userId, userId)));\n      \n      // Recalculate user's reputation after un-RSVP\n      await this.calculateUserReputation(userId);\n      \n      return null; // Return null to indicate RSVP was removed\n    } else {\n      // User hasn't RSVP'd - add the RSVP (toggle on)\n      const [rsvp] = await db.insert(eventRsvps).values({ eventId, userId }).returning();\n      \n      // Recalculate user's reputation after RSVP\n      await this.calculateUserReputation(userId);\n      \n      return rsvp;\n    }\n  }\n\n  async getEventRsvps(eventId: string): Promise<EventRsvp[]> {\n    return await db.select().from(eventRsvps).where(eq(eventRsvps.eventId, eventId));\n  }\n\n  async getUserRsvps(userId: string): Promise<EventRsvp[]> {\n    return await db.select().from(eventRsvps).where(eq(eventRsvps.userId, userId));\n  }\n\n  async getEventAttendees(eventId: string): Promise<User[]> {\n    const attendees = await db\n      .select()\n      .from(eventRsvps)\n      .innerJoin(users, eq(eventRsvps.userId, users.id))\n      .where(eq(eventRsvps.eventId, eventId))\n      .orderBy(users.name);\n    \n    return attendees.map(row => row.users);\n  }\n\n  // ==================== SCHEDULES ====================\n  async createSchedule(insertSchedule: InsertSchedule): Promise<Schedule> {\n    const [schedule] = await db.insert(schedules).values(insertSchedule).returning();\n    return schedule;\n  }\n\n  async getSchedules(scopeId: string): Promise<Schedule[]> {\n    return await db\n      .select()\n      .from(schedules)\n      .where(eq(schedules.scopeId, scopeId))\n      .orderBy(schedules.dayOfWeek, schedules.periodNumber);\n  }\n\n  async updateSchedule(id: string, teacherName: string, subject: string): Promise<Schedule | undefined> {\n    const [schedule] = await db\n      .update(schedules)\n      .set({ \n        teacherName,\n        subject,\n        updatedAt: new Date(),\n      })\n      .where(eq(schedules.id, id))\n      .returning();\n    return schedule || undefined;\n  }\n\n  async bulkUpdateSchedules(scopeId: string, updates: Array<{ dayOfWeek: number; periodNumber: number; subject: string | null; teacherName: string | null }>): Promise<void> {\n    for (const update of updates) {\n      // Check if schedule exists for this slot\n      const [existing] = await db\n        .select()\n        .from(schedules)\n        .where(\n          and(\n            eq(schedules.scopeId, scopeId),\n            eq(schedules.dayOfWeek, update.dayOfWeek),\n            eq(schedules.periodNumber, update.periodNumber)\n          )\n        );\n\n      if (existing) {\n        // Update existing schedule\n        await db\n          .update(schedules)\n          .set({\n            subject: update.subject,\n            teacherName: update.teacherName,\n            updatedAt: new Date(),\n          })\n          .where(eq(schedules.id, existing.id));\n      } else if (update.subject || update.teacherName) {\n        // Create new schedule entry only if there's actual data\n        await db.insert(schedules).values({\n          scopeId,\n          dayOfWeek: update.dayOfWeek,\n          periodNumber: update.periodNumber,\n          subject: update.subject,\n          teacherName: update.teacherName,\n        });\n      }\n    }\n  }\n\n  // ==================== TEACHERS ====================\n  async createTeacher(insertTeacher: InsertTeacher): Promise<Teacher> {\n    const [teacher] = await db.insert(teachers).values(insertTeacher).returning();\n    return teacher;\n  }\n\n  async getTeachers(): Promise<Teacher[]> {\n    return await db.select().from(teachers);\n  }\n\n  async getTeacher(id: string): Promise<Teacher | undefined> {\n    const [teacher] = await db.select().from(teachers).where(eq(teachers.id, id));\n    return teacher || undefined;\n  }\n\n  async updateTeacher(id: string, updates: Partial<InsertTeacher>): Promise<Teacher | undefined> {\n    const [updated] = await db\n      .update(teachers)\n      .set({ ...updates, updatedAt: new Date() })\n      .where(eq(teachers.id, id))\n      .returning();\n    return updated || undefined;\n  }\n\n  async deleteTeacher(id: string): Promise<boolean> {\n    const result = await db.delete(teachers).where(eq(teachers.id, id));\n    return result.rowCount !== null && result.rowCount > 0;\n  }\n\n  async getTeacherWithReviews(id: string): Promise<{ teacher: Teacher; reviews: TeacherReview[]; averageRating: number } | undefined> {\n    const teacher = await this.getTeacher(id);\n    if (!teacher) return undefined;\n\n    const reviews = await this.getTeacherReviews(id);\n    \n    const averageRating = reviews.length > 0\n      ? reviews.reduce((sum, review) => sum + review.rating, 0) / reviews.length\n      : 0;\n\n    return { teacher, reviews, averageRating };\n  }\n\n  async createTeacherReview(insertReview: InsertTeacherReview): Promise<TeacherReview> {\n    const [review] = await db.insert(teacherReviews).values(insertReview).returning();\n    return review;\n  }\n\n  async getTeacherReviews(teacherId: string): Promise<TeacherReview[]> {\n    return await db\n      .select()\n      .from(teacherReviews)\n      .where(eq(teacherReviews.teacherId, teacherId))\n      .orderBy(desc(teacherReviews.createdAt));\n  }\n\n  async createTeacherFeedback(insertFeedback: InsertTeacherFeedback): Promise<TeacherFeedback> {\n    const [feedback] = await db.insert(teacherFeedback).values(insertFeedback).returning();\n    return feedback;\n  }\n\n  async getTeacherFeedbackByStudent(teacherId: string, studentId: string): Promise<TeacherFeedback | undefined> {\n    const [feedback] = await db\n      .select()\n      .from(teacherFeedback)\n      .where(\n        and(\n          eq(teacherFeedback.teacherId, teacherId),\n          eq(teacherFeedback.studentId, studentId)\n        )\n      );\n    return feedback || undefined;\n  }\n\n  async updateTeacherFeedback(teacherId: string, studentId: string, updates: Partial<InsertTeacherFeedback>): Promise<TeacherFeedback | undefined> {\n    const [feedback] = await db\n      .update(teacherFeedback)\n      .set(updates)\n      .where(\n        and(\n          eq(teacherFeedback.teacherId, teacherId),\n          eq(teacherFeedback.studentId, studentId)\n        )\n      )\n      .returning();\n    return feedback || undefined;\n  }\n\n  async getTeacherFeedback(teacherId: string): Promise<TeacherFeedback[]> {\n    return await db\n      .select()\n      .from(teacherFeedback)\n      .where(eq(teacherFeedback.teacherId, teacherId))\n      .orderBy(desc(teacherFeedback.createdAt));\n  }\n\n  async getTeacherFeedbackStats(teacherId: string): Promise<{ averages: Record<string, number>; count: number }> {\n    const feedbacks = await this.getTeacherFeedback(teacherId);\n    \n    if (feedbacks.length === 0) {\n      return {\n        averages: {\n          clarity: 0,\n          instruction: 0,\n          communication: 0,\n          patience: 0,\n          motivation: 0,\n          improvement: 0,\n        },\n        count: 0,\n      };\n    }\n\n    const totals = feedbacks.reduce(\n      (acc, f) => ({\n        clarity: acc.clarity + f.clarity,\n        instruction: acc.instruction + f.instruction,\n        communication: acc.communication + f.communication,\n        patience: acc.patience + f.patience,\n        motivation: acc.motivation + f.motivation,\n        improvement: acc.improvement + f.improvement,\n      }),\n      { clarity: 0, instruction: 0, communication: 0, patience: 0, motivation: 0, improvement: 0 }\n    );\n\n    const count = feedbacks.length;\n\n    return {\n      averages: {\n        clarity: totals.clarity / count,\n        instruction: totals.instruction / count,\n        communication: totals.communication / count,\n        patience: totals.patience / count,\n        motivation: totals.motivation / count,\n        improvement: totals.improvement / count,\n      },\n      count,\n    };\n  }\n\n  // ==================== POST COMMENTS ====================\n  async createPostComment(insertComment: InsertPostComment): Promise<PostComment> {\n    const [comment] = await db.insert(postComments).values(insertComment).returning();\n    await db\n      .update(posts)\n      .set({ commentsCount: sql`${posts.commentsCount} + 1` })\n      .where(eq(posts.id, insertComment.postId));\n    return comment;\n  }\n\n  async getPostComments(postId: string): Promise<Array<PostComment & { authorName?: string; authorRole?: string; authorAvatarUrl?: string | null }>> {\n    const results = await db\n      .select({\n        id: postComments.id,\n        postId: postComments.postId,\n        content: postComments.content,\n        createdAt: postComments.createdAt,\n        authorId: postComments.authorId,\n        authorName: users.name,\n        authorRole: users.role,\n        authorAvatarUrl: users.avatarUrl,\n      })\n      .from(postComments)\n      .leftJoin(users, eq(postComments.authorId, users.id))\n      .where(eq(postComments.postId, postId))\n      .orderBy(desc(postComments.createdAt));\n    \n    return results as Array<PostComment & { authorName?: string; authorRole?: string; authorAvatarUrl?: string | null }>;\n  }\n\n  // ==================== EVENT COMMENTS ====================\n  async createEventComment(insertComment: InsertEventComment): Promise<EventComment> {\n    const [comment] = await db.insert(eventComments).values(insertComment).returning();\n    return comment;\n  }\n\n  async getEventComments(eventId: string): Promise<Array<EventComment & { authorName?: string; authorRole?: string; authorAvatarUrl?: string | null }>> {\n    const results = await db\n      .select({\n        id: eventComments.id,\n        eventId: eventComments.eventId,\n        content: eventComments.content,\n        createdAt: eventComments.createdAt,\n        authorId: eventComments.authorId,\n        authorName: users.name,\n        authorRole: users.role,\n        authorAvatarUrl: users.avatarUrl,\n      })\n      .from(eventComments)\n      .leftJoin(users, eq(eventComments.authorId, users.id))\n      .where(eq(eventComments.eventId, eventId))\n      .orderBy(desc(eventComments.createdAt));\n    \n    return results as Array<EventComment & { authorName?: string; authorRole?: string; authorAvatarUrl?: string | null }>;\n  }\n\n  // ==================== PROFILE COMMENTS ====================\n  async createProfileComment(insertComment: InsertProfileComment): Promise<ProfileComment> {\n    const [comment] = await db.insert(profileComments).values(insertComment).returning();\n    return comment;\n  }\n\n  async getProfileComments(profileUserId: string): Promise<Array<ProfileComment & { authorName?: string; authorRole?: string; authorAvatarUrl?: string | null }>> {\n    const results = await db\n      .select({\n        id: profileComments.id,\n        profileUserId: profileComments.profileUserId,\n        content: profileComments.content,\n        rating: profileComments.rating,\n        createdAt: profileComments.createdAt,\n        authorId: profileComments.authorId,\n        authorName: users.name,\n        authorRole: users.role,\n        authorAvatarUrl: users.avatarUrl,\n      })\n      .from(profileComments)\n      .leftJoin(users, eq(profileComments.authorId, users.id))\n      .where(eq(profileComments.profileUserId, profileUserId))\n      .orderBy(desc(profileComments.createdAt));\n    \n    return results as Array<ProfileComment & { authorName?: string; authorRole?: string; authorAvatarUrl?: string | null }>;\n  }\n\n  // ==================== POST REACTIONS ====================\n  async createPostReaction(postId: string, userId: string): Promise<PostReaction> {\n    const [reaction] = await db\n      .insert(postReactions)\n      .values({ postId, userId })\n      .returning();\n    \n    // Increment likes count\n    await db\n      .update(posts)\n      .set({ likesCount: sql`${posts.likesCount} + 1` })\n      .where(eq(posts.id, postId));\n    \n    return reaction;\n  }\n\n  async deletePostReaction(postId: string, userId: string): Promise<void> {\n    const result = await db\n      .delete(postReactions)\n      .where(\n        and(\n          eq(postReactions.postId, postId),\n          eq(postReactions.userId, userId)\n        )\n      )\n      .returning();\n    \n    // Only decrement likes count if a reaction was actually deleted\n    if (result.length > 0) {\n      await db\n        .update(posts)\n        .set({ likesCount: sql`GREATEST(${posts.likesCount} - 1, 0)` })\n        .where(eq(posts.id, postId));\n    }\n  }\n\n  async getUserPostReaction(postId: string, userId: string): Promise<PostReaction | undefined> {\n    const [reaction] = await db\n      .select()\n      .from(postReactions)\n      .where(\n        and(\n          eq(postReactions.postId, postId),\n          eq(postReactions.userId, userId)\n        )\n      );\n    \n    return reaction;\n  }\n\n\n  // ==================== SETTINGS ====================\n  async getSetting(key: string): Promise<Setting | undefined> {\n    const [setting] = await db\n      .select()\n      .from(settings)\n      .where(eq(settings.key, key));\n    return setting || undefined;\n  }\n\n  async setSetting(key: string, value: string): Promise<Setting> {\n    const existingSetting = await this.getSetting(key);\n\n    if (existingSetting) {\n      // Update existing setting\n      const [updated] = await db\n        .update(settings)\n        .set({\n          value,\n          updatedAt: new Date(),\n        })\n        .where(eq(settings.key, key))\n        .returning();\n      return updated;\n    } else {\n      // Insert new setting\n      const [inserted] = await db\n        .insert(settings)\n        .values({\n          key,\n          value,\n        })\n        .returning();\n      return inserted;\n    }\n  }\n\n  // ==================== PASSWORD RESET ====================\n  async createPasswordResetToken(userId: string): Promise<string> {\n    // Generate a random token\n    const token = Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);\n    \n    // Delete any existing tokens for this user\n    await db.delete(passwordResetTokens).where(eq(passwordResetTokens.userId, userId));\n    \n    // Create new token (expires in 1 hour)\n    const expiresAt = new Date(Date.now() + 60 * 60 * 1000);\n    await db.insert(passwordResetTokens).values({\n      userId,\n      token,\n      expiresAt,\n    });\n    \n    return token;\n  }\n\n  async validatePasswordResetToken(token: string): Promise<User | undefined> {\n    const [resetToken] = await db\n      .select()\n      .from(passwordResetTokens)\n      .where(eq(passwordResetTokens.token, token));\n\n    if (!resetToken || resetToken.expiresAt < new Date()) {\n      return undefined;\n    }\n\n    const user = await this.getUser(resetToken.userId);\n    return user;\n  }\n\n  async resetPassword(token: string, newPassword: string): Promise<boolean> {\n    try {\n      return await db.transaction(async (tx) => {\n        const [resetToken] = await tx\n          .select()\n          .from(passwordResetTokens)\n          .where(eq(passwordResetTokens.token, token));\n\n        if (!resetToken || resetToken.expiresAt < new Date()) {\n          return false;\n        }\n\n        const hashedPassword = await bcrypt.hash(newPassword, 10);\n\n        await tx\n          .update(users)\n          .set({ password: hashedPassword })\n          .where(eq(users.id, resetToken.userId));\n\n        await tx.delete(passwordResetTokens).where(eq(passwordResetTokens.token, token));\n\n        return true;\n      });\n    } catch (error) {\n      console.error(\"Failed to reset password:\", error);\n      return false;\n    }\n  }\n\n  // ==================== FRIENDS ====================\n  async sendFriendRequest(user1Id: string, user2Id: string): Promise<Friendship> {\n    const [lowerId, higherId] = [user1Id, user2Id].sort();\n    \n    const [friendship] = await db\n      .insert(friendships)\n      .values({\n        user1Id: lowerId,\n        user2Id: higherId,\n        initiatorId: user1Id,\n        status: \"pending\",\n      })\n      .returning();\n    \n    return friendship;\n  }\n\n  async acceptFriendRequest(friendshipId: string): Promise<Friendship | undefined> {\n    const [friendship] = await db\n      .update(friendships)\n      .set({ status: \"accepted\", updatedAt: new Date() })\n      .where(eq(friendships.id, friendshipId))\n      .returning();\n    \n    return friendship || undefined;\n  }\n\n  async rejectFriendRequest(friendshipId: string): Promise<Friendship | undefined> {\n    const [friendship] = await db\n      .update(friendships)\n      .set({ status: \"rejected\", updatedAt: new Date() })\n      .where(eq(friendships.id, friendshipId))\n      .returning();\n    \n    return friendship || undefined;\n  }\n\n  async getFriends(userId: string): Promise<User[]> {\n    const friendshipsData = await db\n      .select()\n      .from(friendships)\n      .where(\n        and(\n          sql`(${friendships.user1Id} = ${userId} OR ${friendships.user2Id} = ${userId})`,\n          eq(friendships.status, \"accepted\")\n        )\n      );\n    \n    const friendIds = friendshipsData.map((f) =>\n      f.user1Id === userId ? f.user2Id : f.user1Id\n    );\n    \n    if (friendIds.length === 0) return [];\n    \n    const friends = await db\n      .select()\n      .from(users)\n      .where(inArray(users.id, friendIds));\n    \n    return friends;\n  }\n\n  async getPendingFriendRequests(userId: string): Promise<Array<Friendship & { initiator: User }>> {\n    const requests = await db\n      .select({\n        friendship: friendships,\n        initiator: users,\n      })\n      .from(friendships)\n      .innerJoin(users, eq(friendships.initiatorId, users.id))\n      .where(\n        and(\n          sql`(${friendships.user1Id} = ${userId} OR ${friendships.user2Id} = ${userId})`,\n          eq(friendships.status, \"pending\"),\n          sql`${friendships.initiatorId} != ${userId}`\n        )\n      );\n    \n    return requests.map((r) => ({ ...r.friendship, initiator: r.initiator }));\n  }\n\n  async unfriend(user1Id: string, user2Id: string): Promise<boolean> {\n    const [lowerId, higherId] = [user1Id, user2Id].sort();\n    \n    const result = await db\n      .delete(friendships)\n      .where(\n        and(\n          eq(friendships.user1Id, lowerId),\n          eq(friendships.user2Id, higherId)\n        )\n      );\n    \n    return true;\n  }\n\n  async getFriendship(user1Id: string, user2Id: string): Promise<Friendship | undefined> {\n    const [lowerId, higherId] = [user1Id, user2Id].sort();\n    \n    const [friendship] = await db\n      .select()\n      .from(friendships)\n      .where(\n        and(\n          eq(friendships.user1Id, lowerId),\n          eq(friendships.user2Id, higherId)\n        )\n      );\n    \n    return friendship || undefined;\n  }\n\n  // ==================== CHAT ====================\n  async sendChatMessage(senderId: string, receiverId: string, content: string): Promise<ChatMessage> {\n    const [message] = await db\n      .insert(chatMessages)\n      .values({\n        senderId,\n        receiverId,\n        content,\n        isRead: false,\n      })\n      .returning();\n    \n    return message;\n  }\n\n  async getChatMessages(user1Id: string, user2Id: string): Promise<ChatMessage[]> {\n    const messages = await db\n      .select()\n      .from(chatMessages)\n      .where(\n        sql`(${chatMessages.senderId} = ${user1Id} AND ${chatMessages.receiverId} = ${user2Id}) OR (${chatMessages.senderId} = ${user2Id} AND ${chatMessages.receiverId} = ${user1Id})`\n      )\n      .orderBy(chatMessages.createdAt);\n    \n    return messages;\n  }\n\n  async markMessageAsRead(messageId: string): Promise<ChatMessage | undefined> {\n    const [message] = await db\n      .update(chatMessages)\n      .set({ isRead: true })\n      .where(eq(chatMessages.id, messageId))\n      .returning();\n    \n    return message || undefined;\n  }\n\n  async getUnreadMessageCount(userId: string): Promise<number> {\n    const result = await db\n      .select({ count: sql<number>`count(*)` })\n      .from(chatMessages)\n      .where(\n        and(\n          eq(chatMessages.receiverId, userId),\n          eq(chatMessages.isRead, false)\n        )\n      );\n    \n    return Number(result[0]?.count || 0);\n  }\n\n  // ==================== CONTENT MODERATION ====================\n  async createViolation(violation: InsertContentViolation): Promise<ContentViolation> {\n    const [created] = await db\n      .insert(contentViolations)\n      .values(violation)\n      .returning();\n    \n    return created;\n  }\n\n  async getUserViolations(userId: string): Promise<ContentViolation[]> {\n    const violations = await db\n      .select()\n      .from(contentViolations)\n      .where(eq(contentViolations.authorId, userId))\n      .orderBy(desc(contentViolations.createdAt));\n    \n    return violations;\n  }\n\n  async getUserViolationCount(userId: string): Promise<number> {\n    const result = await db\n      .select({ count: sql<number>`count(*)` })\n      .from(contentViolations)\n      .where(eq(contentViolations.authorId, userId));\n    \n    return Number(result[0]?.count || 0);\n  }\n\n  // ==================== PUNISHMENTS ====================\n  async createPunishment(punishment: InsertUserPunishment): Promise<UserPunishment> {\n    const [created] = await db\n      .insert(userPunishments)\n      .values(punishment)\n      .returning();\n    \n    return created;\n  }\n\n  async getUserPunishments(userId: string): Promise<UserPunishment[]> {\n    const punishments = await db\n      .select()\n      .from(userPunishments)\n      .where(eq(userPunishments.userId, userId))\n      .orderBy(desc(userPunishments.createdAt));\n    \n    return punishments;\n  }\n\n  async applyPunishment(userId: string, credibilityPenalty: number, banUntil?: Date): Promise<User | undefined> {\n    const user = await this.getUser(userId);\n    if (!user) return undefined;\n    \n    const newCredibility = Math.max(0, user.credibilityScore - credibilityPenalty);\n    \n    const updates: any = {\n      credibilityScore: newCredibility,\n      updatedAt: new Date(),\n    };\n    \n    if (banUntil) {\n      updates.accountStatus = \"suspended\";\n    } else if (newCredibility < CREDIBILITY_THRESHOLD_FOR_THREAT) {\n      updates.accountStatus = \"threatened\";\n    }\n    \n    const [updated] = await db\n      .update(users)\n      .set(updates)\n      .where(eq(users.id, userId))\n      .returning();\n    \n    return updated || undefined;\n  }\n}\n\nexport const storage = new DatabaseStorage();\n","path":null,"size_bytes":72696,"size_tokens":null},"replit.md":{"content":"# School Community Ecosystem\n\n## Overview\n\nThis project is a social platform designed for students, teachers, and administrators within a school environment. Its primary purpose is to create a gamified community experience, leveraging a reputation-based access control system. Key capabilities include news feeds, event management with RSVP, class schedules, teacher profiles with review functionality, and a comprehensive gamification system featuring credibility scores and reputation rankings. The platform aims to foster engagement, streamline school communications, and enhance community interaction through a structured and rewarding digital environment with a strong business vision for enhancing educational community interaction and potential market growth.\n\n## User Preferences\n\nPreferred communication style: Simple, everyday language.\n\n## System Architecture\n\n### UI/UX Decisions\n\nThe platform features a modern and premium design, incorporating a vibrant color palette (rich purple, vibrant teal, warm coral), Inter and Outfit typography, and consistent design elements like 0.875rem border radii. It utilizes an elevation system with colored shadows, glassmorphism effects, and smooth 300ms animations. Key design principles include clear hierarchy, generous whitespace, consistency, dark/light mode harmony, micro-interactions, and accessibility. The home page features a hero section, 4-column stat card grid, quick action cards, a mini calendar, and a featured news section. Responsive design is implemented with breakpoints for mobile, tablet, and desktop, using a defined spacing scale and container strategy.\n\n**Navigation Controls:** Sidebar can be toggled via Tab key (desktop) or swipe gesture from left edge (mobile), removing need for manual trigger button.\n\n### Technical Implementations\n\nThe frontend is built with React, TypeScript, and Vite, utilizing Shadcn UI (based on Radix UI) with Tailwind CSS for styling. State management is handled by TanStack Query for server state and React hooks for local state, with Wouter for client-side routing. The backend uses Node.js and Express, providing a RESTful API. Drizzle ORM with a PostgreSQL dialect manages database interactions. The project is structured as a monorepo (`/client`, `/server`, `/shared`) for full-stack type safety.\n\n### Feature Specifications\n\n-   **Navigation**: Sticky header with backdrop blur, gradient accent sidebar, distinguished admin items.\n-   **Cards & Containers**: Rounded corners, colored shadows, hover elevation, gradient fills on stat cards.\n-   **Buttons & Interactive Elements**: Gradient backgrounds, smooth hover effects, badge styling, accessible focus rings.\n-   **Forms & Inputs**: Clean design, rounded corners, proper label hierarchy, validation states.\n-   **News & Posts**: Public square posts visible to all users on news page; scope-specific posts only visible to users with access to that scope. Scope selector allows filtering by public square, grade scopes, or class section scopes. Public square is the default scope on news page.\n-   **Teacher Management**: Teachers can be assigned to multiple subjects and sections. Admin interface allows selecting which subjects and sections each teacher teaches.\n-   **Schedule Auto-Population**: In the schedule page (Sunday-Thursday school week), when a subject is selected, the teacher dropdown auto-populates with only teachers who teach that subject in the user's class section. Teacher is automatically cleared when subject changes.\n-   **Authentication System**: Three-tier system for Admins, Students, and Visitors.\n    -   **Admin Auth**: Requires one-time invitation code, unique credentials, auto-generated student IDs, separate UI flow, 7-day persistent login.\n    -   **Student Auth**: Standard username/password, 7-day persistent login, full account creation.\n    -   **Visitor Access**: Session-only, read-only, single-click access with restricted UI.\n        -   **Hidden from Visitors**: Profile card, Schedule/Calendar card, Community Highlights section on home page; Profile and Schedule links in sidebar.\n        -   **Visible to Visitors**: Activity Status card, Quick Access card, all other navigation (Home, News, Grades, Events, Teachers, Settings, Support).\n    -   **Security**: Failed login tracking (3 attempts, 15-min lockout), `remember-me` tokens with sliding expiration, HttpOnly cookies, PostgreSQL-backed sessions.\n    -   **Password Recovery**: Includes `password_reset_tokens` table, backend endpoints for forgot/reset password, token validation, and a frontend page.\n-   **Admin Account Seeding**: Automatic creation of 2 admin accounts on server startup, configured via environment variables.\n\n### System Design Choices\n\n-   **Access Code Pattern**: \"Secret Access Codes\" and \"Digital Keys\" manage content creation and access within school scopes (global, grade, class).\n-   **Credibility & Reputation Engine**: Dual-score system (credibility for content, reputation for contribution) with automatic account status adjustments.\n-   **Admin Succession Protocol**: One-click handover mechanism for admin privileges.\n-   **Session-Based Authentication**: Utilizes `express-session` with HttpOnly cookies and a 7-day expiration.\n-   **Peer Rating System**: Students can rate peers on 15 performance metrics, aggregated on user profiles. Self-rating is prevented.\n-   **Profile Social Features**: Profile comments for peer feedback, clickable avatars/names.\n-   **Server-Authoritative Social Interactions**: Post likes tracked server-side, `isLikedByCurrentUser` included in queries, safeguards for counter updates.\n-   **Support System**: Configurable donation URL system for external fundraising.\n\n### Database Schema\n\nIncludes tables for `Users` (roles, gamification scores, peer-ratable metrics), `Scopes`, `DigitalKeys`, `Posts`, `Events`, `Schedules`, `Teachers` (with review system), `PeerRatings`, `ProfileComments`, `PostReactions`, `Settings`, `failed_login_attempts`, and `remember_me_tokens`.\n\n**Scopes System:** Three-tier hierarchy with public square scope (always accessible), grade scopes (grades 1-6), and class section scopes (format: grade-section, e.g., \"1-A\"). Each non-public scope has a unique access code. Admin UI provides full CRUD capabilities with comprehensive validation:\n- Public square: Always accessible scope with no access code required\n- Grade scopes: 6 grades with unique access codes (e.g., gaDrIE5Lo0, SolELo74F)\n- Class scopes: 30 sections across 6 grades (5 sections per grade: A-E) with unique codes (e.g., jtKJdrDS9K, HJdr3cVj90p)\n- Referential integrity: Cannot delete grade scopes while child sections exist; cannot delete scopes with users, posts, events, or schedules\n- Parent-child validation: Section scopes require parent grade scope to exist before creation\n- Automatic seeding on server boot with safe duplicate-check logic (1 public + 6 grades + 30 sections = 37 total scopes)\n\n## External Dependencies\n\n-   **Database**: Neon Serverless PostgreSQL (with WebSocket support and connection pooling).\n-   **UI Library**: Radix UI primitives and Shadcn UI.\n-   **Form Handling**: React Hook Form with Zod.\n-   **Styling**: Tailwind CSS, PostCSS, `class-variance-authority`, `clsx`, `tailwind-merge`.\n-   **Development Tools**: TypeScript, Drizzle Kit, ESBuild, Vite plugins.\n-   **Fonts**: Google Fonts (Inter, Outfit) via CDN.\n-   **Session Storage**: `express-session` with `connect-pg-simple`.","path":null,"size_bytes":7445,"size_tokens":null},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","path":null,"size_bytes":7609,"size_tokens":null},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  // Whitespace-nowrap: Badges should never wrap.\n  \"whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\" +\n  \" hover-elevate \" ,\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground shadow-xs\",\n        secondary: \"border-transparent bg-secondary text-secondary-foreground\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground shadow-xs\",\n\n        outline: \" border [border-color:var(--badge-outline)] shadow-xs\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  },\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  );\n}\n\nexport { Badge, badgeVariants }\n","path":null,"size_bytes":1202,"size_tokens":null},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 1000000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","path":null,"size_bytes":3895,"size_tokens":null},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","path":null,"size_bytes":1753,"size_tokens":null},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","path":null,"size_bytes":261,"size_tokens":null},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":711,"size_tokens":null},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","path":null,"size_bytes":710,"size_tokens":null},"server/seed.ts":{"content":"import { storage } from \"./storage\";\n\nasync function seed() {\n  console.log(\"🌱 Seeding database...\");\n  \n  try {\n    // Create global scope\n    const globalScope = await storage.createScope({\n      name: \"Public Square\",\n      type: \"global\",\n      accessCode: \"PUBLIC123\",\n    });\n    console.log(\"✓ Created Global scope\");\n    \n    // Create 22 class sections as specified:\n    // Classes 1-4: 4 groups each (A, B, C, D)\n    // Class 5: 5 groups (A, B, C, D, E)\n    // Class 6: 1 group (A)\n    \n    const classes = [\n      { classNum: 1, groups: ['A', 'B', 'C', 'D'] },\n      { classNum: 2, groups: ['A', 'B', 'C', 'D'] },\n      { classNum: 3, groups: ['A', 'B', 'C', 'D'] },\n      { classNum: 4, groups: ['A', 'B', 'C', 'D'] },\n      { classNum: 5, groups: ['A', 'B', 'C', 'D', 'E'] },\n      { classNum: 6, groups: ['A'] },\n    ];\n    \n    console.log(\"\\n📚 Creating class sections:\");\n    for (const { classNum, groups } of classes) {\n      for (const group of groups) {\n        const sectionName = `${classNum}-${group}`;\n        const accessCode = `CLASS${classNum}${group}`;\n        \n        await storage.createScope({\n          name: `Class ${sectionName}`,\n          type: \"section\",\n          sectionName,\n          accessCode,\n        });\n        \n        console.log(`  ✓ Class ${sectionName} (Code: ${accessCode})`);\n      }\n    }\n    \n    console.log(\"\\n📋 Access Codes Summary:\");\n    console.log(\"─────────────────────────────────────\");\n    console.log(\"Global:\");\n    console.log(\"  • Public Square: PUBLIC123\");\n    console.log(\"\\nClass Sections (22 total):\");\n    console.log(\"  Classes 1-4 (A, B, C, D groups):\");\n    console.log(\"    • 1-A: CLASS1A, 1-B: CLASS1B, 1-C: CLASS1C, 1-D: CLASS1D\");\n    console.log(\"    • 2-A: CLASS2A, 2-B: CLASS2B, 2-C: CLASS2C, 2-D: CLASS2D\");\n    console.log(\"    • 3-A: CLASS3A, 3-B: CLASS3B, 3-C: CLASS3C, 3-D: CLASS3D\");\n    console.log(\"    • 4-A: CLASS4A, 4-B: CLASS4B, 4-C: CLASS4C, 4-D: CLASS4D\");\n    console.log(\"  Class 5 (A, B, C, D, E groups):\");\n    console.log(\"    • 5-A: CLASS5A, 5-B: CLASS5B, 5-C: CLASS5C, 5-D: CLASS5D, 5-E: CLASS5E\");\n    console.log(\"  Class 6 (A group only):\");\n    console.log(\"    • 6-A: CLASS6A\");\n    console.log(\"─────────────────────────────────────\");\n    \n    console.log(\"\\n✅ Seeding complete! Created 23 scopes (1 global + 22 class sections)\");\n  } catch (error) {\n    console.error(\"❌ Seeding failed:\", error);\n  }\n}\n\nseed();\n","path":null,"size_bytes":2607,"size_tokens":null},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","path":null,"size_bytes":5128,"size_tokens":null},"client/src/components/ui/sidebar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, VariantProps } from \"class-variance-authority\"\nimport { PanelLeftIcon } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nfunction SidebarProvider({\n  defaultOpen = true,\n  open: openProp,\n  onOpenChange: setOpenProp,\n  className,\n  style,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  defaultOpen?: boolean\n  open?: boolean\n  onOpenChange?: (open: boolean) => void\n}) {\n  const isMobile = useIsMobile()\n  const [openMobile, setOpenMobile] = React.useState(false)\n\n  // This is the internal state of the sidebar.\n  // We use openProp and setOpenProp for control from outside the component.\n  const [_open, _setOpen] = React.useState(defaultOpen)\n  const open = openProp ?? _open\n  const setOpen = React.useCallback(\n    (value: boolean | ((value: boolean) => boolean)) => {\n      const openState = typeof value === \"function\" ? value(open) : value\n      if (setOpenProp) {\n        setOpenProp(openState)\n      } else {\n        _setOpen(openState)\n      }\n\n      // This sets the cookie to keep the sidebar state.\n      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n    },\n    [setOpenProp, open]\n  )\n\n  // Helper to toggle the sidebar.\n  const toggleSidebar = React.useCallback(() => {\n    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open)\n  }, [isMobile, setOpen, setOpenMobile])\n\n  // Adds a keyboard shortcut to toggle the sidebar.\n  React.useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (\n        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n        (event.metaKey || event.ctrlKey)\n      ) {\n        event.preventDefault()\n        toggleSidebar()\n      }\n    }\n\n    window.addEventListener(\"keydown\", handleKeyDown)\n    return () => window.removeEventListener(\"keydown\", handleKeyDown)\n  }, [toggleSidebar])\n\n  // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n  // This makes it easier to style the sidebar with Tailwind classes.\n  const state = open ? \"expanded\" : \"collapsed\"\n\n  const contextValue = React.useMemo<SidebarContextProps>(\n    () => ({\n      state,\n      open,\n      setOpen,\n      isMobile,\n      openMobile,\n      setOpenMobile,\n      toggleSidebar,\n    }),\n    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n  )\n\n  return (\n    <SidebarContext.Provider value={contextValue}>\n      <TooltipProvider delayDuration={0}>\n        <div\n          data-slot=\"sidebar-wrapper\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH,\n              \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n              ...style,\n            } as React.CSSProperties\n          }\n          className={cn(\n            \"group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full\",\n            className\n          )}\n          {...props}\n        >\n          {children}\n        </div>\n      </TooltipProvider>\n    </SidebarContext.Provider>\n  )\n}\n\nfunction Sidebar({\n  side = \"left\",\n  variant = \"sidebar\",\n  collapsible = \"offcanvas\",\n  className,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  side?: \"left\" | \"right\"\n  variant?: \"sidebar\" | \"floating\" | \"inset\"\n  collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n}) {\n  const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n  if (collapsible === \"none\") {\n    return (\n      <div\n        data-slot=\"sidebar\"\n        className={cn(\n          \"bg-sidebar text-sidebar-foreground flex h-full w-[var(--sidebar-width)] flex-col\",\n          className\n        )}\n        {...props}\n      >\n        {children}\n      </div>\n    )\n  }\n\n  if (isMobile) {\n    return (\n      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n        <SheetContent\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar\"\n          data-mobile=\"true\"\n          className=\"bg-sidebar text-sidebar-foreground w-[var(--sidebar-width)] p-0 [&>button]:hidden\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n            } as React.CSSProperties\n          }\n          side={side}\n        >\n          <SheetHeader className=\"sr-only\">\n            <SheetTitle>Sidebar</SheetTitle>\n            <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n          </SheetHeader>\n          <div className=\"flex h-full w-full flex-col\">{children}</div>\n        </SheetContent>\n      </Sheet>\n    )\n  }\n\n  return (\n    <div\n      className=\"group peer text-sidebar-foreground hidden md:block\"\n      data-state={state}\n      data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n      data-variant={variant}\n      data-side={side}\n      data-slot=\"sidebar\"\n    >\n      {/* This is what handles the sidebar gap on desktop */}\n      <div\n        data-slot=\"sidebar-gap\"\n        className={cn(\n          \"relative w-[var(--sidebar-width)] bg-transparent transition-[width] duration-200 ease-linear\",\n          \"group-data-[collapsible=offcanvas]:w-0\",\n          \"group-data-[side=right]:rotate-180\",\n          variant === \"floating\" || variant === \"inset\"\n            ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4))]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)]\"\n        )}\n      />\n      <div\n        data-slot=\"sidebar-container\"\n        className={cn(\n          \"fixed inset-y-0 z-10 hidden h-svh w-[var(--sidebar-width)] transition-[left,right,width] duration-200 ease-linear md:flex\",\n          side === \"left\"\n            ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n            : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n          // Adjust the padding for floating and inset variants.\n          variant === \"floating\" || variant === \"inset\"\n            ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4)+2px)]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n          className\n        )}\n        {...props}\n      >\n        <div\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar-inner\"\n          className=\"bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm\"\n        >\n          {children}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nfunction SidebarTrigger({\n  className,\n  onClick,\n  ...props\n}: React.ComponentProps<typeof Button>) {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      data-sidebar=\"trigger\"\n      data-slot=\"sidebar-trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeftIcon />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n}\n\nfunction SidebarRail({ className, ...props }: React.ComponentProps<\"button\">) {\n  const { toggleSidebar } = useSidebar()\n\n  // Note: Tailwind v3.4 doesn't support \"in-\" selectors. So the rail won't work perfectly.\n  return (\n    <button\n      data-sidebar=\"rail\"\n      data-slot=\"sidebar-rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex\",\n        \"in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInset({ className, ...props }: React.ComponentProps<\"main\">) {\n  return (\n    <main\n      data-slot=\"sidebar-inset\"\n      className={cn(\n        \"bg-background relative flex w-full flex-1 flex-col\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInput({\n  className,\n  ...props\n}: React.ComponentProps<typeof Input>) {\n  return (\n    <Input\n      data-slot=\"sidebar-input\"\n      data-sidebar=\"input\"\n      className={cn(\"bg-background h-8 w-full shadow-none\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-header\"\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-footer\"\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"sidebar-separator\"\n      data-sidebar=\"separator\"\n      className={cn(\"bg-sidebar-border mx-2 w-auto\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-content\"\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group\"\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupLabel({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-label\"\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:h-4 [&>svg]:w-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupAction({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-action\"\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupContent({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group-content\"\n      data-sidebar=\"group-content\"\n      className={cn(\"w-full text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenu({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu\"\n      data-sidebar=\"menu\"\n      className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuItem({ className, ...props }: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-item\"\n      data-sidebar=\"menu-item\"\n      className={cn(\"group/menu-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:w-8! group-data-[collapsible=icon]:h-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:p-0!\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction SidebarMenuButton({\n  asChild = false,\n  isActive = false,\n  variant = \"default\",\n  size = \"default\",\n  tooltip,\n  className,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  isActive?: boolean\n  tooltip?: string | React.ComponentProps<typeof TooltipContent>\n} & VariantProps<typeof sidebarMenuButtonVariants>) {\n  const Comp = asChild ? Slot : \"button\"\n  const { isMobile, state } = useSidebar()\n\n  const button = (\n    <Comp\n      data-slot=\"sidebar-menu-button\"\n      data-sidebar=\"menu-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n      {...props}\n    />\n  )\n\n  if (!tooltip) {\n    return button\n  }\n\n  if (typeof tooltip === \"string\") {\n    tooltip = {\n      children: tooltip,\n    }\n  }\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>{button}</TooltipTrigger>\n      <TooltipContent\n        side=\"right\"\n        align=\"center\"\n        hidden={state !== \"collapsed\" || isMobile}\n        {...tooltip}\n      />\n    </Tooltip>\n  )\n}\n\nfunction SidebarMenuAction({\n  className,\n  asChild = false,\n  showOnHover = false,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  showOnHover?: boolean\n}) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-action\"\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuBadge({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-menu-badge\"\n      data-sidebar=\"menu-badge\"\n      className={cn(\n        \"text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none\",\n        \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSkeleton({\n  className,\n  showIcon = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  showIcon?: boolean\n}) {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      data-slot=\"sidebar-menu-skeleton\"\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[var(--skeleton-width)] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n}\n\nfunction SidebarMenuSub({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu-sub\"\n      data-sidebar=\"menu-sub\"\n      className={cn(\n        \"border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubItem({\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-sub-item\"\n      data-sidebar=\"menu-sub-item\"\n      className={cn(\"group/menu-sub-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubButton({\n  asChild = false,\n  size = \"md\",\n  isActive = false,\n  className,\n  ...props\n}: React.ComponentProps<\"a\"> & {\n  asChild?: boolean\n  size?: \"sm\" | \"md\"\n  isActive?: boolean\n}) {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-sub-button\"\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline outline-2 outline-transparent outline-offset-2 focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","path":null,"size_bytes":21846,"size_tokens":null},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","path":null,"size_bytes":80,"size_tokens":null},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","path":null,"size_bytes":1584,"size_tokens":null},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","path":null,"size_bytes":1056,"size_tokens":null},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","path":null,"size_bytes":7428,"size_tokens":null},"client/src/App.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Switch, Route, Redirect } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider, useQuery } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { SidebarProvider, useSidebar } from \"@/components/ui/sidebar\";\nimport { ThemeProvider } from \"@/contexts/theme\";\nimport { AppSidebar } from \"@/components/app-sidebar\";\nimport Home from \"@/pages/home\";\nimport AuthPage from \"@/pages/auth\";\nimport ForgotPasswordPage from \"@/pages/forgot-password\";\nimport NewsPage from \"@/pages/news\";\nimport EventsPage from \"@/pages/events\";\nimport EventDetailPage from \"@/pages/event-detail\";\nimport KeysPage from \"@/pages/keys\";\nimport TeachersPage from \"@/pages/teachers\";\nimport TeacherDetailPage from \"@/pages/teacher-detail\";\nimport SchedulePage from \"@/pages/schedule\";\nimport ProfilePage from \"@/pages/profile\";\nimport SettingsPage from \"@/pages/settings\";\nimport AdminPage from \"@/pages/admin\";\nimport GradesPage from \"@/pages/grades\";\nimport GradeDetailPage from \"@/pages/grade-detail\";\nimport ClassDetailPage from \"@/pages/class-detail\";\nimport SupportPage from \"@/pages/support\";\nimport NotFound from \"@/pages/not-found\";\n\ntype User = {\n  id: string;\n  name: string;\n  email: string;\n  role: string;\n};\n\nfunction HeaderWithGestures() {\n  const { toggleSidebar } = useSidebar();\n  const [touchStart, setTouchStart] = useState(0);\n\n  useEffect(() => {\n    const handleKeyDown = (e: KeyboardEvent) => {\n      // Tab key to toggle sidebar on desktop\n      if (e.key === \"Tab\" && !e.ctrlKey && !e.altKey && !e.metaKey && !e.shiftKey) {\n        e.preventDefault();\n        toggleSidebar();\n      }\n    };\n\n    const handleTouchStart = (e: TouchEvent) => {\n      setTouchStart(e.touches[0].clientX);\n    };\n\n    const handleTouchEnd = (e: TouchEvent) => {\n      const touchEnd = e.changedTouches[0].clientX;\n      // Swipe from left edge (within 50px) to the right to open sidebar\n      if (touchStart < 50 && touchEnd - touchStart > 100) {\n        toggleSidebar();\n      }\n    };\n\n    window.addEventListener(\"keydown\", handleKeyDown);\n    window.addEventListener(\"touchstart\", handleTouchStart);\n    window.addEventListener(\"touchend\", handleTouchEnd);\n\n    return () => {\n      window.removeEventListener(\"keydown\", handleKeyDown);\n      window.removeEventListener(\"touchstart\", handleTouchStart);\n      window.removeEventListener(\"touchend\", handleTouchEnd);\n    };\n  }, [toggleSidebar]);\n\n  return (\n    <header className=\"sticky top-0 z-40 flex items-center justify-between px-6 py-3 border-b border-border/50 bg-background/80 backdrop-blur-sm dark:bg-background/70\">\n      <h2 className=\"text-sm font-semibold text-foreground hidden md:block\">School Community Ecosystem</h2>\n    </header>\n  );\n}\n\nfunction AuthenticatedLayout({ children }: { children: React.ReactNode }) {\n  const { data: user, isLoading } = useQuery<User>({\n    queryKey: [\"/api/auth/me\"],\n  });\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center min-h-screen\">\n        <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n      </div>\n    );\n  }\n\n  if (!user) {\n    return <Redirect to=\"/auth\" />;\n  }\n\n  const style = {\n    \"--sidebar-width\": \"16rem\",\n    \"--sidebar-width-icon\": \"3rem\",\n  };\n\n  return (\n    <SidebarProvider style={style as React.CSSProperties}>\n      <div className=\"flex h-screen w-full scrollbar-thin\">\n        <AppSidebar />\n        <div className=\"flex flex-col flex-1\">\n          <HeaderWithGestures />\n          <main className=\"flex-1 overflow-auto scrollbar-thin bg-gradient-to-br from-background via-background to-background/50 dark:from-background dark:via-background dark:to-background/40\">{children}</main>\n        </div>\n      </div>\n    </SidebarProvider>\n  );\n}\n\nfunction Router() {\n  return (\n    <Switch>\n      <Route path=\"/auth\" component={AuthPage} />\n      <Route path=\"/forgot-password\" component={ForgotPasswordPage} />\n      <Route path=\"/\">\n        {() => (\n          <AuthenticatedLayout>\n            <Home />\n          </AuthenticatedLayout>\n        )}\n      </Route>\n      <Route path=\"/news\">\n        {() => (\n          <AuthenticatedLayout>\n            <NewsPage />\n          </AuthenticatedLayout>\n        )}\n      </Route>\n      <Route path=\"/events/:id\">\n        {() => (\n          <AuthenticatedLayout>\n            <EventDetailPage />\n          </AuthenticatedLayout>\n        )}\n      </Route>\n      <Route path=\"/events\">\n        {() => (\n          <AuthenticatedLayout>\n            <EventsPage />\n          </AuthenticatedLayout>\n        )}\n      </Route>\n      <Route path=\"/keys\">\n        {() => (\n          <AuthenticatedLayout>\n            <KeysPage />\n          </AuthenticatedLayout>\n        )}\n      </Route>\n      <Route path=\"/teachers/:id\">\n        {() => (\n          <AuthenticatedLayout>\n            <TeacherDetailPage />\n          </AuthenticatedLayout>\n        )}\n      </Route>\n      <Route path=\"/teachers\">\n        {() => (\n          <AuthenticatedLayout>\n            <TeachersPage />\n          </AuthenticatedLayout>\n        )}\n      </Route>\n      <Route path=\"/schedule\">\n        {() => (\n          <AuthenticatedLayout>\n            <SchedulePage />\n          </AuthenticatedLayout>\n        )}\n      </Route>\n      <Route path=\"/profile/:userId\">\n        {() => (\n          <AuthenticatedLayout>\n            <ProfilePage />\n          </AuthenticatedLayout>\n        )}\n      </Route>\n      <Route path=\"/profile\">\n        {() => (\n          <AuthenticatedLayout>\n            <ProfilePage />\n          </AuthenticatedLayout>\n        )}\n      </Route>\n      <Route path=\"/settings\">\n        {() => (\n          <AuthenticatedLayout>\n            <SettingsPage />\n          </AuthenticatedLayout>\n        )}\n      </Route>\n      <Route path=\"/admin\">\n        {() => (\n          <AuthenticatedLayout>\n            <AdminPage />\n          </AuthenticatedLayout>\n        )}\n      </Route>\n      <Route path=\"/grades/:gradeNumber/:className\">\n        {() => (\n          <AuthenticatedLayout>\n            <ClassDetailPage />\n          </AuthenticatedLayout>\n        )}\n      </Route>\n      <Route path=\"/grades/:gradeNumber\">\n        {() => (\n          <AuthenticatedLayout>\n            <GradeDetailPage />\n          </AuthenticatedLayout>\n        )}\n      </Route>\n      <Route path=\"/grades\">\n        {() => (\n          <AuthenticatedLayout>\n            <GradesPage />\n          </AuthenticatedLayout>\n        )}\n      </Route>\n      <Route path=\"/support\">\n        {() => (\n          <AuthenticatedLayout>\n            <SupportPage />\n          </AuthenticatedLayout>\n        )}\n      </Route>\n      <Route component={NotFound} />\n    </Switch>\n  );\n}\n\nfunction App() {\n  return (\n    <ThemeProvider>\n      <QueryClientProvider client={queryClient}>\n        <TooltipProvider>\n          <Toaster />\n          <Router />\n        </TooltipProvider>\n      </QueryClientProvider>\n    </ThemeProvider>\n  );\n}\n\nexport default App;\n","path":null,"size_bytes":7104,"size_tokens":null},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","path":null,"size_bytes":325,"size_tokens":null},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","path":null,"size_bytes":4885,"size_tokens":null},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","path":null,"size_bytes":1642,"size_tokens":null},"client/src/pages/home.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Calendar, Trophy, TrendingUp, Newspaper, Clock, BookOpen, Volleyball, Flame, Star } from \"lucide-react\";\nimport { Link } from \"wouter\";\nimport { useMemo } from \"react\";\n\ntype User = {\n  id: string;\n  name: string;\n  role: string;\n  credibilityScore: number;\n  reputationScore: number;\n  accountStatus: string;\n};\n\ntype Post = {\n  id: string;\n  content: string;\n  authorId: string;\n  scopeId: string | null;\n  credibilityRating: number;\n  createdAt: string;\n  author?: {\n    name: string;\n    role: string;\n  };\n};\n\ntype Event = {\n  id: string;\n  title: string;\n  startTime: string;\n  eventType: \"curricular\" | \"extracurricular\";\n  location?: string;\n};\n\nexport default function Home() {\n  const { data: user } = useQuery<User>({\n    queryKey: [\"/api/auth/me\"],\n  });\n\n  const { data: recentPosts = [] } = useQuery<Post[]>({\n    queryKey: [\"/api/posts\"],\n  });\n\n  const { data: events = [] } = useQuery<Event[]>({\n    queryKey: [\"/api/events\"],\n  });\n\n  const getUserInitials = (name: string) => {\n    return name\n      .split(\" \")\n      .map((n) => n[0])\n      .join(\"\")\n      .toUpperCase()\n      .slice(0, 2);\n  };\n\n  const today = useMemo(() => {\n    const d = new Date();\n    d.setHours(0, 0, 0, 0);\n    return d;\n  }, []);\n\n  const calendarDays = useMemo(() => {\n    const days = [];\n    const startDate = new Date(today);\n    startDate.setDate(startDate.getDate() - 1);\n    \n    for (let i = 0; i < 15; i++) {\n      const date = new Date(startDate);\n      date.setDate(date.getDate() + i);\n      days.push(date);\n    }\n    \n    return days;\n  }, [today]);\n\n  const getDateString = (date: Date) => {\n    if (!(date instanceof Date) || isNaN(date.getTime())) {\n      return null;\n    }\n    const year = date.getFullYear();\n    const month = String(date.getMonth() + 1).padStart(2, '0');\n    const day = String(date.getDate()).padStart(2, '0');\n    return `${year}-${month}-${day}`;\n  };\n\n  const eventsByDate = useMemo(() => {\n    const map: Record<string, Event[]> = {};\n    \n    events.forEach(event => {\n      try {\n        const eventDate = new Date(event.startTime);\n        \n        if (!(eventDate instanceof Date) || isNaN(eventDate.getTime())) {\n          return;\n        }\n        \n        eventDate.setHours(0, 0, 0, 0);\n        const dateStr = getDateString(eventDate);\n        \n        if (dateStr) {\n          if (!map[dateStr]) {\n            map[dateStr] = [];\n          }\n          map[dateStr].push(event);\n        }\n      } catch (e) {\n        // Silently skip invalid dates\n      }\n    });\n    \n    return map;\n  }, [events]);\n\n  const getEventTypeStyle = (eventType: string) => {\n    if (eventType === \"curricular\") {\n      return {\n        bg: \"bg-indigo-500/20 dark:bg-indigo-400/20\",\n        text: \"text-indigo-700 dark:text-indigo-300\",\n        icon: BookOpen,\n        label: \"Class\",\n      };\n    } else {\n      return {\n        bg: \"bg-teal-500/20 dark:bg-teal-400/20\",\n        text: \"text-teal-700 dark:text-teal-300\",\n        icon: Volleyball,\n        label: \"Activity\",\n      };\n    }\n  };\n\n  return (\n    <div className=\"h-full overflow-y-auto\">\n      <div className=\"w-full\">\n        {/* Hero/Header Section */}\n        <div className=\"relative bg-gradient-to-br from-primary/5 via-transparent to-secondary/5 dark:from-primary/10 dark:via-transparent dark:to-secondary/10 border-b border-border/50\">\n          <div className=\"max-w-7xl mx-auto px-6 lg:px-8 py-12 lg:py-16\">\n            <div className=\"space-y-3\">\n              <div className=\"flex items-center gap-3\">\n                <div className=\"w-1 h-8 bg-gradient-to-b from-primary to-secondary rounded-full\" />\n                <h1 className=\"text-4xl lg:text-5xl font-bold tracking-tight\">\n                  Welcome back{user ? `, ${user.name.split(' ')[0]}` : ''}!\n                </h1>\n              </div>\n              <p className=\"text-base text-muted-foreground max-w-2xl\">\n                Stay connected with your school community. Track your progress, explore upcoming events, and engage with classmates.\n              </p>\n            </div>\n          </div>\n        </div>\n\n        {/* Main Content */}\n        <div className=\"max-w-7xl mx-auto px-6 lg:px-8 py-8 lg:py-12 space-y-8\">\n          \n          {/* Stats Grid */}\n          {user && (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n              \n              {/* User Profile Card - Hidden for visitors */}\n              {user.role !== \"visitor\" && (\n                <Link href=\"/profile\" className=\"group\">\n                  <Card className=\"hover-elevate active-elevate-2 cursor-pointer h-full transition-all\" data-testid=\"card-user-stats\">\n                    <CardContent className=\"p-6 flex flex-col h-full\">\n                      <div className=\"flex items-center gap-3 mb-6\">\n                        <div className=\"relative\">\n                          <Avatar className=\"w-12 h-12 ring-2 ring-primary/20\">\n                            <AvatarFallback className=\"text-sm font-bold bg-gradient-to-br from-primary to-secondary text-white\">\n                              {getUserInitials(user.name)}\n                            </AvatarFallback>\n                          </Avatar>\n                          {user.role === \"admin\" && (\n                            <div className=\"absolute -top-1 -right-1 w-5 h-5 bg-gradient-to-br from-amber-400 to-orange-500 rounded-full flex items-center justify-center text-xs font-bold text-white shadow-lg\">\n                              ⭐\n                            </div>\n                          )}\n                        </div>\n                        <div className=\"flex-1 min-w-0\">\n                          <p className=\"font-semibold text-sm truncate group-hover:text-primary transition-colors\" data-testid=\"text-user-name\">\n                            {user.name}\n                          </p>\n                          <Badge variant=\"secondary\" className=\"mt-1 text-xs font-medium\">\n                            {user.role}\n                          </Badge>\n                        </div>\n                      </div>\n                      \n                      <div className=\"space-y-3 flex-1\">\n                        <div className=\"p-4 rounded-xl bg-gradient-to-br from-primary/10 to-primary/5 dark:from-primary/20 dark:to-primary/10 border border-primary/20 dark:border-primary/30\">\n                          <div className=\"flex items-center gap-2 mb-2\">\n                            <Trophy className=\"w-4 h-4 text-primary\" />\n                            <span className=\"text-xs font-semibold text-muted-foreground uppercase tracking-wide\">Credibility</span>\n                          </div>\n                          <p className=\"text-2xl font-bold text-primary\" data-testid=\"text-credibility\">\n                            {(user.credibilityScore ?? 0).toFixed(0)}\n                          </p>\n                        </div>\n                        <div className=\"p-4 rounded-xl bg-gradient-to-br from-secondary/10 to-secondary/5 dark:from-secondary/20 dark:to-secondary/10 border border-secondary/20 dark:border-secondary/30\">\n                          <div className=\"flex items-center gap-2 mb-2\">\n                            <TrendingUp className=\"w-4 w-4 text-secondary\" />\n                            <span className=\"text-xs font-semibold text-muted-foreground uppercase tracking-wide\">Reputation</span>\n                          </div>\n                          <p className=\"text-2xl font-bold text-secondary\" data-testid=\"text-reputation\">\n                            {(user.reputationScore ?? 0).toFixed(0)}\n                          </p>\n                        </div>\n                      </div>\n\n                      <div className=\"mt-4 pt-4 border-t border-border/50 text-xs text-muted-foreground flex items-center gap-1\">\n                        <span>View full profile</span>\n                        <span className=\"group-hover:translate-x-1 transition-transform\">→</span>\n                      </div>\n                    </CardContent>\n                  </Card>\n                </Link>\n              )}\n\n              {/* Status Overview Card */}\n              <Card className=\"h-full\" data-testid=\"card-status-overview\">\n                <CardContent className=\"p-6 flex flex-col h-full\">\n                  <div className=\"flex items-center gap-2 mb-6\">\n                    <div className=\"w-8 h-8 rounded-lg bg-gradient-to-br from-accent to-accent/70 flex items-center justify-center\">\n                      <Flame className=\"w-4 h-4 text-white\" />\n                    </div>\n                    <h3 className=\"font-semibold text-sm\">Activity Status</h3>\n                  </div>\n                  \n                  <div className=\"space-y-3 flex-1\">\n                    <div className=\"bg-background/50 dark:bg-background/30 rounded-lg p-3\">\n                      <p className=\"text-xs text-muted-foreground mb-1\">Account Status</p>\n                      <Badge variant=\"outline\" className=\"text-xs font-medium\">\n                        {user.accountStatus}\n                      </Badge>\n                    </div>\n                    <div className=\"bg-background/50 dark:bg-background/30 rounded-lg p-3\">\n                      <p className=\"text-xs text-muted-foreground mb-1\">Participation</p>\n                      <p className=\"font-semibold text-sm\">{recentPosts.length} posts</p>\n                    </div>\n                    <div className=\"bg-background/50 dark:bg-background/30 rounded-lg p-3\">\n                      <p className=\"text-xs text-muted-foreground mb-1\">Upcoming Events</p>\n                      <p className=\"font-semibold text-sm\">{events.length} total</p>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n\n              {/* Quick Actions Card */}\n              <Card className=\"h-full\" data-testid=\"card-quick-actions\">\n                <CardContent className=\"p-6 flex flex-col h-full\">\n                  <div className=\"flex items-center gap-2 mb-6\">\n                    <div className=\"w-8 h-8 rounded-lg bg-gradient-to-br from-indigo-500 to-indigo-600 flex items-center justify-center\">\n                      <Star className=\"w-4 h-4 text-white\" />\n                    </div>\n                    <h3 className=\"font-semibold text-sm\">Quick Access</h3>\n                  </div>\n                  \n                  <div className=\"space-y-2 flex-1\">\n                    <Link href=\"/news\" className=\"block\">\n                      <div className=\"p-3 rounded-lg bg-background/50 dark:bg-background/30 hover:bg-background dark:hover:bg-background/50 transition-colors group\">\n                        <p className=\"text-xs font-medium text-muted-foreground\">Latest News</p>\n                        <p className=\"text-sm font-semibold group-hover:text-primary transition-colors\">View posts →</p>\n                      </div>\n                    </Link>\n                    <Link href=\"/events\" className=\"block\">\n                      <div className=\"p-3 rounded-lg bg-background/50 dark:bg-background/30 hover:bg-background dark:hover:bg-background/50 transition-colors group\">\n                        <p className=\"text-xs font-medium text-muted-foreground\">Events</p>\n                        <p className=\"text-sm font-semibold group-hover:text-primary transition-colors\">Explore events →</p>\n                      </div>\n                    </Link>\n                    <Link href=\"/teachers\" className=\"block\">\n                      <div className=\"p-3 rounded-lg bg-background/50 dark:bg-background/30 hover:bg-background dark:hover:bg-background/50 transition-colors group\">\n                        <p className=\"text-xs font-medium text-muted-foreground\">Faculty</p>\n                        <p className=\"text-sm font-semibold group-hover:text-primary transition-colors\">Meet teachers →</p>\n                      </div>\n                    </Link>\n                  </div>\n                </CardContent>\n              </Card>\n\n              {/* Calendar Preview Card - Hidden for visitors */}\n              {user.role !== \"visitor\" && (\n                <Link href=\"/schedule\" className=\"group\">\n                  <Card className=\"hover-elevate active-elevate-2 cursor-pointer h-full transition-all\" data-testid=\"card-upcoming-events\">\n                    <CardContent className=\"p-6 flex flex-col h-full\">\n                      <div className=\"flex items-center gap-2 mb-4\">\n                        <div className=\"w-8 h-8 rounded-lg bg-gradient-to-br from-teal-500 to-teal-600 flex items-center justify-center\">\n                          <Calendar className=\"w-4 h-4 text-white\" />\n                        </div>\n                        <h3 className=\"font-semibold text-sm\">Calendar</h3>\n                      </div>\n\n                      {/* Mini Calendar Grid */}\n                      <div className=\"grid grid-cols-7 gap-1 flex-1\">\n                        {calendarDays.slice(0, 14).map((date, idx) => {\n                          const dateStr = getDateString(date);\n                          const dayEvents = dateStr ? (eventsByDate[dateStr] || []) : [];\n                          const isToday = date.getTime() === today.getTime();\n                          const isPast = date.getTime() < today.getTime();\n\n                          return (\n                            <div\n                              key={idx}\n                              className={`\n                                text-center text-[0.65rem] p-1 rounded-lg min-h-10 flex flex-col items-center justify-center font-medium transition-colors\n                                ${isToday \n                                  ? 'bg-gradient-to-br from-primary to-secondary text-white font-bold shadow-md' \n                                  : isPast \n                                  ? 'text-muted-foreground/50' \n                                  : dayEvents.length > 0\n                                  ? 'bg-accent/20 dark:bg-accent/30 text-accent-foreground font-semibold'\n                                  : 'hover:bg-background/50 dark:hover:bg-background/30'\n                                }\n                              `}\n                              data-testid={`event-${date.getDate()}`}\n                            >\n                              <div className=\"text-[#141414]\">{date.getDate()}</div>\n                              {dayEvents.length > 0 && !isToday && (\n                                <div className=\"w-1 h-1 bg-accent rounded-full mt-0.5\" />\n                              )}\n                            </div>\n                          );\n                        })}\n                      </div>\n\n                      <div className=\"mt-3 pt-3 border-t border-border/50 text-xs text-muted-foreground flex items-center gap-1\">\n                        <span>View calendar</span>\n                        <span className=\"group-hover:translate-x-1 transition-transform\">→</span>\n                      </div>\n                    </CardContent>\n                  </Card>\n                </Link>\n              )}\n            </div>\n          )}\n\n          {/* Featured Section - Hidden for visitors */}\n          {user && user.role !== \"visitor\" && (\n            <div className=\"space-y-4\">\n              <div className=\"flex items-center gap-3\">\n                <div className=\"w-1 h-6 bg-gradient-to-b from-primary to-secondary rounded-full\" />\n                <h2 className=\"text-2xl font-bold\">Community Highlights</h2>\n              </div>\n\n              <Link href=\"/news\" className=\"group\">\n                <Card className=\"hover-elevate active-elevate-2 cursor-pointer transition-all\" data-testid=\"card-news-preview\">\n                  <CardContent className=\"p-8\">\n                    <div className=\"flex items-center gap-3 mb-6\">\n                      <div className=\"w-10 h-10 rounded-xl bg-gradient-to-br from-accent to-accent/70 flex items-center justify-center\">\n                        <Newspaper className=\"w-5 h-5 text-white\" />\n                      </div>\n                      <div className=\"flex-1\">\n                        <h3 className=\"text-lg font-semibold\">Latest News & Posts</h3>\n                        <p className=\"text-sm text-muted-foreground mt-1\">\n                          {recentPosts.length} posts from your school community\n                        </p>\n                      </div>\n                    </div>\n\n                    {recentPosts.length === 0 ? (\n                      <div className=\"text-center py-8\">\n                        <p className=\"text-muted-foreground\">No posts yet. Be the first to share!</p>\n                      </div>\n                    ) : (\n                      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                        {recentPosts.slice(0, 6).map((post: Post) => (\n                          <div \n                            key={post.id} \n                            className=\"p-4 rounded-xl bg-background/50 dark:bg-background/30 border border-border/50 hover:border-primary/30 hover:bg-background dark:hover:bg-background/50 transition-all group/post\"\n                            data-testid={`post-preview-${post.id}`}\n                          >\n                            <div className=\"flex items-start gap-3 mb-3\">\n                              <Avatar className=\"w-8 h-8 flex-shrink-0 ring-2 ring-primary/20\">\n                                <AvatarFallback className=\"text-xs font-bold\">\n                                  {post.author ? getUserInitials(post.author.name) : \"U\"}\n                                </AvatarFallback>\n                              </Avatar>\n                              <div className=\"flex-1 min-w-0\">\n                                <p className=\"text-sm font-semibold truncate group-hover/post:text-primary transition-colors\">\n                                  {post.author?.name || \"Unknown\"}\n                                </p>\n                                <p className=\"text-xs text-muted-foreground\">\n                                  {post.author?.role}\n                                </p>\n                              </div>\n                            </div>\n                            <p className=\"text-sm text-foreground/80 line-clamp-2 mb-3\">\n                              {post.content}\n                            </p>\n                            <div className=\"flex items-center gap-2 text-xs text-muted-foreground\">\n                              <Clock className=\"w-3 h-3\" />\n                              {new Date(post.createdAt).toLocaleDateString()}\n                            </div>\n                          </div>\n                        ))}\n                      </div>\n                    )}\n\n                    <div className=\"mt-6 flex items-center gap-2 text-primary font-medium text-sm group-hover:gap-3 transition-all\">\n                      <span>View all posts</span>\n                      <span>→</span>\n                    </div>\n                  </CardContent>\n                </Card>\n              </Link>\n            </div>\n          )}\n\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":19425,"size_tokens":null},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \".5625rem\", /* 9px */\n        md: \".375rem\", /* 6px */\n        sm: \".1875rem\", /* 3px */\n      },\n      colors: {\n        // Flat / base colors (regular buttons)\n        background: \"hsl(var(--background) / <alpha-value>)\",\n        foreground: \"hsl(var(--foreground) / <alpha-value>)\",\n        border: \"hsl(var(--border) / <alpha-value>)\",\n        input: \"hsl(var(--input) / <alpha-value>)\",\n        card: {\n          DEFAULT: \"hsl(var(--card) / <alpha-value>)\",\n          foreground: \"hsl(var(--card-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--card-border) / <alpha-value>)\",\n        },\n        popover: {\n          DEFAULT: \"hsl(var(--popover) / <alpha-value>)\",\n          foreground: \"hsl(var(--popover-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--popover-border) / <alpha-value>)\",\n        },\n        primary: {\n          DEFAULT: \"hsl(var(--primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--primary-foreground) / <alpha-value>)\",\n          border: \"var(--primary-border)\",\n        },\n        secondary: {\n          DEFAULT: \"hsl(var(--secondary) / <alpha-value>)\",\n          foreground: \"hsl(var(--secondary-foreground) / <alpha-value>)\",\n          border: \"var(--secondary-border)\",\n        },\n        muted: {\n          DEFAULT: \"hsl(var(--muted) / <alpha-value>)\",\n          foreground: \"hsl(var(--muted-foreground) / <alpha-value>)\",\n          border: \"var(--muted-border)\",\n        },\n        accent: {\n          DEFAULT: \"hsl(var(--accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--accent-foreground) / <alpha-value>)\",\n          border: \"var(--accent-border)\",\n        },\n        destructive: {\n          DEFAULT: \"hsl(var(--destructive) / <alpha-value>)\",\n          foreground: \"hsl(var(--destructive-foreground) / <alpha-value>)\",\n          border: \"var(--destructive-border)\",\n        },\n        ring: \"hsl(var(--ring) / <alpha-value>)\",\n        chart: {\n          \"1\": \"hsl(var(--chart-1) / <alpha-value>)\",\n          \"2\": \"hsl(var(--chart-2) / <alpha-value>)\",\n          \"3\": \"hsl(var(--chart-3) / <alpha-value>)\",\n          \"4\": \"hsl(var(--chart-4) / <alpha-value>)\",\n          \"5\": \"hsl(var(--chart-5) / <alpha-value>)\",\n        },\n        sidebar: {\n          ring: \"hsl(var(--sidebar-ring) / <alpha-value>)\",\n          DEFAULT: \"hsl(var(--sidebar) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--sidebar-border) / <alpha-value>)\",\n        },\n        \"sidebar-primary\": {\n          DEFAULT: \"hsl(var(--sidebar-primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-primary-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-primary-border)\",\n        },\n        \"sidebar-accent\": {\n          DEFAULT: \"hsl(var(--sidebar-accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-accent-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-accent-border)\"\n        },\n        status: {\n          online: \"rgb(34 197 94)\",\n          away: \"rgb(245 158 11)\",\n          busy: \"rgb(239 68 68)\",\n          offline: \"rgb(156 163 175)\",\n        },\n      },\n      fontFamily: {\n        sans: [\"var(--font-sans)\"],\n        serif: [\"var(--font-serif)\"],\n        mono: [\"var(--font-mono)\"],\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: { height: \"0\" },\n          to: { height: \"var(--radix-accordion-content-height)\" },\n        },\n        \"accordion-up\": {\n          from: { height: \"var(--radix-accordion-content-height)\" },\n          to: { height: \"0\" },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","path":null,"size_bytes":4050,"size_tokens":null},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","path":null,"size_bytes":1977,"size_tokens":null},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","path":null,"size_bytes":4845,"size_tokens":null},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","path":null,"size_bytes":1280,"size_tokens":null},"server/routes.ts":{"content":"import type { Express, Request, Response, NextFunction } from \"express\";\nimport express from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { promises as fs } from \"fs\";\nimport path from \"path\";\nimport crypto from \"crypto\";\nimport { storage } from \"./storage\";\nimport { db } from \"./db\";\nimport { \n  users,\n  insertUserSchema,\n  insertPostSchema,\n  insertEventSchema,\n  insertEventRsvpSchema,\n  insertScheduleSchema,\n  insertTeacherSchema,\n  insertTeacherReviewSchema,\n  insertTeacherFeedbackSchema,\n  insertScopeSchema,\n  insertPostCommentSchema,\n  insertEventCommentSchema,\n  insertAdminStudentIdSchema,\n  insertPostAccuracyRatingSchema,\n  insertFriendshipSchema,\n  insertChatMessageSchema,\n  insertContentViolationSchema,\n  insertUserPunishmentSchema,\n} from \"@shared/schema\";\nimport bcrypt from \"bcrypt\";\nimport { z } from \"zod\";\nimport { requireModeration, moderateContentEnhanced, calculatePunishment } from \"./moderation\";\nimport { upload, getMediaType } from \"./upload\";\n\n// Authentication middleware (allows both logged-in users and visitors)\nfunction requireAuth(req: Request, res: Response, next: NextFunction) {\n  // Allow visitors with session-only access\n  if (req.session.isVisitor) {\n    return next();\n  }\n  \n  // Require userId for regular users\n  if (!req.session.userId) {\n    return res.status(401).json({ message: \"Authentication required\" });\n  }\n  next();\n}\n\n// Admin role middleware\nasync function requireAdmin(req: Request, res: Response, next: NextFunction) {\n  if (!req.session.userId) {\n    return res.status(401).json({ message: \"Authentication required\" });\n  }\n  \n  const user = await storage.getUser(req.session.userId);\n  if (!user || user.role !== \"admin\") {\n    return res.status(403).json({ message: \"Admin privileges required\" });\n  }\n  \n  next();\n}\n\n// Non-visitor middleware (prevent read-only visitors from making changes)\nasync function requireNonVisitor(req: Request, res: Response, next: NextFunction) {\n  if (!req.session.userId) {\n    return res.status(401).json({ message: \"Authentication required\" });\n  }\n  \n  const user = await storage.getUser(req.session.userId);\n  if (!user) {\n    return res.status(401).json({ message: \"User not found\" });\n  }\n  \n  if (user.role === \"visitor\") {\n    return res.status(403).json({ message: \"Visitors cannot perform this action. Please login as a student or admin.\" });\n  }\n  \n  next();\n}\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n  // ==================== AUTHENTICATION ====================\n  \n  // Register\n  app.post(\"/api/auth/register\", async (req, res) => {\n    try {\n      const userData = insertUserSchema.parse(req.body);\n      console.log(\"[REGISTER] Registration attempt for:\", userData.username, \"with studentId:\", userData.studentId);\n      \n      // Check if username already exists\n      const existingByUsername = await storage.getUserByUsername(userData.username);\n      if (existingByUsername) {\n        console.log(\"[REGISTER] Username already taken:\", userData.username);\n        return res.status(400).json({ message: \"Username already taken\" });\n      }\n      \n      // Check if email already exists\n      const existingByEmail = await storage.getUserByEmail(userData.email);\n      if (existingByEmail) {\n        console.log(\"[REGISTER] Email already registered:\", userData.email);\n        return res.status(400).json({ message: \"Email already registered\" });\n      }\n      \n      console.log(\"[REGISTER] Creating user...\");\n      // Create user (will validate student ID and assign it automatically)\n      const user = await storage.createUser(userData);\n      console.log(\"[REGISTER] User created successfully:\", user.id);\n      \n      // Set session\n      req.session.userId = user.id;\n      \n      // Don't send password back\n      const { password, ...userWithoutPassword } = user;\n      \n      res.json({ \n        message: \"Registration successful\",\n        user: userWithoutPassword \n      });\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        console.log(\"[REGISTER] Validation error:\", error.errors);\n        return res.status(400).json({ message: \"Invalid input\", errors: error.errors });\n      }\n      \n      // Handle student ID validation errors (return 400, not 500)\n      if (error instanceof Error) {\n        const message = error.message;\n        console.log(\"[REGISTER] Registration error:\", message);\n        \n        // These are validation errors, not server errors\n        if (message.includes(\"Student ID\") || message.includes(\"Username does not match\")) {\n          return res.status(400).json({ message });\n        }\n      }\n      \n      // Only use 500 for unexpected errors\n      console.error(\"[REGISTER] Unexpected error:\", error);\n      console.error(\"[REGISTER] Error stack:\", error instanceof Error ? error.stack : \"No stack\");\n      res.status(500).json({ \n        message: \"Registration failed. Please try again.\",\n      });\n    }\n  });\n  \n  // Login (username + password)\n  app.post(\"/api/auth/login\", async (req, res) => {\n    try {\n      const { username, password, rememberMe } = req.body;\n      \n      if (!username || !password) {\n        console.log(\"[AUTH] Missing credentials\");\n        return res.status(400).json({ message: \"Username and password required\" });\n      }\n      \n      const user = await storage.getUserByUsername(username);\n      if (!user) {\n        console.log(\"[AUTH] User not found:\", username);\n        return res.status(401).json({ message: \"Invalid credentials\" });\n      }\n      \n      console.log(\"[AUTH] User found:\", { id: user.id, username: user.username });\n      const passwordMatch = await bcrypt.compare(password, user.password);\n      console.log(\"[AUTH] Password match:\", passwordMatch);\n      \n      if (!passwordMatch) {\n        return res.status(401).json({ message: \"Invalid credentials\" });\n      }\n      \n      // Set session\n      req.session.userId = user.id;\n      console.log(\"[AUTH] Session set:\", req.session.userId);\n      \n      // Handle remember me for students (same as admins)\n      if (rememberMe) {\n        const token = crypto.randomBytes(32).toString('hex');\n        await storage.createRememberMeToken(user.id, token);\n        \n        // Set remember-me cookie (7 days)\n        res.cookie('remember_token', token, {\n          httpOnly: true,\n          secure: process.env.NODE_ENV === 'production',\n          maxAge: 7 * 24 * 60 * 60 * 1000, // 7 days\n          sameSite: 'lax'\n        });\n      }\n      \n      // Don't send password back\n      const { password: _, ...userWithoutPassword } = user;\n      \n      res.json({ \n        message: \"Login successful\",\n        user: userWithoutPassword \n      });\n    } catch (error) {\n      console.error(\"Login error:\", error);\n      res.status(500).json({ message: \"Login failed\" });\n    }\n  });\n\n  // Admin Register (requires scientific question answer)\n  app.post(\"/api/auth/admin/register\", async (req, res) => {\n    try {\n      const { scientificAnswer, username, password, name, email } = req.body;\n      \n      if (!scientificAnswer || !username || !password || !name || !email) {\n        return res.status(400).json({ message: \"All fields are required\" });\n      }\n\n      if (password.length < 6) {\n        return res.status(400).json({ message: \"Password must be at least 6 characters\" });\n      }\n\n      // Verify administration code\n      const ADMIN_CODE = process.env.ADMIN_DEFAULT_PASSWORD || \"NOTHINg27$\";\n      \n      if (scientificAnswer !== ADMIN_CODE) {\n        return res.status(401).json({ message: \"Incorrect administration code\" });\n      }\n      \n      // Check if username already exists\n      const existingByUsername = await storage.getUserByUsername(username);\n      if (existingByUsername) {\n        return res.status(400).json({ message: \"Username already taken\" });\n      }\n      \n      // Check if email already exists\n      const existingByEmail = await storage.getUserByEmail(email);\n      if (existingByEmail) {\n        return res.status(400).json({ message: \"Email already registered\" });\n      }\n\n      // Create admin account\n      const hashedPassword = await bcrypt.hash(password, 10);\n      const [admin] = await db.insert(users).values({\n        username,\n        password: hashedPassword,\n        name,\n        email,\n        studentId: `ADMIN_${Date.now()}`, // Unique admin student ID\n        role: \"admin\",\n        credibilityScore: 100,\n        reputationScore: 0,\n        accountStatus: \"active\",\n        initiativeScore: 0,\n        communicationScore: 0,\n        cooperationScore: 0,\n        kindnessScore: 0,\n        perseveranceScore: 0,\n        fitnessScore: 0,\n        playingSkillsScore: 0,\n        inClassMisconductScore: 0,\n        outClassMisconductScore: 0,\n        literaryScienceScore: 0,\n        naturalScienceScore: 0,\n        electronicScienceScore: 0,\n        confidenceScore: 0,\n        temperScore: 0,\n        cheerfulnessScore: 0,\n      }).returning();\n      \n      // Set session\n      req.session.userId = admin.id;\n      \n      const { password: _, ...adminWithoutPassword } = admin;\n      \n      res.json({ \n        message: \"Admin account created successfully\",\n        user: adminWithoutPassword \n      });\n    } catch (error) {\n      console.error(\"Admin registration error:\", error);\n      const errorMsg = error instanceof Error ? error.message : \"Unknown error\";\n      const errorType = error instanceof Error ? error.constructor.name : \"Unknown\";\n      console.error(`Error type: ${errorType}`);\n      console.error(`Error message: ${errorMsg}`);\n      if (error instanceof Error && error.stack) {\n        console.error(\"Stack trace:\", error.stack);\n      }\n      \n      // Provide more specific error messages\n      let userMessage = \"Admin registration failed\";\n      if (errorMsg.includes(\"unique\") || errorMsg.includes(\"already exists\")) {\n        userMessage = \"Username or email already registered\";\n      } else if (errorMsg.includes(\"database\") || errorMsg.includes(\"connection\")) {\n        userMessage = \"Database connection error - please try again\";\n      }\n      \n      res.status(500).json({ \n        message: userMessage, \n        error: errorMsg,\n        debug: {\n          type: errorType,\n          details: errorMsg\n        }\n      });\n    }\n  });\n\n  // Admin Login (username + password + optional remember-me)\n  app.post(\"/api/auth/admin/login\", async (req, res) => {\n    try {\n      const { username, password, rememberMe } = req.body;\n      \n      if (!username || !password) {\n        return res.status(400).json({ message: \"Username and password required\" });\n      }\n\n      // Check if account is locked\n      const isLocked = await storage.isAccountLocked(username);\n      if (isLocked) {\n        return res.status(429).json({ \n          message: \"Account locked due to too many failed attempts. Please try again in 15 minutes.\" \n        });\n      }\n      \n      const user = await storage.getUserByUsername(username);\n      if (!user || user.role !== \"admin\") {\n        await storage.recordFailedLogin(username);\n        return res.status(401).json({ message: \"Invalid admin credentials\" });\n      }\n      \n      const passwordMatch = await bcrypt.compare(password, user.password);\n      \n      if (!passwordMatch) {\n        await storage.recordFailedLogin(username);\n        const attempts = await storage.getFailedLoginAttempts(username);\n        const remaining = attempts ? Math.max(0, 3 - attempts.attemptCount) : 3;\n        return res.status(401).json({ \n          message: `Invalid credentials. ${remaining} attempt(s) remaining.` \n        });\n      }\n      \n      // Successful login - clear failed attempts\n      await storage.clearFailedLoginAttempts(username);\n      \n      // Set session\n      req.session.userId = user.id;\n\n      // Handle remember-me functionality\n      if (rememberMe) {\n        const token = crypto.randomBytes(32).toString('hex');\n        await storage.createRememberMeToken(user.id, token);\n        \n        // Set remember-me cookie (7 days)\n        res.cookie('remember_token', token, {\n          httpOnly: true,\n          secure: process.env.NODE_ENV === 'production',\n          maxAge: 7 * 24 * 60 * 60 * 1000, // 7 days\n          sameSite: 'lax'\n        });\n      }\n      \n      const { password: _, ...userWithoutPassword } = user;\n      \n      res.json({ \n        message: \"Login successful\",\n        user: userWithoutPassword \n      });\n    } catch (error) {\n      console.error(\"Admin login error:\", error);\n      const errorMsg = error instanceof Error ? error.message : \"Unknown error\";\n      const errorType = error instanceof Error ? error.constructor.name : \"Unknown\";\n      console.error(`Error type: ${errorType}, Message: ${errorMsg}`);\n      if (error instanceof Error && error.stack) {\n        console.error(\"Stack trace:\", error.stack);\n      }\n      res.status(500).json({ \n        message: \"Admin login failed\", \n        error: errorMsg,\n        debug: {\n          type: errorType,\n          details: errorMsg\n        }\n      });\n    }\n  });\n\n  // Visitor guest access (session-only, no database user)\n  app.post(\"/api/auth/visitor\", async (req, res) => {\n    try {\n      // Create temporary visitor session data (no database user)\n      req.session.isVisitor = true;\n      req.session.visitorData = {\n        username: \"Guest Visitor\",\n        name: \"Guest Visitor\",\n        role: \"visitor\",\n      };\n      \n      res.json({ \n        message: \"Visitor access granted\",\n        user: {\n          username: \"Guest Visitor\",\n          name: \"Guest Visitor\",\n          role: \"visitor\",\n        }\n      });\n    } catch (error) {\n      console.error(\"Visitor access error:\", error);\n      res.status(500).json({ message: \"Visitor access failed\" });\n    }\n  });\n\n  // Logout\n  app.post(\"/api/auth/logout\", async (req, res) => {\n    try {\n      // Delete remember-me token if it exists\n      const rememberToken = req.cookies?.remember_token;\n      if (rememberToken) {\n        await storage.deleteRememberMeToken(rememberToken);\n        res.clearCookie('remember_token');\n      }\n\n      req.session.destroy((err) => {\n        if (err) {\n          return res.status(500).json({ message: \"Logout failed\" });\n        }\n        res.json({ message: \"Logged out successfully\" });\n      });\n    } catch (error) {\n      console.error(\"Logout error:\", error);\n      res.status(500).json({ message: \"Logout failed\" });\n    }\n  });\n\n  // Request password reset (by email or phone)\n  app.post(\"/api/auth/forgot-password\", async (req, res) => {\n    try {\n      const { email, phone } = req.body;\n\n      if (!email && !phone) {\n        return res.status(400).json({ message: \"Email or phone number required\" });\n      }\n\n      let user: any;\n      if (email) {\n        user = await storage.getUserByEmail(email);\n      } else if (phone) {\n        // For phone, we would search through users but for now just handle email\n        return res.json({ message: \"Phone-based recovery coming soon. Please use email.\" });\n      }\n\n      if (!user) {\n        // Don't reveal whether email/phone exists (security best practice)\n        return res.json({ message: \"If an account exists, a password reset link will be sent\" });\n      }\n\n      const token = await storage.createPasswordResetToken(user.id);\n      \n      res.json({ \n        message: \"Password reset token created\",\n        token: token // In production, send this via email/SMS instead\n      });\n    } catch (error) {\n      console.error(\"Forgot password error:\", error);\n      res.status(500).json({ message: \"Failed to process password reset request\" });\n    }\n  });\n\n  // Validate password reset token\n  app.post(\"/api/auth/validate-reset-token\", async (req, res) => {\n    try {\n      const { token } = req.body;\n\n      if (!token) {\n        return res.status(400).json({ message: \"Token required\" });\n      }\n\n      const user = await storage.validatePasswordResetToken(token);\n      \n      if (!user) {\n        return res.status(400).json({ message: \"Invalid or expired token\" });\n      }\n\n      res.json({ \n        message: \"Token valid\",\n        userId: user.id,\n        username: user.username\n      });\n    } catch (error) {\n      console.error(\"Validate token error:\", error);\n      res.status(500).json({ message: \"Failed to validate token\" });\n    }\n  });\n\n  // Reset password with token\n  app.post(\"/api/auth/reset-password\", async (req, res) => {\n    try {\n      const { token, newPassword } = req.body;\n\n      if (!token || !newPassword) {\n        return res.status(400).json({ message: \"Token and new password required\" });\n      }\n\n      if (newPassword.length < 6) {\n        return res.status(400).json({ message: \"Password must be at least 6 characters\" });\n      }\n\n      const success = await storage.resetPassword(token, newPassword);\n      \n      if (!success) {\n        return res.status(400).json({ message: \"Invalid or expired token\" });\n      }\n\n      res.json({ message: \"Password reset successfully\" });\n    } catch (error) {\n      console.error(\"Reset password error:\", error);\n      res.status(500).json({ message: \"Failed to reset password\" });\n    }\n  });\n\n  // Get current user (from session)\n  app.get(\"/api/auth/me\", requireAuth, async (req, res) => {\n    try {\n      // Return visitor session data if visitor\n      if (req.session.isVisitor && req.session.visitorData) {\n        return res.json(req.session.visitorData);\n      }\n\n      const user = await storage.getUser(req.session.userId!);\n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n      \n      const { password, ...userWithoutPassword } = user;\n      res.json(userWithoutPassword);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch user\" });\n    }\n  });\n\n  // Get user by ID (public profile)\n  app.get(\"/api/users/:userId\", requireAuth, async (req, res) => {\n    try {\n      const user = await storage.getUser(req.params.userId);\n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n      \n      // Only expose safe public fields\n      const publicProfile = {\n        id: user.id,\n        username: user.username,\n        name: user.name,\n        role: user.role,\n        grade: user.grade,\n        className: user.className,\n        avatarUrl: user.avatarUrl,\n        bio: user.bio,\n        credibilityScore: user.credibilityScore,\n        reputationScore: user.reputationScore,\n        accountStatus: user.accountStatus,\n        createdAt: user.createdAt,\n        // Hexagon tendency charts\n        empathy: user.empathy,\n        angerManagement: user.angerManagement,\n        cooperation: user.cooperation,\n        selfConfidence: user.selfConfidence,\n        acceptingCriticism: user.acceptingCriticism,\n        listening: user.listening,\n        problemSolving: user.problemSolving,\n        creativity: user.creativity,\n        memoryFocus: user.memoryFocus,\n        planningOrganization: user.planningOrganization,\n        communicationExpression: user.communicationExpression,\n        leadershipInitiative: user.leadershipInitiative,\n        artisticCreative: user.artisticCreative,\n        athleticPhysical: user.athleticPhysical,\n        technicalTech: user.technicalTech,\n        linguisticReading: user.linguisticReading,\n        socialHumanitarian: user.socialHumanitarian,\n        naturalEnvironmental: user.naturalEnvironmental,\n        hobbies: user.hobbies,\n      };\n      \n      res.json(publicProfile);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch user profile\" });\n    }\n  });\n\n  // Update user profile (own profile only)\n  app.patch(\"/api/users/:userId/profile\", requireAuth, requireNonVisitor, async (req, res) => {\n    try {\n      const userId = req.params.userId;\n      const currentUserId = req.session.userId!;\n      \n      if (userId !== currentUserId) {\n        return res.status(403).json({ message: \"You can only edit your own profile\" });\n      }\n      \n      const { bio, avatarUrl, grade, className } = req.body;\n      \n      // Moderate bio before updating\n      if (bio && typeof bio === \"string\" && bio.trim()) {\n        await requireModeration(bio);\n      }\n      \n      const updated = await storage.updateUserProfile(userId, { bio, avatarUrl, grade, className });\n      \n      if (!updated) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n      \n      const { password, ...userWithoutPassword } = updated;\n      res.json(userWithoutPassword);\n    } catch (error) {\n      if (error instanceof Error && error.message.includes(\"community guidelines\")) {\n        return res.status(400).json({ message: error.message });\n      }\n      res.status(500).json({ message: \"Failed to update profile\" });\n    }\n  });\n\n  // Update hexagon tendency charts (own profile only)\n  app.patch(\"/api/users/:userId/hexagon\", requireAuth, requireNonVisitor, async (req, res) => {\n    try {\n      const userId = req.params.userId;\n      const currentUserId = req.session.userId!;\n      \n      if (userId !== currentUserId) {\n        return res.status(403).json({ message: \"You can only edit your own tendency charts\" });\n      }\n      \n      // Sanitize payload to prevent prototype pollution attacks\n      // Create a clean object with only own properties (no inherited keys like __proto__)\n      const sanitized = Object.create(null);\n      for (const [key, value] of Object.entries(req.body)) {\n        // Only copy own enumerable properties\n        if (Object.prototype.hasOwnProperty.call(req.body, key)) {\n          sanitized[key] = value;\n        }\n      }\n      \n      // Validate sanitized body using Zod schema to ensure integers 0-10\n      const hexagonUpdateSchema = z.record(z.string(), z.number().int().min(0).max(10));\n      const parseResult = hexagonUpdateSchema.safeParse(sanitized);\n      \n      if (!parseResult.success) {\n        return res.status(400).json({ \n          message: \"Invalid payload format. All values must be integers between 0 and 10.\",\n          errors: parseResult.error.errors\n        });\n      }\n      \n      const hexagonData = parseResult.data;\n      \n      // Define hexagon field groups\n      const hexagonGroups = {\n        social: new Set([\"empathy\", \"angerManagement\", \"cooperation\", \"selfConfidence\", \"acceptingCriticism\", \"listening\"]),\n        skills: new Set([\"problemSolving\", \"creativity\", \"memoryFocus\", \"planningOrganization\", \"communicationExpression\", \"leadershipInitiative\"]),\n        interests: new Set([\"artisticCreative\", \"athleticPhysical\", \"technicalTech\", \"linguisticReading\", \"socialHumanitarian\", \"naturalEnvironmental\"]),\n      };\n      \n      const keys = Object.keys(hexagonData);\n      \n      // Validate that exactly 6 keys are present\n      if (keys.length !== 6) {\n        return res.status(400).json({ \n          message: `Invalid payload. Must update exactly 6 metrics for one hexagon. Received ${keys.length} keys.`\n        });\n      }\n      \n      // Determine which hexagon group these keys belong to\n      // SECURITY: This prevents cross-hexagon contamination by ensuring all 6 keys\n      // belong to the SAME hexagon group (not a mix from multiple groups)\n      let detectedGroup: string | null = null;\n      let canonicalKeys: Set<string> | null = null;\n      for (const [groupName, groupKeys] of Object.entries(hexagonGroups)) {\n        if (keys.every(k => groupKeys.has(k))) {\n          detectedGroup = groupName;\n          canonicalKeys = groupKeys;\n          break;\n        }\n      }\n      \n      if (!detectedGroup || !canonicalKeys) {\n        return res.status(400).json({ \n          message: \"Invalid payload. All 6 metrics must belong to the same hexagon (social, skills, or interests).\"\n        });\n      }\n      \n      // EXTRA SECURITY: Verify the 6 keys received are EXACTLY the 6 canonical keys\n      // for this hexagon group (no missing keys, no extra keys)\n      const receivedKeysSet = new Set(keys);\n      const canonicalKeysArray = Array.from(canonicalKeys);\n      \n      if (!canonicalKeysArray.every(k => receivedKeysSet.has(k))) {\n        return res.status(400).json({ \n          message: `Invalid payload. Must include all 6 metrics for ${detectedGroup} hexagon.`\n        });\n      }\n      \n      // hexagonData is already validated by Zod schema (integers 0-10)\n      const updates: Record<string, number> = hexagonData;\n      \n      // Validate total points for the detected hexagon (must be exactly 24)\n      const total = Object.values(updates).reduce((sum, v) => sum + v, 0);\n      \n      if (total !== 33) {\n        return res.status(400).json({ \n          message: `Invalid point distribution. The ${detectedGroup} hexagon must have exactly 33 total points (received ${total}).`\n        });\n      }\n      \n      // All validations passed - update the hexagon\n      const updated = await storage.updateUserProfile(userId, updates);\n      \n      if (!updated) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n      \n      const { password, ...userWithoutPassword } = updated;\n      res.json(userWithoutPassword);\n    } catch (error) {\n      console.error(\"Failed to update hexagon:\", error);\n      res.status(500).json({ message: \"Failed to update tendency charts\" });\n    }\n  });\n\n  // Update user hobbies (own profile only)\n  app.patch(\"/api/users/:userId/hobbies\", requireAuth, requireNonVisitor, async (req, res) => {\n    try {\n      const userId = req.params.userId;\n      const currentUserId = req.session.userId!;\n      \n      if (userId !== currentUserId) {\n        return res.status(403).json({ message: \"You can only edit your own hobbies\" });\n      }\n      \n      // Validate hobbies using Zod schema (allow empty array to delete all hobbies)\n      const hobbiesSchema = z.object({\n        hobbies: z.array(z.string().trim().min(1).max(50)).max(5)\n      });\n      \n      const parseResult = hobbiesSchema.safeParse(req.body);\n      \n      if (!parseResult.success) {\n        return res.status(400).json({ \n          message: \"Invalid hobbies format. Must be an array of 1-5 strings, each 1-50 characters.\",\n          errors: parseResult.error.errors\n        });\n      }\n      \n      const { hobbies } = parseResult.data;\n      \n      // Update user hobbies\n      const updated = await storage.updateUserProfile(userId, { hobbies });\n      \n      if (!updated) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n      \n      const { password, ...userWithoutPassword } = updated;\n      res.json(userWithoutPassword);\n    } catch (error) {\n      console.error(\"Failed to update hobbies:\", error);\n      res.status(500).json({ message: \"Failed to update hobbies\" });\n    }\n  });\n\n  // ==================== ADMIN STUDENT ID MANAGEMENT ====================\n  \n  // Generate new student ID (admin only)\n  // Admin provides username, grade, className → system generates random studentId\n  app.post(\"/api/admin/student-ids\", requireAdmin, async (req, res) => {\n    try {\n      const validatedData = insertAdminStudentIdSchema.parse({\n        username: req.body.username,\n        grade: req.body.grade,\n        className: req.body.className,\n        createdByAdminId: req.session.userId!,\n      });\n      \n      const record = await storage.createStudentId(\n        validatedData.username,\n        validatedData.grade,\n        validatedData.className,\n        req.session.userId!\n      );\n      \n      res.json({ \n        message: \"Student ID created successfully\",\n        studentId: record \n      });\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid input\", errors: error.errors });\n      }\n      console.error(\"Failed to create student ID:\", error);\n      res.status(400).json({ message: error instanceof Error ? error.message : \"Failed to create student ID\" });\n    }\n  });\n\n  // Get all student IDs (admin only)\n  app.get(\"/api/admin/student-ids\", requireAdmin, async (req, res) => {\n    try {\n      const studentIds = await storage.getAllStudentIds();\n      res.json(studentIds);\n    } catch (error) {\n      console.error(\"Failed to fetch student IDs:\", error);\n      res.status(500).json({ message: \"Failed to fetch student IDs\" });\n    }\n  });\n\n  // Get all assigned students (admin only)\n  app.get(\"/api/admin/students\", requireAdmin, async (req, res) => {\n    try {\n      const students = await storage.getAssignedStudents();\n      res.json(students);\n    } catch (error) {\n      console.error(\"Failed to fetch assigned students:\", error);\n      res.status(500).json({ message: \"Failed to fetch assigned students\" });\n    }\n  });\n\n  // Delete student ID (admin only, only unassigned IDs)\n  app.delete(\"/api/admin/student-ids/:id\", requireAdmin, async (req, res) => {\n    try {\n      const { id } = req.params;\n      \n      const success = await storage.deleteStudentId(id);\n      \n      if (!success) {\n        return res.status(400).json({ \n          message: \"Cannot delete student ID. It may be already assigned or not found.\" \n        });\n      }\n      \n      res.json({ message: \"Student ID deleted successfully\" });\n    } catch (error) {\n      console.error(\"Failed to delete student ID:\", error);\n      res.status(500).json({ message: \"Failed to delete student ID\" });\n    }\n  });\n\n  // Delete student account (admin only) - deletes all related data and the user\n  app.delete(\"/api/admin/student/:userId\", requireAdmin, async (req, res) => {\n    try {\n      const { userId } = req.params;\n      \n      // Prevent admin from deleting themselves\n      if (userId === req.session.userId) {\n        return res.status(400).json({ \n          message: \"Cannot delete your own admin account\" \n        });\n      }\n      \n      // Verify the user exists and is a student (not an admin)\n      const user = await storage.getUser(userId);\n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n      \n      if (user.role === \"admin\") {\n        return res.status(400).json({ \n          message: \"Cannot delete admin accounts using this endpoint\" \n        });\n      }\n      \n      const success = await storage.deleteStudentAccount(userId);\n      \n      if (!success) {\n        return res.status(500).json({ \n          message: \"Failed to delete student account\" \n        });\n      }\n      \n      res.json({ message: \"Student account deleted successfully\" });\n    } catch (error) {\n      console.error(\"Failed to delete student account:\", error);\n      res.status(500).json({ message: \"Failed to delete student account\" });\n    }\n  });\n\n  // Delete teacher account (admin only) - deletes all related data\n  app.delete(\"/api/admin/teacher/:teacherId\", requireAdmin, async (req, res) => {\n    try {\n      const { teacherId } = req.params;\n      \n      const success = await storage.deleteTeacherAccount(teacherId);\n      \n      if (!success) {\n        return res.status(500).json({ \n          message: \"Failed to delete teacher account\" \n        });\n      }\n      \n      res.json({ message: \"Teacher account deleted successfully\" });\n    } catch (error) {\n      console.error(\"Failed to delete teacher account:\", error);\n      res.status(500).json({ message: \"Failed to delete teacher account\" });\n    }\n  });\n\n  // ==================== SETTINGS / SUPPORT ====================\n  \n  // Get donation URL (public - anyone can check if donation URL is configured)\n  app.get(\"/api/settings/donation-url\", async (req, res) => {\n    try {\n      const setting = await storage.getSetting(\"donationUrl\");\n      res.json({ \n        url: setting?.value || null \n      });\n    } catch (error) {\n      console.error(\"Failed to get donation URL:\", error);\n      res.status(500).json({ message: \"Failed to get donation URL\" });\n    }\n  });\n  \n  // Set donation URL (admin only)\n  app.put(\"/api/admin/settings/donation-url\", requireAdmin, async (req, res) => {\n    try {\n      const { url } = req.body;\n      \n      if (!url || typeof url !== \"string\") {\n        return res.status(400).json({ message: \"Invalid donation URL\" });\n      }\n      \n      // Basic URL validation\n      try {\n        new URL(url);\n      } catch {\n        return res.status(400).json({ message: \"Invalid URL format\" });\n      }\n      \n      await storage.setSetting(\"donationUrl\", url);\n      res.json({ \n        message: \"Donation URL updated successfully\",\n        url \n      });\n    } catch (error) {\n      console.error(\"Failed to set donation URL:\", error);\n      res.status(500).json({ message: \"Failed to set donation URL\" });\n    }\n  });\n\n  // ==================== ACCESS CODE / DIGITAL KEY SYSTEM ====================\n  \n  // Verify and unlock scope (uses authenticated user from session)\n  app.post(\"/api/keys/unlock\", requireAuth, requireNonVisitor, async (req, res) => {\n    try {\n      const { scopeId, accessCode } = req.body;\n      const userId = req.session.userId!; // From authenticated session\n      \n      if (!scopeId || !accessCode) {\n        return res.status(400).json({ message: \"Missing required fields\" });\n      }\n      \n      const result = await storage.verifyAndUnlockScope(userId, scopeId, accessCode);\n      \n      if (!result.success) {\n        return res.status(400).json({ message: result.message });\n      }\n      \n      res.json(result);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to verify access code\" });\n    }\n  });\n  \n  // Get user's digital keys (authenticated user only)\n  app.get(\"/api/keys\", requireAuth, async (req, res) => {\n    try {\n      const keys = await storage.getUserDigitalKeys(req.session.userId!);\n      res.json(keys);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch digital keys\" });\n    }\n  });\n  \n  // Check if authenticated user has access to scope\n  app.get(\"/api/keys/check/:scopeId\", requireAuth, async (req, res) => {\n    try {\n      const hasAccess = await storage.hasAccessToScope(req.session.userId!, req.params.scopeId);\n      res.json({ hasAccess });\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to check access\" });\n    }\n  });\n\n  // ==================== ADMIN HANDOVER PROTOCOL ====================\n  \n  // Transfer admin privileges (requires current user to be admin)\n  app.post(\"/api/admin/handover\", requireAdmin, async (req, res) => {\n    try {\n      const { successorId, notes } = req.body;\n      const currentAdminId = req.session.userId!; // Authenticated admin\n      \n      if (!successorId) {\n        return res.status(400).json({ message: \"Successor ID required\" });\n      }\n      \n      const result = await storage.transferAdminPrivileges(currentAdminId, successorId, notes);\n      \n      if (!result.success) {\n        return res.status(400).json({ message: result.message });\n      }\n      \n      res.json(result);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to transfer admin privileges\" });\n    }\n  });\n  \n  // Get succession history (admin only)\n  app.get(\"/api/admin/succession-history\", requireAdmin, async (req, res) => {\n    try {\n      const history = await storage.getAdminSuccessionHistory();\n      res.json(history);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch succession history\" });\n    }\n  });\n\n  // Promote user to admin (requires current user to be admin)\n  app.post(\"/api/admin/promote\", requireAdmin, async (req, res) => {\n    try {\n      const { userId } = req.body;\n      const currentAdminId = req.session.userId!;\n      \n      if (!userId) {\n        return res.status(400).json({ message: \"User ID required\" });\n      }\n      \n      const result = await storage.promoteUserToAdmin(currentAdminId, userId);\n      \n      if (!result.success) {\n        return res.status(400).json({ message: result.message });\n      }\n      \n      res.json(result);\n    } catch (error) {\n      console.error(\"Failed to promote user to admin:\", error);\n      res.status(500).json({ message: \"Failed to promote user to admin\" });\n    }\n  });\n\n  // ==================== CREDIBILITY & REPUTATION ENGINE ====================\n  \n  // Calculate authenticated user's reputation\n  app.post(\"/api/reputation/calculate\", requireAuth, requireNonVisitor, async (req, res) => {\n    try {\n      const reputation = await storage.calculateUserReputation(req.session.userId!);\n      res.json({ reputation });\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to calculate reputation\" });\n    }\n  });\n  \n  // Update user credibility (admin only)\n  app.patch(\"/api/users/:userId/credibility\", requireAdmin, async (req, res) => {\n    try {\n      const { credibilityScore } = req.body;\n      \n      if (typeof credibilityScore !== \"number\") {\n        return res.status(400).json({ message: \"Invalid credibility score\" });\n      }\n      \n      const user = await storage.updateUserCredibility(req.params.userId, credibilityScore);\n      \n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n      \n      const { password, ...userWithoutPassword } = user;\n      res.json(userWithoutPassword);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to update credibility\" });\n    }\n  });\n\n  // Delete user account (admin only)\n  app.delete(\"/api/users/:userId\", requireAdmin, async (req, res) => {\n    try {\n      const userId = req.params.userId;\n      const currentAdmin = await storage.getUser(req.session.userId!);\n      \n      // Prevent admins from deleting themselves\n      if (currentAdmin?.id === userId) {\n        return res.status(400).json({ message: \"You cannot delete your own account\" });\n      }\n      \n      const success = await storage.deleteUser(userId);\n      \n      if (!success) {\n        return res.status(404).json({ message: \"User not found or already deleted\" });\n      }\n      \n      res.json({ message: \"User account deleted successfully\" });\n    } catch (error) {\n      console.error(\"Failed to delete user:\", error);\n      res.status(500).json({ message: \"Failed to delete user account\" });\n    }\n  });\n  \n  // Get user stats (public - for profile cards)\n  app.get(\"/api/users/:userId/stats\", async (req, res) => {\n    try {\n      const user = await storage.getUser(req.params.userId);\n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n      \n      // Return only public stats (hide private info like phone, transport)\n      res.json({\n        name: user.name,\n        role: user.role,\n        credibilityScore: user.credibilityScore,\n        reputationScore: user.reputationScore,\n        accountStatus: user.accountStatus,\n        avatarUrl: user.avatarUrl,\n        bio: user.bio,\n      });\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch user stats\" });\n    }\n  });\n\n  // Search user by email (for admin handover)\n  app.get(\"/api/users/search\", requireAuth, async (req, res) => {\n    try {\n      const { email } = req.query;\n      \n      if (!email || typeof email !== \"string\") {\n        return res.status(400).json({ message: \"Email query parameter required\" });\n      }\n      \n      const user = await storage.getUserByEmail(email);\n      \n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n      \n      // Return limited info\n      res.json({\n        id: user.id,\n        name: user.name,\n        email: user.email,\n        role: user.role,\n      });\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to search user\" });\n    }\n  });\n\n  // Get students by class\n  app.get(\"/api/classes/:grade/:className/students\", requireAuth, async (req, res) => {\n    try {\n      const { grade, className } = req.params;\n      const gradeNum = parseInt(grade);\n      \n      if (isNaN(gradeNum) || gradeNum < 1 || gradeNum > 6) {\n        return res.status(400).json({ message: \"Invalid grade (must be 1-6)\" });\n      }\n      \n      if (!className || className.length !== 1 || !/[A-E]/i.test(className)) {\n        return res.status(400).json({ message: \"Invalid class name (must be A-E)\" });\n      }\n      \n      const students = await storage.getStudentsByClass(gradeNum, className.toUpperCase());\n      \n      // Return students without sensitive info\n      const studentsPublicInfo = students.map(({ password, phone, transportDetails, email, ...student }) => student);\n      \n      res.json(studentsPublicInfo);\n    } catch (error) {\n      console.error(\"Failed to fetch students by class:\", error);\n      res.status(500).json({ message: \"Failed to fetch students\" });\n    }\n  });\n\n  // ==================== SCOPES ====================\n  \n  // Get all scopes\n  app.get(\"/api/scopes\", requireAuth, async (req, res) => {\n    try {\n      const scopes = await storage.getAllScopes();\n      res.json(scopes);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch scopes\" });\n    }\n  });\n  \n  // Get single scope\n  app.get(\"/api/scopes/:id\", requireAuth, async (req, res) => {\n    try {\n      const scope = await storage.getScope(req.params.id);\n      if (!scope) {\n        return res.status(404).json({ message: \"Scope not found\" });\n      }\n      res.json(scope);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch scope\" });\n    }\n  });\n  \n  // Create scope (admin only)\n  app.post(\"/api/scopes\", requireAdmin, async (req, res) => {\n    try {\n      // Additional validation\n      const { type, gradeNumber, sectionName, accessCode, name } = req.body;\n\n      // Public scopes don't need access codes, but other scopes do\n      if (type !== \"public\") {\n        // Validate access code format (alphanumeric, no spaces)\n        if (!accessCode || !/^[A-Za-z0-9]+$/.test(accessCode)) {\n          return res.status(400).json({ message: \"Access code must be alphanumeric with no spaces\" });\n        }\n      }\n\n      // Validate based on scope type\n      if (type === \"public\") {\n        // Public scope is always allowed and doesn't require additional validation\n        // Check if public scope already exists\n        const allScopes = await storage.getAllScopes();\n        const existingPublic = allScopes.find(s => s.type === \"public\");\n        if (existingPublic) {\n          return res.status(400).json({ message: \"Public square scope already exists\" });\n        }\n      } else if (type === \"grade\") {\n        if (!gradeNumber || typeof gradeNumber !== \"number\" || gradeNumber < 1 || gradeNumber > 6) {\n          return res.status(400).json({ message: \"Grade number must be a number between 1 and 6\" });\n        }\n        \n        // Check if grade scope already exists\n        const allScopes = await storage.getAllScopes();\n        const existingGrade = allScopes.find(s => s.type === \"grade\" && s.gradeNumber === gradeNumber);\n        if (existingGrade) {\n          return res.status(400).json({ message: `Grade ${gradeNumber} scope already exists` });\n        }\n      } else if (type === \"section\") {\n        if (!sectionName || typeof sectionName !== \"string\" || !sectionName.trim()) {\n          return res.status(400).json({ message: \"Section name is required for class scopes\" });\n        }\n        // Validate section name format (e.g., \"1-A\", \"2-B\")\n        if (!/^\\d+-[A-E]$/.test(sectionName)) {\n          return res.status(400).json({ message: \"Section name must be in format: grade-section (e.g., 1-A, 2-B)\" });\n        }\n        \n        // Extract grade number from section name and verify parent grade exists\n        const sectionGrade = parseInt(sectionName.split('-')[0]);\n        const allScopes = await storage.getAllScopes();\n        const parentGrade = allScopes.find(s => s.type === \"grade\" && s.gradeNumber === sectionGrade);\n        if (!parentGrade) {\n          return res.status(400).json({ message: `Parent grade scope (Grade ${sectionGrade}) must exist before creating class sections` });\n        }\n        \n        // Check if section already exists\n        const existingSection = allScopes.find(s => s.type === \"section\" && s.sectionName === sectionName);\n        if (existingSection) {\n          return res.status(400).json({ message: `Class section ${sectionName} already exists` });\n        }\n      }\n\n      const scopeData = insertScopeSchema.parse(req.body);\n      const scope = await storage.createScope(scopeData);\n      res.json(scope);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid input\", errors: error.errors });\n      }\n      res.status(500).json({ message: \"Failed to create scope\" });\n    }\n  });\n\n  // Delete scope (admin only)\n  app.delete(\"/api/scopes/:id\", requireAdmin, async (req, res) => {\n    try {\n      const deleted = await storage.deleteScope(req.params.id);\n      if (!deleted) {\n        return res.status(404).json({ message: \"Scope not found\" });\n      }\n      res.json({ message: \"Scope deleted successfully\" });\n    } catch (error) {\n      if (error instanceof Error) {\n        // Return specific error message from storage layer\n        return res.status(400).json({ message: error.message });\n      }\n      res.status(500).json({ message: \"Failed to delete scope\" });\n    }\n  });\n\n  // ==================== POSTS ====================\n  \n  // Create post (uses authenticated user) with optional file upload\n  app.post(\"/api/posts\", requireAuth, requireNonVisitor, upload.single('media'), async (req, res) => {\n    try {\n      // Moderate content before saving (only if content is provided)\n      if (req.body.content?.trim()) {\n        await requireModeration(req.body.content);\n      }\n      \n      // Prepare post data with media if uploaded\n      const postData = insertPostSchema.parse({\n        ...req.body,\n        authorId: req.session.userId!, // Use authenticated user\n        mediaUrl: req.file ? `/uploads/${req.file.filename}` : undefined,\n        mediaType: req.file ? getMediaType(req.file.mimetype) : undefined,\n      });\n      \n      // If posting to a restricted scope, verify user has access\n      if (postData.scopeId) {\n        const hasAccess = await storage.hasAccessToScope(req.session.userId!, postData.scopeId);\n        if (!hasAccess) {\n          return res.status(403).json({ message: \"You don't have access to post in this scope. Please enter the access code first.\" });\n        }\n      }\n      \n      const post = await storage.createPost(postData);\n      res.json(post);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid input\", errors: error.errors });\n      }\n      if (error instanceof Error) {\n        // Handle moderation errors\n        if (error.message.includes(\"community guidelines\")) {\n          return res.status(400).json({ message: error.message });\n        }\n      }\n      res.status(500).json({ message: \"Failed to create post\" });\n    }\n  });\n  \n  // Get posts (by scope or public square)\n  app.get(\"/api/posts\", requireAuth, async (req, res) => {\n    try {\n      const scopeId = req.query.scopeId as string | undefined;\n      const userId = req.session.userId!;\n      const posts = await storage.getPosts(scopeId === \"null\" ? null : scopeId, userId);\n      res.json(posts);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch posts\" });\n    }\n  });\n  \n  // Edit post (author only)\n  app.patch(\"/api/posts/:id\", requireAuth, requireNonVisitor, async (req, res) => {\n    try {\n      const postId = req.params.id;\n      const userId = req.session.userId!;\n      const { content } = req.body;\n      \n      if (!content || typeof content !== \"string\") {\n        return res.status(400).json({ message: \"Content is required\" });\n      }\n      \n      // Verify user is the post author\n      const post = await storage.getPost(postId);\n      if (!post) {\n        return res.status(404).json({ message: \"Post not found\" });\n      }\n      \n      if (post.authorId !== userId) {\n        return res.status(403).json({ message: \"You can only edit your own posts\" });\n      }\n      \n      // Moderate content before updating\n      if (content.trim()) {\n        await requireModeration(content);\n      }\n      \n      const updated = await storage.updatePost(postId, content);\n      res.json(updated);\n    } catch (error) {\n      if (error instanceof Error && error.message.includes(\"community guidelines\")) {\n        return res.status(400).json({ message: error.message });\n      }\n      res.status(500).json({ message: \"Failed to update post\" });\n    }\n  });\n  \n  // Update post credibility (admin only)\n  app.patch(\"/api/posts/:id/credibility\", requireAdmin, async (req, res) => {\n    try {\n      const { credibilityRating } = req.body;\n      \n      if (typeof credibilityRating !== \"number\") {\n        return res.status(400).json({ message: \"Invalid credibility rating\" });\n      }\n      \n      const post = await storage.updatePostCredibility(req.params.id, credibilityRating);\n      \n      if (!post) {\n        return res.status(404).json({ message: \"Post not found\" });\n      }\n      \n      res.json(post);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to update post credibility\" });\n    }\n  });\n\n  // Delete post (admin only)\n  app.delete(\"/api/posts/:id\", requireAdmin, async (req, res) => {\n    try {\n      const postId = req.params.id;\n      \n      const post = await storage.getPost(postId);\n      if (!post) {\n        return res.status(404).json({ message: \"Post not found\" });\n      }\n      \n      const success = await storage.deletePost(postId);\n      \n      if (!success) {\n        return res.status(500).json({ message: \"Failed to delete post\" });\n      }\n      \n      res.json({ message: \"Post deleted successfully\" });\n    } catch (error) {\n      console.error(\"Failed to delete post:\", error);\n      res.status(500).json({ message: \"Failed to delete post\" });\n    }\n  });\n\n  // Like a post (toggle)\n  app.post(\"/api/posts/:id/like\", requireAuth, requireNonVisitor, async (req, res) => {\n    try {\n      const postId = req.params.id;\n      const userId = req.session.userId!;\n      \n      // Check if user already liked this post\n      const existingReaction = await storage.getUserPostReaction(postId, userId);\n      \n      if (existingReaction) {\n        // Unlike - delete reaction\n        await storage.deletePostReaction(postId, userId);\n        res.json({ liked: false, message: \"Post unliked\" });\n      } else {\n        // Like - create reaction\n        await storage.createPostReaction(postId, userId);\n        res.json({ liked: true, message: \"Post liked\" });\n      }\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to toggle like\" });\n    }\n  });\n\n  // Get user's like status for a post\n  app.get(\"/api/posts/:id/like-status\", requireAuth, async (req, res) => {\n    try {\n      const postId = req.params.id;\n      const userId = req.session.userId!;\n      \n      const reaction = await storage.getUserPostReaction(postId, userId);\n      res.json({ liked: !!reaction });\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch like status\" });\n    }\n  });\n\n  // Rate post accuracy (1-5 stars)\n  app.post(\"/api/posts/:id/rate-accuracy\", requireAuth, requireNonVisitor, async (req, res) => {\n    try {\n      const postId = req.params.id;\n      const userId = req.session.userId!;\n      const { rating } = req.body;\n      \n      // Validate rating\n      if (!Number.isInteger(rating) || rating < 1 || rating > 5) {\n        return res.status(400).json({ message: \"Rating must be an integer between 1 and 5\" });\n      }\n      \n      const result = await storage.ratePostAccuracy(postId, userId, rating);\n      res.json({ success: true, rating: result.rating });\n    } catch (error) {\n      console.error(\"Failed to rate post accuracy:\", error);\n      res.status(500).json({ message: \"Failed to rate post accuracy\" });\n    }\n  });\n\n  // ==================== EVENTS ====================\n  \n  // Create event\n  app.post(\"/api/events\", requireAuth, requireNonVisitor, async (req, res) => {\n    try {\n      // Moderate event description before saving (only if description is provided)\n      if (req.body.description?.trim()) {\n        await requireModeration(req.body.description);\n      }\n      \n      // Parse dates from ISO strings to Date objects\n      const eventPayload = {\n        ...req.body,\n        createdById: req.session.userId!,\n        startTime: new Date(req.body.startTime),\n        endTime: req.body.endTime ? new Date(req.body.endTime) : undefined,\n      };\n      \n      const eventData = insertEventSchema.parse(eventPayload);\n      \n      // If creating event in a restricted scope, verify user has access\n      if (eventData.scopeId) {\n        const hasAccess = await storage.hasAccessToScope(req.session.userId!, eventData.scopeId);\n        if (!hasAccess) {\n          return res.status(403).json({ message: \"You don't have access to create events in this scope. Please enter the access code first.\" });\n        }\n      }\n      \n      const event = await storage.createEvent(eventData);\n      res.status(201).json(event);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid input\", errors: error.errors });\n      }\n      if (error instanceof Error && error.message.includes(\"community guidelines\")) {\n        return res.status(400).json({ message: error.message });\n      }\n      console.error(\"Failed to create event:\", error);\n      res.status(500).json({ message: \"Failed to create event\" });\n    }\n  });\n  \n  // Get events\n  app.get(\"/api/events\", requireAuth, async (req, res) => {\n    try {\n      const scopeId = req.query.scopeId as string | undefined;\n      const userId = req.session.userId;\n      const events = await storage.getEvents(scopeId, userId);\n      res.json(events);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch events\" });\n    }\n  });\n\n  // Get single event by ID\n  app.get(\"/api/events/:id\", requireAuth, async (req, res) => {\n    try {\n      const events = await storage.getEvents(undefined, req.session.userId);\n      const event = events.find(e => e.id === req.params.id);\n      if (!event) {\n        return res.status(404).json({ message: \"Event not found\" });\n      }\n      res.json(event);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch event\" });\n    }\n  });\n  \n  // RSVP to event\n  app.post(\"/api/events/:id/rsvp\", requireAuth, requireNonVisitor, async (req, res) => {\n    try {\n      const rsvp = await storage.rsvpToEvent(req.params.id, req.session.userId!);\n      res.json(rsvp);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to RSVP to event\" });\n    }\n  });\n  \n  // Get event RSVPs\n  app.get(\"/api/events/:id/rsvps\", requireAuth, async (req, res) => {\n    try {\n      const rsvps = await storage.getEventRsvps(req.params.id);\n      res.json(rsvps);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch RSVPs\" });\n    }\n  });\n\n  // Get current user's RSVPs\n  app.get(\"/api/rsvps\", requireAuth, async (req, res) => {\n    try {\n      const rsvps = await storage.getUserRsvps(req.session.userId!);\n      res.json(rsvps);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch user RSVPs\" });\n    }\n  });\n\n  app.get(\"/api/events/:id/attendees\", requireAuth, async (req, res) => {\n    try {\n      const attendees = await storage.getEventAttendees(req.params.id);\n      res.json(attendees);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch event attendees\" });\n    }\n  });\n\n  // ==================== SCHEDULES ====================\n  \n  // Create schedule entry (requires section key)\n  app.post(\"/api/schedules\", requireAuth, requireNonVisitor, async (req, res) => {\n    try {\n      const scheduleData = insertScheduleSchema.parse(req.body);\n      \n      // Verify user has access to the section\n      const hasAccess = await storage.hasAccessToScope(req.session.userId!, scheduleData.scopeId);\n      if (!hasAccess) {\n        return res.status(403).json({ message: \"You need the section key to create/edit schedules\" });\n      }\n      \n      const schedule = await storage.createSchedule(scheduleData);\n      res.json(schedule);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid input\", errors: error.errors });\n      }\n      res.status(500).json({ message: \"Failed to create schedule\" });\n    }\n  });\n  \n  // Get schedules for a scope\n  app.get(\"/api/schedules/:scopeId\", requireAuth, async (req, res) => {\n    try {\n      const schedules = await storage.getSchedules(req.params.scopeId);\n      res.json(schedules);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch schedules\" });\n    }\n  });\n  \n  // Update schedule entry (requires section key)\n  app.patch(\"/api/schedules/:id\", requireAuth, requireNonVisitor, async (req, res) => {\n    try {\n      const { teacherName, subject, scopeId } = req.body;\n      \n      if (!teacherName || !subject || !scopeId) {\n        return res.status(400).json({ message: \"Teacher name, subject, and scope ID required\" });\n      }\n      \n      // Verify user has access to the section\n      const hasAccess = await storage.hasAccessToScope(req.session.userId!, scopeId);\n      if (!hasAccess) {\n        return res.status(403).json({ message: \"You need the section key to edit schedules\" });\n      }\n      \n      const schedule = await storage.updateSchedule(req.params.id, teacherName, subject);\n      \n      if (!schedule) {\n        return res.status(404).json({ message: \"Schedule not found\" });\n      }\n      \n      res.json(schedule);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to update schedule\" });\n    }\n  });\n\n  // Bulk update schedules for a scope (requires section key or admin)\n  app.patch(\"/api/schedules/:scopeId/bulk\", requireAuth, requireNonVisitor, async (req, res) => {\n    try {\n      const { scopeId } = req.params;\n      const { updates } = req.body;\n\n      if (!Array.isArray(updates)) {\n        return res.status(400).json({ message: \"Updates must be an array\" });\n      }\n\n      // Verify user has access to the section or is admin\n      const user = await storage.getUser(req.session.userId!);\n      const hasAccess = user?.role === \"admin\" || await storage.hasAccessToScope(req.session.userId!, scopeId);\n      \n      if (!hasAccess) {\n        return res.status(403).json({ message: \"You need the section key or admin privileges to edit schedules\" });\n      }\n\n      await storage.bulkUpdateSchedules(scopeId, updates);\n      res.json({ message: \"Schedules updated successfully\" });\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to update schedules\" });\n    }\n  });\n\n  // ==================== TEACHERS ====================\n  \n  // Create teacher profile (admin only)\n  app.post(\"/api/teachers\", requireAdmin, async (req, res) => {\n    try {\n      console.log(\"[TEACHER CREATE] Received body:\", JSON.stringify(req.body));\n      const teacherData = insertTeacherSchema.parse(req.body);\n      console.log(\"[TEACHER CREATE] Validated data:\", JSON.stringify(teacherData));\n      const teacher = await storage.createTeacher(teacherData);\n      console.log(\"[TEACHER CREATE] Success:\", teacher.id);\n      res.json(teacher);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        console.error(\"[TEACHER CREATE] Validation error:\", error.errors);\n        return res.status(400).json({ message: \"Invalid input\", errors: error.errors });\n      }\n      console.error(\"[TEACHER CREATE] Database error:\", error instanceof Error ? error.message : String(error));\n      console.error(\"[TEACHER CREATE] Full error:\", error);\n      const errorMsg = error instanceof Error ? error.message : \"Unknown error\";\n      res.status(500).json({ message: \"Failed to create teacher\", error: errorMsg });\n    }\n  });\n  \n  // Get all teachers\n  app.get(\"/api/teachers\", requireAuth, async (req, res) => {\n    try {\n      console.log(\"[TEACHER GET] Fetching all teachers\");\n      const teachers = await storage.getTeachers();\n      console.log(\"[TEACHER GET] Success, found\", teachers.length, \"teachers\");\n      res.json(teachers);\n    } catch (error) {\n      console.error(\"[TEACHER GET] Error:\", error instanceof Error ? error.message : String(error));\n      console.error(\"[TEACHER GET] Full error:\", error);\n      const errorMsg = error instanceof Error ? error.message : \"Unknown error\";\n      res.status(500).json({ message: \"Failed to fetch teachers\", error: errorMsg });\n    }\n  });\n  \n  // Get single teacher with reviews and average rating\n  app.get(\"/api/teachers/:id\", requireAuth, async (req, res) => {\n    try {\n      console.log(\"[TEACHER GET BY ID] Fetching teacher:\", req.params.id);\n      const result = await storage.getTeacherWithReviews(req.params.id);\n      if (!result) {\n        return res.status(404).json({ message: \"Teacher not found\" });\n      }\n      console.log(\"[TEACHER GET BY ID] Success\");\n      res.json(result);\n    } catch (error) {\n      console.error(\"[TEACHER GET BY ID] Error:\", error instanceof Error ? error.message : String(error));\n      console.error(\"[TEACHER GET BY ID] Full error:\", error);\n      const errorMsg = error instanceof Error ? error.message : \"Unknown error\";\n      res.status(500).json({ message: \"Failed to fetch teacher\", error: errorMsg });\n    }\n  });\n\n  // Update teacher (admin only)\n  app.patch(\"/api/teachers/:id\", requireAdmin, async (req, res) => {\n    try {\n      console.log(\"[TEACHER UPDATE] Updating teacher:\", req.params.id);\n      const updates = req.body;\n      const teacher = await storage.updateTeacher(req.params.id, updates);\n      if (!teacher) {\n        return res.status(404).json({ message: \"Teacher not found\" });\n      }\n      console.log(\"[TEACHER UPDATE] Success\");\n      res.json(teacher);\n    } catch (error) {\n      console.error(\"[TEACHER UPDATE] Error:\", error instanceof Error ? error.message : String(error));\n      console.error(\"[TEACHER UPDATE] Full error:\", error);\n      const errorMsg = error instanceof Error ? error.message : \"Unknown error\";\n      res.status(500).json({ message: \"Failed to update teacher\", error: errorMsg });\n    }\n  });\n\n  // Delete teacher (admin only)\n  app.delete(\"/api/teachers/:id\", requireAdmin, async (req, res) => {\n    try {\n      console.log(\"[TEACHER DELETE] Deleting teacher:\", req.params.id);\n      const deleted = await storage.deleteTeacher(req.params.id);\n      if (!deleted) {\n        return res.status(404).json({ message: \"Teacher not found\" });\n      }\n      console.log(\"[TEACHER DELETE] Success\");\n      res.json({ message: \"Teacher deleted successfully\" });\n    } catch (error) {\n      console.error(\"[TEACHER DELETE] Error:\", error instanceof Error ? error.message : String(error));\n      console.error(\"[TEACHER DELETE] Full error:\", error);\n      const errorMsg = error instanceof Error ? error.message : \"Unknown error\";\n      res.status(500).json({ message: \"Failed to delete teacher\", error: errorMsg });\n    }\n  });\n  \n  // Create teacher review\n  app.post(\"/api/teachers/:id/reviews\", requireAuth, requireNonVisitor, async (req, res) => {\n    try {\n      // Moderate review comment before saving (only if comment is provided)\n      if (req.body.comment?.trim()) {\n        await requireModeration(req.body.comment);\n      }\n      \n      const reviewData = insertTeacherReviewSchema.parse({\n        ...req.body,\n        teacherId: req.params.id,\n        studentId: req.session.userId!,\n      });\n      const review = await storage.createTeacherReview(reviewData);\n      res.json(review);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid input\", errors: error.errors });\n      }\n      if (error instanceof Error && error.message.includes(\"community guidelines\")) {\n        return res.status(400).json({ message: error.message });\n      }\n      // Handle unique constraint violation for duplicate reviews\n      if (error instanceof Error && (error.message.includes(\"unique\") || error.message.includes(\"duplicate\"))) {\n        return res.status(409).json({ message: \"You have already submitted a review for this teacher\" });\n      }\n      res.status(500).json({ message: \"Failed to create review\" });\n    }\n  });\n  \n  // Get teacher reviews\n  app.get(\"/api/teachers/:id/reviews\", requireAuth, async (req, res) => {\n    try {\n      const reviews = await storage.getTeacherReviews(req.params.id);\n      res.json(reviews);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch reviews\" });\n    }\n  });\n\n  // Create or update teacher feedback\n  app.post(\"/api/teachers/:id/feedback\", requireAuth, requireNonVisitor, async (req, res) => {\n    try {\n      console.log(\"[FEEDBACK CREATE] Received body:\", JSON.stringify(req.body));\n      const feedbackData = insertTeacherFeedbackSchema.parse({\n        ...req.body,\n        teacherId: req.params.id,\n        studentId: req.session.userId!,\n      });\n      console.log(\"[FEEDBACK CREATE] Validated data:\", JSON.stringify(feedbackData));\n      const feedback = await storage.createTeacherFeedback(feedbackData);\n      console.log(\"[FEEDBACK CREATE] Success:\", feedback.id);\n      res.json(feedback);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        console.error(\"[FEEDBACK CREATE] Validation error:\", error.errors);\n        return res.status(400).json({ message: \"Invalid input\", errors: error.errors });\n      }\n      if (error instanceof Error && (error.message.includes(\"unique\") || error.message.includes(\"duplicate\"))) {\n        return res.status(409).json({ message: \"You have already submitted feedback for this teacher\" });\n      }\n      console.error(\"[FEEDBACK CREATE] Error:\", error instanceof Error ? error.message : String(error));\n      console.error(\"[FEEDBACK CREATE] Full error:\", error);\n      const errorMsg = error instanceof Error ? error.message : \"Unknown error\";\n      res.status(500).json({ message: \"Failed to submit feedback\", error: errorMsg });\n    }\n  });\n\n  // Update teacher feedback\n  app.patch(\"/api/teachers/:id/feedback\", requireAuth, requireNonVisitor, async (req, res) => {\n    try {\n      console.log(\"[FEEDBACK UPDATE] Received body:\", JSON.stringify(req.body));\n      const teacherId = req.params.id;\n      const studentId = req.session.userId!;\n\n      // Check if feedback exists\n      const existing = await storage.getTeacherFeedbackByStudent(teacherId, studentId);\n      if (!existing) {\n        return res.status(404).json({ message: \"No feedback found to update. Please submit new feedback first.\" });\n      }\n\n      // Validate update data (allow partial updates)\n      const updateData = req.body;\n      const updated = await storage.updateTeacherFeedback(teacherId, studentId, updateData);\n      \n      if (!updated) {\n        return res.status(500).json({ message: \"Failed to update feedback\" });\n      }\n\n      console.log(\"[FEEDBACK UPDATE] Success:\", updated.id);\n      res.json(updated);\n    } catch (error) {\n      console.error(\"[FEEDBACK UPDATE] Error:\", error instanceof Error ? error.message : String(error));\n      console.error(\"[FEEDBACK UPDATE] Full error:\", error);\n      const errorMsg = error instanceof Error ? error.message : \"Unknown error\";\n      res.status(500).json({ message: \"Failed to update feedback\", error: errorMsg });\n    }\n  });\n\n  // Get user's feedback for a teacher\n  app.get(\"/api/teachers/:id/feedback/my-feedback\", requireAuth, async (req, res) => {\n    try {\n      const teacherId = req.params.id;\n      const studentId = req.session.userId;\n\n      if (!studentId) {\n        return res.status(401).json({ message: \"Authentication required\" });\n      }\n\n      const feedback = await storage.getTeacherFeedbackByStudent(teacherId, studentId);\n      res.json(feedback || null);\n    } catch (error) {\n      console.error(\"[FEEDBACK GET USER] Error:\", error instanceof Error ? error.message : String(error));\n      res.status(500).json({ message: \"Failed to fetch feedback\" });\n    }\n  });\n\n  // Get teacher feedback statistics (admin only)\n  app.get(\"/api/teachers/:id/feedback\", requireAuth, async (req, res) => {\n    try {\n      console.log(\"[FEEDBACK STATS] Fetching feedback for teacher:\", req.params.id);\n      // Only admins can view feedback statistics\n      if (req.session.userId) {\n        const user = await storage.getUser(req.session.userId);\n        if (!user || user.role !== \"admin\") {\n          return res.status(403).json({ message: \"Admin privileges required\" });\n        }\n      } else {\n        return res.status(403).json({ message: \"Admin privileges required\" });\n      }\n\n      const stats = await storage.getTeacherFeedbackStats(req.params.id);\n      console.log(\"[FEEDBACK STATS] Success\");\n      res.json(stats);\n    } catch (error) {\n      console.error(\"[FEEDBACK STATS] Error:\", error instanceof Error ? error.message : String(error));\n      console.error(\"[FEEDBACK STATS] Full error:\", error);\n      const errorMsg = error instanceof Error ? error.message : \"Unknown error\";\n      res.status(500).json({ message: \"Failed to fetch feedback statistics\", error: errorMsg });\n    }\n  });\n\n  // ==================== POST COMMENTS ====================\n  app.post(\"/api/posts/:postId/comments\", requireAuth, requireNonVisitor, async (req, res) => {\n    try {\n      const commentData = insertPostCommentSchema.parse({\n        ...req.body,\n        postId: req.params.postId,\n        authorId: req.session.userId!,\n      });\n      \n      const comment = await storage.createPostComment(commentData);\n      res.json(comment);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid input\", errors: error.errors });\n      }\n      res.status(500).json({ message: \"Failed to create comment\" });\n    }\n  });\n\n  app.get(\"/api/posts/:postId/comments\", requireAuth, async (req, res) => {\n    try {\n      const comments = await storage.getPostComments(req.params.postId);\n      res.json(comments);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch comments\" });\n    }\n  });\n\n  // ==================== EVENT COMMENTS ====================\n  app.post(\"/api/events/:eventId/comments\", requireAuth, requireNonVisitor, async (req, res) => {\n    try {\n      const commentData = insertEventCommentSchema.parse({\n        ...req.body,\n        eventId: req.params.eventId,\n        authorId: req.session.userId!,\n      });\n      \n      const comment = await storage.createEventComment(commentData);\n      res.json(comment);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid input\", errors: error.errors });\n      }\n      res.status(500).json({ message: \"Failed to create comment\" });\n    }\n  });\n\n  app.get(\"/api/events/:eventId/comments\", requireAuth, async (req, res) => {\n    try {\n      const comments = await storage.getEventComments(req.params.eventId);\n      res.json(comments);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch comments\" });\n    }\n  });\n\n\n  // ==================== FRIENDS ====================\n  app.post(\"/api/friends/request\", requireNonVisitor, async (req, res) => {\n    try {\n      const { receiverId } = req.body;\n      const senderId = req.session.userId!;\n      \n      if (senderId === receiverId) {\n        return res.status(400).json({ message: \"Cannot send friend request to yourself\" });\n      }\n      \n      const existingFriendship = await storage.getFriendship(senderId, receiverId);\n      if (existingFriendship) {\n        return res.status(400).json({ message: \"Friend request already exists or you are already friends\" });\n      }\n      \n      const friendship = await storage.sendFriendRequest(senderId, receiverId);\n      res.json(friendship);\n    } catch (error) {\n      console.error(\"Send friend request error:\", error);\n      res.status(500).json({ message: \"Failed to send friend request\" });\n    }\n  });\n\n  app.post(\"/api/friends/accept/:friendshipId\", requireNonVisitor, async (req, res) => {\n    try {\n      const friendship = await storage.acceptFriendRequest(req.params.friendshipId);\n      if (!friendship) {\n        return res.status(404).json({ message: \"Friend request not found\" });\n      }\n      res.json(friendship);\n    } catch (error) {\n      console.error(\"Accept friend request error:\", error);\n      res.status(500).json({ message: \"Failed to accept friend request\" });\n    }\n  });\n\n  app.post(\"/api/friends/reject/:friendshipId\", requireNonVisitor, async (req, res) => {\n    try {\n      const friendship = await storage.rejectFriendRequest(req.params.friendshipId);\n      if (!friendship) {\n        return res.status(404).json({ message: \"Friend request not found\" });\n      }\n      res.json(friendship);\n    } catch (error) {\n      console.error(\"Reject friend request error:\", error);\n      res.status(500).json({ message: \"Failed to reject friend request\" });\n    }\n  });\n\n  app.get(\"/api/friends\", requireNonVisitor, async (req, res) => {\n    try {\n      const friends = await storage.getFriends(req.session.userId!);\n      res.json(friends);\n    } catch (error) {\n      console.error(\"Get friends error:\", error);\n      res.status(500).json({ message: \"Failed to fetch friends\" });\n    }\n  });\n\n  app.get(\"/api/friends/requests\", requireNonVisitor, async (req, res) => {\n    try {\n      const requests = await storage.getPendingFriendRequests(req.session.userId!);\n      res.json(requests);\n    } catch (error) {\n      console.error(\"Get friend requests error:\", error);\n      res.status(500).json({ message: \"Failed to fetch friend requests\" });\n    }\n  });\n\n  app.delete(\"/api/friends/:friendId\", requireNonVisitor, async (req, res) => {\n    try {\n      await storage.unfriend(req.session.userId!, req.params.friendId);\n      res.json({ message: \"Friend removed successfully\" });\n    } catch (error) {\n      console.error(\"Unfriend error:\", error);\n      res.status(500).json({ message: \"Failed to remove friend\" });\n    }\n  });\n\n  // ==================== CHAT ====================\n  app.post(\"/api/chat/messages\", requireNonVisitor, async (req, res) => {\n    try {\n      const messageData = insertChatMessageSchema.parse({\n        ...req.body,\n        senderId: req.session.userId!,\n      });\n      \n      const friendship = await storage.getFriendship(messageData.senderId, messageData.receiverId);\n      if (!friendship || friendship.status !== \"accepted\") {\n        return res.status(403).json({ message: \"Can only send messages to friends\" });\n      }\n      \n      const moderation = await moderateContentEnhanced(messageData.content, \"chat message\");\n      \n      if (moderation.isViolation && moderation.severity && moderation.violationType) {\n        const violationCount = await storage.getUserViolationCount(messageData.senderId);\n        \n        const violation = await storage.createViolation({\n          contentType: \"chat_message\",\n          contentId: \"pending\",\n          authorId: messageData.senderId,\n          violationType: moderation.violationType,\n          severity: moderation.severity,\n          detectedBy: \"ai\",\n          aiConfidence: moderation.confidence,\n          aiReasoning: moderation.reasoning,\n          reportedById: null,\n        });\n        \n        const punishment = calculatePunishment(moderation.violationType, moderation.severity, violationCount);\n        \n        await storage.createPunishment({\n          userId: messageData.senderId,\n          violationId: violation.id,\n          punishmentType: punishment.punishmentType,\n          credibilityPenalty: punishment.credibilityPenalty,\n          banUntil: punishment.banDurationHours ? new Date(Date.now() + punishment.banDurationHours * 60 * 60 * 1000) : null,\n          notes: `AI detected ${moderation.violationType} (${moderation.severity}) in chat message`,\n        });\n        \n        await storage.applyPunishment(\n          messageData.senderId,\n          punishment.credibilityPenalty,\n          punishment.banDurationHours ? new Date(Date.now() + punishment.banDurationHours * 60 * 60 * 1000) : undefined\n        );\n        \n        return res.status(400).json({ \n          message: `Message blocked: ${moderation.reasoning}`,\n          punishment: punishment.punishmentType,\n          credibilityLost: punishment.credibilityPenalty\n        });\n      }\n      \n      const message = await storage.sendChatMessage(messageData.senderId, messageData.receiverId, messageData.content);\n      res.json(message);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid message\", errors: error.errors });\n      }\n      console.error(\"Send message error:\", error);\n      res.status(500).json({ message: \"Failed to send message\" });\n    }\n  });\n\n  app.get(\"/api/chat/messages/:friendId\", requireNonVisitor, async (req, res) => {\n    try {\n      const messages = await storage.getChatMessages(req.session.userId!, req.params.friendId);\n      res.json(messages);\n    } catch (error) {\n      console.error(\"Get messages error:\", error);\n      res.status(500).json({ message: \"Failed to fetch messages\" });\n    }\n  });\n\n  app.patch(\"/api/chat/messages/:messageId/read\", requireNonVisitor, async (req, res) => {\n    try {\n      const message = await storage.markMessageAsRead(req.params.messageId);\n      if (!message) {\n        return res.status(404).json({ message: \"Message not found\" });\n      }\n      res.json(message);\n    } catch (error) {\n      console.error(\"Mark message as read error:\", error);\n      res.status(500).json({ message: \"Failed to mark message as read\" });\n    }\n  });\n\n  app.get(\"/api/chat/unread-count\", requireNonVisitor, async (req, res) => {\n    try {\n      const count = await storage.getUnreadMessageCount(req.session.userId!);\n      res.json({ count });\n    } catch (error) {\n      console.error(\"Get unread count error:\", error);\n      res.status(500).json({ message: \"Failed to fetch unread count\" });\n    }\n  });\n\n  // ==================== FILE UPLOADS ====================\n  \n  // Ensure uploads directory exists and serve uploaded files\n  const UPLOAD_DIR = path.join(process.cwd(), \"uploads\");\n  try {\n    await fs.mkdir(UPLOAD_DIR, { recursive: true });\n  } catch (error) {\n    console.error(\"Failed to create uploads directory:\", error);\n    // Continue anyway - static serving will fail gracefully\n  }\n  app.use('/uploads', express.static(UPLOAD_DIR));\n\n  const httpServer = createServer(app);\n\n  return httpServer;\n}\n","path":null,"size_bytes":78412,"size_tokens":null},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","path":null,"size_bytes":6210,"size_tokens":null},"design_guidelines.md":{"content":"# School Community Ecosystem - Updated Design Guidelines\n\n## Design Approach\n\n**Selected Approach:** Reference-Based (Premium Social Platform)\n\n**Primary References:** \n- Instagram (social feed elegance)\n- Discord (community hierarchy)\n- Notion (modern card UI)\n- Linear (sophisticated minimalism)\n- Stripe (premium polish)\n\n**Core Principles:**\n- Elevated aesthetics with functional clarity\n- Layered depth through glassmorphism and shadows\n- Fluid transitions creating premium feel\n- Role distinction through subtle visual cues, not heavy borders\n\n---\n\n## Typography\n\n**Font Stack:**\n- Primary: Inter (400, 500, 600, 700) via Google Fonts CDN\n- Accent: Outfit (500, 600, 700) for headlines/badges via Google Fonts CDN\n\n**Hierarchy:**\n- Hero/Dashboard Titles: text-5xl lg:text-6xl, font-bold (Outfit)\n- Page Headers: text-3xl lg:text-4xl, font-semibold (Outfit)\n- Section Headers: text-xl lg:text-2xl, font-semibold (Inter)\n- Card Titles: text-lg font-semibold (Inter)\n- Body Text: text-base font-normal leading-relaxed (Inter)\n- Captions: text-sm font-medium (Inter)\n- Badges/Labels: text-xs font-bold tracking-wide uppercase (Outfit)\n\n**Letter Spacing:**\n- Headlines: tracking-tight\n- Body: tracking-normal\n- Labels: tracking-wider\n\n---\n\n## Layout System\n\n**Spacing Primitives:** Tailwind units of 3, 4, 6, 8, 12, 16, 20, 24, 32\n\n**Container Strategy:**\n- Dashboard wrapper: max-w-[1920px] mx-auto px-6 lg:px-8\n- Feed content: max-w-4xl mx-auto\n- Sidebar panels: w-80 lg:w-96 (wider for premium feel)\n- Modal overlays: max-w-2xl mx-auto\n\n**Grid Patterns:**\n- News Feed: Single column, gap-8\n- Stats Dashboard: 4-column responsive (lg:grid-cols-4 md:grid-cols-2 gap-6)\n- Event Cards: 2-column masonry-style (lg:grid-cols-2 gap-8)\n- Leaderboard: Single column with ranking cards, gap-4\n- Teacher Grid: 3-column (lg:grid-cols-3 md:grid-cols-2 gap-8)\n\n**Padding Standards:**\n- Cards: p-6 lg:p-8\n- Modals: p-8 lg:p-12\n- Sections: py-12 lg:py-16\n- Page containers: px-6 lg:px-8\n\n---\n\n## Core Components\n\n### Navigation & Header\n- Sticky top nav with backdrop blur (backdrop-blur-lg)\n- Semi-transparent background with subtle shadow\n- Logo/branding left, scope selector center, profile/notifications right\n- Three-tier scope pills: Interactive segmented control with sliding indicator animation\n- Search expands on focus with smooth width transition\n- Admin avatars: Subtle animated glow ring (animate-pulse-slow)\n\n### News Feed Cards\n- Elevated cards: rounded-2xl with multi-layer shadow (shadow-lg shadow-xl on hover)\n- Hover lift effect: transform transition with slight scale (hover:scale-[1.02])\n- Author bar: Avatar (w-12 h-12 rounded-full with ring) + Name + Timestamp in flex layout\n- Glassmorphic credibility badge floating top-right\n- Rich media support: Full-bleed images with rounded-t-2xl, aspect-video\n- Interaction bar: Icon buttons with counter badges, hover scale effect\n- Smooth expansion for comments section\n\n### Admin Interface Elements\n- Premium badge system: Animated gradient badges instead of heavy borders\n- Admin posts: Subtle accent glow on card edge\n- Admin panel: Dedicated dashboard with glassmorphic sidebar\n- Crown icon badge with gradient fill next to admin names\n- Elevated z-index cards for admin announcements\n\n### Access Code Modal\n- Full-screen overlay with backdrop-blur-2xl\n- Centered glassmorphic card (rounded-3xl)\n- Large monospace input with animated underline\n- Success: Checkmark animation with confetti micro-interaction\n- Digital key appears in animated slide-in drawer showing unlocked scopes\n- Key collection: Icon grid in profile dropdown with unlock animations\n\n### Gamification Dashboard\n- Hero stats section: Large circular progress rings with gradient strokes\n- Reputation score: Animated counting on page load\n- Rank badge: 3D-style shield with gradient overlay and shadow depth\n- Achievement showcase: Glassmorphic card grid with hover reveal animations\n- Progress bars: Gradient-filled with smooth transition animations\n- Leaderboard: Cards with position numbers, top 3 with podium-height variation and special treatments\n\n### Events System\n- Calendar: Grid with glassmorphic date cells, current day highlighted\n- Event cards: Image header (aspect-video) + glassmorphic content overlay at bottom\n- Category pills: Rounded-full badges with semi-transparent backgrounds\n- RSVP button: Toggle with smooth color transition and attendee count animation\n- Event detail modal: Full-bleed image hero with glassmorphic content section\n\n### Schedule Grid\n- Premium table design with rounded corners and cell borders\n- Period/day headers with semi-transparent backgrounds\n- Hover state: Cell highlight with smooth transition\n- Edit mode: Inline editor with glassmorphic dropdown\n- Teacher names clickable with underline animation on hover\n- Lock indicators: Small icon badges for restricted cells\n\n### Teacher Profile Cards\n- Vertical cards with rounded-2xl borders\n- Photo: aspect-square rounded-t-2xl with gradient overlay at bottom\n- Name/subject on glassmorphic overlay over photo\n- Expandable rules section with smooth accordion animation\n- Star rating: Large interactive stars with fill animation\n- Review modal: Glassmorphic overlay with review cards\n\n### User Stats Panel\n- Slide-in panel from right (translate-x animation)\n- Glassmorphic background with backdrop blur\n- Three metric cards at top with gradient backgrounds\n- Badge grid below with stagger animation on panel open\n- Achievement timeline with connecting lines and milestone markers\n\n---\n\n## Visual Treatment\n\n### Glassmorphism Implementation\n- Cards: backdrop-blur-md with semi-transparent backgrounds\n- Overlays: backdrop-blur-xl for modals and dropdowns\n- Navigation: backdrop-blur-lg with subtle border\n- Sidebar panels: backdrop-blur-sm with gradient overlay\n\n### Shadow Strategy\n- Resting cards: shadow-lg with subtle spread\n- Hover elevation: shadow-2xl with increased blur\n- Modals: shadow-[0_25px_50px_-12px] for depth\n- Floating elements: shadow-xl with colored shadow tints\n\n### Border Radius Hierarchy\n- Cards: rounded-2xl\n- Buttons: rounded-xl\n- Badges/Pills: rounded-full\n- Modals: rounded-3xl\n- Images: rounded-xl (nested in cards use rounded-t-2xl)\n\n### Animation Specifications\n- Transitions: transition-all duration-300 ease-in-out (default)\n- Hover scales: hover:scale-[1.02] or hover:scale-105\n- Micro-interactions: 150ms for button states\n- Page transitions: 500ms for route changes\n- Loading states: Skeleton screens with shimmer gradient animation\n- Success states: Checkmark with scale + opacity animation (300ms)\n\n### Gradient Applications\n- Background accents: Subtle radial gradients on sections\n- Badge fills: Linear gradients for ranks/achievements\n- Button hovers: Gradient shift on interaction\n- Stat visualizations: Multi-color gradient progress indicators\n- Card overlays: Gradient masks on images\n\n---\n\n## Images\n\n### Profile Images\n- User avatars: Circular (rounded-full) with ring borders throughout interface\n- Teacher photos: Professional headshots, aspect-square, rounded-xl\n- Placeholder: Gradient backgrounds with user initials in Outfit font\n- Admin avatars: Animated gradient ring with subtle pulse\n\n### Content Images\n- Feed posts: Full-width images, aspect-video or aspect-square, rounded-xl\n- Event cards: Hero images aspect-video with glassmorphic content overlay\n- Image galleries: Masonry grid with staggered heights, gap-4\n\n### Decorative Elements\n- Background: Subtle gradient mesh patterns\n- Empty states: Illustrated icons (Heroicons) with gradient fills\n- Achievement badges: Icon-based designs with gradient overlays\n\n**Hero Image:** No traditional hero. Dashboard-first application with stats cards and feed taking priority.\n\n---\n\n## Responsive Behavior\n\n**Mobile (base to md):**\n- Single column layouts with full-width cards\n- Bottom navigation: 4 glassmorphic pill buttons with icons\n- Reduced padding (p-4 instead of p-6)\n- Smaller shadows and border radius\n- Collapsible sections for schedules/leaderboards\n\n**Tablet (md to lg):**\n- 2-column grids emerge\n- Side navigation converts to slide-out drawer with glassmorphic overlay\n- Maintain generous spacing\n\n**Desktop (lg+):**\n- Multi-column dashboards (3-4 columns for stats)\n- Persistent dual sidebar layout (left nav + right activity feed)\n- Sticky navigation and section headers\n- Expanded card sizes with more padding\n\n---\n\n## Accessibility\n\n- Focus rings: 3px offset rings with high contrast\n- Touch targets: Minimum 48px for all interactive elements\n- Motion: Respect prefers-reduced-motion for animations\n- Contrast: Maintain WCAG AAA for text, AA for UI elements\n- Screen readers: Aria labels for all icon buttons and status indicators\n- Keyboard navigation: Tab order follows visual hierarchy, focus indicators on all interactive elements","path":null,"size_bytes":8772,"size_tokens":null},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport session from \"express-session\";\nimport cookieParser from \"cookie-parser\";\nimport { registerRoutes } from \"./routes\";\nimport { setupVite, serveStatic, log } from \"./vite\";\nimport { seedAdminAccounts } from \"./seed-admins\";\nimport { seedScopes } from \"./seed-scopes\";\nimport { storage } from \"./storage\";\n\nconst app = express();\n\n// Trust proxy - Required for secure cookies to work in production behind Replit's proxy\napp.set('trust proxy', 1);\n\n// Cookie parser middleware (for remember-me tokens)\napp.use(cookieParser());\n\n// Session configuration\napp.use(\n  session({\n    secret: process.env.SESSION_SECRET || \"school-community-secret-key\",\n    resave: false,\n    saveUninitialized: false,\n    cookie: {\n      secure: process.env.NODE_ENV === \"production\",\n      httpOnly: true,\n      maxAge: 7 * 24 * 60 * 60 * 1000, // 7 days\n    },\n  })\n);\n\n// Remember-me token middleware (automatically restore sessions)\napp.use(async (req, res, next) => {\n  // Skip if already authenticated\n  if (req.session.userId) {\n    return next();\n  }\n\n  // Check for remember-me token\n  const token = req.cookies?.remember_token;\n  if (!token) {\n    return next();\n  }\n\n  try {\n    const tokenRecord = await storage.getRememberMeToken(token);\n    \n    if (!tokenRecord) {\n      // Invalid token, clear cookie\n      res.clearCookie('remember_token');\n      return next();\n    }\n\n    // Check if token is expired\n    if (new Date() > tokenRecord.expiresAt) {\n      // Expired, delete from database and clear cookie\n      await storage.deleteRememberMeToken(token);\n      res.clearCookie('remember_token');\n      return next();\n    }\n\n    // Valid token - restore session\n    req.session.userId = tokenRecord.userId;\n    \n    try {\n      // Update last used time and extend expiration (both in DB and cookie)\n      await storage.updateRememberMeTokenActivity(tokenRecord.id);\n      \n      // Refresh the cookie with new expiration (7 days from now)\n      res.cookie('remember_token', token, {\n        httpOnly: true,\n        secure: process.env.NODE_ENV === 'production',\n        maxAge: 7 * 24 * 60 * 60 * 1000, // 7 days\n        sameSite: 'lax'\n      });\n    } catch (updateError) {\n      // If update fails, clear the cookie to avoid state divergence\n      console.error(\"Failed to update remember-me token activity:\", updateError);\n      res.clearCookie('remember_token');\n      await storage.deleteRememberMeToken(token);\n    }\n    \n    next();\n  } catch (error) {\n    console.error(\"Remember-me token validation error:\", error);\n    next();\n  }\n});\n\n// Extend Express session type\ndeclare module \"express-session\" {\n  interface SessionData {\n    userId?: string;\n    isVisitor?: boolean;\n    visitorData?: {\n      username: string;\n      name: string;\n      role: string;\n    };\n  }\n}\n\ndeclare module 'http' {\n  interface IncomingMessage {\n    rawBody: unknown\n  }\n}\napp.use(express.json({\n  verify: (req, _res, buf) => {\n    req.rawBody = buf;\n  }\n}));\napp.use(express.urlencoded({ extended: false }));\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"…\";\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  const server = await registerRoutes(app);\n\n  // Automatically seed admin accounts and scopes on startup\n  await seedAdminAccounts();\n  await seedScopes();\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (app.get(\"env\") === \"development\") {\n    await setupVite(app, server);\n  } else {\n    serveStatic(app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || '5000', 10);\n  server.listen({\n    port,\n    host: \"0.0.0.0\",\n    reusePort: true,\n  }, () => {\n    log(`serving on port ${port}`);\n  });\n})();\n","path":null,"size_bytes":4979,"size_tokens":null},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n          await import(\"@replit/vite-plugin-dev-banner\").then((m) =>\n            m.devBanner(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","path":null,"size_bytes":1080,"size_tokens":null},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","path":null,"size_bytes":8605,"size_tokens":null},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","path":null,"size_bytes":756,"size_tokens":null},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","path":null,"size_bytes":1527,"size_tokens":null},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","path":null,"size_bytes":10481,"size_tokens":null},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey.join(\"/\") as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","path":null,"size_bytes":1383,"size_tokens":null},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","path":null,"size_bytes":4281,"size_tokens":null},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","path":null,"size_bytes":1139,"size_tokens":null},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","path":null,"size_bytes":1077,"size_tokens":null},"server/moderation.ts":{"content":"import OpenAI from \"openai\";\n\nconst openai = new OpenAI({\n  baseURL: process.env.AI_INTEGRATIONS_OPENAI_BASE_URL,\n  apiKey: process.env.AI_INTEGRATIONS_OPENAI_API_KEY,\n});\n\nexport interface ModerationResult {\n  flagged: boolean;\n  categories: string[];\n  reason?: string;\n}\n\nexport interface EnhancedModerationResult {\n  isViolation: boolean;\n  violationType?: \"spam\" | \"offensive\" | \"hate_speech\" | \"harassment\" | \"inappropriate\";\n  severity?: \"low\" | \"medium\" | \"high\" | \"critical\";\n  confidence: number;\n  reasoning: string;\n}\n\n/**\n * Check if content contains inappropriate material using OpenAI Moderation API\n * Supports Arabic, English, and French content\n */\nexport async function moderateContent(content: string): Promise<ModerationResult> {\n  try {\n    // Use OpenAI's moderation API\n    const moderation = await openai.moderations.create({\n      input: content,\n    });\n\n    const result = moderation.results[0];\n    \n    if (result.flagged) {\n      // Collect flagged categories\n      const flaggedCategories: string[] = [];\n      \n      if (result.categories.sexual) flaggedCategories.push(\"sexual\");\n      if (result.categories.hate) flaggedCategories.push(\"hate\");\n      if (result.categories.harassment) flaggedCategories.push(\"harassment\");\n      if (result.categories.violence) flaggedCategories.push(\"violence\");\n      if (result.categories[\"self-harm\"]) flaggedCategories.push(\"self-harm\");\n      if (result.categories[\"sexual/minors\"]) flaggedCategories.push(\"sexual/minors\");\n      if (result.categories[\"hate/threatening\"]) flaggedCategories.push(\"hate/threatening\");\n      if (result.categories[\"violence/graphic\"]) flaggedCategories.push(\"violence/graphic\");\n      if (result.categories[\"self-harm/intent\"]) flaggedCategories.push(\"self-harm/intent\");\n      if (result.categories[\"self-harm/instructions\"]) flaggedCategories.push(\"self-harm/instructions\");\n      if (result.categories[\"harassment/threatening\"]) flaggedCategories.push(\"harassment/threatening\");\n      \n      return {\n        flagged: true,\n        categories: flaggedCategories,\n        reason: `Content violates community guidelines: ${flaggedCategories.join(\", \")}`,\n      };\n    }\n    \n    return {\n      flagged: false,\n      categories: [],\n    };\n  } catch (error) {\n    console.error(\"Moderation API error:\", error);\n    \n    // If moderation API fails, we log the error but allow the content\n    // (better than blocking legitimate content)\n    return {\n      flagged: false,\n      categories: [],\n    };\n  }\n}\n\nexport async function requireModeration(content: string): Promise<void> {\n  const result = await moderateContent(content);\n  \n  if (result.flagged) {\n    throw new Error(result.reason || \"Content violates community guidelines\");\n  }\n}\n\nexport async function moderateContentEnhanced(content: string, contentType: string): Promise<EnhancedModerationResult> {\n  try {\n    const response = await openai.chat.completions.create({\n      model: \"gpt-5\",\n      messages: [\n        {\n          role: \"system\",\n          content: `You are a content moderation AI for a school community platform. Analyze the following ${contentType} content and determine if it violates community guidelines.\n\nCheck for:\n1. Spam (repetitive, irrelevant, or promotional content)\n2. Offensive language (profanity, insults, derogatory remarks)\n3. Hate speech (discrimination, racism, sexism, etc.)\n4. Harassment (bullying, threats, intimidation)\n5. Inappropriate content (sexual content, violence, illegal activities)\n\nRespond ONLY with valid JSON matching this exact structure:\n{\n  \"isViolation\": boolean,\n  \"violationType\": \"spam\" | \"offensive\" | \"hate_speech\" | \"harassment\" | \"inappropriate\" | null,\n  \"severity\": \"low\" | \"medium\" | \"high\" | \"critical\" | null,\n  \"confidence\": number (0-1),\n  \"reasoning\": \"Brief explanation of why this is or isn't a violation\"\n}\n\nFor school context:\n- Be strict but fair\n- Consider age-appropriate language\n- Flag bullying and exclusionary behavior\n- Allow constructive criticism and debate`\n        },\n        {\n          role: \"user\",\n          content: `Moderate this ${contentType}: \"${content}\"`\n        }\n      ],\n      response_format: { type: \"json_object\" },\n      max_completion_tokens: 500,\n    });\n\n    const result = JSON.parse(response.choices[0]?.message?.content || \"{}\");\n    \n    return {\n      isViolation: result.isViolation || false,\n      violationType: result.violationType,\n      severity: result.severity,\n      confidence: result.confidence || 0,\n      reasoning: result.reasoning || \"No reasoning provided\"\n    };\n  } catch (error) {\n    console.error(\"Enhanced moderation error:\", error);\n    return {\n      isViolation: false,\n      confidence: 0,\n      reasoning: \"Moderation service error - content allowed by default\"\n    };\n  }\n}\n\nexport function calculatePunishment(\n  violationType: string,\n  severity: string,\n  userViolationCount: number\n): {\n  punishmentType: \"warning\" | \"credibility_reduction\" | \"temp_ban\" | \"permanent_ban\";\n  credibilityPenalty: number;\n  banDurationHours?: number;\n} {\n  const severityMultiplier = {\n    low: 1,\n    medium: 2,\n    high: 3,\n    critical: 5\n  }[severity] || 1;\n\n  const baseCredibilityPenalty = {\n    spam: 2,\n    offensive: 5,\n    hate_speech: 15,\n    harassment: 10,\n    inappropriate: 8\n  }[violationType] || 5;\n\n  const credibilityPenalty = baseCredibilityPenalty * severityMultiplier * (1 + userViolationCount * 0.2);\n\n  if (severity === \"critical\" || userViolationCount >= 5) {\n    return {\n      punishmentType: \"permanent_ban\",\n      credibilityPenalty: Math.min(credibilityPenalty, 50)\n    };\n  }\n\n  if (severity === \"high\" || userViolationCount >= 3) {\n    return {\n      punishmentType: \"temp_ban\",\n      credibilityPenalty: Math.min(credibilityPenalty, 30),\n      banDurationHours: severity === \"high\" ? 168 : 72\n    };\n  }\n\n  if (credibilityPenalty >= 10 || userViolationCount >= 2) {\n    return {\n      punishmentType: \"credibility_reduction\",\n      credibilityPenalty: Math.min(credibilityPenalty, 20)\n    };\n  }\n\n  return {\n    punishmentType: \"warning\",\n    credibilityPenalty: Math.min(credibilityPenalty, 5)\n  };\n}\n","path":null,"size_bytes":6130,"size_tokens":null},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","path":null,"size_bytes":3021,"size_tokens":null},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","path":null,"size_bytes":1883,"size_tokens":null},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","path":null,"size_bytes":565,"size_tokens":null},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","path":null,"size_bytes":2765,"size_tokens":null},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","path":null,"size_bytes":2154,"size_tokens":null},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","path":null,"size_bytes":2695,"size_tokens":null},"client/src/index.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n/* LIGHT MODE - Modern Vibrant Palette */\n:root {\n  --button-outline: rgba(99, 102, 241, .12);\n  --badge-outline: rgba(99, 102, 241, .08);\n  --opaque-button-border-intensity: -6;\n  --elevate-1: rgba(99, 102, 241, .04);\n  --elevate-2: rgba(99, 102, 241, .08);\n  \n  /* Backgrounds - Soft, modern */\n  --background: 250 40% 96%;\n  --foreground: 250 10% 15%;\n  --border: 250 30% 88%;\n  --card: 0deg 0% 100%;\n  --card-foreground: 250 10% 15%;\n  --card-border: 250 20% 92%;\n  \n  /* Sidebar - Clean, minimal */\n  --sidebar: 250 35% 93%;\n  --sidebar-foreground: 250 10% 15%;\n  --sidebar-border: 250 20% 85%;\n  --sidebar-primary: 270 73% 58%;\n  --sidebar-primary-foreground: 0 0% 100%;\n  --sidebar-accent: 199 89% 48%;\n  --sidebar-accent-foreground: 250 10% 15%;\n  --sidebar-ring: 270 73% 58%;\n  \n  /* Popover */\n  --popover: 0 0% 100%;\n  --popover-foreground: 250 10% 15%;\n  --popover-border: 0 0% 93%;\n  \n  /* Primary - Rich purple */\n  --primary: 270 73% 56%;\n  --primary-foreground: 0 0% 100%;\n  \n  /* Secondary - Vibrant teal */\n  --secondary: 199 89% 48%;\n  --secondary-foreground: 250 10% 15%;\n  \n  /* Muted - Subtle pink */\n  --muted: 342 89% 94%;\n  --muted-foreground: 342 80% 40%;\n  \n  /* Accent - Warm coral */\n  --accent: 14 100% 57%;\n  --accent-foreground: 0 0% 100%;\n  \n  /* Destructive */\n  --destructive: 0 84% 60%;\n  --destructive-foreground: 0 0% 100%;\n  \n  /* Input */\n  --input: 250 30% 92%;\n  --ring: 270 73% 58%;\n  \n  /* Chart colors */\n  --chart-1: 270 73% 56%;\n  --chart-2: 199 89% 48%;\n  --chart-3: 14 100% 57%;\n  --chart-4: 290 70% 55%;\n  --chart-5: 39 92% 50%;\n  \n  /* Typography */\n  --font-sans: 'Inter', sans-serif;\n  --font-serif: 'Georgia', serif;\n  --font-mono: 'Menlo', monospace;\n  \n  /* Radius - Modern rounded */\n  --radius: 0.875rem;\n  \n  /* Shadows - Subtle elevation */\n  --shadow-2xs: 0px 1px 2px -1px rgba(99, 102, 241, 0.06);\n  --shadow-xs: 0px 1px 2px -1px rgba(99, 102, 241, 0.08);\n  --shadow-sm: 0px 2px 4px -1px rgba(99, 102, 241, 0.08), 0px 1px 2px -1px rgba(99, 102, 241, 0.04);\n  --shadow: 0px 4px 8px -2px rgba(99, 102, 241, 0.1), 0px 2px 4px -1px rgba(99, 102, 241, 0.06);\n  --shadow-md: 0px 4px 12px -2px rgba(99, 102, 241, 0.15), 0px 2px 4px -1px rgba(99, 102, 241, 0.06);\n  --shadow-lg: 0px 8px 16px -2px rgba(99, 102, 241, 0.15), 0px 4px 6px -1px rgba(99, 102, 241, 0.1);\n  --shadow-xl: 0px 12px 24px -4px rgba(99, 102, 241, 0.15), 0px 8px 10px -1px rgba(99, 102, 241, 0.1);\n  --shadow-2xl: 0px 20px 40px -4px rgba(99, 102, 241, 0.2);\n  \n  --tracking-normal: 0em;\n  --spacing: 0.25rem;\n\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n/* DARK MODE - Sophisticated dark palette */\n.dark {\n  --button-outline: rgba(165, 180, 252, .15);\n  --badge-outline: rgba(165, 180, 252, .10);\n  --opaque-button-border-intensity: 8;\n  --elevate-1: rgba(165, 180, 252, .06);\n  --elevate-2: rgba(165, 180, 252, .10);\n  \n  /* Backgrounds - Deep, sophisticated */\n  --background: 250 25% 10%;\n  --foreground: 250 20% 93%;\n  --border: 250 25% 25%;\n  --card: 250 20% 13%;\n  --card-foreground: 250 20% 93%;\n  --card-border: 250 25% 28%;\n  \n  /* Sidebar - Deep with accent */\n  --sidebar: 250 20% 11%;\n  --sidebar-foreground: 250 20% 93%;\n  --sidebar-border: 250 25% 30%;\n  --sidebar-primary: 270 73% 64%;\n  --sidebar-primary-foreground: 0 0% 100%;\n  --sidebar-accent: 199 89% 54%;\n  --sidebar-accent-foreground: 250 20% 13%;\n  --sidebar-ring: 270 73% 64%;\n  \n  /* Popover */\n  --popover: 250 20% 11%;\n  --popover-foreground: 250 20% 93%;\n  --popover-border: 250 25% 28%;\n  \n  /* Primary - Bright purple */\n  --primary: 270 73% 62%;\n  --primary-foreground: 0 0% 100%;\n  \n  /* Secondary - Bright teal */\n  --secondary: 199 89% 54%;\n  --secondary-foreground: 250 20% 13%;\n  \n  /* Muted - Dark muted pink */\n  --muted: 342 60% 25%;\n  --muted-foreground: 342 75% 72%;\n  \n  /* Accent - Bright coral */\n  --accent: 14 100% 62%;\n  --accent-foreground: 0 0% 100%;\n  \n  /* Destructive */\n  --destructive: 0 84% 60%;\n  --destructive-foreground: 0 0% 100%;\n  \n  /* Input */\n  --input: 250 20% 19%;\n  --ring: 270 73% 62%;\n  \n  /* Chart colors */\n  --chart-1: 270 73% 62%;\n  --chart-2: 199 89% 54%;\n  --chart-3: 14 100% 62%;\n  --chart-4: 290 73% 60%;\n  --chart-5: 39 92% 58%;\n  \n  /* Typography */\n  --font-sans: 'Inter', sans-serif;\n  --font-serif: 'Georgia', serif;\n  --font-mono: 'Menlo', monospace;\n  \n  /* Radius */\n  --radius: 0.875rem;\n  \n  /* Shadows - Elevated dark */\n  --shadow-2xs: 0px 1px 2px -1px rgba(0, 0, 0, 0.3);\n  --shadow-xs: 0px 1px 2px -1px rgba(0, 0, 0, 0.4);\n  --shadow-sm: 0px 2px 4px -1px rgba(0, 0, 0, 0.4), 0px 1px 2px -1px rgba(0, 0, 0, 0.2);\n  --shadow: 0px 4px 8px -2px rgba(0, 0, 0, 0.4), 0px 2px 4px -1px rgba(0, 0, 0, 0.2);\n  --shadow-md: 0px 4px 12px -2px rgba(0, 0, 0, 0.5), 0px 2px 4px -1px rgba(0, 0, 0, 0.2);\n  --shadow-lg: 0px 8px 16px -2px rgba(0, 0, 0, 0.5), 0px 4px 6px -1px rgba(0, 0, 0, 0.25);\n  --shadow-xl: 0px 12px 24px -4px rgba(0, 0, 0, 0.5), 0px 8px 10px -1px rgba(0, 0, 0, 0.3);\n  --shadow-2xl: 0px 20px 40px -4px rgba(0, 0, 0, 0.6);\n\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n  html, body {\n    @apply bg-background text-foreground;\n    overflow-x: hidden;\n    width: 100%;\n    max-width: 100vw;\n  }\n  body {\n    min-height: 100vh;\n    min-height: 100dvh; /* Better mobile support */\n  }\n  h1, h2, h3, h4, h5, h6 {\n    @apply font-semibold tracking-tight;\n  }\n  \n  /* Prevent horizontal scroll on all elements */\n  * {\n    box-sizing: border-box;\n  }\n}\n\n@layer utilities {\n  /* Glassmorphism effect */\n  .glass {\n    @apply backdrop-blur-md bg-white/80 dark:bg-slate-900/80 border border-white/20 dark:border-white/10;\n  }\n  \n  .glass-lg {\n    @apply backdrop-blur-lg bg-white/70 dark:bg-slate-900/70 border border-white/20 dark:border-white/10;\n  }\n\n  /* Elevation utilities */\n  .no-default-hover-elevate:hover {\n    background-color: transparent;\n    transform: none;\n    filter: none;\n  }\n  .no-default-active-elevate:active {\n    background-color: transparent;\n    transform: none;\n    filter: none;\n  }\n  \n  .hover-elevate {\n    --tw-shadow: none;\n    transition-property: background-color, box-shadow, transform, filter;\n    transition-duration: 300ms;\n    transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);\n  }\n  .hover-elevate:hover {\n    background-color: var(--elevate-1, rgba(99, 102, 241, 0.04));\n    box-shadow: 0px 12px 24px -4px rgba(99, 102, 241, 0.15);\n    transform: translateY(-4px);\n    filter: brightness(1.02);\n  }\n  \n  .active-elevate-2 {\n    --tw-shadow: none;\n    transition-property: background-color, box-shadow, transform;\n    transition-duration: 200ms;\n    transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);\n  }\n  .active-elevate-2:active {\n    background-color: var(--elevate-2, rgba(99, 102, 241, 0.08));\n    box-shadow: 0px 20px 40px -4px rgba(99, 102, 241, 0.2);\n    transform: translateY(-6px);\n  }\n  \n  .toggle-elevate {\n    --tw-shadow: none;\n    transition-property: background-color, box-shadow, transform;\n    transition-duration: 200ms;\n    transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);\n  }\n  .toggle-elevate.toggle-elevated {\n    background-color: var(--elevate-1, rgba(99, 102, 241, 0.04));\n    box-shadow: 0px 12px 24px -4px rgba(99, 102, 241, 0.15);\n    transform: translateY(-4px);\n  }\n\n  /* Gradient text */\n  .gradient-text {\n    @apply bg-gradient-to-r from-primary via-secondary to-accent bg-clip-text text-transparent;\n  }\n\n  /* Subtle animations */\n  @keyframes pulse-slow {\n    0%, 100% { opacity: 1; }\n    50% { opacity: 0.7; }\n  }\n  \n  .animate-pulse-slow {\n    animation: pulse-slow 3s cubic-bezier(0.4, 0, 0.6, 1) infinite;\n  }\n\n  /* Custom scrollbar styling - minimal and clean */\n  ::-webkit-scrollbar {\n    width: 6px;\n    height: 6px;\n  }\n  \n  ::-webkit-scrollbar-track {\n    background: hsl(var(--muted) / 0.3);\n    border-radius: 3px;\n  }\n  \n  ::-webkit-scrollbar-thumb {\n    background: hsl(var(--muted-foreground) / 0.3);\n    border-radius: 3px;\n  }\n  \n  ::-webkit-scrollbar-thumb:hover {\n    background: hsl(var(--muted-foreground) / 0.5);\n  }\n\n  /* Firefox scrollbar */\n  * {\n    scrollbar-width: thin;\n    scrollbar-color: hsl(var(--muted-foreground) / 0.3) hsl(var(--muted) / 0.3);\n  }\n\n  /* Mobile touch optimization */\n  @media (max-width: 768px) {\n    * {\n      -webkit-tap-highlight-color: transparent;\n    }\n  }\n}\n","path":null,"size_bytes":10577,"size_tokens":null},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","path":null,"size_bytes":1467,"size_tokens":null},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","path":null,"size_bytes":689,"size_tokens":null},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","path":null,"size_bytes":1251,"size_tokens":null},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","path":null,"size_bytes":166,"size_tokens":null},"server/vite.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport async function setupVite(app: Express, server: Server) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(import.meta.dirname, \"public\");\n\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","path":null,"size_bytes":2263,"size_tokens":null},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","path":null,"size_bytes":1723,"size_tokens":null},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-9 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","path":null,"size_bytes":5741,"size_tokens":null},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","path":null,"size_bytes":2712,"size_tokens":null},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","path":null,"size_bytes":3848,"size_tokens":null},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(`\n      after:content-[''] after:block after:absolute after:inset-0 after:rounded-full after:pointer-events-none after:border after:border-black/10 dark:after:border-white/10\n      relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full`,\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","path":null,"size_bytes":1592,"size_tokens":null},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","path":null,"size_bytes":4420,"size_tokens":null},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","path":null,"size_bytes":157,"size_tokens":null},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","path":null,"size_bytes":4120,"size_tokens":null},"server/db.ts":{"content":"import { Pool, neonConfig } from '@neondatabase/serverless';\nimport { drizzle } from 'drizzle-orm/neon-serverless';\nimport ws from \"ws\";\nimport * as schema from \"@shared/schema\";\n\nneonConfig.webSocketConstructor = ws;\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set. Did you forget to provision a database?\",\n  );\n}\n\nexport const pool = new Pool({ connectionString: process.env.DATABASE_URL });\nexport const db = drizzle({ client: pool, schema });\n","path":null,"size_bytes":483,"size_tokens":null},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","path":null,"size_bytes":140,"size_tokens":null},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"shadcn-card rounded-xl border bg-card border-card-border text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n));\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n));\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n));\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardDescription,\n  CardContent,\n}\n","path":null,"size_bytes":1904,"size_tokens":null},"client/src/pages/auth.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useLocation, Link } from \"wouter\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { AlertCircle, Eye, EyeOff, ShieldCheck, User, Users } from \"lucide-react\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\n\ntype RoleType = \"student\" | \"admin\" | \"visitor\" | null;\n\nexport default function AuthPage() {\n  const [, navigate] = useLocation();\n  const { toast } = useToast();\n  const [selectedRole, setSelectedRole] = useState<RoleType>(null);\n  const [showLoginPassword, setShowLoginPassword] = useState(false);\n  const [showRegisterPassword, setShowRegisterPassword] = useState(false);\n  const [showAdminRegisterPassword, setShowAdminRegisterPassword] = useState(false);\n  const [showAdminLoginPassword, setShowAdminLoginPassword] = useState(false);\n  const [showAdminCode, setShowAdminCode] = useState(false);\n  const [rememberMe, setRememberMe] = useState(false);\n  \n  const [registerData, setRegisterData] = useState({\n    username: \"\",\n    studentId: \"\",\n    email: \"\",\n    password: \"\",\n    phone: \"\",\n  });\n  \n  const [loginData, setLoginData] = useState({\n    username: \"\",\n    password: \"\",\n    rememberMe: false,\n  });\n\n  const [adminRegisterData, setAdminRegisterData] = useState({\n    scientificAnswer: \"\",\n    username: \"\",\n    password: \"\",\n    name: \"\",\n    email: \"\",\n  });\n\n  const [adminLoginData, setAdminLoginData] = useState({\n    username: \"\",\n    password: \"\",\n    rememberMe: false,\n  });\n\n  const registerMutation = useMutation({\n    mutationFn: async (data: typeof registerData) => {\n      return await apiRequest(\"POST\", \"/api/auth/register\", data);\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Registration successful\",\n        description: \"You've been automatically logged in\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/auth/me\"] });\n      navigate(\"/\");\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Registration failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const loginMutation = useMutation({\n    mutationFn: async (data: typeof loginData) => {\n      return await apiRequest(\"POST\", \"/api/auth/login\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/auth/me\"] });\n      navigate(\"/\");\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Login failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const adminRegisterMutation = useMutation({\n    mutationFn: async (data: typeof adminRegisterData) => {\n      return await apiRequest(\"POST\", \"/api/auth/admin/register\", data);\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Admin registration successful\",\n        description: \"You've been automatically logged in\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/auth/me\"] });\n      navigate(\"/\");\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Admin registration failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const adminLoginMutation = useMutation({\n    mutationFn: async (data: typeof adminLoginData) => {\n      return await apiRequest(\"POST\", \"/api/auth/admin/login\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/auth/me\"] });\n      navigate(\"/\");\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Admin login failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const visitorMutation = useMutation({\n    mutationFn: async () => {\n      return await apiRequest(\"POST\", \"/api/auth/visitor\", {});\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/auth/me\"] });\n      navigate(\"/\");\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Access failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleRegister = (e: React.FormEvent) => {\n    e.preventDefault();\n    registerMutation.mutate(registerData);\n  };\n\n  const handleLogin = (e: React.FormEvent) => {\n    e.preventDefault();\n    loginMutation.mutate(loginData);\n  };\n\n  const handleAdminRegister = (e: React.FormEvent) => {\n    e.preventDefault();\n    adminRegisterMutation.mutate(adminRegisterData);\n  };\n\n  const handleAdminLogin = (e: React.FormEvent) => {\n    e.preventDefault();\n    adminLoginMutation.mutate(adminLoginData);\n  };\n\n  const handleVisitorAccess = () => {\n    visitorMutation.mutate();\n  };\n\n  return (\n    <div className=\"flex items-center justify-center min-h-screen bg-gradient-to-br from-background via-background to-muted/20\">\n      <Card className=\"w-full max-w-md shadow-lg\">\n        <CardHeader>\n          <CardTitle className=\"text-3xl font-bold\">School Community</CardTitle>\n          <CardDescription>Join your school's digital ecosystem</CardDescription>\n        </CardHeader>\n        <CardContent>\n          {!selectedRole ? (\n            <div className=\"space-y-4\">\n              <Label>Select your role to continue</Label>\n              <div className=\"grid grid-cols-1 gap-3\">\n                <Button\n                  variant=\"outline\"\n                  className=\"h-auto py-4 justify-start\"\n                  onClick={() => setSelectedRole(\"student\")}\n                  data-testid=\"button-role-student\"\n                >\n                  <User className=\"mr-2 h-5 w-5\" />\n                  <div className=\"text-left\">\n                    <div className=\"font-semibold\">Student</div>\n                    <div className=\"text-xs text-muted-foreground\">Login or register as a student</div>\n                  </div>\n                </Button>\n                <Button\n                  variant=\"outline\"\n                  className=\"h-auto py-4 justify-start\"\n                  onClick={() => setSelectedRole(\"admin\")}\n                  data-testid=\"button-role-admin\"\n                >\n                  <ShieldCheck className=\"mr-2 h-5 w-5\" />\n                  <div className=\"text-left\">\n                    <div className=\"font-semibold\">Admin</div>\n                    <div className=\"text-xs text-muted-foreground\">Login or register with credentials</div>\n                  </div>\n                </Button>\n                <Button\n                  variant=\"outline\"\n                  className=\"h-auto py-4 justify-start\"\n                  onClick={() => setSelectedRole(\"visitor\")}\n                  data-testid=\"button-role-visitor\"\n                >\n                  <Users className=\"mr-2 h-5 w-5\" />\n                  <div className=\"text-left\">\n                    <div className=\"font-semibold\">Visitor</div>\n                    <div className=\"text-xs text-muted-foreground\">Browse as a guest (read-only)</div>\n                  </div>\n                </Button>\n              </div>\n            </div>\n          ) : selectedRole === \"admin\" ? (\n            <>\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={() => setSelectedRole(null)}\n                className=\"mb-4\"\n                data-testid=\"button-back\"\n              >\n                ← Back\n              </Button>\n              <Tabs defaultValue=\"login\">\n                <TabsList className=\"grid w-full grid-cols-2 mb-4\">\n                  <TabsTrigger value=\"login\" data-testid=\"tab-admin-login\">Login</TabsTrigger>\n                  <TabsTrigger value=\"register\" data-testid=\"tab-admin-register\">Register</TabsTrigger>\n                </TabsList>\n                \n                <TabsContent value=\"login\">\n                  <form onSubmit={handleAdminLogin} className=\"space-y-4\">\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"admin-login-username\">Username</Label>\n                      <Input\n                        id=\"admin-login-username\"\n                        type=\"text\"\n                        placeholder=\"admin.username\"\n                        value={adminLoginData.username}\n                        onChange={(e) => setAdminLoginData({ ...adminLoginData, username: e.target.value })}\n                        required\n                        data-testid=\"input-admin-username-login\"\n                      />\n                    </div>\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"admin-login-password\">Password</Label>\n                      <div className=\"relative\">\n                        <Input\n                          id=\"admin-login-password\"\n                          type={showAdminLoginPassword ? \"text\" : \"password\"}\n                          value={adminLoginData.password}\n                          onChange={(e) => setAdminLoginData({ ...adminLoginData, password: e.target.value })}\n                          required\n                          data-testid=\"input-admin-password-login\"\n                          className=\"pr-10\"\n                        />\n                        <Button\n                          type=\"button\"\n                          variant=\"ghost\"\n                          size=\"icon\"\n                          className=\"absolute right-0 top-0 h-full px-3 hover:bg-transparent\"\n                          onClick={() => setShowAdminLoginPassword(!showAdminLoginPassword)}\n                          data-testid=\"button-toggle-admin-password-login\"\n                        >\n                          {showAdminLoginPassword ? (\n                            <EyeOff className=\"h-4 w-4 text-muted-foreground\" />\n                          ) : (\n                            <Eye className=\"h-4 w-4 text-muted-foreground\" />\n                          )}\n                        </Button>\n                      </div>\n                    </div>\n                    <div className=\"flex items-center space-x-2\">\n                      <Checkbox \n                        id=\"remember-me\" \n                        checked={adminLoginData.rememberMe}\n                        onCheckedChange={(checked) => \n                          setAdminLoginData({ ...adminLoginData, rememberMe: checked as boolean })\n                        }\n                        data-testid=\"checkbox-remember-me\"\n                      />\n                      <Label htmlFor=\"remember-me\" className=\"text-sm cursor-pointer\">\n                        Remember me for 7 days\n                      </Label>\n                    </div>\n                    <Button type=\"submit\" className=\"w-full\" disabled={adminLoginMutation.isPending} data-testid=\"button-admin-login\">\n                      {adminLoginMutation.isPending ? \"Logging in...\" : \"Admin Login\"}\n                    </Button>\n                  </form>\n                </TabsContent>\n            \n                <TabsContent value=\"register\">\n                  <form onSubmit={handleAdminRegister} className=\"space-y-4\">\n                    <Alert>\n                      <ShieldCheck className=\"h-4 w-4\" />\n                      <AlertDescription className=\"text-sm\">\n                        Contact the system administrator to obtain the administration code required for registration.\n                      </AlertDescription>\n                    </Alert>\n                    \n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"admin-code\">Administration Code</Label>\n                      <div className=\"relative\">\n                        <Input\n                          id=\"admin-code\"\n                          type={showAdminCode ? \"text\" : \"password\"}\n                          placeholder=\"Enter administration code\"\n                          value={adminRegisterData.scientificAnswer}\n                          onChange={(e) => setAdminRegisterData({ ...adminRegisterData, scientificAnswer: e.target.value })}\n                          required\n                          data-testid=\"input-admin-code\"\n                          className=\"pr-10\"\n                        />\n                        <Button\n                          type=\"button\"\n                          variant=\"ghost\"\n                          size=\"icon\"\n                          className=\"absolute right-0 top-0 h-full px-3 hover:bg-transparent\"\n                          onClick={() => setShowAdminCode(!showAdminCode)}\n                          data-testid=\"button-toggle-admin-code\"\n                        >\n                          {showAdminCode ? (\n                            <EyeOff className=\"h-4 w-4 text-muted-foreground\" />\n                          ) : (\n                            <Eye className=\"h-4 w-4 text-muted-foreground\" />\n                          )}\n                        </Button>\n                      </div>\n                      <p className=\"text-xs text-muted-foreground\">\n                        Ask your system administrator for the administration code\n                      </p>\n                    </div>\n                    \n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"admin-register-name\">Full Name</Label>\n                      <Input\n                        id=\"admin-register-name\"\n                        placeholder=\"John Doe\"\n                        value={adminRegisterData.name}\n                        onChange={(e) => setAdminRegisterData({ ...adminRegisterData, name: e.target.value })}\n                        required\n                        data-testid=\"input-admin-name\"\n                      />\n                    </div>\n                    \n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"admin-register-username\">Username</Label>\n                      <Input\n                        id=\"admin-register-username\"\n                        placeholder=\"admin.username\"\n                        value={adminRegisterData.username}\n                        onChange={(e) => setAdminRegisterData({ ...adminRegisterData, username: e.target.value })}\n                        required\n                        data-testid=\"input-admin-username\"\n                      />\n                    </div>\n                    \n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"admin-register-email\">Email</Label>\n                      <Input\n                        id=\"admin-register-email\"\n                        type=\"email\"\n                        placeholder=\"admin@school.edu\"\n                        value={adminRegisterData.email}\n                        onChange={(e) => setAdminRegisterData({ ...adminRegisterData, email: e.target.value })}\n                        required\n                        data-testid=\"input-admin-email\"\n                      />\n                    </div>\n                    \n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"admin-register-password\">Password</Label>\n                      <div className=\"relative\">\n                        <Input\n                          id=\"admin-register-password\"\n                          type={showAdminRegisterPassword ? \"text\" : \"password\"}\n                          placeholder=\"Minimum 6 characters\"\n                          value={adminRegisterData.password}\n                          onChange={(e) => setAdminRegisterData({ ...adminRegisterData, password: e.target.value })}\n                          required\n                          data-testid=\"input-admin-password\"\n                          className=\"pr-10\"\n                        />\n                        <Button\n                          type=\"button\"\n                          variant=\"ghost\"\n                          size=\"icon\"\n                          className=\"absolute right-0 top-0 h-full px-3 hover:bg-transparent\"\n                          onClick={() => setShowAdminRegisterPassword(!showAdminRegisterPassword)}\n                          data-testid=\"button-toggle-admin-password-register\"\n                        >\n                          {showAdminRegisterPassword ? (\n                            <EyeOff className=\"h-4 w-4 text-muted-foreground\" />\n                          ) : (\n                            <Eye className=\"h-4 w-4 text-muted-foreground\" />\n                          )}\n                        </Button>\n                      </div>\n                    </div>\n                    \n                    <Button type=\"submit\" className=\"w-full\" disabled={adminRegisterMutation.isPending} data-testid=\"button-admin-register\">\n                      {adminRegisterMutation.isPending ? \"Registering...\" : \"Register as Admin\"}\n                    </Button>\n                  </form>\n                </TabsContent>\n              </Tabs>\n            </>\n          ) : selectedRole === \"visitor\" ? (\n            <div className=\"space-y-4\">\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={() => setSelectedRole(null)}\n                className=\"mb-2\"\n                data-testid=\"button-back\"\n              >\n                ← Back\n              </Button>\n              <Alert>\n                <Users className=\"h-4 w-4\" />\n                <AlertDescription className=\"text-sm\">\n                  As a visitor, you can browse the platform but cannot make any changes or interact with content.\n                </AlertDescription>\n              </Alert>\n              <Button\n                onClick={handleVisitorAccess}\n                className=\"w-full\"\n                disabled={visitorMutation.isPending}\n                data-testid=\"button-visitor-access\"\n              >\n                {visitorMutation.isPending ? \"Accessing...\" : \"Continue as Visitor\"}\n              </Button>\n            </div>\n          ) : (\n            <>\n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={() => setSelectedRole(null)}\n                className=\"mb-4\"\n                data-testid=\"button-back\"\n              >\n                ← Back\n              </Button>\n              <Tabs defaultValue=\"login\">\n                <TabsList className=\"grid w-full grid-cols-2 mb-4\">\n                  <TabsTrigger value=\"login\" data-testid=\"tab-login\">Login</TabsTrigger>\n                  <TabsTrigger value=\"register\" data-testid=\"tab-register\">Register</TabsTrigger>\n                </TabsList>\n                \n                <TabsContent value=\"login\">\n                  <form onSubmit={handleLogin} className=\"space-y-4\">\n                    <div className=\"space-y-2\">\n                  <Label htmlFor=\"login-username\">Username</Label>\n                  <Input\n                    id=\"login-username\"\n                    type=\"text\"\n                    placeholder=\"Mahmood.Fawaz.AL-Faqi\"\n                    value={loginData.username}\n                    onChange={(e) => setLoginData({ ...loginData, username: e.target.value })}\n                    required\n                    data-testid=\"input-username-login\"\n                  />\n                    </div>\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"login-password\">Password</Label>\n                  <div className=\"relative\">\n                    <Input\n                      id=\"login-password\"\n                      type={showLoginPassword ? \"text\" : \"password\"}\n                      value={loginData.password}\n                      onChange={(e) => setLoginData({ ...loginData, password: e.target.value })}\n                      required\n                      data-testid=\"input-password-login\"\n                      className=\"pr-10\"\n                    />\n                    <Button\n                      type=\"button\"\n                      variant=\"ghost\"\n                      size=\"icon\"\n                      className=\"absolute right-0 top-0 h-full px-3 hover:bg-transparent\"\n                      onClick={() => setShowLoginPassword(!showLoginPassword)}\n                      data-testid=\"button-toggle-password-login\"\n                    >\n                      {showLoginPassword ? (\n                        <EyeOff className=\"h-4 w-4 text-muted-foreground\" />\n                      ) : (\n                        <Eye className=\"h-4 w-4 text-muted-foreground\" />\n                      )}\n                    </Button>\n                      </div>\n                    </div>\n                    \n                    <div className=\"flex items-center space-x-2\">\n                      <Checkbox \n                        id=\"remember-me-student\" \n                        checked={loginData.rememberMe}\n                        onCheckedChange={(checked) => \n                          setLoginData({ ...loginData, rememberMe: checked as boolean })\n                        }\n                        data-testid=\"checkbox-remember-me-student\"\n                      />\n                      <Label htmlFor=\"remember-me-student\" className=\"text-sm cursor-pointer\">\n                        Remember me for 7 days\n                      </Label>\n                    </div>\n                    \n                    <Button type=\"submit\" className=\"w-full\" disabled={loginMutation.isPending} data-testid=\"button-login\">\n                      {loginMutation.isPending ? \"Logging in...\" : \"Login\"}\n                    </Button>\n                    <div className=\"text-center\">\n                      <Link href=\"/forgot-password\" className=\"text-sm text-primary hover:underline\" data-testid=\"link-forgot-password\">\n                        Forgot password?\n                      </Link>\n                    </div>\n                  </form>\n                </TabsContent>\n            \n                <TabsContent value=\"register\">\n                  <form onSubmit={handleRegister} className=\"space-y-4\">\n                    <Alert>\n                      <AlertCircle className=\"h-4 w-4\" />\n                      <AlertDescription className=\"text-sm\">\n                        You need an admin-assigned Student ID to register. Contact your administrator.\n                      </AlertDescription>\n                    </Alert>\n                    \n                    <div className=\"space-y-2\">\n                  <Label htmlFor=\"register-username\">Username</Label>\n                  <Input\n                    id=\"register-username\"\n                    placeholder=\"John.Smith or Jane.Doe.Williams\"\n                    value={registerData.username}\n                    onChange={(e) => setRegisterData({ ...registerData, username: e.target.value })}\n                    required\n                    data-testid=\"input-username\"\n                      />\n                      <p className=\"text-xs text-muted-foreground\">1-5 names, letters/periods/hyphens/commas, single spaces between names</p>\n                    </div>\n                    \n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"register-studentId\">Student ID</Label>\n                      <Input\n                        id=\"register-studentId\"\n                        placeholder=\"ST2024001\"\n                        value={registerData.studentId}\n                        onChange={(e) => setRegisterData({ ...registerData, studentId: e.target.value })}\n                        required\n                        data-testid=\"input-studentid\"\n                      />\n                      <p className=\"text-xs text-muted-foreground\">Use the ID provided by your administrator (matches your username)</p>\n                    </div>\n                    \n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"register-email\">Email</Label>\n                      <Input\n                        id=\"register-email\"\n                        type=\"email\"\n                        placeholder=\"john.smith@school.edu\"\n                        value={registerData.email}\n                        onChange={(e) => setRegisterData({ ...registerData, email: e.target.value })}\n                        required\n                        data-testid=\"input-email\"\n                      />\n                    </div>\n                    \n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"register-password\">Password</Label>\n                      <div className=\"relative\">\n                        <Input\n                          id=\"register-password\"\n                          type={showRegisterPassword ? \"text\" : \"password\"}\n                          placeholder=\"Minimum 8 characters\"\n                          value={registerData.password}\n                          onChange={(e) => setRegisterData({ ...registerData, password: e.target.value })}\n                          required\n                          data-testid=\"input-password\"\n                          className=\"pr-10\"\n                        />\n                        <Button\n                          type=\"button\"\n                          variant=\"ghost\"\n                          size=\"icon\"\n                          className=\"absolute right-0 top-0 h-full px-3 hover:bg-transparent\"\n                          onClick={() => setShowRegisterPassword(!showRegisterPassword)}\n                          data-testid=\"button-toggle-password-register\"\n                        >\n                          {showRegisterPassword ? (\n                            <EyeOff className=\"h-4 w-4 text-muted-foreground\" />\n                          ) : (\n                            <Eye className=\"h-4 w-4 text-muted-foreground\" />\n                          )}\n                        </Button>\n                      </div>\n                    </div>\n                    \n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"register-phone\">Phone (Optional)</Label>\n                      <Input\n                        id=\"register-phone\"\n                        type=\"tel\"\n                        placeholder=\"+1234567890\"\n                        value={registerData.phone}\n                        onChange={(e) => setRegisterData({ ...registerData, phone: e.target.value })}\n                        data-testid=\"input-phone\"\n                      />\n                    </div>\n                    \n                    <Button type=\"submit\" className=\"w-full\" disabled={registerMutation.isPending} data-testid=\"button-register\">\n                      {registerMutation.isPending ? \"Registering...\" : \"Register\"}\n                    </Button>\n                  </form>\n                </TabsContent>\n              </Tabs>\n            </>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":27166,"size_tokens":null},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","path":null,"size_bytes":1209,"size_tokens":null},"client/src/pages/grade-detail.tsx":{"content":"import { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Users, Calendar, Newspaper, Lock } from \"lucide-react\";\nimport { Link, useParams } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport type { Scope } from \"@shared/schema\";\nimport { useHasAccessToScope } from \"@/hooks/use-digital-keys\";\n\ntype Post = {\n  id: string;\n  content: string;\n  authorId: string;\n  scopeId?: string;\n  credibilityRating: number;\n  likesCount: number;\n  commentsCount: number;\n  createdAt: string;\n  author: {\n    name: string;\n    role: string;\n    avatarUrl?: string;\n  };\n};\n\ntype Event = {\n  id: string;\n  title: string;\n  description: string;\n  type: \"curricular\" | \"extracurricular\";\n  startTime: string;\n  endTime: string;\n  location?: string;\n};\n\nexport default function GradeDetail() {\n  const { gradeNumber } = useParams();\n  const grade = parseInt(gradeNumber || \"1\");\n\n  // Mock classes for now - in reality, this would come from the database\n  const classes = [\"A\", \"B\", \"C\", \"D\", \"E\"];\n\n  // Fetch all scopes to find this grade's scope\n  const { data: scopes } = useQuery<Scope[]>({\n    queryKey: [\"/api/scopes\"],\n  });\n\n  // Find the scope for this grade\n  const gradeScope = scopes?.find(s => s.name === `Grade ${grade}`);\n  const hasAccess = useHasAccessToScope(gradeScope?.id);\n\n  const { data: posts = [], isLoading: postsLoading } = useQuery<Post[]>({\n    queryKey: [\"/api/posts\", gradeScope?.id],\n    queryFn: async () => {\n      if (!gradeScope?.id) return [];\n      const response = await fetch(`/api/posts?scopeId=${gradeScope.id}`);\n      if (!response.ok) throw new Error(\"Failed to fetch posts\");\n      return response.json();\n    },\n    enabled: !!gradeScope?.id && hasAccess,\n  });\n\n  const { data: events = [], isLoading: eventsLoading } = useQuery<Event[]>({\n    queryKey: [\"/api/events\", gradeScope?.id],\n    queryFn: async () => {\n      if (!gradeScope?.id) return [];\n      const response = await fetch(`/api/events?scopeId=${gradeScope.id}`);\n      if (!response.ok) throw new Error(\"Failed to fetch events\");\n      return response.json();\n    },\n    enabled: !!gradeScope?.id && hasAccess,\n  });\n\n  const getGradeName = (num: number) => {\n    const names = [\"First\", \"Second\", \"Third\", \"Fourth\", \"Fifth\", \"Sixth\"];\n    return names[num - 1] || \"Unknown\";\n  };\n\n  return (\n    <div className=\"h-full overflow-y-auto\">\n      <div className=\"max-w-7xl mx-auto p-6 space-y-8\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <div className=\"flex items-center gap-3\">\n              <h1 className=\"text-3xl font-bold\">Grade {grade}</h1>\n              <Badge variant=\"outline\" className=\"text-lg px-3 py-1\">\n                {getGradeName(grade)} Grade\n              </Badge>\n            </div>\n            <p className=\"text-muted-foreground mt-2\">\n              News, events, and classes for Grade {grade}\n            </p>\n          </div>\n          <Button variant=\"outline\" asChild data-testid=\"button-back-to-grades\">\n            <Link href=\"/grades\">Back to Grades</Link>\n          </Button>\n        </div>\n\n        {/* Classes Section */}\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Users className=\"w-5 h-5\" />\n              Classes in Grade {grade}\n            </CardTitle>\n            <CardDescription>\n              Select a class to view class-specific news and student profiles\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-5 gap-3\">\n              {classes.map((className) => (\n                <Link \n                  key={className} \n                  href={`/grades/${grade}/${className}`}\n                  data-testid={`button-class-${grade}-${className}`}\n                >\n                  <Button \n                    variant=\"outline\" \n                    className=\"w-full hover-elevate active-elevate-2\"\n                  >\n                    Class {grade}-{className}\n                  </Button>\n                </Link>\n              ))}\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* News & Events Tabs */}\n        <Tabs defaultValue=\"news\" className=\"w-full\">\n          <TabsList className=\"grid w-full max-w-md grid-cols-2\">\n            <TabsTrigger value=\"news\" data-testid=\"tab-grade-news\">\n              <Newspaper className=\"w-4 h-4 mr-2\" />\n              News\n            </TabsTrigger>\n            <TabsTrigger value=\"events\" data-testid=\"tab-grade-events\">\n              <Calendar className=\"w-4 h-4 mr-2\" />\n              Events\n            </TabsTrigger>\n          </TabsList>\n\n          <TabsContent value=\"news\" className=\"space-y-4 mt-6\">\n            {postsLoading ? (\n              <div className=\"space-y-4\">\n                {[1, 2, 3].map((i) => (\n                  <Card key={i}>\n                    <CardHeader>\n                      <Skeleton className=\"h-6 w-3/4\" />\n                      <Skeleton className=\"h-4 w-1/2 mt-2\" />\n                    </CardHeader>\n                    <CardContent>\n                      <Skeleton className=\"h-20 w-full\" />\n                    </CardContent>\n                  </Card>\n                ))}\n              </div>\n            ) : posts && posts.length > 0 ? (\n              <div className=\"space-y-4\">\n                {posts.map((post) => (\n                  <Card key={post.id}>\n                    <CardHeader>\n                      <div className=\"flex items-center gap-2\">\n                        <span className=\"font-semibold\">{post.author.name}</span>\n                        <Badge variant=\"outline\" className=\"text-xs\">\n                          {post.author.role}\n                        </Badge>\n                        <Badge variant=\"secondary\">\n                          Credibility: {post.credibilityRating}\n                        </Badge>\n                      </div>\n                      <span className=\"text-sm text-muted-foreground\">\n                        {new Date(post.createdAt).toLocaleDateString()}\n                      </span>\n                    </CardHeader>\n                    <CardContent>\n                      <p className=\"text-muted-foreground\">{post.content}</p>\n                    </CardContent>\n                  </Card>\n                ))}\n              </div>\n            ) : (\n              <Card>\n                <CardContent className=\"flex flex-col items-center justify-center py-12 text-center\">\n                  <Newspaper className=\"w-12 h-12 text-muted-foreground mb-4\" />\n                  <p className=\"text-muted-foreground\">\n                    No news posts yet for Grade {grade}\n                  </p>\n                </CardContent>\n              </Card>\n            )}\n          </TabsContent>\n\n          <TabsContent value=\"events\" className=\"space-y-4 mt-6\">\n            {eventsLoading ? (\n              <div className=\"space-y-4\">\n                {[1, 2].map((i) => (\n                  <Card key={i}>\n                    <CardHeader>\n                      <Skeleton className=\"h-6 w-3/4\" />\n                      <Skeleton className=\"h-4 w-1/2 mt-2\" />\n                    </CardHeader>\n                    <CardContent>\n                      <Skeleton className=\"h-16 w-full\" />\n                    </CardContent>\n                  </Card>\n                ))}\n              </div>\n            ) : events && events.length > 0 ? (\n              <div className=\"space-y-4\">\n                {events.map((event) => (\n                  <Card key={event.id}>\n                    <CardHeader>\n                      <div className=\"flex items-center justify-between\">\n                        <CardTitle>{event.title}</CardTitle>\n                        <Badge variant={event.type === \"curricular\" ? \"default\" : \"secondary\"}>\n                          {event.type}\n                        </Badge>\n                      </div>\n                      <CardDescription>\n                        {new Date(event.startTime).toLocaleString()}\n                        {event.location && ` • ${event.location}`}\n                      </CardDescription>\n                    </CardHeader>\n                    <CardContent>\n                      <p className=\"text-muted-foreground\">{event.description}</p>\n                    </CardContent>\n                  </Card>\n                ))}\n              </div>\n            ) : (\n              <Card>\n                <CardContent className=\"flex flex-col items-center justify-center py-12 text-center\">\n                  <Calendar className=\"w-12 h-12 text-muted-foreground mb-4\" />\n                  <p className=\"text-muted-foreground\">\n                    No events scheduled yet for Grade {grade}\n                  </p>\n                </CardContent>\n              </Card>\n            )}\n          </TabsContent>\n        </Tabs>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":9223,"size_tokens":null},"client/src/pages/events.tsx":{"content":"import { useState, useMemo } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { Card, CardContent, CardHeader, CardFooter, CardTitle } from \"@/components/ui/card\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Calendar, MapPin, Clock, Users, Plus, ChevronDown, ChevronUp, Star, Send, MessageSquare, Filter, Check } from \"lucide-react\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { format, formatDistanceToNow } from \"date-fns\";\nimport {\n  Collapsible,\n  CollapsibleContent,\n  CollapsibleTrigger,\n} from \"@/components/ui/collapsible\";\nimport { ScopeSelector } from \"@/components/ScopeSelector\";\nimport { useHasAccessToScope } from \"@/hooks/use-digital-keys\";\nimport { UserProfileLink } from \"@/components/UserProfileLink\";\nimport { Link } from \"wouter\";\n\ntype Event = {\n  id: string;\n  title: string;\n  description: string | null;\n  eventType: \"curricular\" | \"extracurricular\";\n  scopeId: string | null;\n  startTime: string;\n  endTime: string | null;\n  location: string | null;\n  imageUrl: string | null;\n  createdById: string;\n  createdAt: string;\n  createdByName: string;\n  createdByRole: string;\n  createdByAvatarUrl: string | null;\n  rsvpCount: number;\n  userHasRsvpd: boolean;\n  createdBy: {\n    name: string;\n    role: string;\n    avatarUrl: string | null;\n    averageRating: number | null;\n  };\n};\n\ntype Rsvp = {\n  id: string;\n  eventId: string;\n  userId: string;\n  rsvpedAt: string;\n};\n\ntype Attendee = {\n  id: string;\n  name: string;\n  username: string;\n  avatarUrl: string | null;\n  grade: number | null;\n  className: string | null;\n  credibilityScore: number;\n};\n\nconst SUBJECTS = [\n  \"Math\",\n  \"R.E.\",\n  \"P.E.\",\n  \"Social Studies\",\n  \"Biology\",\n  \"Chemistry\",\n  \"Physics\",\n  \"Arabic\",\n  \"English\",\n  \"French\",\n  \"B.P.C.\",\n  \"Finance\",\n  \"Geology\",\n  \"Computer Science\",\n  \"Arts\",\n  \"Moralism\",\n  \"Library\",\n] as const;\n\nfunction EventCard({ event }: { event: Event }) {\n  const { toast } = useToast();\n  const [showAttendees, setShowAttendees] = useState(false);\n  const [showComments, setShowComments] = useState(false);\n  const [commentText, setCommentText] = useState(\"\");\n\n  const { data: attendees = [], isLoading: loadingAttendees } = useQuery<Attendee[]>({\n    queryKey: [\"/api/events\", event.id, \"attendees\"],\n    enabled: showAttendees,\n    queryFn: async () => {\n      const response = await fetch(`/api/events/${event.id}/attendees`);\n      if (!response.ok) throw new Error(\"Failed to fetch attendees\");\n      return response.json();\n    },\n  });\n\n  const { data: comments = [], isLoading: loadingComments } = useQuery<any[]>({\n    queryKey: [`/api/events/${event.id}/comments`],\n    enabled: showComments,\n    queryFn: async () => {\n      const response = await fetch(`/api/events/${event.id}/comments`);\n      if (!response.ok) throw new Error(\"Failed to fetch comments\");\n      return response.json();\n    },\n  });\n\n  const rsvpMutation = useMutation({\n    mutationFn: async () => {\n      return await apiRequest(\"POST\", `/api/events/${event.id}/rsvp`, {});\n    },\n    onSuccess: (result) => {\n      if (result === null) {\n        toast({\n          title: \"RSVP cancelled\",\n          description: \"You've been removed from the event attendance list\",\n        });\n      } else {\n        toast({\n          title: \"RSVP confirmed\",\n          description: \"You've been added to the event attendance list\",\n        });\n      }\n      queryClient.invalidateQueries({ queryKey: [\"/api/events\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/events\", event.id, \"attendees\"] });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"RSVP failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const createCommentMutation = useMutation({\n    mutationFn: async (content: string) => {\n      return await apiRequest(\"POST\", `/api/events/${event.id}/comments`, { content });\n    },\n    onSuccess: () => {\n      setCommentText(\"\");\n      queryClient.invalidateQueries({ queryKey: [`/api/events/${event.id}/comments`] });\n      toast({ title: \"Comment added\", description: \"Your comment has been posted\" });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Failed to add comment\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  return (\n    <Card className=\"hover-elevate\" data-testid={`card-event-${event.id}`}>\n      <CardHeader>\n        <div className=\"flex items-start justify-between\">\n          <div className=\"flex-1\">\n            <div className=\"flex items-center gap-2 mb-2\">\n              <CardTitle data-testid={`text-event-title-${event.id}`}>\n                {event.title}\n              </CardTitle>\n              <Badge variant={event.eventType === \"curricular\" ? \"default\" : \"secondary\"}>\n                {event.eventType}\n              </Badge>\n            </div>\n            <div className=\"flex items-center gap-3 text-sm text-muted-foreground\">\n              <UserProfileLink \n                userId={event.createdById}\n                name={event.createdByName}\n                avatarUrl={event.createdByAvatarUrl}\n                showAvatar={true}\n                className=\"text-sm\"\n              />\n              <Badge variant=\"outline\" className=\"text-xs\">\n                {event.createdByRole}\n              </Badge>\n              {event.createdBy.averageRating !== null && event.createdBy.averageRating > 0 && (\n                <>\n                  <span>•</span>\n                  <div className=\"flex items-center gap-1\">\n                    <Star className=\"w-3 h-3 fill-yellow-400 text-yellow-400\" />\n                    <span className=\"text-xs font-medium\">{event.createdBy.averageRating.toFixed(1)}</span>\n                  </div>\n                </>\n              )}\n            </div>\n          </div>\n        </div>\n      </CardHeader>\n      <CardContent className=\"space-y-3\">\n        {event.description && (\n          <p className=\"text-muted-foreground\">{event.description}</p>\n        )}\n        <div className=\"flex flex-wrap gap-4 text-sm\">\n          <div className=\"flex items-center gap-2\">\n            <Clock className=\"w-4 h-4 text-muted-foreground\" />\n            <span>{format(new Date(event.startTime), \"PPp\")}</span>\n          </div>\n          {event.location && (\n            <div className=\"flex items-center gap-2\">\n              <MapPin className=\"w-4 h-4 text-muted-foreground\" />\n              <span>{event.location}</span>\n            </div>\n          )}\n        </div>\n      </CardContent>\n      <Separator />\n      <CardFooter className=\"py-3 flex-col items-start gap-3\">\n        <div className=\"w-full flex items-center justify-between\">\n          <Collapsible open={showAttendees} onOpenChange={setShowAttendees} className=\"flex items-center gap-2\">\n            <CollapsibleTrigger className=\"flex items-center gap-2 text-sm text-muted-foreground hover-elevate px-2 py-1 rounded-md\" data-testid={`button-toggle-attendees-${event.id}`}>\n              <Users className=\"w-4 h-4\" />\n              <span data-testid={`text-rsvp-count-${event.id}`}>\n                {event.rsvpCount} {event.rsvpCount === 1 ? \"attendee\" : \"attendees\"}\n              </span>\n              {showAttendees ? <ChevronUp className=\"w-4 h-4\" /> : <ChevronDown className=\"w-4 h-4\" />}\n            </CollapsibleTrigger>\n          </Collapsible>\n          <Button\n            size=\"sm\"\n            variant={event.userHasRsvpd ? \"outline\" : \"default\"}\n            onClick={() => rsvpMutation.mutate()}\n            disabled={rsvpMutation.isPending}\n            data-testid={`button-rsvp-${event.id}`}\n          >\n            {event.userHasRsvpd ? \"Cancel RSVP\" : \"RSVP\"}\n          </Button>\n        </div>\n        \n        <Collapsible open={showAttendees} onOpenChange={setShowAttendees} className=\"w-full\">\n          <CollapsibleContent>\n            {loadingAttendees ? (\n              <div className=\"text-sm text-muted-foreground\">Loading attendees...</div>\n            ) : attendees.length === 0 ? (\n              <div className=\"text-sm text-muted-foreground\">No attendees yet</div>\n            ) : (\n              <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-3 pt-2\">\n                {attendees.map((attendee) => (\n                  <div key={attendee.id} className=\"flex items-center gap-3 p-2 rounded-md bg-muted/50\" data-testid={`attendee-${attendee.id}`}>\n                    <Link href={`/profile/${attendee.id}`} className=\"flex items-center gap-3 flex-1 min-w-0 hover-elevate rounded-md px-1\">\n                      <Avatar className=\"h-8 w-8\">\n                        <AvatarImage src={attendee.avatarUrl || undefined} />\n                        <AvatarFallback>{attendee.name.charAt(0)}</AvatarFallback>\n                      </Avatar>\n                      <div className=\"flex-1 min-w-0\">\n                        <div className=\"font-medium text-sm truncate\">{attendee.name}</div>\n                        <div className=\"flex items-center gap-2 text-xs text-muted-foreground\">\n                          {attendee.grade && attendee.className && (\n                            <Badge variant=\"outline\" className=\"text-xs\">\n                              Grade {attendee.grade}-{attendee.className}\n                            </Badge>\n                          )}\n                          <span>Score: {attendee.credibilityScore.toFixed(0)}</span>\n                        </div>\n                      </div>\n                    </Link>\n                  </div>\n                ))}\n              </div>\n            )}\n          </CollapsibleContent>\n        </Collapsible>\n\n        <Separator />\n\n        <Collapsible open={showComments} onOpenChange={setShowComments} className=\"w-full\">\n          <CollapsibleTrigger className=\"flex items-center gap-2 text-sm text-muted-foreground hover-elevate px-2 py-1 rounded-md w-full\" data-testid={`button-toggle-comments-${event.id}`}>\n            <MessageSquare className=\"w-4 h-4\" />\n            <span>Comments</span>\n            {showComments ? <ChevronUp className=\"w-4 h-4 ml-auto\" /> : <ChevronDown className=\"w-4 h-4 ml-auto\" />}\n          </CollapsibleTrigger>\n          <CollapsibleContent className=\"space-y-3 pt-3\">\n            <div className=\"flex gap-2\">\n              <Input\n                placeholder=\"Add a comment...\"\n                value={commentText}\n                onChange={(e) => setCommentText(e.target.value)}\n                className=\"text-sm\"\n                data-testid=\"input-event-comment\"\n              />\n              <Button size=\"sm\" onClick={() => createCommentMutation.mutate(commentText)} disabled={!commentText.trim() || createCommentMutation.isPending} data-testid=\"button-submit-event-comment\">\n                <Send className=\"w-4 h-4\" />\n              </Button>\n            </div>\n\n            <div className=\"space-y-2\">\n              {loadingComments ? (\n                <p className=\"text-sm text-muted-foreground\">Loading comments...</p>\n              ) : comments.length === 0 ? (\n                <p className=\"text-sm text-muted-foreground\">No comments yet</p>\n              ) : (\n                comments.map((comment) => (\n                  <div key={comment.id} className=\"flex gap-2 p-2 bg-muted/50 rounded-md text-sm\" data-testid={`event-comment-${comment.id}`}>\n                    <Avatar className=\"h-6 w-6\">\n                      <AvatarImage src={comment.authorAvatarUrl || undefined} />\n                      <AvatarFallback>{comment.authorName?.charAt(0)}</AvatarFallback>\n                    </Avatar>\n                    <div className=\"flex-1 min-w-0\">\n                      <div className=\"flex items-center gap-2\">\n                        <span className=\"font-medium text-xs\">{comment.authorName}</span>\n                        <span className=\"text-xs text-muted-foreground\">{formatDistanceToNow(new Date(comment.createdAt), { addSuffix: true })}</span>\n                      </div>\n                      <p className=\"text-xs text-foreground break-words\">{comment.content}</p>\n                    </div>\n                  </div>\n                ))\n              )}\n            </div>\n          </CollapsibleContent>\n        </Collapsible>\n      </CardFooter>\n    </Card>\n  );\n}\n\nexport default function EventsPage() {\n  const { toast } = useToast();\n  const [showCreateForm, setShowCreateForm] = useState(false);\n  const [selectedScope, setSelectedScope] = useState<string | null>(null);\n  const [filterBy, setFilterBy] = useState<\"all\" | \"upcoming\" | \"past\">(\"upcoming\");\n  const [sortBy, setSortBy] = useState<\"dateAsc\" | \"dateDesc\" | \"popular\">(\"dateAsc\");\n  const [typeFilter, setTypeFilter] = useState<string[]>([]);\n  const [formData, setFormData] = useState({\n    title: \"\",\n    description: \"\",\n    eventType: \"extracurricular\" as \"curricular\" | \"extracurricular\",\n    subject: \"\",\n    extracurricularCategory: \"\",\n    startTime: \"\",\n    endTime: \"\",\n    location: \"\",\n  });\n\n  const extracurricularCategories = [\n    \"sports\",\n    \"arts\",\n    \"music\",\n    \"technology\",\n    \"debate\",\n    \"science\",\n    \"community\",\n    \"cultural\",\n    \"other\",\n  ];\n\n  const categoryLabels: Record<string, string> = {\n    sports: \"Sports & Athletics\",\n    arts: \"Arts & Design\",\n    music: \"Music & Performing Arts\",\n    technology: \"Technology & Innovation\",\n    debate: \"Debate & Public Speaking\",\n    science: \"Science & Research\",\n    community: \"Community Service\",\n    cultural: \"Cultural & Heritage\",\n    other: \"Other\",\n  };\n\n  // Check if user has access to selected scope\n  const hasAccess = useHasAccessToScope(selectedScope);\n\n  // Fetch all scopes to find the global scope\n  const { data: scopes = [] } = useQuery<Array<{\n    id: string;\n    name: string;\n    type: string;\n  }>>({\n    queryKey: [\"/api/scopes\"],\n  });\n\n  // Get the global scope ID\n  const publicScope = scopes.find(s => s.type === \"public\");\n\n  // Fetch all events the user has access to\n  const { data: rawEvents = [], isLoading } = useQuery<Event[]>({\n    queryKey: [\"/api/events\"],\n    queryFn: async () => {\n      const response = await fetch(\"/api/events\");\n      if (!response.ok) throw new Error(\"Failed to fetch events\");\n      return response.json();\n    },\n  });\n\n  // Filter and sort events\n  const events = useMemo(() => {\n    const now = new Date();\n    let filtered = [...rawEvents];\n    \n    // Filter by time (upcoming/past)\n    if (filterBy === \"upcoming\") {\n      filtered = filtered.filter(e => new Date(e.startTime) >= now);\n    } else if (filterBy === \"past\") {\n      filtered = filtered.filter(e => new Date(e.startTime) < now);\n    }\n    \n    // Filter by type/subject/category\n    if (typeFilter.length > 0) {\n      filtered = filtered.filter(e => {\n        if (e.eventType === \"curricular\") {\n          return typeFilter.some(t => SUBJECTS.includes(t as any) && e.subject === t);\n        } else {\n          return typeFilter.some(t => extracurricularCategories.includes(t) && e.extracurricularCategory === t);\n        }\n      });\n    }\n    \n    // Sort\n    switch (sortBy) {\n      case \"dateAsc\":\n        return filtered.sort((a, b) => new Date(a.startTime).getTime() - new Date(b.startTime).getTime());\n      case \"dateDesc\":\n        return filtered.sort((a, b) => new Date(b.startTime).getTime() - new Date(a.startTime).getTime());\n      case \"popular\":\n        return filtered.sort((a, b) => b.rsvpCount - a.rsvpCount);\n      default:\n        return filtered;\n    }\n  }, [rawEvents, filterBy, sortBy, typeFilter]);\n\n  // Get current user info\n  const { data: user } = useQuery<{\n    id: string;\n    name: string;\n    email: string;\n    role: string;\n  }>({\n    queryKey: [\"/api/auth/me\"],\n  });\n\n  const createEventMutation = useMutation({\n    mutationFn: async (data: typeof formData) => {\n      const scopeId = selectedScope || publicScope?.id || null;\n      return await apiRequest(\"POST\", \"/api/events\", {\n        ...data,\n        scopeId,\n        startTime: new Date(data.startTime),\n        endTime: data.endTime ? new Date(data.endTime) : null,\n      });\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Event created\",\n        description: \"Your event has been posted successfully\",\n      });\n      setFormData({\n        title: \"\",\n        description: \"\",\n        eventType: \"extracurricular\",\n        subject: \"\",\n        extracurricularCategory: \"\",\n        startTime: \"\",\n        endTime: \"\",\n        location: \"\",\n      });\n      setSelectedScope(null);\n      setShowCreateForm(false);\n      queryClient.invalidateQueries({ queryKey: [\"/api/events\"] });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Failed to create event\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    const isValid = formData.title.trim() && formData.startTime && \n      (formData.eventType === \"curricular\" ? formData.subject.trim() : formData.extracurricularCategory);\n    if (isValid) {\n      createEventMutation.mutate(formData);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8 space-y-6\">\n        <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4\">\n          <div>\n            <h1 className=\"text-3xl sm:text-4xl font-bold mb-2\">Events</h1>\n            <p className=\"text-sm sm:text-base text-muted-foreground\">\n              Discover and join school events\n            </p>\n          </div>\n          <Button\n            onClick={() => setShowCreateForm(!showCreateForm)}\n            data-testid=\"button-create-event\"\n          >\n            <Plus className=\"w-4 h-4 mr-2\" />\n            Create Event\n          </Button>\n        </div>\n\n        {/* Create Event Form */}\n        {showCreateForm && (\n          <Card data-testid=\"card-create-event\">\n            <CardHeader>\n              <CardTitle>Create New Event</CardTitle>\n            </CardHeader>\n            <form onSubmit={handleSubmit}>\n              <CardContent className=\"space-y-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"title\">Event Title *</Label>\n                  <Input\n                    id=\"title\"\n                    placeholder=\"Science Fair 2024\"\n                    value={formData.title}\n                    onChange={(e) => setFormData({ ...formData, title: e.target.value })}\n                    required\n                    data-testid=\"input-event-title\"\n                  />\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"description\">Description</Label>\n                  <Textarea\n                    id=\"description\"\n                    placeholder=\"Tell us about the event...\"\n                    value={formData.description}\n                    onChange={(e) => setFormData({ ...formData, description: e.target.value })}\n                    className=\"min-h-24\"\n                    data-testid=\"textarea-event-description\"\n                    maxLength={4000}\n                  />\n                  <div className=\"flex justify-end\">\n                    <span className={`text-xs ${formData.description.length > 4000 ? \"text-destructive\" : \"text-muted-foreground\"}`} data-testid=\"text-character-count\">\n                      {formData.description.length}/4000\n                    </span>\n                  </div>\n                </div>\n\n                <div className=\"space-y-4\">\n                  <div className=\"grid grid-cols-2 gap-4\">\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"eventType\">Event Type *</Label>\n                      <Select\n                        value={formData.eventType}\n                        onValueChange={(value: \"curricular\" | \"extracurricular\") =>\n                          setFormData({ ...formData, eventType: value, extracurricularCategory: \"\" })\n                        }\n                      >\n                        <SelectTrigger data-testid=\"select-event-type\">\n                          <SelectValue />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"curricular\">Curricular</SelectItem>\n                          <SelectItem value=\"extracurricular\">Extracurricular</SelectItem>\n                        </SelectContent>\n                      </Select>\n                    </div>\n\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"location\">Location</Label>\n                      <Input\n                        id=\"location\"\n                        placeholder=\"School Auditorium\"\n                        value={formData.location}\n                        onChange={(e) => setFormData({ ...formData, location: e.target.value })}\n                        data-testid=\"input-event-location\"\n                      />\n                    </div>\n                  </div>\n\n                  {formData.eventType === \"curricular\" && (\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"subject\">Subject *</Label>\n                      <Select\n                        value={formData.subject}\n                        onValueChange={(value) =>\n                          setFormData({ ...formData, subject: value })\n                        }\n                      >\n                        <SelectTrigger data-testid=\"select-event-subject\">\n                          <SelectValue placeholder=\"Select subject\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          {SUBJECTS.map((subject) => (\n                            <SelectItem key={subject} value={subject}>\n                              {subject}\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                    </div>\n                  )}\n\n                  {formData.eventType === \"extracurricular\" && (\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"extracurricularCategory\">What kind of extracurricular? *</Label>\n                      <Select\n                        value={formData.extracurricularCategory}\n                        onValueChange={(value) =>\n                          setFormData({ ...formData, extracurricularCategory: value })\n                        }\n                      >\n                        <SelectTrigger data-testid=\"select-extracurricular-category\">\n                          <SelectValue placeholder=\"Select category\" />\n                        </SelectTrigger>\n                        <SelectContent>\n                          <SelectItem value=\"sports\">Sports & Athletics</SelectItem>\n                          <SelectItem value=\"arts\">Arts & Design</SelectItem>\n                          <SelectItem value=\"music\">Music & Performing Arts</SelectItem>\n                          <SelectItem value=\"technology\">Technology & Innovation</SelectItem>\n                          <SelectItem value=\"debate\">Debate & Public Speaking</SelectItem>\n                          <SelectItem value=\"science\">Science & Research</SelectItem>\n                          <SelectItem value=\"community\">Community Service</SelectItem>\n                          <SelectItem value=\"cultural\">Cultural & Heritage</SelectItem>\n                          <SelectItem value=\"other\">Other</SelectItem>\n                        </SelectContent>\n                      </Select>\n                    </div>\n                  )}\n                </div>\n\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"startTime\">Start Date & Time *</Label>\n                    <Input\n                      id=\"startTime\"\n                      type=\"datetime-local\"\n                      value={formData.startTime}\n                      onChange={(e) => setFormData({ ...formData, startTime: e.target.value })}\n                      required\n                      data-testid=\"input-event-start\"\n                    />\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"endTime\">End Date & Time</Label>\n                    <Input\n                      id=\"endTime\"\n                      type=\"datetime-local\"\n                      value={formData.endTime}\n                      onChange={(e) => setFormData({ ...formData, endTime: e.target.value })}\n                      data-testid=\"input-event-end\"\n                    />\n                  </div>\n                </div>\n\n                <Separator />\n\n                <ScopeSelector\n                  value={selectedScope}\n                  onChange={setSelectedScope}\n                  label=\"Event Scope\"\n                  placeholder=\"Select event scope\"\n                />\n              </CardContent>\n              <CardFooter className=\"justify-end gap-2\">\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={() => setShowCreateForm(false)}\n                  data-testid=\"button-cancel-event\"\n                >\n                  Cancel\n                </Button>\n                <Button\n                  type=\"submit\"\n                  disabled={!formData.title.trim() || !formData.startTime || (formData.eventType === \"curricular\" ? !formData.subject.trim() : !formData.extracurricularCategory) || createEventMutation.isPending || (selectedScope !== null && !hasAccess)}\n                  data-testid=\"button-submit-event\"\n                >\n                  {createEventMutation.isPending ? \"Creating...\" : \"Create Event\"}\n                </Button>\n              </CardFooter>\n            </form>\n          </Card>\n        )}\n\n        {/* Events List */}\n        <div className=\"space-y-4 sm:space-y-6\">\n          <div className=\"flex flex-col gap-4\">\n            <h2 className=\"text-xl sm:text-2xl font-semibold flex items-center gap-2\">\n              <Calendar className=\"w-5 h-5\" />\n              Events\n            </h2>\n            <div className=\"flex flex-col sm:flex-row gap-3\">\n              <div className=\"flex items-center gap-2 flex-1\">\n                <Filter className=\"w-4 h-4 text-muted-foreground flex-shrink-0\" />\n                <Select value={filterBy} onValueChange={(value: typeof filterBy) => setFilterBy(value)}>\n                  <SelectTrigger className=\"w-full sm:w-[180px]\" data-testid=\"select-filter-events\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"all\">All Events</SelectItem>\n                    <SelectItem value=\"upcoming\">Upcoming Only</SelectItem>\n                    <SelectItem value=\"past\">Past Events</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n              <Select value={typeFilter[0] || \"\"} onValueChange={(value) => {\n                if (value === \"\") {\n                  setTypeFilter([]);\n                } else {\n                  setTypeFilter([value]);\n                }\n              }}>\n                <SelectTrigger className=\"w-full sm:w-[280px]\" data-testid=\"select-type-subject-filter\">\n                  <SelectValue placeholder=\"Filter by type & subject\" />\n                </SelectTrigger>\n                <SelectContent>\n                  <div className=\"px-2 py-1.5\">\n                    <button\n                      onClick={() => setTypeFilter([])}\n                      className=\"w-full text-left px-2 py-1 text-sm hover:bg-accent rounded\"\n                    >\n                      Clear Filters\n                    </button>\n                  </div>\n                  \n                  {/* Curricular Subjects */}\n                  <div className=\"px-2 py-1.5\">\n                    <div className=\"px-2 py-1 text-xs font-semibold text-muted-foreground\">Curricular Subjects</div>\n                    {SUBJECTS.map((subject) => (\n                      <SelectItem key={subject} value={subject}>\n                        {subject}\n                      </SelectItem>\n                    ))}\n                  </div>\n\n                  {/* Extracurricular Categories */}\n                  <div className=\"px-2 py-1.5\">\n                    <div className=\"px-2 py-1 text-xs font-semibold text-muted-foreground\">Extracurricular</div>\n                    {extracurricularCategories.map((category) => (\n                      <SelectItem key={category} value={category}>\n                        {categoryLabels[category]}\n                      </SelectItem>\n                    ))}\n                  </div>\n                </SelectContent>\n              </Select>\n              <Select value={sortBy} onValueChange={(value: typeof sortBy) => setSortBy(value)}>\n                <SelectTrigger className=\"w-full sm:w-[180px]\" data-testid=\"select-sort-events\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"dateAsc\">Date: Soonest First</SelectItem>\n                  <SelectItem value=\"dateDesc\">Date: Latest First</SelectItem>\n                  <SelectItem value=\"popular\">Most Popular</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n\n          {isLoading ? (\n            <div className=\"text-center py-12\">\n              <p className=\"text-muted-foreground\">Loading events...</p>\n            </div>\n          ) : events.length === 0 ? (\n            <Card>\n              <CardContent className=\"py-12 text-center\">\n                <p className=\"text-muted-foreground\">\n                  No events scheduled yet. Create the first one!\n                </p>\n              </CardContent>\n            </Card>\n          ) : (\n            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6\">\n              {events.map((event) => (\n                <EventCard \n                  key={event.id} \n                  event={event} \n                />\n              ))}\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":30799,"size_tokens":null},"client/src/pages/profile.tsx":{"content":"import { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useRoute, Link } from \"wouter\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Star, Award, TrendingUp, User as UserIcon, Calendar, MessageSquare, Edit2, Trash2, Plus, X } from \"lucide-react\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useState } from \"react\";\nimport { UserProfileLink } from \"@/components/UserProfileLink\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription, DialogFooter } from \"@/components/ui/dialog\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { useLocation } from \"wouter\";\nimport { HexagonTendencyChart } from \"@/components/HexagonTendencyChart\";\nimport { Slider } from \"@/components/ui/slider\";\n\ntype User = {\n  id: string;\n  username: string;\n  name: string;\n  email: string;\n  role: \"student\" | \"admin\";\n  grade: number | null;\n  className: string | null;\n  avatarUrl: string | null;\n  bio: string | null;\n  credibilityScore: number;\n  reputationScore: number;\n  accountStatus: \"active\" | \"threatened\" | \"suspended\";\n  createdAt: string;\n  // Hexagon tendency charts - Social Personality\n  empathy: number | null;\n  angerManagement: number | null;\n  cooperation: number | null;\n  selfConfidence: number | null;\n  acceptingCriticism: number | null;\n  listening: number | null;\n  // Hexagon tendency charts - Skills & Abilities\n  problemSolving: number | null;\n  creativity: number | null;\n  memoryFocus: number | null;\n  planningOrganization: number | null;\n  communicationExpression: number | null;\n  leadershipInitiative: number | null;\n  // Hexagon tendency charts - Interests\n  artisticCreative: number | null;\n  athleticPhysical: number | null;\n  technicalTech: number | null;\n  linguisticReading: number | null;\n  socialHumanitarian: number | null;\n  naturalEnvironmental: number | null;\n  // Hobbies\n  hobbies: string[] | null;\n};\n\ntype ProfileComment = {\n  id: string;\n  profileUserId: string;\n  content: string;\n  rating: number | null;\n  createdAt: string;\n  authorId: string;\n  authorName?: string;\n  authorRole?: string;\n  authorAvatarUrl?: string | null;\n};\n\nexport default function ProfilePage() {\n  const [, params] = useRoute(\"/profile/:userId\");\n  const userId = params?.userId;\n  const [editingProfile, setEditingProfile] = useState(false);\n  const [editBio, setEditBio] = useState(\"\");\n  const [editGrade, setEditGrade] = useState(\"\");\n  const [editClassName, setEditClassName] = useState(\"\");\n  const [editingHexagon, setEditingHexagon] = useState<\"social\" | \"skills\" | \"interests\" | null>(null);\n  const [hexagonValues, setHexagonValues] = useState<Record<string, number>>({});\n  const [addingHobby, setAddingHobby] = useState(false);\n  const [newHobby, setNewHobby] = useState(\"\");\n  const { toast } = useToast();\n\n  const { data: user, isLoading, isFetching } = useQuery<User>({\n    queryKey: userId ? [`/api/users/${userId}`] : [\"/api/auth/me\"],\n  });\n\n  const { data: currentUser } = useQuery<User>({\n    queryKey: [\"/api/auth/me\"],\n  });\n\n  const updateProfileMutation = useMutation({\n    mutationFn: async (data: { bio: string; grade?: number; className?: string }) => {\n      return await apiRequest(\"PATCH\", `/api/users/${currentUser?.id}/profile`, data);\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Profile updated\",\n        description: \"Your profile has been updated successfully\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/auth/me\"] });\n      queryClient.invalidateQueries({ queryKey: [`/api/users/${currentUser?.id}`] });\n      setEditingProfile(false);\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Failed to update profile\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleEditProfile = () => {\n    if (user) {\n      setEditBio(user.bio || \"\");\n      setEditGrade(user.grade?.toString() || \"\");\n      setEditClassName(user.className || \"\");\n      setEditingProfile(true);\n    }\n  };\n\n  const handleSaveProfile = () => {\n    if (currentUser?.id === user?.id) {\n      updateProfileMutation.mutate({\n        bio: editBio,\n        grade: editGrade ? parseInt(editGrade) : undefined,\n        className: editClassName || undefined,\n      });\n    }\n  };\n\n  const [, setLocation] = useLocation();\n\n  const deleteAccountMutation = useMutation({\n    mutationFn: async (userId: string) => {\n      return await apiRequest(\"DELETE\", `/api/users/${userId}`);\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Account deleted\",\n        description: \"The user account has been removed successfully\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/auth/me\"] });\n      setLocation(\"/\");\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Failed to delete account\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleDeleteAccount = (userId: string) => {\n    if (window.confirm(\"Are you sure you want to delete this account? This action cannot be undone.\")) {\n      deleteAccountMutation.mutate(userId);\n    }\n  };\n\n  const handleEditHexagon = (type: \"social\" | \"skills\" | \"interests\") => {\n    if (!user) return;\n    \n    const metricKeys = {\n      social: [\"empathy\", \"angerManagement\", \"cooperation\", \"selfConfidence\", \"acceptingCriticism\", \"listening\"],\n      skills: [\"problemSolving\", \"creativity\", \"memoryFocus\", \"planningOrganization\", \"communicationExpression\", \"leadershipInitiative\"],\n      interests: [\"artisticCreative\", \"athleticPhysical\", \"technicalTech\", \"linguisticReading\", \"socialHumanitarian\", \"naturalEnvironmental\"],\n    };\n    \n    const initialValues: Record<string, number> = {};\n    metricKeys[type].forEach((key) => {\n      initialValues[key] = (user as any)[key] ?? 4;\n    });\n    \n    setHexagonValues(initialValues);\n    setEditingHexagon(type);\n  };\n\n  const updateHexagonMutation = useMutation({\n    mutationFn: async (data: Record<string, number>) => {\n      return await apiRequest(\"PATCH\", `/api/users/${currentUser?.id}/hexagon`, data);\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Tendency chart updated\",\n        description: \"Your hexagon tendency chart has been updated successfully\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/auth/me\"] });\n      queryClient.invalidateQueries({ queryKey: [`/api/users/${currentUser?.id}`] });\n      setEditingHexagon(null);\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Failed to update chart\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateHobbiesMutation = useMutation({\n    mutationFn: async (hobbies: string[]) => {\n      return await apiRequest(\"PATCH\", `/api/users/${currentUser?.id}/hobbies`, { hobbies });\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Hobbies updated\",\n        description: \"Your hobbies have been updated successfully\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/auth/me\"] });\n      queryClient.invalidateQueries({ queryKey: [`/api/users/${currentUser?.id}`] });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Failed to update hobbies\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleAddHobby = () => {\n    if (!user || !currentUser || !newHobby.trim() || updateHobbiesMutation.isPending || isFetching) return;\n    \n    const currentHobbies = user.hobbies || [];\n    \n    if (currentHobbies.length >= 5) {\n      toast({\n        title: \"Maximum hobbies reached\",\n        description: \"You can only add up to 5 hobbies\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    \n    if (newHobby.trim().length > 50) {\n      toast({\n        title: \"Hobby too long\",\n        description: \"Each hobby must be 50 characters or less\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    \n    const updatedHobbies = [...currentHobbies, newHobby.trim()];\n    updateHobbiesMutation.mutate(updatedHobbies);\n    setNewHobby(\"\");\n    setAddingHobby(false);\n  };\n\n  const handleDeleteHobby = (index: number) => {\n    if (!user || !currentUser || updateHobbiesMutation.isPending || isFetching) return;\n    \n    const currentHobbies = user.hobbies || [];\n    const updatedHobbies = currentHobbies.filter((_, i) => i !== index);\n    updateHobbiesMutation.mutate(updatedHobbies);\n  };\n\n  const handleSaveHexagon = () => {\n    if (!editingHexagon) return;\n    \n    const metricKeys = {\n      social: [\"empathy\", \"angerManagement\", \"cooperation\", \"selfConfidence\", \"acceptingCriticism\", \"listening\"],\n      skills: [\"problemSolving\", \"creativity\", \"memoryFocus\", \"planningOrganization\", \"communicationExpression\", \"leadershipInitiative\"],\n      interests: [\"artisticCreative\", \"athleticPhysical\", \"technicalTech\", \"linguisticReading\", \"socialHumanitarian\", \"naturalEnvironmental\"],\n    };\n    \n    const validKeys = metricKeys[editingHexagon];\n    const filteredValues: Record<string, number> = {};\n    validKeys.forEach(key => {\n      filteredValues[key] = hexagonValues[key] ?? 4;\n    });\n    \n    const total = Object.values(filteredValues).reduce((sum, v) => sum + v, 0);\n    const hasInvalid = Object.values(filteredValues).some((v) => v < 0 || v > 10);\n    \n    if (total !== 33) {\n      toast({\n        title: \"Invalid distribution\",\n        description: `You must distribute exactly 33 points. Current total: ${total}`,\n        variant: \"destructive\",\n      });\n      return;\n    }\n    \n    if (hasInvalid) {\n      toast({\n        title: \"Invalid values\",\n        description: \"Each metric must be between 0 and 10\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    \n    updateHexagonMutation.mutate(filteredValues);\n  };\n\n  const hexagonMetricLabels = {\n    social: {\n      empathy: \"التعاطف (Empathy)\",\n      angerManagement: \"إدارة الغضب (Anger Management)\",\n      cooperation: \"التعاون (Cooperation)\",\n      selfConfidence: \"الثقة بالنفس (Self Confidence)\",\n      acceptingCriticism: \"تقبل النقد (Accepting Criticism)\",\n      listening: \"الاستماع (Listening)\",\n    },\n    skills: {\n      problemSolving: \"حل المشكلات (Problem Solving)\",\n      creativity: \"الإبداع (Creativity)\",\n      memoryFocus: \"الذاكرة والتركيز (Memory & Focus)\",\n      planningOrganization: \"التخطيط والتنظيم (Planning & Organization)\",\n      communicationExpression: \"التواصل والتعبير (Communication & Expression)\",\n      leadershipInitiative: \"القيادة والمبادرة (Leadership & Initiative)\",\n    },\n    interests: {\n      artisticCreative: \"الفن والإبداع (Artistic & Creative)\",\n      athleticPhysical: \"الرياضة واللياقة (Athletic & Physical)\",\n      technicalTech: \"التقنية والحاسوب (Technical & Tech)\",\n      linguisticReading: \"اللغة والقراءة (Linguistic & Reading)\",\n      socialHumanitarian: \"الاجتماعي والإنساني (Social & Humanitarian)\",\n      naturalEnvironmental: \"الطبيعة والبيئة (Natural & Environmental)\",\n    },\n  };\n\n  const currentHexagonLabels = editingHexagon ? hexagonMetricLabels[editingHexagon] : {};\n  \n  const currentMetricKeys = editingHexagon ? {\n    social: [\"empathy\", \"angerManagement\", \"cooperation\", \"selfConfidence\", \"acceptingCriticism\", \"listening\"],\n    skills: [\"problemSolving\", \"creativity\", \"memoryFocus\", \"planningOrganization\", \"communicationExpression\", \"leadershipInitiative\"],\n    interests: [\"artisticCreative\", \"athleticPhysical\", \"technicalTech\", \"linguisticReading\", \"socialHumanitarian\", \"naturalEnvironmental\"],\n  }[editingHexagon] : [];\n  \n  const currentTotal = currentMetricKeys.reduce((sum, k) => sum + (hexagonValues[k] ?? 0), 0);\n\n  if (isLoading) {\n    return (\n      <div className=\"h-full overflow-y-auto\">\n        <div className=\"max-w-4xl mx-auto p-6 space-y-6\">\n          <Skeleton className=\"h-64 w-full\" />\n          <Skeleton className=\"h-96 w-full\" />\n        </div>\n      </div>\n    );\n  }\n\n  if (!user) {\n    return (\n      <div className=\"h-full overflow-y-auto\">\n        <div className=\"max-w-4xl mx-auto p-6\">\n          <Card>\n            <CardContent className=\"flex flex-col items-center justify-center py-12 text-center\">\n              <UserIcon className=\"w-12 h-12 text-muted-foreground mb-4\" />\n              <h3 className=\"text-lg font-semibold mb-2\">User Not Found</h3>\n              <p className=\"text-sm text-muted-foreground max-w-md mb-4\">\n                The user you're looking for doesn't exist.\n              </p>\n              <Link href=\"/\">\n                <Button>Go Home</Button>\n              </Link>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    );\n  }\n\n  const isOwnProfile = currentUser?.id === user.id;\n\n  return (\n    <div className=\"h-full overflow-y-auto\">\n      <div className=\"max-w-4xl mx-auto p-6 space-y-6\">\n        <Card>\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-start gap-6 flex-wrap\">\n              <Avatar className=\"w-24 h-24\">\n                <AvatarImage src={user.avatarUrl || undefined} />\n                <AvatarFallback className=\"text-2xl\">\n                  {user.name.charAt(0).toUpperCase()}\n                </AvatarFallback>\n              </Avatar>\n              \n              <div className=\"flex-1 min-w-[200px]\">\n                <div className=\"flex items-center gap-3 mb-2 flex-wrap\">\n                  <h1 className=\"text-3xl font-bold\" data-testid=\"text-profile-name\">\n                    {user.name}\n                  </h1>\n                  <Badge variant={user.role === \"admin\" ? \"default\" : \"secondary\"}>\n                    {user.role}\n                  </Badge>\n                  {user.accountStatus !== \"active\" && (\n                    <Badge variant=\"destructive\">{user.accountStatus}</Badge>\n                  )}\n                  {isOwnProfile && (\n                    <Button\n                      size=\"sm\"\n                      variant=\"outline\"\n                      onClick={handleEditProfile}\n                      data-testid=\"button-edit-profile\"\n                    >\n                      <Edit2 className=\"w-4 h-4 mr-2\" />\n                      Edit\n                    </Button>\n                  )}\n                  {currentUser?.role === \"admin\" && !isOwnProfile && (\n                    <Button\n                      size=\"sm\"\n                      variant=\"destructive\"\n                      onClick={() => handleDeleteAccount(user.id)}\n                      disabled={deleteAccountMutation.isPending}\n                      data-testid=\"button-delete-account\"\n                    >\n                      <Trash2 className=\"w-4 h-4 mr-2\" />\n                      {deleteAccountMutation.isPending ? \"Deleting...\" : \"Delete Account\"}\n                    </Button>\n                  )}\n                </div>\n                \n                <p className=\"text-muted-foreground mb-2\">@{user.username}</p>\n                \n                {user.grade && user.className && (\n                  <div className=\"flex items-center gap-2 text-sm mb-3\">\n                    <Badge variant=\"outline\">\n                      Grade {user.grade}-{user.className}\n                    </Badge>\n                  </div>\n                )}\n                \n                {user.bio && (\n                  <p className=\"text-sm mt-3\">{user.bio}</p>\n                )}\n                \n                <div className=\"flex items-center gap-4 mt-4 text-sm text-muted-foreground\">\n                  <div className=\"flex items-center gap-1\">\n                    <Calendar className=\"w-4 h-4\" />\n                    Joined {new Date(user.createdAt).toLocaleDateString()}\n                  </div>\n                </div>\n              </div>\n\n            </div>\n          </CardContent>\n        </Card>\n\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <Award className=\"w-5 h-5 text-yellow-500\" />\n                Credibility Score\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-4xl font-bold text-primary\">\n                {user.credibilityScore.toFixed(1)}\n              </div>\n              <p className=\"text-sm text-muted-foreground mt-1\">\n                Content quality rating (0-100)\n              </p>\n            </CardContent>\n          </Card>\n\n          <Card>\n            <CardHeader>\n              <CardTitle className=\"flex items-center gap-2\">\n                <TrendingUp className=\"w-5 h-5 text-green-500\" />\n                Reputation Score\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"text-4xl font-bold text-primary\">\n                {user.reputationScore.toFixed(0)}\n              </div>\n              <p className=\"text-sm text-muted-foreground mt-1\">\n                Overall contribution points\n              </p>\n            </CardContent>\n          </Card>\n        </div>\n\n        {user.role === \"student\" && (\n          <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-4\">\n            <HexagonTendencyChart\n              title=\"Social Personality\"\n              description=\"Interpersonal traits and social skills\"\n              metrics={[\n                { metric: \"empathy\", arabicLabel: \"التعاطف\", value: user.empathy || 4, max: 10 },\n                { metric: \"angerManagement\", arabicLabel: \"إدارة الغضب\", value: user.angerManagement || 4, max: 10 },\n                { metric: \"cooperation\", arabicLabel: \"التعاون\", value: user.cooperation || 4, max: 10 },\n                { metric: \"selfConfidence\", arabicLabel: \"الثقة بالنفس\", value: user.selfConfidence || 4, max: 10 },\n                { metric: \"acceptingCriticism\", arabicLabel: \"تقبل النقد\", value: user.acceptingCriticism || 4, max: 10 },\n                { metric: \"listening\", arabicLabel: \"الاستماع\", value: user.listening || 4, max: 10 },\n              ]}\n              color=\"hsl(var(--chart-1))\"\n              isOwnProfile={isOwnProfile}\n              onEdit={() => handleEditHexagon(\"social\")}\n            />\n            \n            <HexagonTendencyChart\n              title=\"Skills & Abilities\"\n              description=\"Cognitive and practical capabilities\"\n              metrics={[\n                { metric: \"problemSolving\", arabicLabel: \"حل المشكلات\", value: user.problemSolving || 4, max: 10 },\n                { metric: \"creativity\", arabicLabel: \"الإبداع\", value: user.creativity || 4, max: 10 },\n                { metric: \"memoryFocus\", arabicLabel: \"الذاكرة والتركيز\", value: user.memoryFocus || 4, max: 10 },\n                { metric: \"planningOrganization\", arabicLabel: \"التخطيط والتنظيم\", value: user.planningOrganization || 4, max: 10 },\n                { metric: \"communicationExpression\", arabicLabel: \"التواصل والتعبير\", value: user.communicationExpression || 4, max: 10 },\n                { metric: \"leadershipInitiative\", arabicLabel: \"القيادة والمبادرة\", value: user.leadershipInitiative || 4, max: 10 },\n              ]}\n              color=\"hsl(var(--chart-2))\"\n              isOwnProfile={isOwnProfile}\n              onEdit={() => handleEditHexagon(\"skills\")}\n            />\n            \n            <HexagonTendencyChart\n              title=\"Interests\"\n              description=\"Hobbies and personal preferences\"\n              metrics={[\n                { metric: \"artisticCreative\", arabicLabel: \"الفن والإبداع\", value: user.artisticCreative || 4, max: 10 },\n                { metric: \"athleticPhysical\", arabicLabel: \"الرياضة واللياقة\", value: user.athleticPhysical || 4, max: 10 },\n                { metric: \"technicalTech\", arabicLabel: \"التقنية والحاسوب\", value: user.technicalTech || 4, max: 10 },\n                { metric: \"linguisticReading\", arabicLabel: \"اللغة والقراءة\", value: user.linguisticReading || 4, max: 10 },\n                { metric: \"socialHumanitarian\", arabicLabel: \"الاجتماعي والإنساني\", value: user.socialHumanitarian || 4, max: 10 },\n                { metric: \"naturalEnvironmental\", arabicLabel: \"الطبيعة والبيئة\", value: user.naturalEnvironmental || 4, max: 10 },\n              ]}\n              color=\"hsl(var(--chart-3))\"\n              isOwnProfile={isOwnProfile}\n              onEdit={() => handleEditHexagon(\"interests\")}\n            />\n          </div>\n        )}\n\n        {user.role === \"student\" && (\n          <Card className=\"p-6\">\n            <div className=\"flex items-center justify-between mb-4\">\n              <div>\n                <h3 className=\"text-lg font-semibold\">Hobbies & Interests</h3>\n                <p className=\"text-sm text-muted-foreground\">\n                  Share up to 5 hobbies or activities you enjoy\n                </p>\n              </div>\n              {isOwnProfile && (user.hobbies?.length || 0) < 5 && (\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={() => setAddingHobby(true)}\n                  disabled={updateHobbiesMutation.isPending || isFetching}\n                  data-testid=\"button-add-hobby\"\n                >\n                  <Plus className=\"h-4 w-4 mr-2\" />\n                  Add Hobby\n                </Button>\n              )}\n            </div>\n\n            {(!user.hobbies || user.hobbies.length === 0) ? (\n              <div className=\"text-center py-8 text-muted-foreground\">\n                {isOwnProfile \n                  ? \"You haven't added any hobbies yet. Click 'Add Hobby' to get started!\"\n                  : \"No hobbies added yet.\"}\n              </div>\n            ) : (\n              <div className=\"flex flex-wrap gap-2\">\n                {user.hobbies.map((hobby, index) => (\n                  <div\n                    key={index}\n                    className=\"inline-flex items-center gap-2 px-3 py-1.5 bg-accent/50 rounded-full text-sm\"\n                    data-testid={`hobby-${index}`}\n                  >\n                    <span>{hobby}</span>\n                    {isOwnProfile && (\n                      <button\n                        onClick={() => handleDeleteHobby(index)}\n                        disabled={updateHobbiesMutation.isPending || isFetching}\n                        className=\"text-destructive hover:text-destructive/80 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\n                        data-testid={`button-delete-hobby-${index}`}\n                      >\n                        <X className=\"h-3.5 w-3.5\" />\n                      </button>\n                    )}\n                  </div>\n                ))}\n              </div>\n            )}\n          </Card>\n        )}\n\n      </div>\n\n      <Dialog open={editingProfile} onOpenChange={setEditingProfile}>\n        <DialogContent data-testid=\"dialog-edit-profile\">\n          <DialogHeader>\n            <DialogTitle>Edit Profile</DialogTitle>\n            <DialogDescription>Update your profile information.</DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <label htmlFor=\"grade\" className=\"text-sm font-medium\">Grade</label>\n              <Select value={editGrade} onValueChange={setEditGrade}>\n                <SelectTrigger id=\"grade\" data-testid=\"select-edit-grade\">\n                  <SelectValue placeholder=\"Select grade\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {[1, 2, 3, 4, 5, 6].map((g) => (\n                    <SelectItem key={g} value={g.toString()}>\n                      Grade {g}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n\n            <div className=\"space-y-2\">\n              <label htmlFor=\"className\" className=\"text-sm font-medium\">Class</label>\n              <Select value={editClassName} onValueChange={setEditClassName}>\n                <SelectTrigger id=\"className\" data-testid=\"select-edit-class\">\n                  <SelectValue placeholder=\"Select class\" />\n                </SelectTrigger>\n                <SelectContent>\n                  {[\"A\", \"B\", \"C\", \"D\"].map((cls) => (\n                    <SelectItem key={cls} value={cls}>\n                      {cls}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n\n            <div className=\"space-y-2\">\n              <label htmlFor=\"bio\" className=\"text-sm font-medium\">Bio</label>\n              <Textarea\n                id=\"bio\"\n                value={editBio}\n                onChange={(e) => setEditBio(e.target.value)}\n                placeholder=\"Tell us about yourself...\"\n                className=\"min-h-24 resize-none\"\n                data-testid=\"textarea-edit-bio\"\n                maxLength={500}\n              />\n              <div className=\"flex justify-end\">\n                <span className={`text-xs ${editBio.length > 500 ? \"text-destructive\" : \"text-muted-foreground\"}`}>\n                  {editBio.length}/500\n                </span>\n              </div>\n            </div>\n          </div>\n          <DialogFooter className=\"gap-2\">\n            <Button\n              variant=\"outline\"\n              onClick={() => setEditingProfile(false)}\n              data-testid=\"button-cancel-profile-edit\"\n            >\n              Cancel\n            </Button>\n            <Button\n              onClick={handleSaveProfile}\n              disabled={editBio.length > 500 || updateProfileMutation.isPending}\n              data-testid=\"button-save-profile-edit\"\n            >\n              {updateProfileMutation.isPending ? \"Saving...\" : \"Save Changes\"}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={editingHexagon !== null} onOpenChange={() => setEditingHexagon(null)}>\n        <DialogContent className=\"max-w-2xl max-h-[80vh] overflow-y-auto\" data-testid=\"dialog-edit-hexagon\">\n          <DialogHeader>\n            <DialogTitle>\n              Edit {editingHexagon === \"social\" ? \"Social Personality\" : editingHexagon === \"skills\" ? \"Skills & Abilities\" : \"Interests\"} Hexagon\n            </DialogTitle>\n            <DialogDescription>\n              Distribute 33 points across the 6 metrics. Each metric can have a maximum of 10 points.\n            </DialogDescription>\n          </DialogHeader>\n          \n          <div className=\"space-y-6\">\n            {Object.entries(currentHexagonLabels).map(([key, label]) => (\n              <div key={key} className=\"space-y-2\">\n                <div className=\"flex items-center justify-between\">\n                  <label className=\"text-sm font-medium\">{label}</label>\n                  <span className=\"text-sm font-bold text-primary\">{hexagonValues[key] || 0}/10</span>\n                </div>\n                <Slider\n                  value={[hexagonValues[key] ?? 0]}\n                  onValueChange={(vals) => setHexagonValues({ ...hexagonValues, [key]: Math.floor(vals[0]) })}\n                  max={10}\n                  min={0}\n                  step={1}\n                  className=\"w-full\"\n                  data-testid={`slider-${key}`}\n                />\n              </div>\n            ))}\n            \n            <div className=\"flex items-center justify-between pt-4 border-t\">\n              <span className=\"font-medium\">Total Points Used:</span>\n              <span className={`text-lg font-bold ${currentTotal !== 33 ? \"text-destructive\" : \"text-green-600 dark:text-green-500\"}`}>\n                {currentTotal}/33\n              </span>\n            </div>\n            \n            {currentTotal !== 33 && (\n              <div className={`p-3 rounded-md text-sm ${currentTotal > 33 ? \"bg-destructive/10 text-destructive\" : \"bg-yellow-500/10 text-yellow-700 dark:text-yellow-500\"}`}>\n                {currentTotal > 33 \n                  ? \"⚠️ You have exceeded the limit. Please reduce some values.\"\n                  : `⚠️ You need to use exactly 33 points. Add ${33 - currentTotal} more point${33 - currentTotal === 1 ? \"\" : \"s\"}.`\n                }\n              </div>\n            )}\n          </div>\n          \n          <DialogFooter className=\"gap-2\">\n            <Button\n              variant=\"outline\"\n              onClick={() => setEditingHexagon(null)}\n              data-testid=\"button-cancel-hexagon-edit\"\n            >\n              Cancel\n            </Button>\n            <Button\n              onClick={handleSaveHexagon}\n              disabled={updateHexagonMutation.isPending || currentTotal !== 33}\n              data-testid=\"button-save-hexagon\"\n            >\n              {updateHexagonMutation.isPending ? \"Saving...\" : \"Save Changes\"}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={addingHobby} onOpenChange={setAddingHobby}>\n        <DialogContent data-testid=\"dialog-add-hobby\">\n          <DialogHeader>\n            <DialogTitle>Add New Hobby</DialogTitle>\n            <DialogDescription>\n              Share an activity or interest you enjoy (max 50 characters)\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <label htmlFor=\"hobby\" className=\"text-sm font-medium\">Hobby</label>\n              <Input\n                id=\"hobby\"\n                placeholder=\"e.g., Playing guitar, Reading sci-fi, Cooking\"\n                value={newHobby}\n                onChange={(e) => setNewHobby(e.target.value)}\n                maxLength={50}\n                data-testid=\"input-new-hobby\"\n              />\n              <p className=\"text-xs text-muted-foreground\">\n                {newHobby.length}/50 characters\n              </p>\n            </div>\n          </div>\n          <DialogFooter className=\"gap-2\">\n            <Button\n              variant=\"outline\"\n              onClick={() => {\n                setAddingHobby(false);\n                setNewHobby(\"\");\n              }}\n              data-testid=\"button-cancel-hobby\"\n            >\n              Cancel\n            </Button>\n            <Button\n              onClick={handleAddHobby}\n              disabled={updateHobbiesMutation.isPending || !newHobby.trim()}\n              data-testid=\"button-save-hobby\"\n            >\n              {updateHobbiesMutation.isPending ? \"Adding...\" : \"Add Hobby\"}\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n\n","path":null,"size_bytes":31403,"size_tokens":null},"server/seed-admins.ts":{"content":"import { db } from \"./db\";\nimport { users } from \"@shared/schema\";\nimport { eq } from \"drizzle-orm\";\nimport bcrypt from \"bcrypt\";\n\nconst ADMIN_ACCOUNTS = [\n  {\n    username: \"Mahmood.Fawaz.AL-Faqi\",\n    email: \"keneyreplitalfaqi+mahmood@gmail.com\",\n    name: \"Mahmood Fawaz AL-Faqi\",\n    role: \"admin\" as const,\n  },\n  {\n    username: \"Mustafa.Mouied.Al-Ali\",\n    email: \"keneyreplitalfaqi+mustafa@gmail.com\",\n    name: \"Mustafa Mouied Al-Ali\",\n    role: \"admin\" as const,\n  },\n];\n\nexport async function seedAdminAccounts() {\n  try {\n    console.log(\"[SEED] Starting admin account initialization...\");\n\n    // Get admin password from environment variable\n    const adminPassword = process.env.ADMIN_DEFAULT_PASSWORD;\n    \n    if (!adminPassword) {\n      console.error(\"[SEED] ⚠️  ADMIN_DEFAULT_PASSWORD environment variable is not set!\");\n      console.error(\"[SEED] ⚠️  Admin accounts will not be created. Please set this variable.\");\n      return; // Skip seeding if no password is provided\n    }\n\n    const hashedPassword = await bcrypt.hash(adminPassword, 10);\n\n    for (const adminData of ADMIN_ACCOUNTS) {\n      try {\n        // Check if admin already exists\n        const existingUser = await db\n          .select()\n          .from(users)\n          .where(eq(users.username, adminData.username))\n          .limit(1);\n\n        if (existingUser.length > 0) {\n          console.log(`[SEED] Admin account already exists: ${adminData.username}`);\n          \n          // Optional: Update password if hash has changed\n          const passwordMatch = await bcrypt.compare(adminPassword, existingUser[0].password);\n          if (!passwordMatch) {\n            await db\n              .update(users)\n              .set({ password: hashedPassword })\n              .where(eq(users.username, adminData.username));\n            console.log(`[SEED] Updated password for: ${adminData.username}`);\n          }\n          continue;\n        }\n\n        // Create new admin account\n        await db.insert(users).values({\n          username: adminData.username,\n          email: adminData.email,\n          name: adminData.name,\n          password: hashedPassword,\n          role: adminData.role,\n          credibilityScore: 100,\n          reputationPoints: 0,\n          accountStatus: \"active\",\n        });\n\n        console.log(`[SEED] ✓ Created admin account: ${adminData.username}`);\n      } catch (error) {\n        console.error(`[SEED] Failed to seed admin ${adminData.username}:`, error);\n      }\n    }\n\n    console.log(\"[SEED] Admin account initialization complete\");\n  } catch (error) {\n    console.error(\"[SEED] Critical error during admin seeding:\", error);\n    // Don't crash the server, just log the error\n  }\n}\n","path":null,"size_bytes":2716,"size_tokens":null},"client/src/pages/admin.tsx":{"content":"import { useState, useMemo } from \"react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Trash2, Plus, Copy, Check, ChevronUp, ChevronDown, Crown } from \"lucide-react\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\n\ntype StudentId = {\n  id: string;\n  username: string;\n  studentId: string;\n  grade: number;\n  className: string;\n  createdByAdminId: string;\n  isAssigned: boolean;\n  assignedToUserId: string | null;\n  createdAt: string;\n  assignedAt: string | null;\n};\n\ntype Student = {\n  id: string;\n  username: string;\n  name: string;\n  grade: number | null;\n  className: string | null;\n  credibilityScore: number;\n  reputationScore: number;\n  createdAt: string;\n  assignedDate: string | null;\n};\n\ntype SortField = \"name\" | \"grade\" | \"class\" | \"date\";\ntype SortDirection = \"asc\" | \"desc\";\n\ntype Scope = {\n  id: string;\n  name: string;\n  type: \"grade\" | \"section\";\n  gradeNumber: number | null;\n  sectionName: string | null;\n  accessCode: string;\n  createdAt: string;\n};\n\nfunction ScopeManagement() {\n  const { toast } = useToast();\n  const [scopeName, setScopeName] = useState(\"\");\n  const [scopeType, setScopeType] = useState<\"grade\" | \"section\">(\"section\");\n  const [gradeNumber, setGradeNumber] = useState(\"\");\n  const [sectionName, setSectionName] = useState(\"\");\n  const [accessCode, setAccessCode] = useState(\"\");\n  const [showDeleteDialog, setShowDeleteDialog] = useState(false);\n  const [scopeToDelete, setScopeToDelete] = useState<Scope | null>(null);\n\n  const { data: scopes, isLoading } = useQuery<Scope[]>({\n    queryKey: [\"/api/scopes\"],\n  });\n\n  const createScopeMutation = useMutation({\n    mutationFn: async (data: { name: string; type: string; gradeNumber?: number; sectionName?: string; accessCode: string }) => {\n      return await apiRequest(\"POST\", \"/api/scopes\", data);\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Scope created\",\n        description: \"New access scope has been created successfully\",\n      });\n      setScopeName(\"\");\n      setGradeNumber(\"\");\n      setSectionName(\"\");\n      setAccessCode(\"\");\n      queryClient.invalidateQueries({ queryKey: [\"/api/scopes\"] });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Failed to create scope\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const deleteScopeMutation = useMutation({\n    mutationFn: async (id: string) => {\n      return await apiRequest(\"DELETE\", `/api/scopes/${id}`);\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Scope deleted\",\n        description: \"Access scope has been removed successfully\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/scopes\"] });\n      setShowDeleteDialog(false);\n      setScopeToDelete(null);\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Failed to delete scope\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleCreateScope = () => {\n    // Validate scope name\n    if (!scopeName.trim()) {\n      toast({\n        title: \"Validation Error\",\n        description: \"Scope name is required\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (scopeType === \"public\") {\n      createScopeMutation.mutate({\n        name: scopeName,\n        type: scopeType,\n        accessCode: null,\n      });\n    } else if (scopeType === \"grade\") {\n      // Validate access code (alphanumeric, no spaces)\n      if (!accessCode.trim() || !/^[A-Za-z0-9]+$/.test(accessCode)) {\n        toast({\n          title: \"Validation Error\",\n          description: \"Access code must be alphanumeric with no spaces\",\n          variant: \"destructive\",\n        });\n        return;\n      }\n      // Validate grade number\n      const gradeNum = parseInt(gradeNumber);\n      if (!gradeNumber || isNaN(gradeNum) || gradeNum < 1 || gradeNum > 6) {\n        toast({\n          title: \"Validation Error\",\n          description: \"Grade number must be between 1 and 6\",\n          variant: \"destructive\",\n        });\n        return;\n      }\n      createScopeMutation.mutate({\n        name: scopeName,\n        type: scopeType,\n        gradeNumber: gradeNum,\n        accessCode: accessCode.trim(),\n      });\n    } else if (scopeType === \"section\") {\n      // Validate access code (alphanumeric, no spaces)\n      if (!accessCode.trim() || !/^[A-Za-z0-9]+$/.test(accessCode)) {\n        toast({\n          title: \"Validation Error\",\n          description: \"Access code must be alphanumeric with no spaces\",\n          variant: \"destructive\",\n        });\n        return;\n      }\n\n      // Validate section name format (e.g., \"1-A\", \"2-B\")\n      if (!sectionName.trim() || !/^\\d+-[A-E]$/.test(sectionName.trim())) {\n        toast({\n          title: \"Validation Error\",\n          description: \"Section name must be in format: grade-section (e.g., 1-A, 2-B)\",\n          variant: \"destructive\",\n        });\n        return;\n      }\n      createScopeMutation.mutate({\n        name: scopeName,\n        type: scopeType,\n        sectionName: sectionName.trim(),\n        accessCode: accessCode.trim(),\n      });\n    }\n  };\n\n  const handleDeleteClick = (scope: Scope) => {\n    setScopeToDelete(scope);\n    setShowDeleteDialog(true);\n  };\n\n  const handleConfirmDelete = () => {\n    if (scopeToDelete) {\n      deleteScopeMutation.mutate(scopeToDelete.id);\n    }\n  };\n\n  const publicScope = scopes?.find(s => s.type === \"public\");\n  const gradeScopes = scopes?.filter(s => s.type === \"grade\").sort((a, b) => (a.gradeNumber || 0) - (b.gradeNumber || 0)) || [];\n  const classScopes = scopes?.filter(s => s.type === \"section\").sort((a, b) => (a.sectionName || \"\").localeCompare(b.sectionName || \"\")) || [];\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Create New Scope */}\n      <div className=\"space-y-4 p-4 border rounded-lg\">\n        <h3 className=\"font-semibold\">Create New Class Scope</h3>\n        \n        <div className=\"grid gap-4\">\n          <div>\n            <Label htmlFor=\"scope-name\">Scope Name *</Label>\n            <Input\n              id=\"scope-name\"\n              placeholder=\"e.g., Class 1-A\"\n              value={scopeName}\n              onChange={(e) => setScopeName(e.target.value)}\n              data-testid=\"input-scope-name\"\n            />\n          </div>\n\n          <div>\n            <Label htmlFor=\"scope-type\">Scope Type</Label>\n            <Select value={scopeType} onValueChange={(value: \"grade\" | \"section\" | \"public\") => setScopeType(value)}>\n              <SelectTrigger id=\"scope-type\" data-testid=\"select-scope-type\">\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent>\n                <SelectItem value=\"public\">Public Square</SelectItem>\n                <SelectItem value=\"grade\">Grade Scope</SelectItem>\n                <SelectItem value=\"section\">Class Scope</SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n\n          {scopeType === \"public\" && (\n            <p className=\"text-sm text-muted-foreground\">\n              The public square scope is created automatically and is accessible to all users.\n            </p>\n          )}\n\n          {scopeType === \"grade\" && (\n            <div>\n              <Label htmlFor=\"grade-number\">Grade Number *</Label>\n              <Input\n                id=\"grade-number\"\n                type=\"number\"\n                min=\"1\"\n                max=\"6\"\n                placeholder=\"1-6\"\n                value={gradeNumber}\n                onChange={(e) => setGradeNumber(e.target.value)}\n                data-testid=\"input-grade-number\"\n              />\n            </div>\n          )}\n\n          {scopeType === \"section\" && (\n            <div>\n              <Label htmlFor=\"section-name\">Section Name *</Label>\n              <Input\n                id=\"section-name\"\n                placeholder=\"e.g., 1-A, 2-B\"\n                value={sectionName}\n                onChange={(e) => setSectionName(e.target.value)}\n                data-testid=\"input-section-name\"\n              />\n            </div>\n          )}\n\n          {scopeType !== \"public\" && (\n            <div>\n            <Label htmlFor=\"access-code\">Access Code *</Label>\n            <Input\n              id=\"access-code\"\n              placeholder=\"Custom access code for this scope\"\n              value={accessCode}\n              onChange={(e) => setAccessCode(e.target.value)}\n              data-testid=\"input-access-code\"\n            />\n              <p className=\"text-xs text-muted-foreground mt-1\">\n                Students will need this code to access content in this scope\n              </p>\n            </div>\n          )}\n\n          <Button\n            onClick={handleCreateScope}\n            disabled={createScopeMutation.isPending}\n            data-testid=\"button-create-scope\"\n          >\n            <Plus className=\"w-4 h-4 mr-2\" />\n            {createScopeMutation.isPending ? \"Creating...\" : \"Create Scope\"}\n          </Button>\n        </div>\n      </div>\n\n      {/* Existing Scopes */}\n      <div className=\"space-y-4\">\n        <h3 className=\"font-semibold\">Existing Scopes</h3>\n        \n        {isLoading ? (\n          <div className=\"flex items-center justify-center py-8\">\n            <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n          </div>\n        ) : (\n          <>\n            {/* Public Square Scope */}\n            {publicScope && (\n              <div className=\"space-y-2 mb-6\">\n                <h4 className=\"text-sm font-medium text-muted-foreground\">Public Scope</h4>\n                <div className=\"flex items-center justify-between gap-3 p-3 rounded-lg border bg-accent/50 hover-elevate\">\n                  <div className=\"flex-1\">\n                    <div className=\"font-medium\">{publicScope.name}</div>\n                    <div className=\"text-sm text-muted-foreground\">\n                      Accessible to all users without any access code\n                    </div>\n                  </div>\n                  <Badge variant=\"default\">Public</Badge>\n                </div>\n              </div>\n            )}\n\n            {/* Grade Scopes */}\n            <div className=\"space-y-2\">\n              <h4 className=\"text-sm font-medium text-muted-foreground\">Grade Scopes ({gradeScopes.length})</h4>\n              {gradeScopes.map((scope) => (\n                <div\n                  key={scope.id}\n                  className=\"flex items-center justify-between gap-3 p-3 rounded-lg border hover-elevate\"\n                  data-testid={`scope-${scope.id}`}\n                >\n                  <div className=\"flex-1\">\n                    <div className=\"font-medium\">{scope.name}</div>\n                    <div className=\"text-sm text-muted-foreground\">\n                      Code: <code className=\"font-mono\">{scope.accessCode}</code>\n                    </div>\n                  </div>\n                  <Badge variant=\"secondary\">Grade {scope.gradeNumber}</Badge>\n                  <Button\n                    variant=\"ghost\"\n                    size=\"icon\"\n                    onClick={() => handleDeleteClick(scope)}\n                    data-testid={`button-delete-scope-${scope.id}`}\n                  >\n                    <Trash2 className=\"w-4 h-4 text-destructive\" />\n                  </Button>\n                </div>\n              ))}\n            </div>\n\n            {/* Class Scopes */}\n            <div className=\"space-y-2\">\n              <h4 className=\"text-sm font-medium text-muted-foreground\">Class Scopes ({classScopes.length})</h4>\n              {classScopes.map((scope) => (\n                <div\n                  key={scope.id}\n                  className=\"flex items-center justify-between gap-3 p-3 rounded-lg border hover-elevate\"\n                  data-testid={`scope-${scope.id}`}\n                >\n                  <div className=\"flex-1\">\n                    <div className=\"font-medium\">{scope.name}</div>\n                    <div className=\"text-sm text-muted-foreground\">\n                      Code: <code className=\"font-mono\">{scope.accessCode}</code>\n                    </div>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <Badge variant=\"outline\">{scope.sectionName}</Badge>\n                    <Button\n                      size=\"sm\"\n                      variant=\"ghost\"\n                      onClick={() => handleDeleteClick(scope)}\n                      disabled={deleteScopeMutation.isPending}\n                      data-testid={`button-delete-scope-${scope.id}`}\n                    >\n                      <Trash2 className=\"w-4 h-4\" />\n                    </Button>\n                  </div>\n                </div>\n              ))}\n            </div>\n          </>\n        )}\n      </div>\n\n      {/* Delete Confirmation Dialog */}\n      <AlertDialog open={showDeleteDialog} onOpenChange={setShowDeleteDialog}>\n        <AlertDialogContent data-testid=\"dialog-confirm-delete-scope\">\n          <AlertDialogHeader>\n            <AlertDialogTitle>Delete Scope?</AlertDialogTitle>\n            <AlertDialogDescription>\n              Are you sure you want to delete the scope <strong>{scopeToDelete?.name}</strong>?\n              This will remove access for all students who have unlocked this scope.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel data-testid=\"button-cancel-delete-scope\">Cancel</AlertDialogCancel>\n            <AlertDialogAction\n              onClick={handleConfirmDelete}\n              disabled={deleteScopeMutation.isPending}\n              data-testid=\"button-confirm-delete-scope\"\n            >\n              {deleteScopeMutation.isPending ? \"Deleting...\" : \"Delete Scope\"}\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n}\n\nexport default function AdminPage() {\n  const { toast } = useToast();\n  const [username, setUsername] = useState(\"\");\n  const [grade, setGrade] = useState(\"\");\n  const [className, setClassName] = useState(\"\");\n  const [copiedId, setCopiedId] = useState<string | null>(null);\n  \n  // Student Accounts search/sort state\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [sortField, setSortField] = useState<SortField>(\"name\");\n  const [sortDirection, setSortDirection] = useState<SortDirection>(\"asc\");\n  \n  // Student IDs search/sort state\n  const [idSearchQuery, setIdSearchQuery] = useState(\"\");\n  const [idSortField, setIdSortField] = useState<SortField>(\"name\");\n  const [idSortDirection, setIdSortDirection] = useState<SortDirection>(\"asc\");\n  \n  // Promote to admin state\n  const [selectedUserToPromote, setSelectedUserToPromote] = useState<string>(\"\");\n  const [showPromoteDialog, setShowPromoteDialog] = useState(false);\n\n  const { data: studentIds, isLoading } = useQuery<StudentId[]>({\n    queryKey: [\"/api/admin/student-ids\"],\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: { username: string; grade: number; className: string }) => {\n      return await apiRequest(\"POST\", \"/api/admin/student-ids\", data);\n    },\n    onSuccess: (response: any) => {\n      const generatedId = response?.studentId?.studentId || response?.studentId || \"Unknown\";\n      toast({\n        title: \"Student ID created\",\n        description: `Generated ID: ${generatedId} for ${response?.studentId?.username || username}`,\n      });\n      setUsername(\"\");\n      setGrade(\"\");\n      setClassName(\"\");\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/student-ids\"] });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Failed to create student ID\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: string) => {\n      return await apiRequest(\"DELETE\", `/api/admin/student-ids/${id}`);\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Student ID deleted\",\n        description: \"Student ID has been removed successfully\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/student-ids\"] });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Failed to delete student ID\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const { data: students, isLoading: studentsLoading } = useQuery<Student[]>({\n    queryKey: [\"/api/admin/students\"],\n  });\n\n  const deleteAccountMutation = useMutation({\n    mutationFn: async (userId: string) => {\n      return await apiRequest(\"DELETE\", `/api/admin/student/${userId}`);\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Student account deleted\",\n        description: \"Student account and all associated data has been removed successfully\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/students\"] });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Failed to delete student account\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleDeleteStudent = (userId: string, studentName: string) => {\n    if (window.confirm(`Are you sure you want to delete ${studentName}'s account and all associated data? This action cannot be undone.`)) {\n      deleteAccountMutation.mutate(userId);\n    }\n  };\n\n  const promoteMutation = useMutation({\n    mutationFn: async (userId: string) => {\n      return await apiRequest(\"POST\", \"/api/admin/promote\", { userId });\n    },\n    onSuccess: () => {\n      toast({\n        title: \"User promoted to admin\",\n        description: \"The user has been successfully promoted to admin\",\n      });\n      setSelectedUserToPromote(\"\");\n      setShowPromoteDialog(false);\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/students\"] });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Failed to promote user\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n      setShowPromoteDialog(false);\n    },\n  });\n\n  const handlePromoteClick = () => {\n    if (!selectedUserToPromote) return;\n    setShowPromoteDialog(true);\n  };\n\n  const handleConfirmPromotion = () => {\n    if (!selectedUserToPromote) return;\n    promoteMutation.mutate(selectedUserToPromote);\n  };\n\n  const selectedUserData = students?.find(s => s.id === selectedUserToPromote);\n\n  const handleCreate = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (username.trim() && grade && className.trim()) {\n      createMutation.mutate({\n        username: username.trim(),\n        grade: parseInt(grade),\n        className: className.trim().toUpperCase(),\n      });\n    }\n  };\n\n  const handleCopy = async (studentId: string) => {\n    await navigator.clipboard.writeText(studentId);\n    setCopiedId(studentId);\n    setTimeout(() => setCopiedId(null), 2000);\n    toast({\n      title: \"Copied!\",\n      description: \"Student ID copied to clipboard\",\n    });\n  };\n\n  const toggleSort = (field: SortField) => {\n    if (sortField === field) {\n      setSortDirection(sortDirection === \"asc\" ? \"desc\" : \"asc\");\n    } else {\n      setSortField(field);\n      setSortDirection(\"asc\");\n    }\n  };\n\n  const toggleIdSort = (field: SortField) => {\n    if (idSortField === field) {\n      setIdSortDirection(idSortDirection === \"asc\" ? \"desc\" : \"asc\");\n    } else {\n      setIdSortField(field);\n      setIdSortDirection(\"asc\");\n    }\n  };\n\n  const filteredAndSortedStudents = useMemo(() => {\n    if (!students) return [];\n    \n    let filtered = students.filter((student) => {\n      const searchLower = searchQuery.toLowerCase();\n      return (\n        student.name.toLowerCase().includes(searchLower) ||\n        student.username.toLowerCase().includes(searchLower)\n      );\n    });\n\n    filtered.sort((a, b) => {\n      let compareValue = 0;\n\n      switch (sortField) {\n        case \"name\":\n          compareValue = a.name.localeCompare(b.name);\n          break;\n        case \"grade\":\n          compareValue = (a.grade || 0) - (b.grade || 0);\n          break;\n        case \"class\":\n          compareValue = (a.className || \"\").localeCompare(b.className || \"\");\n          break;\n        case \"date\":\n          compareValue = new Date(a.createdAt).getTime() - new Date(b.createdAt).getTime();\n          break;\n      }\n\n      return sortDirection === \"asc\" ? compareValue : -compareValue;\n    });\n\n    return filtered;\n  }, [students, searchQuery, sortField, sortDirection]);\n\n  const filteredAndSortedStudentIds = useMemo(() => {\n    if (!studentIds) return [];\n    \n    let filtered = studentIds.filter((record) => {\n      const searchLower = idSearchQuery.toLowerCase();\n      return (\n        record.username.toLowerCase().includes(searchLower) ||\n        record.studentId.toLowerCase().includes(searchLower)\n      );\n    });\n\n    filtered.sort((a, b) => {\n      let compareValue = 0;\n\n      switch (idSortField) {\n        case \"name\":\n          compareValue = a.username.localeCompare(b.username);\n          break;\n        case \"grade\":\n          compareValue = a.grade - b.grade;\n          break;\n        case \"class\":\n          compareValue = a.className.localeCompare(b.className);\n          break;\n        case \"date\":\n          compareValue = new Date(a.createdAt).getTime() - new Date(b.createdAt).getTime();\n          break;\n      }\n\n      return idSortDirection === \"asc\" ? compareValue : -compareValue;\n    });\n\n    return filtered;\n  }, [studentIds, idSearchQuery, idSortField, idSortDirection]);\n\n  return (\n    <div className=\"container max-w-6xl mx-auto p-6\">\n      <h1 className=\"text-3xl font-bold mb-6\">Admin Management</h1>\n\n      <div className=\"grid gap-6\">\n        <Card>\n          <CardHeader>\n            <CardTitle>Generate Student ID</CardTitle>\n            <CardDescription>\n              Create new student IDs for registration. Students will need these IDs to sign up.\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <form onSubmit={handleCreate} className=\"space-y-4\">\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                <div>\n                  <Label htmlFor=\"username\">Username</Label>\n                  <Input\n                    id=\"username\"\n                    placeholder=\"e.g., John.Smith\"\n                    value={username}\n                    onChange={(e) => setUsername(e.target.value)}\n                    data-testid=\"input-username\"\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"grade\">Grade (1-6)</Label>\n                  <Input\n                    id=\"grade\"\n                    type=\"number\"\n                    min=\"1\"\n                    max=\"6\"\n                    placeholder=\"1-6\"\n                    value={grade}\n                    onChange={(e) => setGrade(e.target.value)}\n                    data-testid=\"input-grade\"\n                  />\n                </div>\n                <div>\n                  <Label htmlFor=\"className\">Class</Label>\n                  <Input\n                    id=\"className\"\n                    placeholder=\"e.g., A\"\n                    value={className}\n                    onChange={(e) => setClassName(e.target.value)}\n                    data-testid=\"input-class\"\n                  />\n                </div>\n              </div>\n              <Button \n                type=\"submit\" \n                disabled={createMutation.isPending || !username.trim() || !grade || !className.trim()}\n                data-testid=\"button-create-student-id\"\n                className=\"w-full\"\n              >\n                <Plus className=\"w-4 h-4 mr-2\" />\n                {createMutation.isPending ? \"Generating...\" : \"Generate Student ID\"}\n              </Button>\n            </form>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>Student ID Database</CardTitle>\n            <CardDescription>\n              All generated student IDs. Assigned IDs cannot be deleted.\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"p-3 pt-0\">\n            <div className=\"space-y-4\">\n              <div className=\"space-y-3\">\n                <div>\n                  <Label htmlFor=\"search-student-ids\">Search by Username or ID</Label>\n                  <Input\n                    id=\"search-student-ids\"\n                    placeholder=\"Search student ID...\"\n                    value={idSearchQuery}\n                    onChange={(e) => setIdSearchQuery(e.target.value)}\n                    data-testid=\"input-search-student-ids\"\n                  />\n                </div>\n\n                <div className=\"flex gap-2 flex-wrap\">\n                  <Button\n                    size=\"sm\"\n                    variant={idSortField === \"name\" ? \"default\" : \"outline\"}\n                    onClick={() => toggleIdSort(\"name\")}\n                    data-testid=\"button-sort-id-name\"\n                  >\n                    Name\n                    {idSortField === \"name\" && (\n                      idSortDirection === \"asc\" ? <ChevronUp className=\"w-3 h-3 ml-1\" /> : <ChevronDown className=\"w-3 h-3 ml-1\" />\n                    )}\n                  </Button>\n                  <Button\n                    size=\"sm\"\n                    variant={idSortField === \"grade\" ? \"default\" : \"outline\"}\n                    onClick={() => toggleIdSort(\"grade\")}\n                    data-testid=\"button-sort-id-grade\"\n                  >\n                    Grade\n                    {idSortField === \"grade\" && (\n                      idSortDirection === \"asc\" ? <ChevronUp className=\"w-3 h-3 ml-1\" /> : <ChevronDown className=\"w-3 h-3 ml-1\" />\n                    )}\n                  </Button>\n                  <Button\n                    size=\"sm\"\n                    variant={idSortField === \"class\" ? \"default\" : \"outline\"}\n                    onClick={() => toggleIdSort(\"class\")}\n                    data-testid=\"button-sort-id-class\"\n                  >\n                    Section\n                    {idSortField === \"class\" && (\n                      idSortDirection === \"asc\" ? <ChevronUp className=\"w-3 h-3 ml-1\" /> : <ChevronDown className=\"w-3 h-3 ml-1\" />\n                    )}\n                  </Button>\n                </div>\n              </div>\n\n              {isLoading ? (\n                <div className=\"flex items-center justify-center py-8\">\n                  <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n                </div>\n              ) : !studentIds || studentIds.length === 0 ? (\n                <p className=\"text-center text-muted-foreground py-8\">\n                  No student IDs generated yet. Create one above to get started.\n                </p>\n              ) : filteredAndSortedStudentIds.length === 0 ? (\n                <p className=\"text-center text-muted-foreground py-8\">\n                  No student IDs match your search criteria.\n                </p>\n              ) : (\n                <div className=\"space-y-2\">\n                  {filteredAndSortedStudentIds.map((record) => (\n                    <div\n                      key={record.id}\n                      className=\"flex items-center justify-between p-4 rounded-lg border hover-elevate\"\n                      data-testid={`student-id-${record.studentId}`}\n                    >\n                      <div className=\"flex items-center gap-4 flex-1\">\n                        <div className=\"flex flex-col\">\n                          <span className=\"font-semibold\">{record.username}</span>\n                          <code className=\"text-sm font-mono text-muted-foreground\">\n                            ID: {record.studentId}\n                          </code>\n                        </div>\n                        <Badge variant=\"outline\">\n                          Grade {record.grade}-{record.className}\n                        </Badge>\n                        <Badge variant={record.isAssigned ? \"default\" : \"outline\"}>\n                          {record.isAssigned ? \"Assigned\" : \"Available\"}\n                        </Badge>\n                        {record.isAssigned && (\n                          <span className=\"text-sm text-muted-foreground\">\n                            {new Date(record.assignedAt!).toLocaleDateString()}\n                          </span>\n                        )}\n                      </div>\n                      <div className=\"flex items-center gap-2\">\n                        <Button\n                          size=\"sm\"\n                          variant=\"ghost\"\n                          onClick={() => handleCopy(record.studentId)}\n                          data-testid={`button-copy-${record.studentId}`}\n                        >\n                          {copiedId === record.studentId ? (\n                            <Check className=\"w-4 h-4\" />\n                          ) : (\n                            <Copy className=\"w-4 h-4\" />\n                          )}\n                        </Button>\n                        {!record.isAssigned && (\n                          <Button\n                            size=\"sm\"\n                            variant=\"ghost\"\n                            onClick={() => deleteMutation.mutate(record.id)}\n                            disabled={deleteMutation.isPending}\n                            data-testid={`button-delete-${record.studentId}`}\n                          >\n                            <Trash2 className=\"w-4 h-4\" />\n                          </Button>\n                        )}\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              )}\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>Student Accounts</CardTitle>\n            <CardDescription>\n              All registered student accounts. You can delete accounts here, which will remove all associated data.\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"p-3 pt-0\">\n            <div className=\"space-y-4\">\n              <div className=\"space-y-3\">\n                <div>\n                  <Label htmlFor=\"search-students\">Search by Name or Username</Label>\n                  <Input\n                    id=\"search-students\"\n                    placeholder=\"Search student...\"\n                    value={searchQuery}\n                    onChange={(e) => setSearchQuery(e.target.value)}\n                    data-testid=\"input-search-students\"\n                  />\n                </div>\n\n                <div className=\"flex gap-2 flex-wrap\">\n                  <Button\n                    size=\"sm\"\n                    variant={sortField === \"name\" ? \"default\" : \"outline\"}\n                    onClick={() => toggleSort(\"name\")}\n                    data-testid=\"button-sort-name\"\n                  >\n                    Name\n                    {sortField === \"name\" && (\n                      sortDirection === \"asc\" ? <ChevronUp className=\"w-3 h-3 ml-1\" /> : <ChevronDown className=\"w-3 h-3 ml-1\" />\n                    )}\n                  </Button>\n                  <Button\n                    size=\"sm\"\n                    variant={sortField === \"grade\" ? \"default\" : \"outline\"}\n                    onClick={() => toggleSort(\"grade\")}\n                    data-testid=\"button-sort-grade\"\n                  >\n                    Grade\n                    {sortField === \"grade\" && (\n                      sortDirection === \"asc\" ? <ChevronUp className=\"w-3 h-3 ml-1\" /> : <ChevronDown className=\"w-3 h-3 ml-1\" />\n                    )}\n                  </Button>\n                  <Button\n                    size=\"sm\"\n                    variant={sortField === \"class\" ? \"default\" : \"outline\"}\n                    onClick={() => toggleSort(\"class\")}\n                    data-testid=\"button-sort-class\"\n                  >\n                    Section\n                    {sortField === \"class\" && (\n                      sortDirection === \"asc\" ? <ChevronUp className=\"w-3 h-3 ml-1\" /> : <ChevronDown className=\"w-3 h-3 ml-1\" />\n                    )}\n                  </Button>\n                </div>\n              </div>\n\n              {studentsLoading ? (\n                <div className=\"flex items-center justify-center py-8\">\n                  <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary\"></div>\n                </div>\n              ) : !students || students.length === 0 ? (\n                <p className=\"text-center text-muted-foreground py-8\">\n                  No student accounts registered yet.\n                </p>\n              ) : filteredAndSortedStudents.length === 0 ? (\n                <p className=\"text-center text-muted-foreground py-8\">\n                  No students match your search criteria.\n                </p>\n              ) : (\n                <div className=\"space-y-2\">\n                  {filteredAndSortedStudents.map((student) => (\n                    <div\n                      key={student.id}\n                      className=\"flex items-center justify-between p-4 rounded-lg border hover-elevate\"\n                      data-testid={`student-account-${student.id}`}\n                    >\n                      <div className=\"flex items-center gap-4 flex-1\">\n                        <div className=\"flex flex-col\">\n                          <span className=\"font-semibold\">{student.name}</span>\n                          <code className=\"text-sm font-mono text-muted-foreground\">\n                            @{student.username}\n                          </code>\n                        </div>\n                        {student.grade && student.className && (\n                          <Badge variant=\"outline\">\n                            Grade {student.grade}-{student.className}\n                          </Badge>\n                        )}\n                        <Badge variant=\"outline\">\n                          Credibility: {student.credibilityScore.toFixed(1)}\n                        </Badge>\n                        <span className=\"text-sm text-muted-foreground\">\n                          Joined {new Date(student.createdAt).toLocaleDateString()}\n                        </span>\n                      </div>\n                      <Button\n                        size=\"sm\"\n                        variant=\"ghost\"\n                        onClick={() => handleDeleteStudent(student.id, student.name)}\n                        disabled={deleteAccountMutation.isPending}\n                        data-testid={`button-delete-account-${student.id}`}\n                      >\n                        <Trash2 className=\"w-4 h-4\" />\n                      </Button>\n                    </div>\n                  ))}\n                </div>\n              )}\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Scope Management Card */}\n        <Card>\n          <CardHeader>\n            <CardTitle>Manage Access Scopes</CardTitle>\n            <CardDescription>\n              Create and manage grade and class scopes with custom access codes\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <ScopeManagement />\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Crown className=\"w-5 h-5\" />\n              Promote User to Admin\n            </CardTitle>\n            <CardDescription>\n              Grant admin privileges to a student without losing your own admin status. This is different from the handover feature.\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-4\">\n              <div>\n                <Label htmlFor=\"select-user-promote\">Select Student to Promote</Label>\n                <Select\n                  value={selectedUserToPromote}\n                  onValueChange={setSelectedUserToPromote}\n                >\n                  <SelectTrigger id=\"select-user-promote\" data-testid=\"select-user-promote\">\n                    <SelectValue placeholder={studentsLoading ? \"Loading...\" : \"Choose a student...\"} />\n                  </SelectTrigger>\n                  <SelectContent>\n                    {studentsLoading ? (\n                      <SelectItem value=\"loading\" disabled>\n                        Loading students...\n                      </SelectItem>\n                    ) : students && students.length > 0 ? (\n                      students.map((student) => (\n                        <SelectItem key={student.id} value={student.id}>\n                          {student.name} (@{student.username}) - Grade {student.grade}-{student.className}\n                        </SelectItem>\n                      ))\n                    ) : (\n                      <SelectItem value=\"none\" disabled>\n                        No students available\n                      </SelectItem>\n                    )}\n                  </SelectContent>\n                </Select>\n              </div>\n              \n              <Button\n                onClick={handlePromoteClick}\n                disabled={!selectedUserToPromote || promoteMutation.isPending}\n                data-testid=\"button-promote-to-admin\"\n                className=\"w-full\"\n              >\n                <Crown className=\"w-4 h-4 mr-2\" />\n                {promoteMutation.isPending ? \"Promoting...\" : \"Promote to Admin\"}\n              </Button>\n\n              <div className=\"rounded-lg bg-muted p-4 space-y-2\">\n                <h4 className=\"font-semibold text-sm\">Important Notes:</h4>\n                <ul className=\"text-sm text-muted-foreground space-y-1 list-disc list-inside\">\n                  <li>This action promotes a student to admin status</li>\n                  <li>You will keep your admin privileges (inheritance model)</li>\n                  <li>The promoted user will have full administrative access</li>\n                  <li>This is different from \"handover\" which transfers privileges</li>\n                </ul>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <AlertDialog open={showPromoteDialog} onOpenChange={setShowPromoteDialog}>\n          <AlertDialogContent data-testid=\"dialog-confirm-promote\">\n            <AlertDialogHeader>\n              <AlertDialogTitle>Promote User to Admin?</AlertDialogTitle>\n              <AlertDialogDescription>\n                {selectedUserData && (\n                  <span>\n                    Are you sure you want to promote <strong>{selectedUserData.name}</strong> (@{selectedUserData.username}) to admin? \n                    They will have full administrative privileges including:\n                    <ul className=\"mt-2 space-y-1 list-disc list-inside\">\n                      <li>Managing student IDs and accounts</li>\n                      <li>Deleting posts and content</li>\n                      <li>Promoting other users to admin</li>\n                      <li>All other administrative functions</li>\n                    </ul>\n                  </span>\n                )}\n              </AlertDialogDescription>\n            </AlertDialogHeader>\n            <AlertDialogFooter>\n              <AlertDialogCancel data-testid=\"button-cancel-promote\">Cancel</AlertDialogCancel>\n              <AlertDialogAction \n                onClick={handleConfirmPromotion} \n                disabled={promoteMutation.isPending}\n                data-testid=\"button-confirm-promote\"\n              >\n                {promoteMutation.isPending ? \"Promoting...\" : \"Promote to Admin\"}\n              </AlertDialogAction>\n            </AlertDialogFooter>\n          </AlertDialogContent>\n        </AlertDialog>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":40542,"size_tokens":null},"client/src/pages/schedule.tsx":{"content":"import { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Calendar, Clock, User as UserIcon, BookOpen, Edit, Save, X } from \"lucide-react\";\nimport { useState, useMemo } from \"react\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Link } from \"wouter\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\n\ntype Teacher = {\n  id: string;\n  name: string;\n  subjects?: string[] | null;\n  sections?: string[] | null;\n};\n\n// Predefined subjects list\nconst SUBJECTS = [\n  \"Math\",\n  \"R.E.\",\n  \"P.E.\",\n  \"Social Studies\",\n  \"Biology\",\n  \"Chemistry\",\n  \"Physics\",\n  \"Arabic\",\n  \"English\",\n  \"French\",\n  \"B.P.C.\",\n  \"Finance\",\n  \"Geology\",\n  \"Computer Science\",\n  \"Arts\",\n  \"Moralism\",\n  \"Library\",\n] as const;\n\ntype Schedule = {\n  id: string;\n  scopeId: string;\n  dayOfWeek: number;\n  periodNumber: number;\n  teacherName: string | null;\n  subject: string | null;\n};\n\ntype User = {\n  id: string;\n  grade: number | null;\n  className: string | null;\n  role: \"student\" | \"admin\";\n};\n\ntype Scope = {\n  id: string;\n  name: string;\n  type: \"global\" | \"stage\" | \"section\";\n};\n\ntype Event = {\n  id: string;\n  title: string;\n  description: string | null;\n  eventType: string;\n  scopeId: string | null;\n  startTime: string;\n  endTime: string | null;\n  location: string | null;\n  imageUrl: string | null;\n  createdById: string;\n  createdAt: string;\n};\n\ntype RSVP = {\n  eventId: string;\n};\n\nexport default function SchedulePage() {\n  const { toast } = useToast();\n  const [isEditing, setIsEditing] = useState(false);\n  const [editedSchedules, setEditedSchedules] = useState<Record<string, { subject: string | null; teacherName: string | null }>>({});\n\n  const { data: user, isLoading: userLoading } = useQuery<User>({\n    queryKey: [\"/api/auth/me\"],\n  });\n\n  const { data: scopes } = useQuery<Scope[]>({\n    queryKey: [\"/api/scopes\"],\n  });\n\n  const { data: digitalKeys = [] } = useQuery<{ scopeId: string }[]>({\n    queryKey: [\"/api/keys\"],\n    enabled: !!user,\n  });\n\n  const { data: events = [] } = useQuery<Event[]>({\n    queryKey: [\"/api/events\"],\n  });\n\n  const { data: rsvps = [] } = useQuery<RSVP[]>({\n    queryKey: [\"/api/rsvps\"],\n    enabled: !!user,\n  });\n\n  const { data: teachers = [] } = useQuery<Teacher[]>({\n    queryKey: [\"/api/teachers\"],\n    enabled: !!user,\n  });\n\n  // Find user's class scope\n  const classScope = scopes?.find(\n    (s) => s.name === `Class ${user?.grade}-${user?.className}`\n  );\n\n  // Find user's grade scope\n  const gradeScope = scopes?.find(\n    (s) => s.type === \"stage\" && s.name === `Grade ${user?.grade}`\n  );\n\n  const { data: schedules = [], isLoading: schedulesLoading } = useQuery<Schedule[]>({\n    queryKey: [\"/api/schedules\", classScope?.id],\n    queryFn: async () => {\n      if (!classScope?.id) return [];\n      const response = await fetch(`/api/schedules/${classScope.id}`);\n      if (!response.ok) throw new Error(\"Failed to fetch schedules\");\n      return response.json();\n    },\n    enabled: !!classScope?.id,\n  });\n\n  // Check if user can edit (admin or has access to class scope)\n  const canEdit = user?.role === \"admin\" || digitalKeys.some(key => key.scopeId === classScope?.id);\n\n  const saveMutation = useMutation({\n    mutationFn: async () => {\n      if (!classScope?.id) throw new Error(\"No class scope\");\n      \n      // Only send slots that were actually edited (exist in editedSchedules)\n      const updates = Object.entries(editedSchedules).map(([key, value]) => {\n        const [dayStr, periodStr] = key.split('-');\n        return {\n          dayOfWeek: parseInt(dayStr),\n          periodNumber: parseInt(periodStr),\n          subject: value.subject || null,\n          teacherName: value.teacherName || null,\n        };\n      });\n\n      // Only send if there are actual changes\n      if (updates.length === 0) {\n        setIsEditing(false);\n        return { message: \"No changes to save\" };\n      }\n\n      return apiRequest(\"PATCH\", `/api/schedules/${classScope.id}/bulk`, { updates });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/schedules\", classScope?.id] });\n      setIsEditing(false);\n      setEditedSchedules({});\n      toast({\n        title: \"Schedule updated\",\n        description: \"Your timetable has been saved successfully.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to update schedule. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const days = [\"Sunday\", \"Monday\", \"Tuesday\", \"Wednesday\", \"Thursday\"];\n  const periods = [1, 2, 3, 4, 5, 6, 7];\n\n  const getScheduleForSlot = (dayIndex: number, periodNum: number): Schedule | undefined => {\n    return schedules.find(\n      (s) => s.dayOfWeek === dayIndex + 1 && s.periodNumber === periodNum\n    );\n  };\n\n  const getEditedValue = (dayIndex: number, periodNum: number, field: 'subject' | 'teacherName') => {\n    const key = `${dayIndex + 1}-${periodNum}`;\n    if (editedSchedules[key]) {\n      return editedSchedules[key][field];\n    }\n    const schedule = getScheduleForSlot(dayIndex, periodNum);\n    return schedule?.[field] || null;\n  };\n\n  const updateScheduleSlot = (dayIndex: number, periodNum: number, field: 'subject' | 'teacherName', value: string | null) => {\n    const key = `${dayIndex + 1}-${periodNum}`;\n    setEditedSchedules(prev => ({\n      ...prev,\n      [key]: {\n        subject: field === 'subject' ? value : (prev[key]?.subject || getScheduleForSlot(dayIndex, periodNum)?.subject || null),\n        teacherName: field === 'teacherName' ? value : (prev[key]?.teacherName || getScheduleForSlot(dayIndex, periodNum)?.teacherName || null),\n      }\n    }));\n  };\n\n  // Get teachers who teach the selected subject in the user's section\n  const getTeachersForSubjectAndSection = (subject: string | null): Teacher[] => {\n    if (!subject || !user?.grade || !user?.className) return [];\n    const userSection = `${user.grade}-${user.className}`;\n    return teachers.filter(\n      (teacher) =>\n        teacher.subjects?.includes(subject) &&\n        teacher.sections?.includes(userSection)\n    );\n  };\n\n  // Get events for calendar (RSVPed events + class/grade events)\n  const rsvpedEventIds = useMemo(() => new Set(rsvps.map(r => r.eventId)), [rsvps]);\n  \n  const relevantEvents = useMemo(() => {\n    return events.filter(event => {\n      // Show if user RSVPed\n      if (rsvpedEventIds.has(event.id)) return true;\n      // Show if event is for user's class or grade\n      if (event.scopeId === classScope?.id || event.scopeId === gradeScope?.id) return true;\n      return false;\n    });\n  }, [events, rsvpedEventIds, classScope?.id, gradeScope?.id]);\n\n  // Generate calendar dates (yesterday + next 13 days = 14 days = 2 rows)\n  const today = new Date();\n  const yesterday = new Date(today);\n  yesterday.setDate(yesterday.getDate() - 1);\n  \n  const calendarDates: Date[] = [];\n  for (let i = 0; i < 14; i++) {\n    const date = new Date(yesterday);\n    date.setDate(date.getDate() + i);\n    calendarDates.push(date);\n  }\n\n  // Group events by date\n  const eventsByDate = new Map<string, Event[]>();\n  relevantEvents.forEach(event => {\n    const eventDate = new Date(event.startTime).toDateString();\n    if (!eventsByDate.has(eventDate)) {\n      eventsByDate.set(eventDate, []);\n    }\n    eventsByDate.get(eventDate)!.push(event);\n  });\n\n  if (userLoading) {\n    return (\n      <div className=\"h-full overflow-y-auto\">\n        <div className=\"max-w-7xl mx-auto p-6\">\n          <Skeleton className=\"h-10 w-64 mb-6\" />\n          <Skeleton className=\"h-96 w-full\" />\n        </div>\n      </div>\n    );\n  }\n\n  if (!user?.grade || !user?.className) {\n    return (\n      <div className=\"h-full overflow-y-auto\">\n        <div className=\"max-w-7xl mx-auto p-6\">\n          <Card>\n            <CardContent className=\"flex flex-col items-center justify-center py-12 text-center\">\n              <Calendar className=\"w-12 h-12 text-muted-foreground mb-4\" />\n              <h3 className=\"text-lg font-semibold mb-2\">No Schedule Available</h3>\n              <p className=\"text-sm text-muted-foreground max-w-md\">\n                You need to be assigned to a grade and class to view your schedule.\n              </p>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"h-full overflow-y-auto scrollbar-thin\">\n      <div className=\"max-w-7xl mx-auto px-3 sm:px-4 md:px-6 py-3 sm:py-4 md:py-6 space-y-4 sm:space-y-6\">\n        <div>\n          <h1 className=\"text-2xl sm:text-3xl font-bold flex items-center gap-2 sm:gap-3\">\n            <Calendar className=\"w-6 h-6 sm:w-8 sm:h-8\" />\n            <span className=\"truncate\">Schedule & Events</span>\n          </h1>\n          <p className=\"text-muted-foreground mt-2 text-sm sm:text-base truncate\">\n            Class {user.grade}-{user.className} • {relevantEvents.length} upcoming events\n          </p>\n        </div>\n\n        {/* Calendar with Events */}\n        <Card>\n          <CardHeader className=\"pb-3 sm:pb-4\">\n            <div className=\"flex flex-col sm:flex-row items-start sm:items-start justify-between gap-2 sm:gap-4\">\n              <div className=\"min-w-0\">\n                <CardTitle className=\"text-lg sm:text-xl\">Upcoming Events</CardTitle>\n                <CardDescription className=\"text-xs sm:text-sm\">\n                  Showing events you're attending and events for your class/grade\n                </CardDescription>\n              </div>\n              <div className=\"text-right text-sm sm:text-base font-semibold whitespace-nowrap flex-shrink-0\">\n                {today.toLocaleDateString('en-US', { month: 'short', year: 'numeric' })}\n              </div>\n            </div>\n          </CardHeader>\n          <CardContent>\n            <div className=\"grid grid-cols-7 gap-2\">\n              {calendarDates.map((date, idx) => {\n                const dateStr = date.toDateString();\n                const dayEvents = eventsByDate.get(dateStr) || [];\n                const isToday = dateStr === today.toDateString();\n                const isPast = date < today && !isToday;\n\n                return (\n                  <div\n                    key={idx}\n                    className={`p-2.5 sm:p-3 rounded-lg border-2 text-center transition-all ${\n                      isToday \n                        ? 'bg-gradient-to-b from-primary/20 to-primary/10 border-primary shadow-md' \n                        : isPast \n                          ? 'bg-muted/30 border-muted/40 opacity-75' \n                          : 'bg-card border-border hover:border-primary/50 hover:shadow-md hover:bg-accent/5'\n                    }`}\n                    data-testid={`calendar-day-${idx}`}\n                  >\n                    <div className={`text-xs font-semibold mb-1 ${isToday ? 'text-primary font-bold' : 'text-muted-foreground'}`}>\n                      {date.toLocaleDateString('en-US', { weekday: 'short' })}\n                    </div>\n                    <div className={`text-xl sm:text-2xl font-bold ${isToday ? 'text-primary' : ''}`}>\n                      {date.getDate()}\n                    </div>\n                    <div className=\"mt-2 space-y-1\">\n                      {dayEvents.slice(0, 1).map(event => {\n                        const isRsvped = rsvpedEventIds.has(event.id);\n                        return (\n                          <Link\n                            key={event.id}\n                            href={`/events/${event.id}`}\n                            data-testid={`link-event-badge-${event.id}`}\n                          >\n                            <div\n                              className={`text-xs p-1.5 rounded-md font-medium truncate cursor-pointer transition-all hover-elevate ${\n                                isRsvped ? 'bg-gradient-to-r from-primary to-primary/80 text-primary-foreground shadow-md font-semibold' : 'bg-gradient-to-r from-accent/90 to-accent/70 text-accent-foreground shadow-sm'\n                              }`}\n                              title={event.title}\n                            >\n                              {event.title}\n                            </div>\n                          </Link>\n                        );\n                      })}\n                      {dayEvents.length > 1 && (\n                        <div className=\"text-xs font-bold text-primary bg-primary/10 px-1.5 py-0.5 rounded inline-block\">\n                          +{dayEvents.length - 1} more\n                        </div>\n                      )}\n                    </div>\n                  </div>\n                );\n              })}\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Timetable */}\n        {schedulesLoading ? (\n          <Card>\n            <CardContent className=\"p-6\">\n              <Skeleton className=\"h-96 w-full\" />\n            </CardContent>\n          </Card>\n        ) : (\n          <Card>\n            <CardHeader className=\"pb-3 sm:pb-4\">\n              <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 sm:gap-2\">\n                <div className=\"min-w-0\">\n                  <CardTitle className=\"text-lg sm:text-xl\">Weekly Timetable</CardTitle>\n                  <CardDescription className=\"text-xs sm:text-sm\">\n                    {schedules.length > 0\n                      ? `${schedules.length} class periods scheduled`\n                      : \"No schedule entries yet\"}\n                  </CardDescription>\n                </div>\n                {canEdit && (\n                  <div className=\"flex gap-2 flex-shrink-0\">\n                    {isEditing ? (\n                      <>\n                        <Button\n                          size=\"sm\"\n                          variant=\"outline\"\n                          onClick={() => {\n                            setIsEditing(false);\n                            setEditedSchedules({});\n                          }}\n                          data-testid=\"button-cancel-edit\"\n                        >\n                          <X className=\"w-4 h-4 mr-2\" />\n                          Cancel\n                        </Button>\n                        <Button\n                          size=\"sm\"\n                          onClick={() => saveMutation.mutate()}\n                          disabled={saveMutation.isPending}\n                          data-testid=\"button-save-schedule\"\n                        >\n                          <Save className=\"w-4 h-4 mr-2\" />\n                          {saveMutation.isPending ? \"Saving...\" : \"Save Changes\"}\n                        </Button>\n                      </>\n                    ) : (\n                      <Button\n                        size=\"sm\"\n                        onClick={() => setIsEditing(true)}\n                        data-testid=\"button-edit-schedule\"\n                      >\n                        <Edit className=\"w-4 h-4 mr-2\" />\n                        Edit Schedule\n                      </Button>\n                    )}\n                  </div>\n                )}\n              </div>\n            </CardHeader>\n            <CardContent>\n              <div className=\"overflow-x-auto scrollbar-thin -mx-6 sm:mx-0\">\n                <table className=\"w-full border-collapse text-sm sm:text-base\">\n                  <thead>\n                    <tr className=\"border-b-2 border-border\">\n                      <th className=\"p-2 sm:p-3 text-left text-xs sm:text-sm font-semibold bg-gradient-to-r from-primary/15 to-primary/10 text-primary sticky left-0 z-10 border-r\">Period</th>\n                      {days.map((day) => (\n                        <th key={day} className=\"p-2 sm:p-3 text-center text-xs sm:text-sm font-semibold bg-gradient-to-b from-accent/10 to-accent/5 text-accent-foreground whitespace-nowrap\">\n                          <span className=\"hidden sm:inline\">{day}</span>\n                          <span className=\"sm:hidden\">{day.substring(0, 3)}</span>\n                        </th>\n                      ))}\n                    </tr>\n                  </thead>\n                  <tbody>\n                    {periods.map((period) => (\n                      <tr key={period} className=\"border-b hover:bg-accent/5 transition-colors\">\n                        <td className=\"p-2 sm:p-3 text-xs sm:text-sm font-medium bg-gradient-to-r from-primary/10 to-primary/5 sticky left-0 z-10 border-r text-primary\">\n                          <div className=\"flex items-center gap-1 sm:gap-2\">\n                            <Clock className=\"w-3 h-3 sm:w-4 sm:h-4 flex-shrink-0\" />\n                            <span className=\"hidden sm:inline\">Period {period}</span>\n                            <span className=\"sm:hidden\">P{period}</span>\n                          </div>\n                        </td>\n                        {days.map((day, dayIndex) => {\n                          const currentSubject = getEditedValue(dayIndex, period, 'subject');\n                          const currentTeacher = getEditedValue(dayIndex, period, 'teacherName');\n\n                          return (\n                            <td\n                              key={day}\n                              className=\"p-1 sm:p-2 text-xs sm:text-sm\"\n                              data-testid={`schedule-cell-${dayIndex + 1}-${period}`}\n                            >\n                              {isEditing ? (\n                                <div className=\"space-y-1 p-1 sm:p-2\">\n                                  <Select\n                                    value={currentSubject || \"NONE\"}\n                                    onValueChange={(value) => {\n                                      const newSubject = value === \"NONE\" ? null : value;\n                                      updateScheduleSlot(dayIndex, period, 'subject', newSubject);\n                                      // Reset teacher when subject changes\n                                      updateScheduleSlot(dayIndex, period, 'teacherName', null);\n                                    }}\n                                  >\n                                    <SelectTrigger className=\"h-7 sm:h-8 text-xs\">\n                                      <SelectValue placeholder=\"Select subject\" />\n                                    </SelectTrigger>\n                                    <SelectContent>\n                                      <SelectItem value=\"NONE\">None</SelectItem>\n                                      {SUBJECTS.map((subject) => (\n                                        <SelectItem key={subject} value={subject}>\n                                          {subject}\n                                        </SelectItem>\n                                      ))}\n                                    </SelectContent>\n                                  </Select>\n                                  \n                                  {currentSubject && (\n                                    <Select\n                                      value={currentTeacher || \"NONE\"}\n                                      onValueChange={(value) =>\n                                        updateScheduleSlot(dayIndex, period, 'teacherName', value === \"NONE\" ? null : value)\n                                      }\n                                    >\n                                      <SelectTrigger className=\"h-7 sm:h-8 text-xs\">\n                                        <SelectValue placeholder=\"Select teacher\" />\n                                      </SelectTrigger>\n                                      <SelectContent>\n                                        <SelectItem value=\"NONE\">None</SelectItem>\n                                        {getTeachersForSubjectAndSection(currentSubject).map((teacher) => (\n                                          <SelectItem key={teacher.id} value={teacher.name}>\n                                            {teacher.name}\n                                          </SelectItem>\n                                        ))}\n                                      </SelectContent>\n                                    </Select>\n                                  )}\n                                </div>\n                              ) : currentSubject ? (\n                                <div className=\"space-y-0.5 p-1 sm:p-2 rounded-lg border-2 border-accent/50 bg-gradient-to-br from-accent/15 to-accent/5 hover-elevate\">\n                                  <div className=\"flex items-center gap-1 font-semibold line-clamp-1 text-accent-foreground\">\n                                    <BookOpen className=\"w-3 h-3 flex-shrink-0\" />\n                                    <span className=\"truncate text-xs sm:text-sm\">{currentSubject}</span>\n                                  </div>\n                                  {currentTeacher && (\n                                    <div className=\"flex items-center gap-1 text-accent-foreground/70 line-clamp-1 text-xs\">\n                                      <UserIcon className=\"w-3 h-3 flex-shrink-0\" />\n                                      <span className=\"truncate\">{currentTeacher}</span>\n                                    </div>\n                                  )}\n                                </div>\n                              ) : (\n                                <div className=\"p-1 sm:p-2 text-center text-muted-foreground\">\n                                  —\n                                </div>\n                              )}\n                            </td>\n                          );\n                        })}\n                      </tr>\n                    ))}\n                  </tbody>\n                </table>\n              </div>\n\n              {schedules.length === 0 && !isEditing && (\n                <div className=\"mt-8 text-center\">\n                  <Calendar className=\"w-12 h-12 text-muted-foreground mx-auto mb-4\" />\n                  <p className=\"text-sm text-muted-foreground\">\n                    No schedule entries have been created yet for your class.\n                  </p>\n                  {canEdit && (\n                    <p className=\"text-sm text-muted-foreground mt-2\">\n                      Click \"Edit Schedule\" to start building your timetable.\n                    </p>\n                  )}\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        )}\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":22741,"size_tokens":null},"client/src/pages/class-detail.tsx":{"content":"import { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Avatar, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Users, Calendar, Newspaper, Lock, ArrowLeft } from \"lucide-react\";\nimport { Link, useParams } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport type { Scope } from \"@shared/schema\";\nimport { useHasAccessToScope } from \"@/hooks/use-digital-keys\";\n\ntype Post = {\n  id: string;\n  content: string;\n  authorId: string;\n  scopeId?: string;\n  credibilityRating: number;\n  likesCount: number;\n  commentsCount: number;\n  createdAt: string;\n  author: {\n    name: string;\n    role: string;\n    avatarUrl?: string;\n  };\n};\n\ntype Event = {\n  id: string;\n  title: string;\n  description: string;\n  type: \"curricular\" | \"extracurricular\";\n  startTime: string;\n  endTime: string;\n  location?: string;\n};\n\ntype Student = {\n  id: string;\n  name: string;\n  username: string;\n  credibilityScore: number;\n  reputationScore: number;\n  avatarUrl?: string;\n};\n\nexport default function ClassDetail() {\n  const { gradeNumber, className } = useParams();\n  const grade = parseInt(gradeNumber || \"1\");\n\n  // Fetch all scopes to find this class's scope\n  const { data: scopes } = useQuery<Scope[]>({\n    queryKey: [\"/api/scopes\"],\n  });\n\n  // Find the scope for this class\n  const classScope = scopes?.find(s => s.name === `Class ${grade}-${className}`);\n  const hasAccess = useHasAccessToScope(classScope?.id);\n\n  const { data: posts = [], isLoading: postsLoading } = useQuery<Post[]>({\n    queryKey: [\"/api/posts\", classScope?.id],\n    queryFn: async () => {\n      if (!classScope?.id) return [];\n      const response = await fetch(`/api/posts?scopeId=${classScope.id}`);\n      if (!response.ok) throw new Error(\"Failed to fetch posts\");\n      return response.json();\n    },\n    enabled: !!classScope?.id && hasAccess,\n  });\n\n  const { data: events = [], isLoading: eventsLoading } = useQuery<Event[]>({\n    queryKey: [\"/api/events\", classScope?.id],\n    queryFn: async () => {\n      if (!classScope?.id) return [];\n      const response = await fetch(`/api/events?scopeId=${classScope.id}`);\n      if (!response.ok) throw new Error(\"Failed to fetch events\");\n      return response.json();\n    },\n    enabled: !!classScope?.id && hasAccess,\n  });\n\n  const { data: students, isLoading: studentsLoading } = useQuery<Student[]>({\n    queryKey: [`/api/classes/${grade}/${className}/students`],\n  });\n\n  const getUserInitials = (name: string) => {\n    return name\n      .split(\" \")\n      .map((n) => n[0])\n      .join(\"\")\n      .toUpperCase()\n      .slice(0, 2);\n  };\n\n  return (\n    <div className=\"h-full overflow-y-auto\">\n      <div className=\"max-w-7xl mx-auto p-6 space-y-8\">\n        {/* Header */}\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <div className=\"flex items-center gap-3\">\n              <h1 className=\"text-3xl font-bold\">Class {grade}-{className}</h1>\n              <Badge variant=\"outline\" className=\"text-lg px-3 py-1\">\n                Grade {grade}\n              </Badge>\n            </div>\n            <p className=\"text-muted-foreground mt-2\">\n              News, events, and students in Class {grade}-{className}\n            </p>\n          </div>\n          <Button variant=\"outline\" asChild data-testid=\"button-back-to-grade\">\n            <Link href={`/grades/${grade}`}>\n              <ArrowLeft className=\"w-4 h-4 mr-2\" />\n              Back to Grade {grade}\n            </Link>\n          </Button>\n        </div>\n\n        {/* Students Section */}\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Users className=\"w-5 h-5\" />\n              Students in Class {grade}-{className}\n            </CardTitle>\n            <CardDescription>\n              View profiles and stats for all students in this class\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            {studentsLoading ? (\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                {[1, 2, 3, 4, 5, 6].map((i) => (\n                  <Card key={i}>\n                    <CardHeader className=\"flex flex-row items-center gap-3\">\n                      <Skeleton className=\"w-12 h-12 rounded-full\" />\n                      <div className=\"space-y-2 flex-1\">\n                        <Skeleton className=\"h-4 w-3/4\" />\n                        <Skeleton className=\"h-3 w-1/2\" />\n                      </div>\n                    </CardHeader>\n                  </Card>\n                ))}\n              </div>\n            ) : students && students.length > 0 ? (\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                {students.map((student) => (\n                  <Link key={student.id} href={`/profile/${student.id}`}>\n                    <Card \n                      className=\"hover-elevate active-elevate-2 cursor-pointer\"\n                      data-testid={`card-student-${student.id}`}\n                    >\n                      <CardHeader className=\"flex flex-row items-center gap-3\">\n                        <Avatar className=\"w-12 h-12\">\n                          <AvatarFallback>{getUserInitials(student.name)}</AvatarFallback>\n                        </Avatar>\n                        <div className=\"flex-1 min-w-0\">\n                          <p className=\"font-semibold truncate\">{student.name}</p>\n                          <p className=\"text-sm text-muted-foreground truncate\">\n                            @{student.username}\n                          </p>\n                        </div>\n                      </CardHeader>\n                    </Card>\n                  </Link>\n                ))}\n              </div>\n            ) : (\n              <Card className=\"border-dashed\">\n                <CardContent className=\"flex flex-col items-center justify-center py-12 text-center\">\n                  <Users className=\"w-12 h-12 text-muted-foreground mb-4\" />\n                  <p className=\"text-muted-foreground\">\n                    No students enrolled in Class {grade}-{className} yet\n                  </p>\n                </CardContent>\n              </Card>\n            )}\n          </CardContent>\n        </Card>\n\n        {/* News & Events Tabs */}\n        <Tabs defaultValue=\"news\" className=\"w-full\">\n          <TabsList className=\"grid w-full max-w-md grid-cols-2\">\n            <TabsTrigger value=\"news\" data-testid=\"tab-class-news\">\n              <Newspaper className=\"w-4 h-4 mr-2\" />\n              Class News\n            </TabsTrigger>\n            <TabsTrigger value=\"events\" data-testid=\"tab-class-events\">\n              <Calendar className=\"w-4 h-4 mr-2\" />\n              Class Events\n            </TabsTrigger>\n          </TabsList>\n\n          <TabsContent value=\"news\" className=\"space-y-4 mt-6\">\n            {postsLoading ? (\n              <div className=\"space-y-4\">\n                {[1, 2].map((i) => (\n                  <Card key={i}>\n                    <CardHeader>\n                      <Skeleton className=\"h-6 w-3/4\" />\n                      <Skeleton className=\"h-4 w-1/2 mt-2\" />\n                    </CardHeader>\n                    <CardContent>\n                      <Skeleton className=\"h-20 w-full\" />\n                    </CardContent>\n                  </Card>\n                ))}\n              </div>\n            ) : posts && posts.length > 0 ? (\n              <div className=\"space-y-4\">\n                {posts.map((post) => (\n                  <Card key={post.id}>\n                    <CardHeader>\n                      <div className=\"flex items-center gap-2\">\n                        <span className=\"font-semibold\">{post.author.name}</span>\n                        <Badge variant=\"outline\" className=\"text-xs\">\n                          {post.author.role}\n                        </Badge>\n                        <Badge variant=\"secondary\">\n                          Credibility: {post.credibilityRating}\n                        </Badge>\n                      </div>\n                      <span className=\"text-sm text-muted-foreground\">\n                        {new Date(post.createdAt).toLocaleDateString()}\n                      </span>\n                    </CardHeader>\n                    <CardContent>\n                      <p className=\"text-muted-foreground\">{post.content}</p>\n                    </CardContent>\n                  </Card>\n                ))}\n              </div>\n            ) : (\n              <Card>\n                <CardContent className=\"flex flex-col items-center justify-center py-12 text-center\">\n                  <Newspaper className=\"w-12 h-12 text-muted-foreground mb-4\" />\n                  <p className=\"text-muted-foreground\">\n                    No news posts yet for Class {grade}-{className}\n                  </p>\n                </CardContent>\n              </Card>\n            )}\n          </TabsContent>\n\n          <TabsContent value=\"events\" className=\"space-y-4 mt-6\">\n            {eventsLoading ? (\n              <div className=\"space-y-4\">\n                {[1].map((i) => (\n                  <Card key={i}>\n                    <CardHeader>\n                      <Skeleton className=\"h-6 w-3/4\" />\n                      <Skeleton className=\"h-4 w-1/2 mt-2\" />\n                    </CardHeader>\n                    <CardContent>\n                      <Skeleton className=\"h-16 w-full\" />\n                    </CardContent>\n                  </Card>\n                ))}\n              </div>\n            ) : events && events.length > 0 ? (\n              <div className=\"space-y-4\">\n                {events.map((event) => (\n                  <Card key={event.id}>\n                    <CardHeader>\n                      <div className=\"flex items-center justify-between\">\n                        <CardTitle>{event.title}</CardTitle>\n                        <Badge variant={event.type === \"curricular\" ? \"default\" : \"secondary\"}>\n                          {event.type}\n                        </Badge>\n                      </div>\n                      <CardDescription>\n                        {new Date(event.startTime).toLocaleString()}\n                        {event.location && ` • ${event.location}`}\n                      </CardDescription>\n                    </CardHeader>\n                    <CardContent>\n                      <p className=\"text-muted-foreground\">{event.description}</p>\n                    </CardContent>\n                  </Card>\n                ))}\n              </div>\n            ) : (\n              <Card>\n                <CardContent className=\"flex flex-col items-center justify-center py-12 text-center\">\n                  <Calendar className=\"w-12 h-12 text-muted-foreground mb-4\" />\n                  <p className=\"text-muted-foreground\">\n                    No events scheduled yet for Class {grade}-{className}\n                  </p>\n                </CardContent>\n              </Card>\n            )}\n          </TabsContent>\n        </Tabs>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":11316,"size_tokens":null},"client/src/pages/settings.tsx":{"content":"import { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Label } from \"@/components/ui/label\";\nimport { Button } from \"@/components/ui/button\";\nimport { useTheme } from \"@/contexts/theme\";\nimport { Moon, Sun, Key } from \"lucide-react\";\nimport { Link } from \"wouter\";\n\nexport default function SettingsPage() {\n  const { theme, toggleTheme } = useTheme();\n\n  return (\n    <div className=\"h-full overflow-y-auto bg-gradient-to-br from-background via-background to-muted/20\">\n      <div className=\"max-w-4xl mx-auto px-4 py-6 space-y-6\">\n        <div>\n          <h1 className=\"text-3xl font-bold tracking-tight\">Settings</h1>\n          <p className=\"text-sm text-muted-foreground mt-0.5\">\n            Manage your preferences and account settings\n          </p>\n        </div>\n\n        {/* Theme Settings */}\n        <Card className=\"hover-elevate\" data-testid=\"card-theme-settings\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              {theme === \"dark\" ? (\n                <Moon className=\"w-5 h-5\" />\n              ) : (\n                <Sun className=\"w-5 h-5\" />\n              )}\n              Theme\n            </CardTitle>\n            <CardDescription>\n              Choose between light and dark mode\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div className=\"flex items-center justify-between p-3 rounded-lg border border-border\">\n              <div>\n                <Label className=\"font-semibold text-sm\">Night Theme</Label>\n                <p className=\"text-xs text-muted-foreground mt-0.5\">\n                  Currently using {theme === \"dark\" ? \"dark\" : \"light\"} mode\n                </p>\n              </div>\n              <Button\n                onClick={toggleTheme}\n                variant=\"default\"\n                className=\"gap-2\"\n                data-testid=\"button-toggle-theme\"\n              >\n                {theme === \"dark\" ? (\n                  <>\n                    <Sun className=\"w-4 h-4\" />\n                    Light Mode\n                  </>\n                ) : (\n                  <>\n                    <Moon className=\"w-4 h-4\" />\n                    Dark Mode\n                  </>\n                )}\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Digital Keys */}\n        <Card className=\"hover-elevate\" data-testid=\"card-digital-keys\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Key className=\"w-5 h-5\" />\n              Digital Keys\n            </CardTitle>\n            <CardDescription>\n              Manage your access keys and permissions\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <Link href=\"/keys\">\n              <Button variant=\"default\" data-testid=\"button-manage-keys\">\n                Manage Keys\n              </Button>\n            </Link>\n          </CardContent>\n        </Card>\n\n        {/* Account Settings */}\n        <Card className=\"hover-elevate\" data-testid=\"card-account-settings\">\n          <CardHeader>\n            <CardTitle>Account Settings</CardTitle>\n            <CardDescription>\n              Manage your account preferences\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <p className=\"text-sm text-muted-foreground\">\n              Additional account settings coming soon...\n            </p>\n          </CardContent>\n        </Card>\n\n        {/* Privacy & Security */}\n        <Card className=\"hover-elevate\" data-testid=\"card-privacy-settings\">\n          <CardHeader>\n            <CardTitle>Privacy & Security</CardTitle>\n            <CardDescription>\n              Control your privacy settings\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <p className=\"text-sm text-muted-foreground\">\n              Privacy and security settings coming soon...\n            </p>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":4110,"size_tokens":null},"client/src/pages/grades.tsx":{"content":"import { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Users, BookOpen } from \"lucide-react\";\nimport { Link } from \"wouter\";\n\nexport default function Grades() {\n  const grades = [\n    { number: 1, description: \"First Grade\" },\n    { number: 2, description: \"Second Grade\" },\n    { number: 3, description: \"Third Grade\" },\n    { number: 4, description: \"Fourth Grade\" },\n    { number: 5, description: \"Fifth Grade\" },\n    { number: 6, description: \"Sixth Grade\" },\n  ];\n\n  return (\n    <div className=\"h-full overflow-y-auto\">\n      <div className=\"max-w-7xl mx-auto p-6 space-y-8\">\n        <div>\n          <h1 className=\"text-3xl font-bold\">Grades</h1>\n          <p className=\"text-muted-foreground mt-2\">\n            Explore news, events, and classes for each grade level\n          </p>\n        </div>\n\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n          {grades.map((grade) => (\n            <Link \n              key={grade.number} \n              href={`/grades/${grade.number}`}\n              data-testid={`card-grade-${grade.number}`}\n            >\n              <Card className=\"hover-elevate active-elevate-2 transition-all cursor-pointer\">\n                <CardHeader>\n                  <div className=\"flex items-center justify-between\">\n                    <CardTitle className=\"text-2xl\">Grade {grade.number}</CardTitle>\n                    <Badge variant=\"outline\" className=\"text-lg px-3 py-1\">\n                      {grade.number}\n                    </Badge>\n                  </div>\n                  <CardDescription>{grade.description}</CardDescription>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"flex items-center gap-6 text-sm text-muted-foreground\">\n                    <div className=\"flex items-center gap-2\">\n                      <BookOpen className=\"w-4 h-4\" />\n                      <span>Classes</span>\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                      <Users className=\"w-4 h-4\" />\n                      <span>Students</span>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            </Link>\n          ))}\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":2386,"size_tokens":null},"client/src/pages/teachers.tsx":{"content":"import { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Avatar, AvatarImage, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Link } from \"wouter\";\nimport { Star, Plus, UserPlus, Trash2 } from \"lucide-react\";\nimport { useUser } from \"@/hooks/use-user\";\nimport { useState } from \"react\";\nimport { TeacherManagementDialog } from \"@/components/TeacherManagementDialog\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\n\ntype Teacher = {\n  id: string;\n  name: string;\n  photoUrl: string | null;\n  description: string | null;\n  academicAchievements: string[] | null;\n};\n\ntype TeacherWithStats = {\n  teacher: Teacher;\n  reviews: any[];\n  averageRating: number;\n};\n\nexport default function TeachersPage() {\n  const { user } = useUser();\n  const { toast } = useToast();\n  const [isManagementOpen, setIsManagementOpen] = useState(false);\n  const [selectedTeacher, setSelectedTeacher] = useState<Teacher | null>(null);\n  const [teacherToDelete, setTeacherToDelete] = useState<Teacher | null>(null);\n\n  const { data: teachers, isLoading } = useQuery<Teacher[]>({\n    queryKey: [\"/api/teachers\"],\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (teacherId: string) => {\n      await apiRequest(\"DELETE\", `/api/admin/teacher/${teacherId}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/teachers\"] });\n      toast({\n        title: \"Success\",\n        description: \"Teacher account has been deleted\",\n      });\n      setTeacherToDelete(null);\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to delete teacher account\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleAddTeacher = () => {\n    setSelectedTeacher(null);\n    setIsManagementOpen(true);\n  };\n\n  const handleEditTeacher = (teacher: Teacher) => {\n    setSelectedTeacher(teacher);\n    setIsManagementOpen(true);\n  };\n\n  const handleDeleteTeacher = (teacher: Teacher) => {\n    setTeacherToDelete(teacher);\n  };\n\n  const renderStars = (rating: number) => {\n    const stars = [];\n    const fullStars = Math.floor(rating);\n    const hasHalfStar = rating % 1 >= 0.5;\n\n    for (let i = 0; i < 5; i++) {\n      if (i < fullStars) {\n        stars.push(\n          <Star key={i} className=\"w-4 h-4 fill-yellow-400 text-yellow-400\" data-testid={`star-full-${i}`} />\n        );\n      } else if (i === fullStars && hasHalfStar) {\n        stars.push(\n          <Star key={i} className=\"w-4 h-4 fill-yellow-400/50 text-yellow-400\" data-testid={`star-half-${i}`} />\n        );\n      } else {\n        stars.push(\n          <Star key={i} className=\"w-4 h-4 text-muted-foreground\" data-testid={`star-empty-${i}`} />\n        );\n      }\n    }\n    return stars;\n  };\n\n  return (\n    <div className=\"container mx-auto p-6 max-w-7xl space-y-6\">\n      <div className=\"flex items-center justify-between\">\n        <div className=\"space-y-2\">\n          <h1 className=\"text-4xl font-bold tracking-tight\" data-testid=\"text-page-title\">Teachers</h1>\n          <p className=\"text-base text-muted-foreground\">Browse teacher profiles and student reviews</p>\n        </div>\n        {user?.role === \"admin\" && (\n          <Button onClick={handleAddTeacher} data-testid=\"button-add-teacher\">\n            <Plus className=\"w-4 h-4 mr-2\" />\n            Add Teacher\n          </Button>\n        )}\n      </div>\n\n      {isLoading ? (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n          {[1, 2, 3].map((i) => (\n            <Card key={i} className=\"animate-pulse\" data-testid={`skeleton-teacher-${i}`}>\n              <CardContent className=\"p-6\">\n                <div className=\"flex items-start gap-4\">\n                  <div className=\"w-16 h-16 rounded-full bg-muted\" />\n                  <div className=\"flex-1 space-y-2\">\n                    <div className=\"h-5 bg-muted rounded w-3/4\" />\n                    <div className=\"h-4 bg-muted rounded w-1/2\" />\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      ) : teachers && teachers.length > 0 ? (\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n          {teachers.map((teacher) => (\n            <Card\n              key={teacher.id}\n              className=\"hover-elevate cursor-pointer\"\n              data-testid={`card-teacher-${teacher.id}`}\n            >\n              <Link href={`/teachers/${teacher.id}`}>\n                <CardContent className=\"p-6\">\n                  <div className=\"flex items-start gap-4\">\n                    <Avatar className=\"w-16 h-16\" data-testid={`avatar-teacher-${teacher.id}`}>\n                      <AvatarImage src={teacher.photoUrl || undefined} alt={teacher.name} />\n                      <AvatarFallback>\n                        {teacher.name.split(\" \").map(n => n[0]).join(\"\").slice(0, 2)}\n                      </AvatarFallback>\n                    </Avatar>\n                    <div className=\"flex-1 min-w-0\">\n                      <h3 className=\"font-semibold text-lg mb-1 truncate\" data-testid={`text-teacher-name-${teacher.id}`}>\n                        {teacher.name}\n                      </h3>\n                      \n                      {teacher.academicAchievements && teacher.academicAchievements.length > 0 && (\n                        <div className=\"flex flex-wrap gap-1 mb-2\">\n                          {teacher.academicAchievements.slice(0, 2).map((achievement, idx) => (\n                            <Badge\n                              key={idx}\n                              variant=\"secondary\"\n                              className=\"text-xs\"\n                              data-testid={`badge-achievement-${teacher.id}-${idx}`}\n                            >\n                              {achievement}\n                            </Badge>\n                          ))}\n                          {teacher.academicAchievements.length > 2 && (\n                            <Badge variant=\"secondary\" className=\"text-xs\" data-testid={`badge-more-achievements-${teacher.id}`}>\n                              +{teacher.academicAchievements.length - 2} more\n                            </Badge>\n                          )}\n                        </div>\n                      )}\n                      \n                      {teacher.description && (\n                        <p className=\"text-sm text-muted-foreground line-clamp-2 mb-2\" data-testid={`text-description-${teacher.id}`}>\n                          {teacher.description}\n                        </p>\n                      )}\n                      \n                      <div className=\"text-sm text-muted-foreground\" data-testid={`text-view-reviews-${teacher.id}`}>\n                        Click to view reviews\n                      </div>\n                    </div>\n                  </div>\n                  \n                  {user?.role === \"admin\" && (\n                    <div className=\"mt-4 pt-4 border-t flex gap-2\">\n                      <Button\n                        variant=\"outline\"\n                        size=\"sm\"\n                        onClick={(e) => {\n                          e.preventDefault();\n                          handleEditTeacher(teacher);\n                        }}\n                        data-testid={`button-edit-teacher-${teacher.id}`}\n                      >\n                        Edit\n                      </Button>\n                      <Button\n                        variant=\"outline\"\n                        size=\"sm\"\n                        onClick={(e) => {\n                          e.preventDefault();\n                          handleDeleteTeacher(teacher);\n                        }}\n                        data-testid={`button-delete-teacher-${teacher.id}`}\n                      >\n                        <Trash2 className=\"w-4 h-4\" />\n                      </Button>\n                    </div>\n                  )}\n                </CardContent>\n              </Link>\n            </Card>\n          ))}\n        </div>\n      ) : (\n        <Card>\n          <CardContent className=\"p-12 text-center\">\n            <UserPlus className=\"w-12 h-12 mx-auto mb-4 text-muted-foreground\" />\n            <h3 className=\"text-lg font-semibold mb-2\" data-testid=\"text-no-teachers\">No Teachers Yet</h3>\n            <p className=\"text-muted-foreground mb-4\">\n              {user?.role === \"admin\" \n                ? \"Add the first teacher profile to get started.\"\n                : \"Teacher profiles will appear here once they are added.\"}\n            </p>\n            {user?.role === \"admin\" && (\n              <Button onClick={handleAddTeacher} data-testid=\"button-add-first-teacher\">\n                <Plus className=\"w-4 h-4 mr-2\" />\n                Add First Teacher\n              </Button>\n            )}\n          </CardContent>\n        </Card>\n      )}\n\n      <TeacherManagementDialog\n        open={isManagementOpen}\n        onOpenChange={setIsManagementOpen}\n        teacher={selectedTeacher}\n      />\n\n      <AlertDialog open={!!teacherToDelete} onOpenChange={(open) => !open && setTeacherToDelete(null)}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle>Delete Teacher Account</AlertDialogTitle>\n            <AlertDialogDescription>\n              Are you sure you want to delete <strong>{teacherToDelete?.name}</strong>? This will permanently remove their account and all associated data including reviews and posts. This action cannot be undone.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <div className=\"flex gap-3 justify-end\">\n            <AlertDialogCancel>Cancel</AlertDialogCancel>\n            <AlertDialogAction\n              onClick={() => {\n                if (teacherToDelete) {\n                  deleteMutation.mutate(teacherToDelete.id);\n                }\n              }}\n              disabled={deleteMutation.isPending}\n              className=\"bg-destructive text-destructive-foreground hover:bg-destructive/90\"\n            >\n              {deleteMutation.isPending ? \"Deleting...\" : \"Delete\"}\n            </AlertDialogAction>\n          </div>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":10719,"size_tokens":null},"client/src/pages/news.tsx":{"content":"import { useState, useEffect, useMemo } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Button } from \"@/components/ui/button\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Card, CardContent, CardHeader, CardFooter } from \"@/components/ui/card\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Heart, MessageSquare, Send, TrendingUp, Star, ChevronDown, ChevronUp, Edit2, X, Trash2, Filter } from \"lucide-react\";\nimport { formatDistanceToNow } from \"date-fns\";\nimport { ScopeSelector } from \"@/components/ScopeSelector\";\nimport { useHasAccessToScope } from \"@/hooks/use-digital-keys\";\nimport { UserProfileLink } from \"@/components/UserProfileLink\";\nimport { Collapsible, CollapsibleContent, CollapsibleTrigger } from \"@/components/ui/collapsible\";\nimport { Input } from \"@/components/ui/input\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription, DialogFooter } from \"@/components/ui/dialog\";\n\ntype Post = {\n  id: string;\n  content: string;\n  authorId: string;\n  scopeId: string | null;\n  credibilityRating: number;\n  authorCredibilityScore: number;\n  mediaUrl: string | null;\n  mediaType: string | null;\n  createdAt: string;\n  likesCount: number;\n  commentsCount: number;\n  authorName: string;\n  authorRole: string;\n  authorAvatarUrl: string | null;\n  isLikedByCurrentUser: boolean;\n  currentUserAccuracyRating?: number | null;\n  author: {\n    name: string;\n    role: string;\n    avatarUrl: string | null;\n    averageRating: number | null;\n  };\n};\n\nexport default function NewsPage() {\n  const { toast } = useToast();\n  const [newPost, setNewPost] = useState(\"\");\n  const [sortBy, setSortBy] = useState<\"newest\" | \"oldest\" | \"mostLiked\" | \"highestCredibility\">(\"newest\");\n  \n  // Fetch scopes to find public scope for default selection\n  const { data: scopes = [] } = useQuery<Array<{ id: string; type: string; name: string }>>({\n    queryKey: [\"/api/scopes\"],\n  });\n\n  // Find public scope\n  const publicScope = scopes.find((s) => s.type === \"public\");\n  \n  // Initialize selected scope to public scope by default\n  const [selectedScope, setSelectedScope] = useState<string | null>(() => publicScope?.id || null);\n  \n  const [showCommentsForPostId, setShowCommentsForPostId] = useState<string | null>(null);\n  const [commentText, setCommentText] = useState<{ [postId: string]: string }>({});\n  const [editingPostId, setEditingPostId] = useState<string | null>(null);\n  const [editContent, setEditContent] = useState(\"\");\n  const [isCreatePostOpen, setIsCreatePostOpen] = useState(false);\n\n  // Update selected scope when public scope loads (in case it wasn't available on mount)\n  useEffect(() => {\n    if (publicScope && selectedScope === null) {\n      setSelectedScope(publicScope.id);\n    }\n  }, [publicScope?.id]);\n\n  // Check if user has access to selected scope\n  const hasAccess = useHasAccessToScope(selectedScope);\n\n  // Fetch news posts for the selected scope (or all global posts if no scope selected)\n  const { data: rawPosts = [], isLoading } = useQuery<Post[]>({\n    queryKey: [\"/api/posts\", selectedScope],\n    queryFn: async () => {\n      const scopeParam = selectedScope === null ? \"null\" : selectedScope;\n      const response = await fetch(`/api/posts?scopeId=${scopeParam}`);\n      if (!response.ok) throw new Error(\"Failed to fetch posts\");\n      return response.json();\n    },\n  });\n\n  // Sort posts based on selected criteria\n  const posts = useMemo(() => {\n    const sorted = [...rawPosts];\n    switch (sortBy) {\n      case \"newest\":\n        return sorted.sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime());\n      case \"oldest\":\n        return sorted.sort((a, b) => new Date(a.createdAt).getTime() - new Date(b.createdAt).getTime());\n      case \"mostLiked\":\n        return sorted.sort((a, b) => b.likesCount - a.likesCount);\n      case \"highestCredibility\":\n        return sorted.sort((a, b) => b.authorCredibilityScore - a.authorCredibilityScore);\n      default:\n        return sorted;\n    }\n  }, [rawPosts, sortBy]);\n\n  // Get current user info\n  const { data: user } = useQuery<{\n    id: string;\n    name: string;\n    email: string;\n    role: string;\n    avatarUrl: string | null;\n  }>({\n    queryKey: [\"/api/auth/me\"],\n  });\n\n  const toggleLikeMutation = useMutation({\n    mutationFn: async (postId: string) => {\n      return await apiRequest(\"POST\", `/api/posts/${postId}/like`);\n    },\n    onSuccess: () => {\n      // Refetch posts to get updated likes count and status\n      queryClient.invalidateQueries({ queryKey: [\"/api/posts\", selectedScope] });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Failed to update like\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const createPostMutation = useMutation({\n    mutationFn: async (content: string) => {\n      return await apiRequest(\"POST\", \"/api/posts\", {\n        content,\n        scopeId: selectedScope,\n      });\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Post published\",\n        description: \"Your news has been shared successfully\",\n      });\n      setNewPost(\"\");\n      queryClient.invalidateQueries({ queryKey: [\"/api/posts\", selectedScope] });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Failed to post\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const rateAccuracyMutation = useMutation({\n    mutationFn: async (data: { postId: string; rating: number }) => {\n      return await apiRequest(\"POST\", `/api/posts/${data.postId}/rate-accuracy`, { rating: data.rating });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/posts\", selectedScope] });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Failed to rate post accuracy\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updatePostMutation = useMutation({\n    mutationFn: async (data: { postId: string; content: string }) => {\n      return await apiRequest(\"PATCH\", `/api/posts/${data.postId}`, { content: data.content });\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Post updated\",\n        description: \"Your post has been edited successfully\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/posts\", selectedScope] });\n      setEditingPostId(null);\n      setEditContent(\"\");\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Failed to update post\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleToggleLike = (postId: string) => {\n    toggleLikeMutation.mutate(postId);\n  };\n\n  const handleEditPost = (post: Post) => {\n    setEditingPostId(post.id);\n    setEditContent(post.content);\n  };\n\n  const handleSaveEdit = () => {\n    if (editContent.trim() && editingPostId) {\n      updatePostMutation.mutate({ postId: editingPostId, content: editContent });\n    }\n  };\n\n  const handleRatePostAccuracy = (postId: string, rating: number) => {\n    rateAccuracyMutation.mutate({ postId, rating });\n  }\n\n  const deletePostMutation = useMutation({\n    mutationFn: async (postId: string) => {\n      return await apiRequest(\"DELETE\", `/api/posts/${postId}`);\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Post deleted\",\n        description: \"The post has been removed successfully\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/posts\", selectedScope] });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Failed to delete post\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleDeletePost = (postId: string) => {\n    if (window.confirm(\"Are you sure you want to delete this post?\")) {\n      deletePostMutation.mutate(postId);\n    }\n  };\n\n  const isPostAuthor = (authorId: string): boolean => {\n    return user?.id === authorId;\n  };\n\n  const isAdmin = (): boolean => {\n    return user?.role === \"admin\";\n  };\n\n  const handleSubmitPost = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (newPost.trim()) {\n      createPostMutation.mutate(newPost);\n    }\n  };\n\n  const getCredibilityColor = (rating: number) => {\n    if (rating >= 75) return \"text-green-600 dark:text-green-400\";\n    if (rating >= 50) return \"text-yellow-600 dark:text-yellow-400\";\n    if (rating >= 25) return \"text-orange-600 dark:text-orange-400\";\n    return \"text-red-600 dark:text-red-400\";\n  };\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 sm:py-8 space-y-6\">\n        <div>\n          <h1 className=\"text-3xl sm:text-4xl font-bold mb-2\">Public Square</h1>\n          <p className=\"text-sm sm:text-base text-muted-foreground\">\n            Share news and updates with the entire school community\n          </p>\n        </div>\n\n        {/* Create Post Card - Collapsible */}\n        <Collapsible open={isCreatePostOpen} onOpenChange={setIsCreatePostOpen}>\n          <Card className=\"transition-all duration-300 ease-out\" data-testid=\"card-create-post\">\n            <CollapsibleTrigger asChild>\n              <CardHeader className=\"cursor-pointer hover-elevate py-3 sm:py-4\">\n                <div className=\"flex items-center justify-between gap-3\">\n                  <div className=\"flex items-center gap-3\">\n                    <Avatar className=\"h-10 w-10\">\n                      <AvatarImage src={user?.avatarUrl || undefined} />\n                      <AvatarFallback>{user?.name?.charAt(0) || \"U\"}</AvatarFallback>\n                    </Avatar>\n                    <div>\n                      <p className=\"font-medium\">{user?.name || \"User\"}</p>\n                      <Badge variant=\"secondary\" className=\"text-xs\">\n                        {user?.role || \"student\"}\n                      </Badge>\n                    </div>\n                  </div>\n                  <div className=\"text-muted-foreground transition-transform duration-300\" style={{\n                    transform: isCreatePostOpen ? \"rotate(180deg)\" : \"rotate(0deg)\"\n                  }}>\n                    <ChevronDown className=\"w-5 h-5\" />\n                  </div>\n                </div>\n              </CardHeader>\n            </CollapsibleTrigger>\n            <CollapsibleContent>\n              <form onSubmit={handleSubmitPost}>\n                <CardContent className=\"space-y-4 animate-in fade-in duration-300\">\n                  <div className=\"space-y-1\">\n                    <Textarea\n                      placeholder=\"What's happening in our school community?\"\n                      value={newPost}\n                      onChange={(e) => setNewPost(e.target.value)}\n                      className=\"min-h-24 resize-none border-0 text-base focus-visible:ring-0\"\n                      data-testid=\"textarea-new-post\"\n                      maxLength={4000}\n                    />\n                    <div className=\"flex justify-end\">\n                      <span className={`text-xs ${newPost.length > 4000 ? \"text-destructive\" : \"text-muted-foreground\"}`} data-testid=\"text-character-count\">\n                        {newPost.length}/4000\n                      </span>\n                    </div>\n                  </div>\n                  <Separator />\n                  <ScopeSelector\n                    value={selectedScope}\n                    onChange={setSelectedScope}\n                    label=\"Post to\"\n                    placeholder=\"Select where to post\"\n                  />\n                </CardContent>\n                <CardFooter className=\"justify-end animate-in fade-in duration-300\">\n                  <Button\n                    type=\"submit\"\n                    disabled={!newPost.trim() || newPost.length > 4000 || createPostMutation.isPending || (selectedScope !== null && !hasAccess)}\n                    data-testid=\"button-submit-post\"\n                  >\n                    <Send className=\"w-4 h-4 mr-2\" />\n                    {createPostMutation.isPending ? \"Posting...\" : \"Post\"}\n                  </Button>\n                </CardFooter>\n              </form>\n            </CollapsibleContent>\n          </Card>\n        </Collapsible>\n\n        {/* News Feed */}\n        <div className=\"space-y-4 sm:space-y-6\">\n          <div className=\"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4\">\n            <h2 className=\"text-xl sm:text-2xl font-semibold flex items-center gap-2\">\n              <TrendingUp className=\"w-5 h-5\" />\n              Latest News\n            </h2>\n            <div className=\"flex items-center gap-2 w-full sm:w-auto\">\n              <Filter className=\"w-4 h-4 text-muted-foreground\" />\n              <Select value={sortBy} onValueChange={(value: typeof sortBy) => setSortBy(value)}>\n                <SelectTrigger className=\"w-full sm:w-[200px]\" data-testid=\"select-sort-news\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"newest\">Newest First</SelectItem>\n                  <SelectItem value=\"oldest\">Oldest First</SelectItem>\n                  <SelectItem value=\"mostLiked\">Most Liked</SelectItem>\n                  <SelectItem value=\"highestCredibility\">Highest Credibility</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n\n          {isLoading ? (\n            <div className=\"text-center py-12\">\n              <p className=\"text-muted-foreground\">Loading news...</p>\n            </div>\n          ) : posts.length === 0 ? (\n            <Card>\n              <CardContent className=\"py-12 text-center\">\n                <p className=\"text-muted-foreground\">\n                  No news yet. Be the first to share something!\n                </p>\n              </CardContent>\n            </Card>\n          ) : (\n            <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6\">\n              {posts.map((post) => (\n              <Card key={post.id} className=\"hover-elevate\" data-testid={`card-post-${post.id}`}>\n                <CardHeader>\n                  <div className=\"flex items-start justify-between\">\n                    <div className=\"flex flex-col gap-2\">\n                      <UserProfileLink \n                        userId={post.authorId}\n                        name={post.authorName}\n                        avatarUrl={post.authorAvatarUrl}\n                        showAvatar={true}\n                      />\n                      <div className=\"flex items-center gap-2 text-sm text-muted-foreground pl-1\">\n                        <Badge variant=\"secondary\" className=\"text-xs\">\n                          {post.authorRole}\n                        </Badge>\n                        {post.author.averageRating !== null && post.author.averageRating > 0 && (\n                          <>\n                            <span>•</span>\n                            <div className=\"flex items-center gap-1\">\n                              <Star className=\"w-3 h-3 fill-yellow-400 text-yellow-400\" />\n                              <span className=\"text-xs font-medium\">{post.author.averageRating.toFixed(1)}</span>\n                            </div>\n                          </>\n                        )}\n                        <span>•</span>\n                        <span>{formatDistanceToNow(new Date(post.createdAt), { addSuffix: true })}</span>\n                      </div>\n                    </div>\n                    <div className=\"flex items-center gap-2\">\n                      <Badge variant=\"outline\" className={getCredibilityColor(post.authorCredibilityScore)}>\n                        {post.authorCredibilityScore.toFixed(0)}% credibility\n                      </Badge>\n                      {isPostAuthor(post.authorId) && (\n                        <Button\n                          size=\"icon\"\n                          variant=\"ghost\"\n                          onClick={() => handleEditPost(post)}\n                          data-testid={`button-edit-post-${post.id}`}\n                        >\n                          <Edit2 className=\"w-4 h-4\" />\n                        </Button>\n                      )}\n                      {isAdmin() && (\n                        <Button\n                          size=\"icon\"\n                          variant=\"ghost\"\n                          onClick={() => handleDeletePost(post.id)}\n                          data-testid={`button-delete-post-${post.id}`}\n                        >\n                          <Trash2 className=\"w-4 h-4\" />\n                        </Button>\n                      )}\n                    </div>\n                  </div>\n                </CardHeader>\n                <CardContent>\n                  <p className=\"whitespace-pre-wrap\" data-testid={`text-content-${post.id}`}>\n                    {post.content}\n                  </p>\n                  {post.mediaUrl && (\n                    <div className=\"mt-4\">\n                      {post.mediaType === \"image\" && (\n                        <img\n                          src={post.mediaUrl}\n                          alt=\"Post media\"\n                          className=\"rounded-md max-h-96 w-full object-cover\"\n                        />\n                      )}\n                    </div>\n                  )}\n                </CardContent>\n                <Separator />\n                <CardFooter className=\"py-3 flex-col items-start gap-3 w-full sticky top-0 z-10 bg-card\">\n                  <div className=\"flex gap-4 w-full items-center justify-between\">\n                    <div className=\"flex gap-4 items-center\">\n                      <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        className=\"gap-2\"\n                        onClick={() => handleToggleLike(post.id)}\n                        data-testid={`button-like-${post.id}`}\n                      >\n                        <Heart\n                          className={`w-4 h-4 ${\n                            post.isLikedByCurrentUser\n                              ? \"fill-red-500 text-red-500\"\n                              : \"\"\n                          }`}\n                        />\n                        <span>{post.likesCount}</span>\n                      </Button>\n                      <Collapsible open={showCommentsForPostId === post.id} onOpenChange={(open) => setShowCommentsForPostId(open ? post.id : null)}>\n                        <CollapsibleTrigger asChild>\n                          <Button variant=\"ghost\" size=\"sm\" className=\"gap-2\" data-testid={`button-comment-${post.id}`}>\n                            <MessageSquare className=\"w-4 h-4\" />\n                            <span>{post.commentsCount}</span>\n                            {showCommentsForPostId === post.id ? <ChevronUp className=\"w-4 h-4\" /> : <ChevronDown className=\"w-4 h-4\" />}\n                          </Button>\n                        </CollapsibleTrigger>\n                      </Collapsible>\n                    </div>\n                    \n                    {/* Post Accuracy Rating */}\n                    <div className=\"flex items-center gap-2 text-xs text-muted-foreground\" data-testid={`post-accuracy-${post.id}`}>\n                      <span className=\"font-medium\">Post Accuracy</span>\n                      <div className=\"flex gap-0.5\">\n                        {[...Array(5)].map((_, i) => (\n                          <button\n                            key={i}\n                            onClick={() => handleRatePostAccuracy(post.id, i + 1)}\n                            className=\"hover:opacity-80 transition-opacity\"\n                            data-testid={`button-rate-accuracy-${post.id}-${i + 1}`}\n                          >\n                            <Star\n                              className={`w-3.5 h-3.5 cursor-pointer ${\n                                i < (post.currentUserAccuracyRating || 0)\n                                  ? \"fill-amber-400 text-amber-400\"\n                                  : \"text-muted-foreground hover:text-amber-300\"\n                              }`}\n                            />\n                          </button>\n                        ))}\n                      </div>\n                      <span className=\"text-xs ml-0.5 font-semibold\">{(post.currentUserAccuracyRating || 0).toFixed(1)}</span>\n                    </div>\n                  </div>\n                  <Collapsible open={showCommentsForPostId === post.id} className=\"w-full\">\n                    <CollapsibleContent className=\"w-full\">\n                      <PostCommentSection postId={post.id} />\n                    </CollapsibleContent>\n                  </Collapsible>\n                </CardFooter>\n              </Card>\n              ))}\n            </div>\n          )}\n        </div>\n\n        <Dialog open={!!editingPostId} onOpenChange={(open) => { if (!open) setEditingPostId(null); }}>\n          <DialogContent data-testid=\"dialog-edit-post\">\n            <DialogHeader>\n              <DialogTitle>Edit Post</DialogTitle>\n              <DialogDescription>Make changes to your post content.</DialogDescription>\n            </DialogHeader>\n            <div className=\"space-y-4\">\n              <Textarea\n                value={editContent}\n                onChange={(e) => setEditContent(e.target.value)}\n                placeholder=\"What's happening in our school community?\"\n                className=\"min-h-24 resize-none\"\n                data-testid=\"textarea-edit-post\"\n                maxLength={4000}\n              />\n              <div className=\"flex justify-end\">\n                <span className={`text-xs ${editContent.length > 4000 ? \"text-destructive\" : \"text-muted-foreground\"}`}>\n                  {editContent.length}/4000\n                </span>\n              </div>\n            </div>\n            <DialogFooter className=\"gap-2\">\n              <Button\n                variant=\"outline\"\n                onClick={() => setEditingPostId(null)}\n                data-testid=\"button-cancel-edit\"\n              >\n                Cancel\n              </Button>\n              <Button\n                onClick={handleSaveEdit}\n                disabled={!editContent.trim() || editContent.length > 4000 || updatePostMutation.isPending}\n                data-testid=\"button-save-edit\"\n              >\n                {updatePostMutation.isPending ? \"Saving...\" : \"Save Changes\"}\n              </Button>\n            </DialogFooter>\n          </DialogContent>\n        </Dialog>\n      </div>\n    </div>\n  );\n}\n\nfunction PostCommentSection({ postId }: { postId: string }) {\n  const { toast } = useToast();\n  const [commentText, setCommentText] = useState(\"\");\n  const { data: comments = [], isLoading } = useQuery<any[]>({\n    queryKey: [`/api/posts/${postId}/comments`],\n    queryFn: async () => {\n      const response = await fetch(`/api/posts/${postId}/comments`);\n      if (!response.ok) throw new Error(\"Failed to fetch comments\");\n      return response.json();\n    },\n  });\n\n  const createCommentMutation = useMutation({\n    mutationFn: async (content: string) => {\n      return await apiRequest(\"POST\", `/api/posts/${postId}/comments`, { content });\n    },\n    onSuccess: () => {\n      setCommentText(\"\");\n      queryClient.invalidateQueries({ queryKey: [`/api/posts/${postId}/comments`] });\n      toast({ title: \"Comment added\", description: \"Your comment has been posted\" });\n    },\n    onError: (error: Error) => {\n      toast({ title: \"Failed to add comment\", description: error.message, variant: \"destructive\" });\n    },\n  });\n\n  const handleSubmitComment = () => {\n    if (commentText.trim()) {\n      createCommentMutation.mutate(commentText);\n    }\n  };\n\n  return (\n    <div className=\"space-y-3 border-t pt-3\">\n      <div className=\"space-y-2\">\n        <div className=\"flex gap-2\">\n          <Input\n            placeholder=\"Add a comment...\"\n            value={commentText}\n            onChange={(e) => setCommentText(e.target.value)}\n            className=\"text-sm\"\n            data-testid=\"input-post-comment\"\n          />\n          <Button size=\"sm\" onClick={handleSubmitComment} disabled={!commentText.trim() || createCommentMutation.isPending} data-testid=\"button-submit-comment\">\n            <Send className=\"w-3.5 h-3.5\" />\n          </Button>\n        </div>\n      </div>\n\n      <div className=\"space-y-2 max-h-[200px] overflow-y-auto scrollbar-thin\">\n        {isLoading ? (\n          <p className=\"text-sm text-muted-foreground\">Loading comments...</p>\n        ) : comments.length === 0 ? (\n          <p className=\"text-sm text-muted-foreground\">No comments yet</p>\n        ) : (\n          comments.map((comment) => (\n            <div key={comment.id} className=\"flex gap-2 p-2 bg-muted/50 rounded-md text-sm\" data-testid={`comment-${comment.id}`}>\n              <Avatar className=\"h-6 w-6\">\n                <AvatarImage src={comment.authorAvatarUrl || undefined} />\n                <AvatarFallback>{comment.authorName?.charAt(0)}</AvatarFallback>\n              </Avatar>\n              <div className=\"flex-1 min-w-0\">\n                <div className=\"flex items-center gap-2\">\n                  <span className=\"font-medium text-xs\">{comment.authorName}</span>\n                  <span className=\"text-xs text-muted-foreground\">{formatDistanceToNow(new Date(comment.createdAt), { addSuffix: true })}</span>\n                </div>\n                <p className=\"text-xs text-foreground break-words\">{comment.content}</p>\n              </div>\n            </div>\n          ))\n        )}\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":25999,"size_tokens":null},"client/src/pages/keys.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useDigitalKeys } from \"@/hooks/use-digital-keys\";\nimport { UnlockScopeDialog } from \"@/components/UnlockScopeDialog\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Lock, Unlock, Key } from \"lucide-react\";\nimport type { Scope, DigitalKey } from \"@shared/schema\";\n\nexport default function KeysPage() {\n  const [unlockDialogOpen, setUnlockDialogOpen] = useState(false);\n  const [selectedScope, setSelectedScope] = useState<Scope | null>(null);\n\n  const { data: scopes = [], isLoading: loadingScopes } = useQuery<Scope[]>({\n    queryKey: [\"/api/scopes\"],\n  });\n\n  const { data: keys = [], isLoading: loadingKeys } = useDigitalKeys();\n\n  const hasKey = (scopeId: string) => keys.some((key) => key.scopeId === scopeId);\n\n  const handleUnlockClick = (scope: Scope) => {\n    setSelectedScope(scope);\n    setUnlockDialogOpen(true);\n  };\n\n  const getScopeDisplayName = (scope: Scope) => {\n    if (scope.type === \"global\") return \"Public Square (Global)\";\n    if (scope.type === \"stage\") return `Grade ${scope.stageLevel}`;\n    if (scope.type === \"section\") return scope.sectionName || \"Unknown Section\";\n    return scope.name;\n  };\n\n  const getScopeBadgeType = (scope: Scope) => {\n    if (scope.type === \"global\") return \"default\";\n    if (scope.type === \"stage\") return \"secondary\";\n    return \"outline\";\n  };\n\n  const globalScope = scopes.find((s) => s.type === \"global\");\n  const stageScopes = scopes.filter((s) => s.type === \"stage\").sort((a, b) => (a.stageLevel || 0) - (b.stageLevel || 0));\n  const sectionScopes = scopes.filter((s) => s.type === \"section\").sort((a, b) => (a.sectionName || \"\").localeCompare(b.sectionName || \"\"));\n\n  const isLoading = loadingScopes || loadingKeys;\n\n  return (\n    <div className=\"min-h-screen bg-background p-6\">\n      <div className=\"max-w-5xl mx-auto space-y-6\">\n        <div className=\"flex items-center gap-3\">\n          <Key className=\"w-8 h-8 text-primary\" />\n          <div>\n            <h1 className=\"text-3xl font-bold\" data-testid=\"text-page-title\">\n              Keys & Scopes\n            </h1>\n            <p className=\"text-muted-foreground\" data-testid=\"text-page-description\">\n              Manage your access to different school communities\n            </p>\n          </div>\n        </div>\n\n        {isLoading ? (\n          <div className=\"text-center py-12\">\n            <p className=\"text-muted-foreground\">Loading scopes...</p>\n          </div>\n        ) : (\n          <div className=\"space-y-8\">\n            {globalScope && (\n              <div>\n                <h2 className=\"text-xl font-semibold mb-4\">Global Access</h2>\n                <ScopeCard\n                  scope={globalScope}\n                  displayName={getScopeDisplayName(globalScope)}\n                  badgeType={getScopeBadgeType(globalScope)}\n                  isUnlocked={true}\n                  onUnlockClick={() => {}}\n                />\n              </div>\n            )}\n\n            {stageScopes.length > 0 && (\n              <div>\n                <h2 className=\"text-xl font-semibold mb-4\">Grade Levels</h2>\n                <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-3\">\n                  {stageScopes.map((scope) => (\n                    <ScopeCard\n                      key={scope.id}\n                      scope={scope}\n                      displayName={getScopeDisplayName(scope)}\n                      badgeType={getScopeBadgeType(scope)}\n                      isUnlocked={hasKey(scope.id)}\n                      onUnlockClick={() => handleUnlockClick(scope)}\n                    />\n                  ))}\n                </div>\n              </div>\n            )}\n\n            {sectionScopes.length > 0 && (\n              <div>\n                <h2 className=\"text-xl font-semibold mb-4\">Class Sections</h2>\n                <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-3\">\n                  {sectionScopes.map((scope) => (\n                    <ScopeCard\n                      key={scope.id}\n                      scope={scope}\n                      displayName={getScopeDisplayName(scope)}\n                      badgeType={getScopeBadgeType(scope)}\n                      isUnlocked={hasKey(scope.id)}\n                      onUnlockClick={() => handleUnlockClick(scope)}\n                    />\n                  ))}\n                </div>\n              </div>\n            )}\n\n            {scopes.length === 0 && (\n              <Card>\n                <CardContent className=\"py-12 text-center\">\n                  <Lock className=\"w-12 h-12 mx-auto mb-4 text-muted-foreground\" />\n                  <p className=\"text-muted-foreground\">No scopes available yet</p>\n                </CardContent>\n              </Card>\n            )}\n          </div>\n        )}\n      </div>\n\n      {selectedScope && (\n        <UnlockScopeDialog\n          open={unlockDialogOpen}\n          onOpenChange={setUnlockDialogOpen}\n          scopeId={selectedScope.id}\n          scopeName={getScopeDisplayName(selectedScope)}\n          onSuccess={() => {\n            setSelectedScope(null);\n          }}\n        />\n      )}\n    </div>\n  );\n}\n\nfunction ScopeCard({\n  scope,\n  displayName,\n  badgeType,\n  isUnlocked,\n  onUnlockClick,\n}: {\n  scope: Scope;\n  displayName: string;\n  badgeType: \"default\" | \"secondary\" | \"outline\";\n  isUnlocked: boolean;\n  onUnlockClick: () => void;\n}) {\n  const isGlobal = scope.type === \"global\";\n\n  return (\n    <Card\n      className={isUnlocked ? \"border-primary/50\" : \"\"}\n      data-testid={`card-scope-${scope.id}`}\n    >\n      <CardHeader className=\"gap-2\">\n        <div className=\"flex items-start justify-between gap-2\">\n          <div className=\"flex-1\">\n            <CardTitle className=\"text-lg\" data-testid={`text-scope-name-${scope.id}`}>\n              {displayName}\n            </CardTitle>\n            <CardDescription className=\"mt-1\">\n              <Badge variant={badgeType} className=\"no-default-hover-elevate\">\n                {scope.type}\n              </Badge>\n            </CardDescription>\n          </div>\n          <div>\n            {isUnlocked ? (\n              <Unlock className=\"w-5 h-5 text-primary\" data-testid={`icon-unlocked-${scope.id}`} />\n            ) : (\n              <Lock className=\"w-5 h-5 text-muted-foreground\" data-testid={`icon-locked-${scope.id}`} />\n            )}\n          </div>\n        </div>\n      </CardHeader>\n      <CardContent>\n        {isGlobal ? (\n          <p className=\"text-sm text-muted-foreground\" data-testid=\"text-global-access\">\n            Everyone has access to the Public Square\n          </p>\n        ) : isUnlocked ? (\n          <div className=\"flex items-center gap-2 text-sm text-primary\">\n            <Key className=\"w-4 h-4\" />\n            <span data-testid={`text-unlocked-${scope.id}`}>Access granted</span>\n          </div>\n        ) : (\n          <Button\n            size=\"sm\"\n            variant=\"outline\"\n            onClick={onUnlockClick}\n            data-testid={`button-unlock-${scope.id}`}\n          >\n            <Lock className=\"w-4 h-4 mr-2\" />\n            Enter Access Code\n          </Button>\n        )}\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":7344,"size_tokens":null},"client/src/components/UnlockScopeDialog.tsx":{"content":"import { useState } from \"react\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Lock, Unlock } from \"lucide-react\";\n\ntype UnlockScopeDialogProps = {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  scopeId: string;\n  scopeName: string;\n  onSuccess?: () => void;\n};\n\nexport function UnlockScopeDialog({\n  open,\n  onOpenChange,\n  scopeId,\n  scopeName,\n  onSuccess,\n}: UnlockScopeDialogProps) {\n  const [accessCode, setAccessCode] = useState(\"\");\n  const { toast } = useToast();\n\n  const unlockMutation = useMutation({\n    mutationFn: async () => {\n      return await apiRequest(\"POST\", \"/api/keys/unlock\", {\n        scopeId,\n        accessCode: accessCode.trim(),\n      });\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Scope Unlocked!\",\n        description: `You now have access to post in ${scopeName}`,\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/keys\"] });\n      setAccessCode(\"\");\n      onOpenChange(false);\n      onSuccess?.();\n    },\n    onError: (error: any) => {\n      const message = error.data?.message || error.message || \"Invalid access code. Please try again.\";\n      toast({\n        title: \"Unlock Failed\",\n        description: message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!accessCode.trim()) {\n      toast({\n        title: \"Missing Code\",\n        description: \"Please enter an access code\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    unlockMutation.mutate();\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onOpenChange}>\n      <DialogContent data-testid=\"dialog-unlock-scope\">\n        <DialogHeader>\n          <div className=\"flex items-center gap-2\">\n            <Lock className=\"w-5 h-5 text-primary\" />\n            <DialogTitle data-testid=\"text-dialog-title\">Unlock {scopeName}</DialogTitle>\n          </div>\n          <DialogDescription data-testid=\"text-dialog-description\">\n            This scope is locked. Enter the secret access code to unlock posting\n            privileges. Once unlocked, you'll have permanent access.\n          </DialogDescription>\n        </DialogHeader>\n\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"accessCode\">Access Code</Label>\n            <Input\n              id=\"accessCode\"\n              type=\"text\"\n              placeholder=\"Enter secret code...\"\n              value={accessCode}\n              onChange={(e) => setAccessCode(e.target.value)}\n              disabled={unlockMutation.isPending}\n              data-testid=\"input-access-code\"\n              autoComplete=\"off\"\n            />\n          </div>\n\n          <DialogFooter>\n            <Button\n              type=\"button\"\n              variant=\"outline\"\n              onClick={() => onOpenChange(false)}\n              disabled={unlockMutation.isPending}\n              data-testid=\"button-cancel\"\n            >\n              Cancel\n            </Button>\n            <Button\n              type=\"submit\"\n              disabled={unlockMutation.isPending}\n              data-testid=\"button-unlock\"\n            >\n              {unlockMutation.isPending ? (\n                \"Unlocking...\"\n              ) : (\n                <>\n                  <Unlock className=\"w-4 h-4 mr-2\" />\n                  Unlock Scope\n                </>\n              )}\n            </Button>\n          </DialogFooter>\n        </form>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","path":null,"size_bytes":3924,"size_tokens":null},"client/src/hooks/use-digital-keys.ts":{"content":"import { useMemo } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport type { DigitalKey } from \"@shared/schema\";\n\nexport function useDigitalKeys() {\n  return useQuery<DigitalKey[]>({\n    queryKey: [\"/api/keys\"],\n    staleTime: 0, // Always refetch on invalidation\n  });\n}\n\nexport function useHasAccessToScope(scopeId: string | null | undefined) {\n  const { data: keys = [] } = useDigitalKeys();\n  \n  return useMemo(() => {\n    if (!scopeId) return true; // Global scope or no scope\n    return keys.some(key => key.scopeId === scopeId);\n  }, [keys, scopeId]);\n}\n","path":null,"size_bytes":581,"size_tokens":null},"client/src/pages/teacher-detail.tsx":{"content":"import { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useParams, Link } from \"wouter\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Avatar, AvatarImage, AvatarFallback } from \"@/components/ui/avatar\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Star, ArrowLeft } from \"lucide-react\";\nimport { useUser } from \"@/hooks/use-user\";\nimport { useState } from \"react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\";\nimport { Label } from \"@/components/ui/label\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from \"@/components/ui/dialog\";\nimport {\n  RadarChart,\n  PolarGrid,\n  PolarAngleAxis,\n  PolarRadiusAxis,\n  Radar,\n  ResponsiveContainer,\n} from \"recharts\";\n\ntype Teacher = {\n  id: string;\n  name: string;\n  photoUrl: string | null;\n  description: string | null;\n  academicAchievements: string[] | null;\n  subjects: string[] | null;\n  sections: string[] | null;\n  adminNotes: string | null;\n};\n\ntype Review = {\n  id: string;\n  rating: number;\n  comment: string | null;\n  createdAt: string;\n  studentId: string;\n};\n\ntype TeacherWithReviews = {\n  teacher: Teacher;\n  reviews: Review[];\n  averageRating: number;\n};\n\ntype TeacherFeedback = {\n  clarity: number;\n  instruction: number;\n  communication: number;\n  patience: number;\n  motivation: number;\n  improvement: number;\n  notes?: string;\n};\n\ntype FeedbackStats = {\n  averages: {\n    clarity: number;\n    instruction: number;\n    communication: number;\n    patience: number;\n    motivation: number;\n    improvement: number;\n  };\n  count: number;\n};\n\nexport default function TeacherDetailPage() {\n  const { id } = useParams<{ id: string }>();\n  const { user } = useUser();\n  const { toast } = useToast();\n\n  const [feedback, setFeedback] = useState<TeacherFeedback>({\n    clarity: 3,\n    instruction: 3,\n    communication: 3,\n    patience: 3,\n    motivation: 3,\n    improvement: 3,\n    notes: \"\",\n  });\n\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [feedbackDialogOpen, setFeedbackDialogOpen] = useState(false);\n\n  const { data, isLoading } = useQuery<TeacherWithReviews>({\n    queryKey: [\"/api/teachers\", id],\n    enabled: !!id,\n  });\n\n  const { data: feedbackStats } = useQuery<FeedbackStats>({\n    queryKey: [\"/api/teachers\", id, \"feedback\"],\n    enabled: !!id && user?.role === \"admin\",\n  });\n\n  const { data: existingFeedback } = useQuery<TeacherFeedback | null>({\n    queryKey: [\"/api/teachers\", id, \"my-feedback\"],\n    enabled: !!id && user && user.role !== \"visitor\",\n  });\n\n  const submitFeedbackMutation = useMutation({\n    mutationFn: async (feedbackData: TeacherFeedback) => {\n      // Try to update existing feedback first\n      try {\n        const result = await apiRequest(\"PATCH\", `/api/teachers/${id}/feedback`, feedbackData);\n        return { result, isUpdate: true };\n      } catch (error) {\n        // If 404, feedback doesn't exist yet, so create it\n        if (error instanceof Error && error.message.includes(\"404\")) {\n          const result = await apiRequest(\"POST\", `/api/teachers/${id}/feedback`, feedbackData);\n          return { result, isUpdate: false };\n        }\n        // Re-throw any other error\n        throw error;\n      }\n    },\n    onSuccess: (data: any) => {\n      const isUpdate = data?.isUpdate || false;\n      toast({\n        title: isUpdate ? \"Feedback updated\" : \"Feedback submitted\",\n        description: isUpdate ? \"Your feedback has been updated!\" : \"Thank you for your feedback!\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/teachers\", id, \"feedback\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/teachers\", id, \"my-feedback\"] });\n      setFeedbackDialogOpen(false);\n      // Reset form\n      setFeedback({\n        clarity: 3,\n        instruction: 3,\n        communication: 3,\n        patience: 3,\n        motivation: 3,\n        improvement: 3,\n        notes: \"\",\n      });\n    },\n    onError: (error: Error) => {\n      setFeedbackDialogOpen(false);\n      // Extract message from error - could be \"409: {...}\" or \"400: {...}\" format\n      let errorMsg = \"Failed to submit feedback\";\n      let isInfo = false;\n      \n      try {\n        const match = error.message.match(/(\\d+):\\s*(.+)$/);\n        if (match) {\n          const status = match[1];\n          const jsonStr = match[2];\n          const parsed = JSON.parse(jsonStr);\n          errorMsg = parsed.message || errorMsg;\n          // 409 is conflict (already submitted) - show as info instead of error\n          isInfo = status === \"409\";\n        } else {\n          errorMsg = error.message;\n        }\n      } catch {\n        errorMsg = error.message || errorMsg;\n      }\n      \n      toast({\n        title: isInfo ? \"Feedback\" : \"Error\",\n        description: errorMsg,\n        variant: isInfo ? \"default\" : \"destructive\",\n      });\n    },\n  });\n\n  // Load existing feedback into form when dialog opens\n  const handleOpenFeedbackDialog = () => {\n    if (existingFeedback) {\n      setFeedback({\n        clarity: existingFeedback.clarity,\n        instruction: existingFeedback.instruction,\n        communication: existingFeedback.communication,\n        patience: existingFeedback.patience,\n        motivation: existingFeedback.motivation,\n        improvement: existingFeedback.improvement,\n        notes: existingFeedback.notes || \"\",\n      });\n    }\n    setFeedbackDialogOpen(true);\n  };\n\n  const handleSubmitFeedback = async (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!user || user.role === \"visitor\") {\n      toast({\n        title: \"Login required\",\n        description: \"Please log in to submit feedback\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    setIsSubmitting(true);\n    try {\n      await submitFeedbackMutation.mutateAsync(feedback);\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  const renderStars = (count: number, interactive = false) => {\n    const stars = [];\n    for (let i = 1; i <= 5; i++) {\n      const filled = interactive \n        ? (hoveredStar !== null ? i <= hoveredStar : i <= count)\n        : i <= Math.floor(count);\n      const halfFilled = !interactive && i === Math.ceil(count) && count % 1 >= 0.5;\n\n      stars.push(\n        <button\n          key={i}\n          type={interactive ? \"button\" : undefined}\n          onClick={interactive ? () => setRating(i) : undefined}\n          onMouseEnter={interactive ? () => setHoveredStar(i) : undefined}\n          onMouseLeave={interactive ? () => setHoveredStar(null) : undefined}\n          className={interactive ? \"cursor-pointer hover:scale-110 transition-transform\" : \"\"}\n          disabled={!interactive}\n          data-testid={`${interactive ? \"button\" : \"icon\"}-star-${i}`}\n        >\n          <Star\n            className={`w-5 h-5 ${\n              filled\n                ? \"fill-yellow-400 text-yellow-400\"\n                : halfFilled\n                ? \"fill-yellow-400/50 text-yellow-400\"\n                : \"text-muted-foreground\"\n            }`}\n          />\n        </button>\n      );\n    }\n    return stars;\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"container mx-auto p-6 max-w-4xl\">\n        <div className=\"animate-pulse space-y-6\">\n          <div className=\"h-8 bg-muted rounded w-48\" />\n          <Card>\n            <CardContent className=\"p-6\">\n              <div className=\"flex items-start gap-6\">\n                <div className=\"w-24 h-24 rounded-full bg-muted\" />\n                <div className=\"flex-1 space-y-4\">\n                  <div className=\"h-6 bg-muted rounded w-1/3\" />\n                  <div className=\"h-4 bg-muted rounded w-1/2\" />\n                  <div className=\"h-4 bg-muted rounded w-full\" />\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    );\n  }\n\n  if (!data) {\n    return (\n      <div className=\"container mx-auto p-6 max-w-4xl\">\n        <Card>\n          <CardContent className=\"p-12 text-center\">\n            <h2 className=\"text-xl font-semibold mb-2\" data-testid=\"text-not-found\">Teacher Not Found</h2>\n            <p className=\"text-muted-foreground mb-4\">The teacher you're looking for doesn't exist.</p>\n            <Link href=\"/teachers\">\n              <Button variant=\"outline\" data-testid=\"button-back-to-teachers\">\n                <ArrowLeft className=\"w-4 h-4 mr-2\" />\n                Back to Teachers\n              </Button>\n            </Link>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  const { teacher, reviews, averageRating } = data;\n\n  return (\n    <div className=\"container mx-auto p-6 max-w-4xl\">\n      <Link href=\"/teachers\">\n        <Button variant=\"ghost\" className=\"mb-6\" data-testid=\"button-back\">\n          <ArrowLeft className=\"w-4 h-4 mr-2\" />\n          Back to Teachers\n        </Button>\n      </Link>\n\n      <Card className=\"mb-6\">\n        <CardContent className=\"p-6\">\n          <div className=\"flex items-start gap-6\">\n            <Avatar className=\"w-24 h-24\" data-testid=\"avatar-teacher\">\n              <AvatarImage src={teacher.photoUrl || undefined} alt={teacher.name} />\n              <AvatarFallback className=\"text-2xl\">\n                {teacher.name.split(\" \").map(n => n[0]).join(\"\").slice(0, 2)}\n              </AvatarFallback>\n            </Avatar>\n            <div className=\"flex-1\">\n              <h1 className=\"text-3xl font-bold mb-2\" data-testid=\"text-teacher-name\">{teacher.name}</h1>\n              \n\n              {teacher.subjects && teacher.subjects.length > 0 && (\n                <div className=\"mb-4\">\n                  <h3 className=\"text-sm font-semibold text-muted-foreground mb-2\">Subjects</h3>\n                  <div className=\"flex flex-wrap gap-2\">\n                    {teacher.subjects.map((subject, idx) => (\n                      <Badge key={idx} variant=\"default\" data-testid={`badge-subject-${idx}`}>\n                        {subject}\n                      </Badge>\n                    ))}\n                  </div>\n                </div>\n              )}\n\n              {teacher.sections && teacher.sections.length > 0 && (\n                <div className=\"mb-4\">\n                  <h3 className=\"text-sm font-semibold text-muted-foreground mb-2\">Classes</h3>\n                  <div className=\"flex flex-wrap gap-2\">\n                    {teacher.sections.map((section, idx) => (\n                      <Badge key={idx} variant=\"outline\" data-testid={`badge-section-${idx}`}>\n                        {section}\n                      </Badge>\n                    ))}\n                  </div>\n                </div>\n              )}\n\n              {teacher.academicAchievements && teacher.academicAchievements.length > 0 && (\n                <div className=\"mb-4\">\n                  <h3 className=\"text-sm font-semibold text-muted-foreground mb-2\">Certificates & Achievements</h3>\n                  <div className=\"flex flex-wrap gap-2\">\n                    {teacher.academicAchievements.map((achievement, idx) => (\n                      <Badge key={idx} variant=\"secondary\" data-testid={`badge-achievement-${idx}`}>\n                        {achievement}\n                      </Badge>\n                    ))}\n                  </div>\n                </div>\n              )}\n\n              {teacher.description && (\n                <div className=\"mb-4\">\n                  <h3 className=\"text-sm font-semibold text-muted-foreground mb-2\">About</h3>\n                  <p className=\"text-sm leading-relaxed\" data-testid=\"text-description\">\n                    {teacher.description}\n                  </p>\n                </div>\n              )}\n\n              {user?.role === \"admin\" && teacher.adminNotes && (\n                <div className=\"p-4 bg-yellow-50 dark:bg-yellow-950/20 border border-yellow-200 dark:border-yellow-900 rounded-md\">\n                  <h3 className=\"text-sm font-semibold text-yellow-900 dark:text-yellow-200 mb-2\">Admin Notes</h3>\n                  <p className=\"text-sm text-yellow-800 dark:text-yellow-300\" data-testid=\"text-admin-notes\">\n                    {teacher.adminNotes}\n                  </p>\n                </div>\n              )}\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Student Feedback Hexagon or Rate Button */}\n      <Card className=\"mb-6\">\n        <CardHeader className=\"flex flex-row items-center justify-between\">\n          <CardTitle>Feedback</CardTitle>\n          {user && user.role !== \"visitor\" && (\n            <Button \n              onClick={handleOpenFeedbackDialog}\n              variant={existingFeedback ? \"default\" : \"outline\"}\n              data-testid=\"button-rate\"\n            >\n              {existingFeedback ? \"Edit Feedback\" : \"Rate\"}\n            </Button>\n          )}\n        </CardHeader>\n        <CardContent>\n          <div className=\"text-center py-8\">\n            <p className=\"text-sm text-muted-foreground mb-4\">\n              Students can provide detailed feedback about this teacher.\n            </p>\n            <p className=\"text-sm text-muted-foreground\">\n              Click the \"Rate\" button to submit your feedback.\n            </p>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Feedback Dialog */}\n      <Dialog open={feedbackDialogOpen} onOpenChange={setFeedbackDialogOpen}>\n        <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\" data-testid=\"dialog-feedback\">\n          <DialogHeader>\n            <DialogTitle>Submit Feedback for {teacher.name}</DialogTitle>\n          </DialogHeader>\n\n          <form onSubmit={handleSubmitFeedback} className=\"space-y-6\">\n            {/* Rating Questions */}\n            {[\n              { key: \"clarity\", label: \"Clarity of Instruction\" },\n              { key: \"instruction\", label: \"Quality of Instruction\" },\n              { key: \"communication\", label: \"Communication Skills\" },\n              { key: \"patience\", label: \"Patience & Understanding\" },\n              { key: \"motivation\", label: \"Student Motivation\" },\n              { key: \"improvement\", label: \"Encourages Improvement\" },\n            ].map(({ key, label }) => (\n              <div key={key} className=\"space-y-2\">\n                <Label className=\"text-sm font-medium\">{label}</Label>\n                <RadioGroup\n                  value={feedback[key as keyof TeacherFeedback]?.toString()}\n                  onValueChange={(value) =>\n                    setFeedback({ ...feedback, [key]: parseInt(value) })\n                  }\n                  className=\"flex gap-4\"\n                >\n                  {[1, 2, 3, 4, 5].map((rating) => (\n                    <div key={rating} className=\"flex items-center space-x-2\">\n                      <RadioGroupItem value={rating.toString()} id={`${key}-${rating}`} />\n                      <Label htmlFor={`${key}-${rating}`} className=\"cursor-pointer\">\n                        {rating}\n                      </Label>\n                    </div>\n                  ))}\n                </RadioGroup>\n              </div>\n            ))}\n\n            {/* Optional Notes */}\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"notes\" className=\"text-sm font-medium\">\n                Additional Notes (Optional)\n              </Label>\n              <Textarea\n                id=\"notes\"\n                placeholder=\"Share any additional thoughts...\"\n                value={feedback.notes}\n                onChange={(e) => setFeedback({ ...feedback, notes: e.target.value })}\n                rows={4}\n              />\n            </div>\n\n            <DialogFooter>\n              <Button variant=\"outline\" onClick={() => setFeedbackDialogOpen(false)}>\n                Cancel\n              </Button>\n              <Button type=\"submit\" disabled={isSubmitting}>\n                {isSubmitting ? \"Submitting...\" : \"Submit Feedback\"}\n              </Button>\n            </DialogFooter>\n          </form>\n        </DialogContent>\n      </Dialog>\n\n      {/* Admin-only Feedback Statistics */}\n      {user?.role === \"admin\" && feedbackStats && feedbackStats.count > 0 && (\n        <Card className=\"mb-6\">\n          <CardHeader>\n            <CardTitle>Feedback Statistics (Admin Only)</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-4\">\n              <p className=\"text-sm text-muted-foreground\">\n                Based on {feedbackStats.count} feedback submission{feedbackStats.count !== 1 ? \"s\" : \"\"}\n              </p>\n              <div className=\"w-full h-96 flex justify-center\">\n                <ResponsiveContainer width=\"100%\" height=\"100%\">\n                  <RadarChart\n                    data={[\n                      {\n                        name: \"Clarity\",\n                        value: feedbackStats.averages.clarity,\n                      },\n                      {\n                        name: \"Instruction\",\n                        value: feedbackStats.averages.instruction,\n                      },\n                      {\n                        name: \"Communication\",\n                        value: feedbackStats.averages.communication,\n                      },\n                      {\n                        name: \"Patience\",\n                        value: feedbackStats.averages.patience,\n                      },\n                      {\n                        name: \"Motivation\",\n                        value: feedbackStats.averages.motivation,\n                      },\n                      {\n                        name: \"Improvement\",\n                        value: feedbackStats.averages.improvement,\n                      },\n                    ]}\n                    margin={{ top: 20, right: 30, bottom: 20, left: 30 }}\n                  >\n                    <PolarGrid stroke=\"currentColor\" strokeOpacity={0.2} />\n                    <PolarAngleAxis\n                      dataKey=\"name\"\n                      tick={{ fontSize: 12 }}\n                      stroke=\"currentColor\"\n                      strokeOpacity={0.5}\n                    />\n                    <PolarRadiusAxis\n                      domain={[0, 5]}\n                      tick={{ fontSize: 12 }}\n                      stroke=\"currentColor\"\n                      strokeOpacity={0.5}\n                    />\n                    <Radar\n                      name=\"Average Rating\"\n                      dataKey=\"value\"\n                      stroke=\"hsl(var(--primary))\"\n                      fill=\"hsl(var(--primary))\"\n                      fillOpacity={0.3}\n                    />\n                  </RadarChart>\n                </ResponsiveContainer>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      )}\n\n    </div>\n  );\n}\n","path":null,"size_bytes":18907,"size_tokens":null},"client/src/components/ScopeSelector.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Label } from \"@/components/ui/label\";\nimport { Lock, Globe, GraduationCap, Users } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { UnlockScopeDialog } from \"@/components/UnlockScopeDialog\";\nimport { useHasAccessToScope } from \"@/hooks/use-digital-keys\";\n\ntype Scope = {\n  id: string;\n  name: string;\n  type: \"public\" | \"grade\" | \"section\";\n  gradeNumber: number | null;\n  sectionName: string | null;\n};\n\ntype ScopeSelectorProps = {\n  value: string | null;\n  onChange: (scopeId: string | null) => void;\n  label?: string;\n  placeholder?: string;\n};\n\nexport function ScopeSelector({ value, onChange, label = \"Post to\", placeholder = \"Select scope\" }: ScopeSelectorProps) {\n  const [showUnlockDialog, setShowUnlockDialog] = useState(false);\n  const [selectedScopeForUnlock, setSelectedScopeForUnlock] = useState<string | null>(null);\n\n  const { data: scopes = [] } = useQuery<Scope[]>({\n    queryKey: [\"/api/scopes\"],\n  });\n\n  const hasAccess = useHasAccessToScope(value);\n\n  const publicScope = scopes.find((s) => s.type === \"public\");\n  const gradeScopes = scopes.filter((s) => s.type === \"grade\").sort((a, b) => (a.gradeNumber || 0) - (b.gradeNumber || 0));\n  const sectionScopes = scopes.filter((s) => s.type === \"section\").sort((a, b) => (a.sectionName || \"\").localeCompare(b.sectionName || \"\"));\n\n  const handleScopeChange = async (newScopeId: string) => {\n    const isPublic = newScopeId === \"public\" || newScopeId === publicScope?.id;\n    if (isPublic && publicScope) {\n      // For public scope, we pass the actual scope ID so it's treated as a specific scope\n      onChange(publicScope.id);\n      return;\n    }\n\n    const scope = scopes.find((s) => s.id === newScopeId);\n    if (!scope) {\n      onChange(newScopeId);\n      return;\n    }\n\n    if (scope.type === \"grade\" || scope.type === \"section\") {\n      const response = await fetch(`/api/keys/check/${newScopeId}`);\n      const hasKey = response.ok && (await response.json()).hasAccess;\n      \n      if (hasKey) {\n        onChange(newScopeId);\n      } else {\n        setSelectedScopeForUnlock(newScopeId);\n        setShowUnlockDialog(true);\n      }\n    } else {\n      onChange(newScopeId);\n    }\n  };\n\n  const handleUnlockSuccess = () => {\n    if (selectedScopeForUnlock) {\n      onChange(selectedScopeForUnlock);\n      setSelectedScopeForUnlock(null);\n    }\n    setShowUnlockDialog(false);\n  };\n\n  const handleUnlockCancel = () => {\n    setSelectedScopeForUnlock(null);\n    setShowUnlockDialog(false);\n  };\n\n  const getScopeIcon = (type: string) => {\n    if (type === \"public\") return <Globe className=\"w-4 h-4\" />;\n    if (type === \"grade\") return <GraduationCap className=\"w-4 h-4\" />;\n    return <Users className=\"w-4 h-4\" />;\n  };\n\n  const selectedScope = value ? scopes.find((s) => s.id === value) : publicScope;\n\n  return (\n    <div className=\"space-y-2\">\n      {label && <Label>{label}</Label>}\n      <div className=\"flex items-center gap-2\">\n        <Select value={value || (publicScope?.id || \"\")} onValueChange={handleScopeChange}>\n          <SelectTrigger data-testid=\"select-scope\">\n            <SelectValue placeholder={placeholder} />\n          </SelectTrigger>\n          <SelectContent>\n            {/* Public Scope */}\n            {publicScope && (\n              <SelectItem value={publicScope.id} data-testid=\"scope-option-public\">\n                <div className=\"flex items-center gap-2\">\n                  <Globe className=\"w-4 h-4\" />\n                  <span>{publicScope.name}</span>\n                </div>\n              </SelectItem>\n            )}\n\n            {/* Grade Scopes */}\n            {gradeScopes.length > 0 && (\n              <>\n                <div className=\"px-2 py-1.5 text-sm font-semibold text-muted-foreground\">Grades</div>\n                {gradeScopes.map((scope) => (\n                  <SelectItem key={scope.id} value={scope.id} data-testid={`scope-option-grade-${scope.gradeNumber}`}>\n                    <div className=\"flex items-center gap-2\">\n                      <GraduationCap className=\"w-4 h-4\" />\n                      <span>{scope.name}</span>\n                    </div>\n                  </SelectItem>\n                ))}\n              </>\n            )}\n\n            {/* Class Scopes */}\n            {sectionScopes.length > 0 && (\n              <>\n                <div className=\"px-2 py-1.5 text-sm font-semibold text-muted-foreground\">Classes</div>\n                {sectionScopes.map((scope) => (\n                  <SelectItem key={scope.id} value={scope.id} data-testid={`scope-option-class-${scope.sectionName}`}>\n                    <div className=\"flex items-center gap-2\">\n                      <Users className=\"w-4 h-4\" />\n                      <span>{scope.name}</span>\n                    </div>\n                  </SelectItem>\n                ))}\n              </>\n            )}\n          </SelectContent>\n        </Select>\n\n        {value && !hasAccess && (\n          <Button\n            type=\"button\"\n            variant=\"outline\"\n            size=\"sm\"\n            onClick={() => {\n              setSelectedScopeForUnlock(value);\n              setShowUnlockDialog(true);\n            }}\n            data-testid=\"button-unlock-scope\"\n          >\n            <Lock className=\"w-4 h-4 mr-2\" />\n            Unlock\n          </Button>\n        )}\n      </div>\n\n      {selectedScope && (\n        <p className=\"text-sm text-muted-foreground flex items-center gap-2\">\n          {getScopeIcon(selectedScope.type)}\n          {hasAccess || !value ? (\n            <span>Posting to {selectedScope.name}</span>\n          ) : (\n            <span className=\"text-orange-600 dark:text-orange-400\">\n              <Lock className=\"w-3 h-3 inline mr-1\" />\n              You need to unlock {selectedScope.name} to post here\n            </span>\n          )}\n        </p>\n      )}\n\n      {selectedScopeForUnlock && (\n        <UnlockScopeDialog\n          scopeId={selectedScopeForUnlock}\n          scopeName={scopes.find((s) => s.id === selectedScopeForUnlock)?.name || \"this scope\"}\n          open={showUnlockDialog}\n          onOpenChange={(open) => {\n            if (!open) handleUnlockCancel();\n          }}\n          onSuccess={handleUnlockSuccess}\n        />\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":6438,"size_tokens":null},"client/src/components/TeacherManagementDialog.tsx":{"content":"import { useState } from \"react\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { X, Plus } from \"lucide-react\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\n\n// Predefined subjects list\nconst SUBJECTS = [\n  \"Math\",\n  \"R.E.\",\n  \"P.E.\",\n  \"Social Studies\",\n  \"Biology\",\n  \"Chemistry\",\n  \"Physics\",\n  \"Arabic\",\n  \"English\",\n  \"French\",\n  \"B.P.C.\",\n  \"Finance\",\n  \"Geology\",\n  \"Computer Science\",\n  \"Arts\",\n  \"Moralism\",\n  \"Library\",\n] as const;\n\n// Generate all possible sections (1-A through 6-E)\nconst SECTIONS = Array.from({ length: 6 }, (_, grade) => {\n  const gradeNum = grade + 1;\n  return Array.from({ length: 5 }, (_, idx) => {\n    const section = String.fromCharCode(65 + idx); // A-E\n    return `${gradeNum}-${section}`;\n  });\n}).flat();\n\ntype Teacher = {\n  id: string;\n  name: string;\n  photoUrl: string | null;\n  description: string | null;\n  academicAchievements: string[] | null;\n  subjects?: string[] | null;\n  sections?: string[] | null;\n};\n\ntype TeacherManagementDialogProps = {\n  open: boolean;\n  onOpenChange: (open: boolean) => void;\n  teacher: Teacher | null;\n};\n\nexport function TeacherManagementDialog({\n  open,\n  onOpenChange,\n  teacher,\n}: TeacherManagementDialogProps) {\n  const { toast } = useToast();\n  const [name, setName] = useState(teacher?.name || \"\");\n  const [photoUrl, setPhotoUrl] = useState(teacher?.photoUrl || \"\");\n  const [description, setDescription] = useState(teacher?.description || \"\");\n  const [achievements, setAchievements] = useState<string[]>(\n    teacher?.academicAchievements || []\n  );\n  const [newAchievement, setNewAchievement] = useState(\"\");\n  const [selectedSubjects, setSelectedSubjects] = useState<Set<string>>(\n    new Set(teacher?.subjects || [])\n  );\n  const [selectedSections, setSelectedSections] = useState<Set<string>>(\n    new Set(teacher?.sections || [])\n  );\n\n  const createMutation = useMutation({\n    mutationFn: async (data: any) => {\n      const res = await apiRequest(\"POST\", \"/api/teachers\", data);\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/teachers\"] });\n      toast({\n        title: \"Success\",\n        description: \"Teacher created successfully\",\n      });\n      onOpenChange(false);\n      resetForm();\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to create teacher\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: string; data: any }) => {\n      const res = await apiRequest(\"PATCH\", `/api/teachers/${id}`, data);\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/teachers\"] });\n      toast({\n        title: \"Success\",\n        description: \"Teacher updated successfully\",\n      });\n      onOpenChange(false);\n      resetForm();\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to update teacher\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: string) => {\n      const res = await apiRequest(\"DELETE\", `/api/teachers/${id}`, undefined);\n      return res.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/teachers\"] });\n      toast({\n        title: \"Success\",\n        description: \"Teacher deleted successfully\",\n      });\n      onOpenChange(false);\n      resetForm();\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to delete teacher\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const resetForm = () => {\n    setName(\"\");\n    setPhotoUrl(\"\");\n    setDescription(\"\");\n    setAchievements([]);\n    setNewAchievement(\"\");\n    setSelectedSubjects(new Set());\n    setSelectedSections(new Set());\n  };\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n\n    const data = {\n      name,\n      photoUrl: photoUrl || null,\n      description: description || null,\n      academicAchievements: achievements.length > 0 ? achievements : null,\n      subjects: selectedSubjects.size > 0 ? Array.from(selectedSubjects) : null,\n      sections: selectedSections.size > 0 ? Array.from(selectedSections) : null,\n    };\n\n    if (teacher) {\n      updateMutation.mutate({ id: teacher.id, data });\n    } else {\n      createMutation.mutate(data);\n    }\n  };\n\n  const handleDelete = () => {\n    if (teacher && confirm(`Are you sure you want to delete ${teacher.name}?`)) {\n      deleteMutation.mutate(teacher.id);\n    }\n  };\n\n  const addAchievement = () => {\n    if (newAchievement.trim()) {\n      setAchievements([...achievements, newAchievement.trim()]);\n      setNewAchievement(\"\");\n    }\n  };\n\n  const removeAchievement = (index: number) => {\n    setAchievements(achievements.filter((_, i) => i !== index));\n  };\n\n  const handleOpenChange = (newOpen: boolean) => {\n    if (!newOpen) {\n      resetForm();\n    }\n    onOpenChange(newOpen);\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={handleOpenChange}>\n      <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\" data-testid=\"dialog-teacher-management\">\n        <DialogHeader>\n          <DialogTitle data-testid=\"text-dialog-title\">\n            {teacher ? \"Edit Teacher\" : \"Add New Teacher\"}\n          </DialogTitle>\n        </DialogHeader>\n\n        <form onSubmit={handleSubmit}>\n          <div className=\"space-y-4 py-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"name\">Name *</Label>\n              <Input\n                id=\"name\"\n                value={name}\n                onChange={(e) => setName(e.target.value)}\n                placeholder=\"Dr. Jane Smith\"\n                required\n                data-testid=\"input-teacher-name\"\n              />\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"photoUrl\">Photo URL</Label>\n              <Input\n                id=\"photoUrl\"\n                value={photoUrl}\n                onChange={(e) => setPhotoUrl(e.target.value)}\n                placeholder=\"https://example.com/photo.jpg\"\n                data-testid=\"input-teacher-photo\"\n              />\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"description\">Description</Label>\n              <Textarea\n                id=\"description\"\n                value={description}\n                onChange={(e) => setDescription(e.target.value)}\n                placeholder=\"A brief description about the teacher...\"\n                rows={4}\n                data-testid=\"textarea-teacher-description\"\n              />\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label>Academic Achievements</Label>\n              <div className=\"flex gap-2\">\n                <Input\n                  value={newAchievement}\n                  onChange={(e) => setNewAchievement(e.target.value)}\n                  placeholder=\"e.g., PhD in Mathematics, Oxford\"\n                  onKeyPress={(e) => {\n                    if (e.key === \"Enter\") {\n                      e.preventDefault();\n                      addAchievement();\n                    }\n                  }}\n                  data-testid=\"input-new-achievement\"\n                />\n                <Button\n                  type=\"button\"\n                  variant=\"outline\"\n                  onClick={addAchievement}\n                  data-testid=\"button-add-achievement\"\n                >\n                  <Plus className=\"w-4 h-4\" />\n                </Button>\n              </div>\n              {achievements.length > 0 && (\n                <div className=\"flex flex-wrap gap-2 mt-2\">\n                  {achievements.map((achievement, index) => (\n                    <Badge\n                      key={index}\n                      variant=\"secondary\"\n                      className=\"gap-1\"\n                      data-testid={`badge-achievement-${index}`}\n                    >\n                      {achievement}\n                      <button\n                        type=\"button\"\n                        onClick={() => removeAchievement(index)}\n                        className=\"ml-1 hover:text-destructive\"\n                        data-testid={`button-remove-achievement-${index}`}\n                      >\n                        <X className=\"w-3 h-3\" />\n                      </button>\n                    </Badge>\n                  ))}\n                </div>\n              )}\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label>Subjects Taught</Label>\n              <div className=\"grid grid-cols-2 gap-3\">\n                {SUBJECTS.map((subject) => (\n                  <div key={subject} className=\"flex items-center space-x-2\">\n                    <Checkbox\n                      id={`subject-${subject}`}\n                      checked={selectedSubjects.has(subject)}\n                      onCheckedChange={(checked) => {\n                        const newSubjects = new Set(selectedSubjects);\n                        if (checked) {\n                          newSubjects.add(subject);\n                        } else {\n                          newSubjects.delete(subject);\n                        }\n                        setSelectedSubjects(newSubjects);\n                      }}\n                      data-testid={`checkbox-subject-${subject}`}\n                    />\n                    <Label htmlFor={`subject-${subject}`} className=\"font-normal cursor-pointer\">\n                      {subject}\n                    </Label>\n                  </div>\n                ))}\n              </div>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label>Sections Taught</Label>\n              <div className=\"space-y-3 max-h-48 overflow-y-auto border rounded-md p-3\">\n                {Array.from({ length: 6 }).map((_, gradeIdx) => {\n                  const gradeNum = gradeIdx + 1;\n                  const gradeSections = SECTIONS.filter((s) => s.startsWith(`${gradeNum}-`));\n                  return (\n                    <div key={`grade-${gradeNum}`}>\n                      <div className=\"font-semibold text-sm mb-2\">Grade {gradeNum}</div>\n                      <div className=\"grid grid-cols-5 gap-2 ml-2\">\n                        {gradeSections.map((section) => (\n                          <div key={section} className=\"flex items-center space-x-2\">\n                            <Checkbox\n                              id={`section-${section}`}\n                              checked={selectedSections.has(section)}\n                              onCheckedChange={(checked) => {\n                                const newSections = new Set(selectedSections);\n                                if (checked) {\n                                  newSections.add(section);\n                                } else {\n                                  newSections.delete(section);\n                                }\n                                setSelectedSections(newSections);\n                              }}\n                              data-testid={`checkbox-section-${section}`}\n                            />\n                            <Label htmlFor={`section-${section}`} className=\"font-normal cursor-pointer\">\n                              {section.split(\"-\")[1]}\n                            </Label>\n                          </div>\n                        ))}\n                      </div>\n                    </div>\n                  );\n                })}\n              </div>\n            </div>\n          </div>\n\n          <DialogFooter className=\"gap-2\">\n            {teacher && (\n              <Button\n                type=\"button\"\n                variant=\"destructive\"\n                onClick={handleDelete}\n                disabled={deleteMutation.isPending}\n                data-testid=\"button-delete-teacher\"\n              >\n                Delete Teacher\n              </Button>\n            )}\n            <Button\n              type=\"button\"\n              variant=\"outline\"\n              onClick={() => handleOpenChange(false)}\n              data-testid=\"button-cancel\"\n            >\n              Cancel\n            </Button>\n            <Button\n              type=\"submit\"\n              disabled={createMutation.isPending || updateMutation.isPending}\n              data-testid=\"button-submit-teacher\"\n            >\n              {teacher ? \"Update\" : \"Create\"} Teacher\n            </Button>\n          </DialogFooter>\n        </form>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","path":null,"size_bytes":13059,"size_tokens":null},"client/src/hooks/use-user.ts":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport type { User } from \"@shared/schema\";\n\nexport function useUser() {\n  const { data: user, isLoading, error } = useQuery<User>({\n    queryKey: [\"/api/auth/me\"],\n  });\n\n  return { user, isLoading, error };\n}\n","path":null,"size_bytes":261,"size_tokens":null},"client/src/components/UserProfileLink.tsx":{"content":"import { Link } from \"wouter\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\n\ntype UserProfileLinkProps = {\n  userId: string;\n  name: string;\n  avatarUrl?: string | null;\n  showAvatar?: boolean;\n  className?: string;\n};\n\nexport function UserProfileLink({ \n  userId, \n  name, \n  avatarUrl, \n  showAvatar = true,\n  className = \"\" \n}: UserProfileLinkProps) {\n  return (\n    <Link \n      href={`/profile/${userId}`}\n      className={`flex items-center gap-2 hover-elevate rounded-md px-1 py-0.5 ${className}`}\n      data-testid={`link-profile-${userId}`}\n    >\n      {showAvatar && (\n        <Avatar className=\"h-6 w-6\">\n          <AvatarImage src={avatarUrl || undefined} />\n          <AvatarFallback>{name.charAt(0)}</AvatarFallback>\n        </Avatar>\n      )}\n      <span className=\"font-medium\">{name}</span>\n    </Link>\n  );\n}\n","path":null,"size_bytes":860,"size_tokens":null},"client/src/pages/event-detail.tsx":{"content":"import { useRoute, Link } from \"wouter\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Calendar, Clock, MapPin, User as UserIcon, ArrowLeft } from \"lucide-react\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ntype Event = {\n  id: string;\n  title: string;\n  description: string | null;\n  eventType: string;\n  scopeId: string | null;\n  startTime: string;\n  endTime: string | null;\n  location: string | null;\n  imageUrl: string | null;\n  createdById: string;\n  createdAt: string;\n};\n\ntype User = {\n  id: string;\n  username: string;\n  photoUrl: string | null;\n};\n\ntype RSVP = {\n  eventId: string;\n};\n\nexport default function EventDetail() {\n  const [, params] = useRoute(\"/events/:id\");\n  const { toast } = useToast();\n  const eventId = params?.id;\n\n  const { data: event, isLoading: eventLoading } = useQuery<Event>({\n    queryKey: [`/api/events/${eventId}`],\n    enabled: !!eventId,\n  });\n\n  const { data: user } = useQuery<User>({\n    queryKey: [\"/api/auth/me\"],\n  });\n\n  const { data: rsvps = [] } = useQuery<RSVP[]>({\n    queryKey: [\"/api/rsvps\"],\n    enabled: !!user,\n  });\n\n  const { data: attendees = [] } = useQuery<User[]>({\n    queryKey: [`/api/events/${eventId}/attendees`],\n    enabled: !!eventId,\n  });\n\n  const isRsvped = rsvps.some(r => r.eventId === eventId);\n\n  const rsvpMutation = useMutation({\n    mutationFn: async () => {\n      return await apiRequest(\"POST\", `/api/events/${eventId}/rsvp`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/rsvps\"] });\n      queryClient.invalidateQueries({ queryKey: [`/api/events/${eventId}/attendees`] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/events\"] });\n      toast({\n        title: \"Success\",\n        description: isRsvped ? \"RSVP cancelled\" : \"RSVP confirmed!\",\n      });\n    },\n    onError: () => {\n      toast({\n        variant: \"destructive\",\n        title: \"Error\",\n        description: \"Failed to update RSVP\",\n      });\n    },\n  });\n\n  if (eventLoading) {\n    return (\n      <div className=\"h-full overflow-y-auto\">\n        <div className=\"max-w-4xl mx-auto p-6\">\n          <Skeleton className=\"h-10 w-64 mb-6\" />\n          <Skeleton className=\"h-96 w-full\" />\n        </div>\n      </div>\n    );\n  }\n\n  if (!event) {\n    return (\n      <div className=\"h-full overflow-y-auto\">\n        <div className=\"max-w-4xl mx-auto p-6\">\n          <Card>\n            <CardContent className=\"flex flex-col items-center justify-center py-12 text-center\">\n              <Calendar className=\"w-12 h-12 text-muted-foreground mb-4\" />\n              <h3 className=\"text-lg font-semibold mb-2\">Event Not Found</h3>\n              <p className=\"text-sm text-muted-foreground max-w-md mb-4\">\n                The event you're looking for doesn't exist or has been removed.\n              </p>\n              <Link href=\"/schedule\">\n                <Button>\n                  <ArrowLeft className=\"w-4 h-4 mr-2\" />\n                  Back to Schedule\n                </Button>\n              </Link>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    );\n  }\n\n  const startDate = new Date(event.startTime);\n  const endDate = event.endTime ? new Date(event.endTime) : null;\n\n  return (\n    <div className=\"h-full overflow-y-auto\">\n      <div className=\"max-w-4xl mx-auto p-6 space-y-6\">\n        <div>\n          <Link href=\"/schedule\">\n            <Button variant=\"ghost\" size=\"sm\" className=\"mb-4\" data-testid=\"button-back\">\n              <ArrowLeft className=\"w-4 h-4 mr-2\" />\n              Back to Schedule\n            </Button>\n          </Link>\n          <h1 className=\"text-3xl font-bold flex items-center gap-3\">\n            <Calendar className=\"w-8 h-8\" />\n            {event.title}\n          </h1>\n        </div>\n\n        <Card>\n          <CardContent className=\"p-6\">\n            {event.imageUrl && (\n              <div className=\"mb-6 rounded-lg overflow-hidden\">\n                <img\n                  src={event.imageUrl}\n                  alt={event.title}\n                  className=\"w-full h-64 object-cover\"\n                />\n              </div>\n            )}\n\n            <div className=\"space-y-4\">\n              <div>\n                <h3 className=\"text-sm font-medium text-muted-foreground mb-2\">Description</h3>\n                <p className=\"text-base\">\n                  {event.description || \"No description provided\"}\n                </p>\n              </div>\n\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                <div>\n                  <h3 className=\"text-sm font-medium text-muted-foreground mb-2 flex items-center gap-2\">\n                    <Clock className=\"w-4 h-4\" />\n                    Start Time\n                  </h3>\n                  <p className=\"text-base\">\n                    {startDate.toLocaleDateString('en-US', {\n                      weekday: 'long',\n                      year: 'numeric',\n                      month: 'long',\n                      day: 'numeric',\n                      hour: 'numeric',\n                      minute: '2-digit',\n                    })}\n                  </p>\n                </div>\n\n                {endDate && (\n                  <div>\n                    <h3 className=\"text-sm font-medium text-muted-foreground mb-2 flex items-center gap-2\">\n                      <Clock className=\"w-4 h-4\" />\n                      End Time\n                    </h3>\n                    <p className=\"text-base\">\n                      {endDate.toLocaleDateString('en-US', {\n                        weekday: 'long',\n                        year: 'numeric',\n                        month: 'long',\n                        day: 'numeric',\n                        hour: 'numeric',\n                        minute: '2-digit',\n                      })}\n                    </p>\n                  </div>\n                )}\n\n                {event.location && (\n                  <div>\n                    <h3 className=\"text-sm font-medium text-muted-foreground mb-2 flex items-center gap-2\">\n                      <MapPin className=\"w-4 h-4\" />\n                      Location\n                    </h3>\n                    <p className=\"text-base\">{event.location}</p>\n                  </div>\n                )}\n\n                <div>\n                  <h3 className=\"text-sm font-medium text-muted-foreground mb-2\">Event Type</h3>\n                  <p className=\"text-base capitalize\">{event.eventType.replace('_', ' ')}</p>\n                </div>\n              </div>\n\n              <div className=\"pt-4\">\n                <Button\n                  onClick={() => rsvpMutation.mutate()}\n                  disabled={rsvpMutation.isPending}\n                  variant={isRsvped ? \"outline\" : \"default\"}\n                  className=\"w-full md:w-auto\"\n                  data-testid=\"button-rsvp\"\n                >\n                  {rsvpMutation.isPending\n                    ? \"Processing...\"\n                    : isRsvped\n                    ? \"Cancel RSVP\"\n                    : \"RSVP to Event\"}\n                </Button>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>Attendees ({attendees.length})</CardTitle>\n            <CardDescription>\n              People who have RSVPed to this event\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            {attendees.length === 0 ? (\n              <p className=\"text-sm text-muted-foreground text-center py-4\">\n                No attendees yet. Be the first to RSVP!\n              </p>\n            ) : (\n              <div className=\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3\">\n                {attendees.map((attendee) => (\n                  <Link\n                    key={attendee.id}\n                    href={`/profile/${attendee.id}`}\n                    className=\"flex items-center gap-3 p-3 rounded-lg border hover-elevate\"\n                    data-testid={`attendee-${attendee.id}`}\n                  >\n                    <Avatar className=\"w-10 h-10\">\n                      <AvatarImage src={attendee.photoUrl || undefined} />\n                      <AvatarFallback>\n                        <UserIcon className=\"w-5 h-5\" />\n                      </AvatarFallback>\n                    </Avatar>\n                    <div className=\"flex-1 min-w-0\">\n                      <p className=\"text-sm font-medium truncate\">\n                        {attendee.username}\n                      </p>\n                    </div>\n                  </Link>\n                ))}\n              </div>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":9037,"size_tokens":null},"client/src/contexts/theme.tsx":{"content":"import { createContext, useContext, useEffect, useState } from \"react\";\n\ntype Theme = \"light\" | \"dark\";\n\ninterface ThemeContextType {\n  theme: Theme;\n  toggleTheme: () => void;\n}\n\nconst ThemeContext = createContext<ThemeContextType | undefined>(undefined);\n\nexport function ThemeProvider({ children }: { children: React.ReactNode }) {\n  const [theme, setTheme] = useState<Theme>(() => {\n    const stored = localStorage.getItem(\"theme\");\n    if (stored === \"light\" || stored === \"dark\") {\n      return stored;\n    }\n    return window.matchMedia(\"(prefers-color-scheme: dark)\").matches\n      ? \"dark\"\n      : \"light\";\n  });\n\n  useEffect(() => {\n    localStorage.setItem(\"theme\", theme);\n    if (theme === \"dark\") {\n      document.documentElement.classList.add(\"dark\");\n    } else {\n      document.documentElement.classList.remove(\"dark\");\n    }\n  }, [theme]);\n\n  const toggleTheme = () => {\n    setTheme((prev) => (prev === \"light\" ? \"dark\" : \"light\"));\n  };\n\n  return (\n    <ThemeContext.Provider value={{ theme, toggleTheme }}>\n      {children}\n    </ThemeContext.Provider>\n  );\n}\n\nexport function useTheme() {\n  const context = useContext(ThemeContext);\n  if (context === undefined) {\n    throw new Error(\"useTheme must be used within a ThemeProvider\");\n  }\n  return context;\n}\n","path":null,"size_bytes":1279,"size_tokens":null},"attached_assets/content-1763829924052.md":{"content":"School Community\n\nJoin your school's digital ecosystem\n\nLoginRegister\n\nUsername\n\nPassword\n\nLogin","path":null,"size_bytes":96,"size_tokens":null},"client/src/pages/support.tsx":{"content":"import { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Form, FormControl, FormDescription, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { useUser } from \"@/hooks/use-user\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { Heart, ExternalLink, Settings } from \"lucide-react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\n\ntype DonationUrlResponse = {\n  url: string | null;\n};\n\nconst donationUrlSchema = z.object({\n  url: z.string().url(\"Please enter a valid URL\").min(1, \"URL is required\"),\n});\n\ntype DonationUrlFormData = z.infer<typeof donationUrlSchema>;\n\nexport default function SupportPage() {\n  const { user } = useUser();\n  const { toast } = useToast();\n\n  const { data, isLoading } = useQuery<DonationUrlResponse>({\n    queryKey: [\"/api/settings/donation-url\"],\n  });\n\n  const form = useForm<DonationUrlFormData>({\n    resolver: zodResolver(donationUrlSchema),\n    defaultValues: {\n      url: \"\",\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async (formData: DonationUrlFormData) => {\n      return await apiRequest(\"PUT\", \"/api/admin/settings/donation-url\", formData);\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Success\",\n        description: \"Donation URL updated successfully\",\n      });\n      queryClient.invalidateQueries({ queryKey: [\"/api/settings/donation-url\"] });\n      form.reset();\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to update donation URL\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const onSubmit = (formData: DonationUrlFormData) => {\n    updateMutation.mutate(formData);\n  };\n\n  const handleSupport = () => {\n    if (data?.url) {\n      window.open(data.url, \"_blank\", \"noopener,noreferrer\");\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"container mx-auto p-6 max-w-7xl\">\n        <div className=\"animate-pulse space-y-6\">\n          <div className=\"h-12 bg-muted rounded w-1/4\" data-testid=\"skeleton-title\" />\n          <div className=\"h-64 bg-muted rounded\" data-testid=\"skeleton-content\" />\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"container mx-auto p-6 max-w-4xl space-y-6\">\n      <div className=\"space-y-2\">\n        <h1 className=\"text-4xl font-bold tracking-tight\" data-testid=\"text-page-title\">\n          Support\n        </h1>\n        <p className=\"text-base text-muted-foreground\" data-testid=\"text-page-description\">\n          {user?.role === \"admin\" \n            ? \"Configure donation settings for the platform\"\n            : \"Support the creator and help keep this platform running\"}\n        </p>\n      </div>\n\n      {user?.role === \"admin\" ? (\n        <Card data-testid=\"card-admin-config\">\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-2\">\n              <Settings className=\"w-5 h-5\" />\n              Donation Configuration\n            </CardTitle>\n            <CardDescription>\n              Set the external donation URL (e.g., Stripe, PayPal, Buy Me a Coffee). No credit card information is stored on this platform.\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-6\">\n            <div className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"current-url\">Current Donation URL</Label>\n                <div className=\"flex items-center gap-2\">\n                  {data?.url ? (\n                    <>\n                      <Input\n                        id=\"current-url\"\n                        value={data.url}\n                        readOnly\n                        className=\"flex-1\"\n                        data-testid=\"input-current-url\"\n                      />\n                      <Button\n                        variant=\"outline\"\n                        size=\"icon\"\n                        onClick={() => window.open(data.url!, \"_blank\", \"noopener,noreferrer\")}\n                        data-testid=\"button-test-url\"\n                      >\n                        <ExternalLink className=\"w-4 h-4\" />\n                      </Button>\n                    </>\n                  ) : (\n                    <p className=\"text-sm text-muted-foreground\" data-testid=\"text-no-url\">\n                      No donation URL configured yet\n                    </p>\n                  )}\n                </div>\n              </div>\n\n              <Form {...form}>\n                <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"url\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>\n                          {data?.url ? \"Update Donation URL\" : \"Set Donation URL\"}\n                        </FormLabel>\n                        <FormControl>\n                          <Input\n                            type=\"url\"\n                            placeholder=\"https://buymeacoffee.com/yourname\"\n                            data-testid=\"input-donation-url\"\n                            {...field}\n                          />\n                        </FormControl>\n                        <FormDescription>\n                          Examples: Stripe Checkout, PayPal.me, Buy Me a Coffee, Ko-fi\n                        </FormDescription>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n\n                  <Button\n                    type=\"submit\"\n                    disabled={updateMutation.isPending}\n                    data-testid=\"button-save-url\"\n                  >\n                    {updateMutation.isPending ? \"Saving...\" : \"Save URL\"}\n                  </Button>\n                </form>\n              </Form>\n            </div>\n\n            <div className=\"pt-4 border-t\">\n              <h3 className=\"font-semibold mb-2\">Important Notes</h3>\n              <ul className=\"text-sm text-muted-foreground space-y-1 list-disc list-inside\">\n                <li>This platform does NOT store credit card information</li>\n                <li>Users will be redirected to your external payment processor</li>\n                <li>Make sure the URL is publicly accessible and secure (HTTPS)</li>\n                <li>Test the URL before saving to ensure it works correctly</li>\n              </ul>\n            </div>\n          </CardContent>\n        </Card>\n      ) : (\n        <div className=\"space-y-6\">\n          <Card data-testid=\"card-user-support\">\n            <CardContent className=\"p-8\">\n              <div className=\"text-center space-y-6\">\n                <div className=\"flex justify-center\" data-testid=\"icon-heart-container\">\n                  <div className=\"w-20 h-20 rounded-full bg-primary/10 flex items-center justify-center\">\n                    <Heart className=\"w-10 h-10 text-primary\" />\n                  </div>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <h2 className=\"text-2xl font-bold\" data-testid=\"text-support-heading\">\n                    Support the Creator\n                  </h2>\n                  <p className=\"text-muted-foreground max-w-md mx-auto\" data-testid=\"text-support-description\">\n                    This platform is made possible by community support. Your contribution helps maintain and improve the platform for everyone.\n                  </p>\n                </div>\n\n                {data?.url ? (\n                  <div className=\"space-y-4\">\n                    <Button\n                      size=\"lg\"\n                      onClick={handleSupport}\n                      className=\"gap-2\"\n                      data-testid=\"button-support-creator\"\n                    >\n                      <Heart className=\"w-5 h-5\" />\n                      Support the Creator\n                    </Button>\n                    <p className=\"text-xs text-muted-foreground\" data-testid=\"text-redirect-notice\">\n                      You'll be redirected to a secure external payment page\n                    </p>\n                  </div>\n                ) : (\n                  <div className=\"space-y-2\" data-testid=\"text-no-donation-configured\">\n                    <p className=\"text-muted-foreground\">\n                      Donation support is not currently configured.\n                    </p>\n                    <p className=\"text-sm text-muted-foreground\">\n                      Please check back later or contact the administrator.\n                    </p>\n                  </div>\n                )}\n              </div>\n            </CardContent>\n          </Card>\n\n          <Card data-testid=\"card-why-support\">\n            <CardHeader>\n              <CardTitle className=\"text-lg\">Why Support?</CardTitle>\n            </CardHeader>\n            <CardContent className=\"space-y-3\">\n              <div className=\"space-y-2\">\n                <h4 className=\"font-semibold text-sm\" data-testid=\"text-benefit-heading-1\">\n                  Platform Maintenance\n                </h4>\n                <p className=\"text-sm text-muted-foreground\" data-testid=\"text-benefit-description-1\">\n                  Keep the servers running and ensure smooth performance for all users.\n                </p>\n              </div>\n              <div className=\"space-y-2\">\n                <h4 className=\"font-semibold text-sm\" data-testid=\"text-benefit-heading-2\">\n                  New Features\n                </h4>\n                <p className=\"text-sm text-muted-foreground\" data-testid=\"text-benefit-description-2\">\n                  Support helps fund development of new features and improvements.\n                </p>\n              </div>\n              <div className=\"space-y-2\">\n                <h4 className=\"font-semibold text-sm\" data-testid=\"text-benefit-heading-3\">\n                  Community Growth\n                </h4>\n                <p className=\"text-sm text-muted-foreground\" data-testid=\"text-benefit-description-3\">\n                  Contributions enable us to expand and better serve the community.\n                </p>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":10649,"size_tokens":null},"ADMIN_SETUP.md":{"content":"# Admin Account Setup Instructions\n\n## Default Admin Accounts\n\nThe system comes with two pre-configured admin accounts that need to be seeded in your database:\n\n### Account 1\n- **Name**: Mahmood Fawaz AL-Faqi\n- **Username**: `Mahmood.Fawaz.AL-Faqi`\n- **Student ID**: ADMIN001\n- **Email**: mahmood.alfaqi@school.edu\n- **Password**: `NOTHINg27$`\n\n### Account 2\n- **Name**: Mustafa Mouied Al-Ali\n- **Username**: `Mustafa.Mouied.Al-Ali`\n- **Student ID**: ADMIN002\n- **Email**: mustafa.alali@school.edu\n- **Password**: `NOTHINg27$`\n\n## How to Seed Admin Accounts\n\n### For Development (Replit Environment)\nRun the following command in the shell:\n\n```bash\ntsx server/seed-admins.ts\n```\n\n### For Production\n1. Open the Replit Shell\n2. Run the seed script:\n   ```bash\n   tsx server/seed-admins.ts\n   ```\n3. The script will:\n   - Create both admin accounts if they don't already exist\n   - Skip creation if accounts already exist\n   - Create associated student ID records\n   - Hash the password securely before storage\n\n## Login to Admin Accounts\n\nOnce seeded, you can log in using:\n1. Navigate to the login page\n2. Use one of the usernames above\n3. Enter the password: `NOTHINg27$`\n\n## Admin Features\n\nOnce logged in as an admin, you will have access to:\n\n### Admin Management Page\n- **Generate Student IDs**: Create new student registration IDs\n- **Manage Student Accounts**: View and delete student accounts\n- **Promote to Admin**: Grant admin privileges to students without losing your own admin status\n\n### Admin Promotion (Inheritance)\nThe new \"Promote to Admin\" feature allows you to:\n- Select any student from the dropdown\n- Promote them to admin role\n- **Keep your own admin privileges** (this is different from the \"handover\" feature)\n- Multiple admins can exist simultaneously\n\n### Handover vs. Promotion\n- **Handover**: Transfers admin privileges to another user and demotes you to student\n- **Promotion** (New): Grants admin privileges to a student while you remain an admin\n\n## Security Notes\n\n- The default password should be changed after first login\n- Admin accounts are marked with `isSpecialAdmin: true` flag\n- All passwords are hashed using bcrypt before storage\n- Admin privileges are required to access `/admin` routes\n\n## Troubleshooting\n\nIf you encounter issues:\n1. Make sure the database is running and accessible\n2. Check that the `DATABASE_URL` environment variable is set correctly\n3. Review the console output for any error messages\n4. The script is idempotent - it's safe to run multiple times\n","path":null,"size_bytes":2514,"size_tokens":null},"client/src/pages/forgot-password.tsx":{"content":"import { useState } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { AlertCircle, ArrowLeft } from \"lucide-react\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\n\nexport default function ForgotPasswordPage() {\n  const [, navigate] = useLocation();\n  const { toast } = useToast();\n  const [step, setStep] = useState<\"request\" | \"reset\">(\"request\");\n  const [email, setEmail] = useState(\"\");\n  const [token, setToken] = useState(\"\");\n  const [newPassword, setNewPassword] = useState(\"\");\n  const [confirmPassword, setConfirmPassword] = useState(\"\");\n\n  const requestResetMutation = useMutation({\n    mutationFn: async (email: string) => {\n      return await apiRequest(\"POST\", \"/api/auth/forgot-password\", { email });\n    },\n    onSuccess: (data: any) => {\n      toast({\n        title: \"Password reset token sent\",\n        description: \"Check your email for the reset link\",\n      });\n      if (data.token) {\n        setToken(data.token);\n        setStep(\"reset\");\n      }\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Error\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const resetPasswordMutation = useMutation({\n    mutationFn: async (data: { token: string; newPassword: string }) => {\n      return await apiRequest(\"POST\", \"/api/auth/reset-password\", data);\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Password reset successful\",\n        description: \"You can now login with your new password\",\n      });\n      navigate(\"/auth\");\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Reset failed\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleRequestReset = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!email) {\n      toast({\n        title: \"Email required\",\n        description: \"Please enter your email address\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    requestResetMutation.mutate(email);\n  };\n\n  const handleResetPassword = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (!token) {\n      toast({\n        title: \"Token required\",\n        description: \"Please enter the reset token from your email\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    if (newPassword !== confirmPassword) {\n      toast({\n        title: \"Passwords don't match\",\n        description: \"Please make sure your passwords match\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    if (newPassword.length < 6) {\n      toast({\n        title: \"Password too short\",\n        description: \"Password must be at least 6 characters\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n    resetPasswordMutation.mutate({ token, newPassword });\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-primary/10 to-secondary/10 flex items-center justify-center p-4\">\n      <Card className=\"w-full max-w-md\">\n        <CardHeader>\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <CardTitle>Reset Password</CardTitle>\n              <CardDescription>\n                {step === \"request\"\n                  ? \"Enter your email to receive a reset token\"\n                  : \"Enter your reset token and new password\"}\n              </CardDescription>\n            </div>\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              onClick={() => navigate(\"/auth\")}\n              data-testid=\"button-back-to-auth\"\n            >\n              <ArrowLeft className=\"w-4 h-4\" />\n            </Button>\n          </div>\n        </CardHeader>\n        <CardContent>\n          {step === \"request\" ? (\n            <form onSubmit={handleRequestReset} className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"email\">Email Address</Label>\n                <Input\n                  id=\"email\"\n                  type=\"email\"\n                  placeholder=\"your.email@example.com\"\n                  value={email}\n                  onChange={(e) => setEmail(e.target.value)}\n                  data-testid=\"input-forgot-email\"\n                />\n              </div>\n              <Button\n                type=\"submit\"\n                className=\"w-full\"\n                disabled={requestResetMutation.isPending}\n                data-testid=\"button-request-reset\"\n              >\n                {requestResetMutation.isPending\n                  ? \"Sending...\"\n                  : \"Send Reset Link\"}\n              </Button>\n            </form>\n          ) : (\n            <form onSubmit={handleResetPassword} className=\"space-y-4\">\n              <Alert>\n                <AlertCircle className=\"h-4 w-4\" />\n                <AlertDescription>\n                  A reset token has been generated. If you don't see it above, check your email.\n                </AlertDescription>\n              </Alert>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"token\">Reset Token</Label>\n                <Input\n                  id=\"token\"\n                  placeholder=\"Enter token from email\"\n                  value={token}\n                  onChange={(e) => setToken(e.target.value)}\n                  data-testid=\"input-reset-token\"\n                />\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"newPassword\">New Password</Label>\n                <Input\n                  id=\"newPassword\"\n                  type=\"password\"\n                  placeholder=\"At least 6 characters\"\n                  value={newPassword}\n                  onChange={(e) => setNewPassword(e.target.value)}\n                  data-testid=\"input-new-password\"\n                />\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"confirmPassword\">Confirm Password</Label>\n                <Input\n                  id=\"confirmPassword\"\n                  type=\"password\"\n                  placeholder=\"Confirm your password\"\n                  value={confirmPassword}\n                  onChange={(e) => setConfirmPassword(e.target.value)}\n                  data-testid=\"input-confirm-password\"\n                />\n              </div>\n\n              <Button\n                type=\"submit\"\n                className=\"w-full\"\n                disabled={resetPasswordMutation.isPending}\n                data-testid=\"button-submit-reset\"\n              >\n                {resetPasswordMutation.isPending\n                  ? \"Resetting...\"\n                  : \"Reset Password\"}\n              </Button>\n\n              <Button\n                type=\"button\"\n                variant=\"outline\"\n                className=\"w-full\"\n                onClick={() => {\n                  setStep(\"request\");\n                  setToken(\"\");\n                  setNewPassword(\"\");\n                  setConfirmPassword(\"\");\n                }}\n                data-testid=\"button-back-to-email\"\n              >\n                Back\n              </Button>\n            </form>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":7547,"size_tokens":null},"server/seed-scopes.ts":{"content":"import { storage } from \"./storage\";\n\n/**\n * Seed scopes and access codes on server startup\n * Safe to run multiple times - checks for existing data first\n */\nexport async function seedScopes() {\n  try {\n    console.log(\"[SEED] Checking scopes initialization...\");\n    \n    // Check if scopes already exist\n    const existingScopes = await storage.getAllScopes();\n    if (existingScopes && existingScopes.length > 0) {\n      console.log(`[SEED] ✓ Found ${existingScopes.length} existing scopes, skipping seed`);\n      return;\n    }\n    \n    console.log(\"[SEED] 🌱 No scopes found, initializing default scopes...\");\n    \n    // Public Square Scope (always accessible, no access code needed)\n    await storage.createScope({\n      name: \"Public Square\",\n      type: \"public\",\n      accessCode: null,\n    });\n    console.log(`[SEED] ✓ Created public square scope`);\n    \n    // Grade Scopes (6 grades)\n    const gradeScopes = [\n      { grade: 1, accessCode: \"gaDrIE5Lo0\" },\n      { grade: 2, accessCode: \"SolELo74F\" },\n      { grade: 3, accessCode: \"3FojUvCk02\" },\n      { grade: 4, accessCode: \"Dm8OnmTj5\" },\n      { grade: 5, accessCode: \"BloIfc63CjH\" },\n      { grade: 6, accessCode: \"tiKoEjN6A2\" },\n    ];\n    \n    for (const { grade, accessCode } of gradeScopes) {\n      await storage.createScope({\n        name: `Grade ${grade}`,\n        type: \"grade\",\n        gradeNumber: grade,\n        accessCode,\n      });\n    }\n    console.log(`[SEED] ✓ Created ${gradeScopes.length} grade scopes`);\n    \n    // Class Scopes (5 classes per grade: A, B, C, D, E)\n    const classScopes = [\n      // Grade 1\n      { grade: 1, section: \"A\", accessCode: \"jtKJdrDS9K\" },\n      { grade: 1, section: \"B\", accessCode: \"HJdr3cVj90p\" },\n      { grade: 1, section: \"C\", accessCode: \"Poij8gdf4s\" },\n      { grade: 1, section: \"D\", accessCode: \"Gytrf6J9lkyF\" },\n      { grade: 1, section: \"E\", accessCode: \"Sdfe57YIJkl\" },\n      // Grade 2\n      { grade: 2, section: \"A\", accessCode: \"juyGAY63D\" },\n      { grade: 2, section: \"B\", accessCode: \"LijKmnBesa3f\" },\n      { grade: 2, section: \"C\", accessCode: \"TcdsE7TkjO31\" },\n      { grade: 2, section: \"D\", accessCode: \"EcSfC7AhPsE7\" },\n      { grade: 2, section: \"E\", accessCode: \"FkhfUvCmjK75\" },\n      // Grade 3\n      { grade: 3, section: \"A\", accessCode: \"SkoiyHifI67T\" },\n      { grade: 3, section: \"B\", accessCode: \"NkuEfdRjyU8\" },\n      { grade: 3, section: \"C\", accessCode: \"Rover3Black\" },\n      { grade: 3, section: \"D\", accessCode: \"hgtyuGPT67\" },\n      { grade: 3, section: \"E\", accessCode: \"lsihyxXxfa645\" },\n      // Grade 4\n      { grade: 4, section: \"A\", accessCode: \"u7T59x92Gp\" },\n      { grade: 4, section: \"B\", accessCode: \"XDfh65trfc\" },\n      { grade: 4, section: \"C\", accessCode: \"Lokoko6768h\" },\n      { grade: 4, section: \"D\", accessCode: \"FOwO7cEjMBjOfY75\" },\n      { grade: 4, section: \"E\", accessCode: \"GjiAfdYk75\" },\n      // Grade 5\n      { grade: 5, section: \"A\", accessCode: \"Mahmood75fd5\" },\n      { grade: 5, section: \"B\", accessCode: \"Senpai8YDf\" },\n      { grade: 5, section: \"C\", accessCode: \"SHkjtfOnmjT76d\" },\n      { grade: 5, section: \"D\", accessCode: \"911EMERGENCY9\" },\n      { grade: 5, section: \"E\", accessCode: \"Htsxd44Ate\" },\n      // Grade 6\n      { grade: 6, section: \"A\", accessCode: \"FoFo6ds5Boy\" },\n      { grade: 6, section: \"B\", accessCode: \"LmjuOdV5E\" },\n      { grade: 6, section: \"C\", accessCode: \"THX53dciyilG\" },\n      { grade: 6, section: \"D\", accessCode: \"legfsxrtut7\" },\n      { grade: 6, section: \"E\", accessCode: \"AREURIGHT7\" },\n    ];\n    \n    for (const { grade, section, accessCode } of classScopes) {\n      const sectionName = `${grade}-${section}`;\n      await storage.createScope({\n        name: `Class ${sectionName}`,\n        type: \"section\",\n        sectionName,\n        accessCode,\n      });\n    }\n    \n    console.log(`[SEED] ✓ Created ${classScopes.length} class section scopes`);\n    console.log(`[SEED] ✅ Scope initialization complete! (1 public + ${gradeScopes.length} grades + ${classScopes.length} class sections)`);\n    \n  } catch (error) {\n    console.error(\"[SEED] ❌ Failed to seed scopes:\", error);\n    // Don't throw - allow server to continue running\n  }\n}\n","path":null,"size_bytes":4183,"size_tokens":null},"client/src/components/HexagonTendencyChart.tsx":{"content":"import { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Edit2 } from \"lucide-react\";\nimport { RadarChart, Radar, PolarGrid, PolarAngleAxis, PolarRadiusAxis, ResponsiveContainer } from \"recharts\";\n\ntype HexagonMetric = {\n  metric: string;\n  arabicLabel: string;\n  value: number;\n  max: number;\n};\n\ntype HexagonTendencyChartProps = {\n  title: string;\n  description: string;\n  metrics: HexagonMetric[];\n  color: string;\n  isOwnProfile: boolean;\n  onEdit?: () => void;\n};\n\nexport function HexagonTendencyChart({\n  title,\n  description,\n  metrics,\n  color,\n  isOwnProfile,\n  onEdit,\n}: HexagonTendencyChartProps) {\n  const totalPoints = metrics.reduce((sum, m) => sum + m.value, 0);\n  const maxTotalPoints = 33;\n\n  const chartData = metrics.map((m) => ({\n    metric: m.arabicLabel,\n    value: m.value,\n    fullMark: m.max,\n  }));\n\n  return (\n    <Card data-testid={`card-${title.toLowerCase().replace(/\\s+/g, \"-\")}`}>\n      <CardHeader>\n        <div className=\"flex items-center justify-between gap-2\">\n          <div className=\"flex-1\">\n            <CardTitle className=\"text-lg\">{title}</CardTitle>\n            <CardDescription>{description}</CardDescription>\n          </div>\n          {isOwnProfile && onEdit && (\n            <Button\n              size=\"sm\"\n              variant=\"outline\"\n              onClick={onEdit}\n              data-testid={`button-edit-${title.toLowerCase().replace(/\\s+/g, \"-\")}`}\n            >\n              <Edit2 className=\"w-3 h-3 mr-1\" />\n              Edit\n            </Button>\n          )}\n        </div>\n      </CardHeader>\n      <CardContent>\n        <div className=\"flex flex-col gap-4\">\n          <div className=\"h-64\">\n            <ResponsiveContainer width=\"100%\" height=\"100%\">\n              <RadarChart data={chartData}>\n                <PolarGrid strokeDasharray=\"3 3\" />\n                <PolarAngleAxis \n                  dataKey=\"metric\" \n                  tick={{ fill: \"hsl(var(--foreground))\", fontSize: 11 }}\n                />\n                <PolarRadiusAxis angle={90} domain={[0, 10]} tick={{ fontSize: 10 }} />\n                <Radar\n                  name={title}\n                  dataKey=\"value\"\n                  stroke={color}\n                  fill={color}\n                  fillOpacity={0.6}\n                />\n              </RadarChart>\n            </ResponsiveContainer>\n          </div>\n\n          <div className=\"grid grid-cols-2 gap-2 text-sm\">\n            {metrics.map((m) => (\n              <div\n                key={m.metric}\n                className=\"flex items-center justify-between p-2 rounded-md bg-muted/30\"\n                data-testid={`metric-${m.metric}`}\n              >\n                <span className=\"text-xs text-muted-foreground truncate\">{m.arabicLabel}</span>\n                <span className=\"font-medium ml-2\">{m.value}/10</span>\n              </div>\n            ))}\n          </div>\n\n          <div className=\"flex items-center justify-between pt-2 border-t\">\n            <span className=\"text-sm font-medium\">Total Points Used:</span>\n            <span className={`text-lg font-bold ${totalPoints > maxTotalPoints ? \"text-destructive\" : \"text-primary\"}`}>\n              {totalPoints}/{maxTotalPoints}\n            </span>\n          </div>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","path":null,"size_bytes":3383,"size_tokens":null}},"version":2}